
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
  "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">

<html xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta http-equiv="X-UA-Compatible" content="IE=Edge" />
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    <title>Variogram Point Cloud - tutorial &#8212; Pyinterpolate 0.2.3 documentation</title>
    <link rel="stylesheet" href="../_static/alabaster.css" type="text/css" />
    <link rel="stylesheet" href="../_static/pygments.css" type="text/css" />
    <script type="text/javascript" id="documentation_options" data-url_root="../" src="../_static/documentation_options.js"></script>
    <script type="text/javascript" src="../_static/jquery.js"></script>
    <script type="text/javascript" src="../_static/underscore.js"></script>
    <script type="text/javascript" src="../_static/doctools.js"></script>
    <script type="text/javascript" src="../_static/language_data.js"></script>
    <script crossorigin="anonymous" integrity="sha256-Ae2Vz/4ePdIu6ZyI/5ZGsYnb+m0JlOmKPjt6XZ9JJkA=" type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/require.js/2.3.4/require.min.js"></script>
    <script async="async" type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/latest.js?config=TeX-AMS-MML_HTMLorMML"></script>
    <script type="text/x-mathjax-config">MathJax.Hub.Config({"tex2jax": {"inlineMath": [["$", "$"], ["\\(", "\\)"]], "processEscapes": true, "ignoreClass": "tex2jax_ignore|mathjax_ignore|document", "processClass": "tex2jax_process|mathjax_process|math|output_area"}})</script>
    <link rel="index" title="Index" href="../genindex.html" />
    <link rel="search" title="Search" href="../search.html" />
    <link rel="next" title="Semivariogram calculation - tutorial" href="Semivariogram Estimation (Basic).html" />
    <link rel="prev" title="Tutorials" href="../tutorials.html" />
   
  <link rel="stylesheet" href="../_static/custom.css" type="text/css" />
  
  
  <meta name="viewport" content="width=device-width, initial-scale=0.9, maximum-scale=0.9" />

  </head><body>
  

    <div class="document">
      <div class="documentwrapper">
        <div class="bodywrapper">
          

          <div class="body" role="main">
            
  
<style>
/* CSS for nbsphinx extension */

/* remove conflicting styling from Sphinx themes */
div.nbinput.container div.prompt *,
div.nboutput.container div.prompt *,
div.nbinput.container div.input_area pre,
div.nboutput.container div.output_area pre,
div.nbinput.container div.input_area .highlight,
div.nboutput.container div.output_area .highlight {
    border: none;
    padding: 0;
    margin: 0;
    box-shadow: none;
}

div.nbinput.container > div[class*=highlight],
div.nboutput.container > div[class*=highlight] {
    margin: 0;
}

div.nbinput.container div.prompt *,
div.nboutput.container div.prompt * {
    background: none;
}

div.nboutput.container div.output_area .highlight,
div.nboutput.container div.output_area pre {
    background: unset;
}

div.nboutput.container div.output_area div.highlight {
    color: unset;  /* override Pygments text color */
}

/* avoid gaps between output lines */
div.nboutput.container div[class*=highlight] pre {
    line-height: normal;
}

/* input/output containers */
div.nbinput.container,
div.nboutput.container {
    display: -webkit-flex;
    display: flex;
    align-items: flex-start;
    margin: 0;
    width: 100%;
}
@media (max-width: 540px) {
    div.nbinput.container,
    div.nboutput.container {
        flex-direction: column;
    }
}

/* input container */
div.nbinput.container {
    padding-top: 5px;
}

/* last container */
div.nblast.container {
    padding-bottom: 5px;
}

/* input prompt */
div.nbinput.container div.prompt pre {
    color: #307FC1;
}

/* output prompt */
div.nboutput.container div.prompt pre {
    color: #BF5B3D;
}

/* all prompts */
div.nbinput.container div.prompt,
div.nboutput.container div.prompt {
    width: 4.5ex;
    padding-top: 5px;
    position: relative;
    user-select: none;
}

div.nbinput.container div.prompt > div,
div.nboutput.container div.prompt > div {
    position: absolute;
    right: 0;
    margin-right: 0.3ex;
}

@media (max-width: 540px) {
    div.nbinput.container div.prompt,
    div.nboutput.container div.prompt {
        width: unset;
        text-align: left;
        padding: 0.4em;
    }
    div.nboutput.container div.prompt.empty {
        padding: 0;
    }

    div.nbinput.container div.prompt > div,
    div.nboutput.container div.prompt > div {
        position: unset;
    }
}

/* disable scrollbars on prompts */
div.nbinput.container div.prompt pre,
div.nboutput.container div.prompt pre {
    overflow: hidden;
}

/* input/output area */
div.nbinput.container div.input_area,
div.nboutput.container div.output_area {
    -webkit-flex: 1;
    flex: 1;
    overflow: auto;
}
@media (max-width: 540px) {
    div.nbinput.container div.input_area,
    div.nboutput.container div.output_area {
        width: 100%;
    }
}

/* input area */
div.nbinput.container div.input_area {
    border: 1px solid #e0e0e0;
    border-radius: 2px;
    /*background: #f5f5f5;*/
}

/* override MathJax center alignment in output cells */
div.nboutput.container div[class*=MathJax] {
    text-align: left !important;
}

/* override sphinx.ext.imgmath center alignment in output cells */
div.nboutput.container div.math p {
    text-align: left;
}

/* standard error */
div.nboutput.container div.output_area.stderr {
    background: #fdd;
}

/* ANSI colors */
.ansi-black-fg { color: #3E424D; }
.ansi-black-bg { background-color: #3E424D; }
.ansi-black-intense-fg { color: #282C36; }
.ansi-black-intense-bg { background-color: #282C36; }
.ansi-red-fg { color: #E75C58; }
.ansi-red-bg { background-color: #E75C58; }
.ansi-red-intense-fg { color: #B22B31; }
.ansi-red-intense-bg { background-color: #B22B31; }
.ansi-green-fg { color: #00A250; }
.ansi-green-bg { background-color: #00A250; }
.ansi-green-intense-fg { color: #007427; }
.ansi-green-intense-bg { background-color: #007427; }
.ansi-yellow-fg { color: #DDB62B; }
.ansi-yellow-bg { background-color: #DDB62B; }
.ansi-yellow-intense-fg { color: #B27D12; }
.ansi-yellow-intense-bg { background-color: #B27D12; }
.ansi-blue-fg { color: #208FFB; }
.ansi-blue-bg { background-color: #208FFB; }
.ansi-blue-intense-fg { color: #0065CA; }
.ansi-blue-intense-bg { background-color: #0065CA; }
.ansi-magenta-fg { color: #D160C4; }
.ansi-magenta-bg { background-color: #D160C4; }
.ansi-magenta-intense-fg { color: #A03196; }
.ansi-magenta-intense-bg { background-color: #A03196; }
.ansi-cyan-fg { color: #60C6C8; }
.ansi-cyan-bg { background-color: #60C6C8; }
.ansi-cyan-intense-fg { color: #258F8F; }
.ansi-cyan-intense-bg { background-color: #258F8F; }
.ansi-white-fg { color: #C5C1B4; }
.ansi-white-bg { background-color: #C5C1B4; }
.ansi-white-intense-fg { color: #A1A6B2; }
.ansi-white-intense-bg { background-color: #A1A6B2; }

.ansi-default-inverse-fg { color: #FFFFFF; }
.ansi-default-inverse-bg { background-color: #000000; }

.ansi-bold { font-weight: bold; }
.ansi-underline { text-decoration: underline; }


div.nbinput.container div.input_area div[class*=highlight] > pre,
div.nboutput.container div.output_area div[class*=highlight] > pre,
div.nboutput.container div.output_area div[class*=highlight].math,
div.nboutput.container div.output_area.rendered_html,
div.nboutput.container div.output_area > div.output_javascript,
div.nboutput.container div.output_area:not(.rendered_html) > img{
    padding: 5px;
    margin: 0;
}

/* fix copybtn overflow problem in chromium (needed for 'sphinx_copybutton') */
div.nbinput.container div.input_area > div[class^='highlight'],
div.nboutput.container div.output_area > div[class^='highlight']{
    overflow-y: hidden;
}

/* hide copybtn icon on prompts (needed for 'sphinx_copybutton') */
.prompt a.copybtn {
    display: none;
}

/* Some additional styling taken form the Jupyter notebook CSS */
div.rendered_html table {
  border: none;
  border-collapse: collapse;
  border-spacing: 0;
  color: black;
  font-size: 12px;
  table-layout: fixed;
}
div.rendered_html thead {
  border-bottom: 1px solid black;
  vertical-align: bottom;
}
div.rendered_html tr,
div.rendered_html th,
div.rendered_html td {
  text-align: right;
  vertical-align: middle;
  padding: 0.5em 0.5em;
  line-height: normal;
  white-space: normal;
  max-width: none;
  border: none;
}
div.rendered_html th {
  font-weight: bold;
}
div.rendered_html tbody tr:nth-child(odd) {
  background: #f5f5f5;
}
div.rendered_html tbody tr:hover {
  background: rgba(66, 165, 245, 0.2);
}
</style>
<div class="section" id="Variogram-Point-Cloud---tutorial">
<h1>Variogram Point Cloud - tutorial<a class="headerlink" href="#Variogram-Point-Cloud---tutorial" title="Permalink to this headline">¶</a></h1>
<div class="section" id="Table-of-Contents:">
<h2>Table of Contents:<a class="headerlink" href="#Table-of-Contents:" title="Permalink to this headline">¶</a></h2>
<ol class="arabic simple">
<li>Read point data,</li>
<li>Set proper lag size with variogram cloud histogram,</li>
<li>Detect and remove outliers.</li>
<li>Calculate experimental semivariance from point cloud.</li>
</ol>
</div>
<div class="section" id="Level:-Basic">
<h2>Level: Basic<a class="headerlink" href="#Level:-Basic" title="Permalink to this headline">¶</a></h2>
</div>
<div class="section" id="Changelog">
<h2>Changelog<a class="headerlink" href="#Changelog" title="Permalink to this headline">¶</a></h2>
<table border="1" class="docutils">
<colgroup>
<col width="18%" />
<col width="59%" />
<col width="23%" />
</colgroup>
<thead valign="bottom">
<tr class="row-odd"><th class="head">Date</th>
<th class="head">Change description</th>
<th class="head">Author</th>
</tr>
</thead>
<tbody valign="top">
<tr class="row-even"><td>2021-12-13</td>
<td>Changed behavior of <code class="docutils literal notranslate"><span class="pre">select_values_in_range()</span></code> function</td>
<td>&#64;SimonMolinsky</td>
</tr>
<tr class="row-odd"><td>2021-10-13</td>
<td>Refactored TheoreticalSemivariogram (name change of class attribute) and refactored <code class="docutils literal notranslate"><span class="pre">calc_semivariance_from_pt_cloud()</span></code> function to protect calculations from <code class="docutils literal notranslate"><span class="pre">NaN's</span></code>.</td>
<td>&#64;ethmtrgt &amp; &#64;SimonMolinsky</td>
</tr>
<tr class="row-even"><td>2021-08-22</td>
<td>Refactored the Outlier Removal algorithm - quantile based algorithm</td>
<td>&#64;SimonMolinsky</td>
</tr>
<tr class="row-odd"><td>2021-08-10</td>
<td>Refactored the Outlier Removal algorithm</td>
<td>&#64;SimonMolinsky</td>
</tr>
<tr class="row-even"><td>2021-05-11</td>
<td>Refactored TheoreticalSemivariogram class</td>
<td>&#64;SimonMolinsky</td>
</tr>
<tr class="row-odd"><td>2021-03-31</td>
<td>Update related to the change of semivariogram weighting. Updated cancer rates data.</td>
<td>&#64;SimonMolinsky</td>
</tr>
</tbody>
</table>
</div>
<div class="section" id="Introduction">
<h2>Introduction<a class="headerlink" href="#Introduction" title="Permalink to this headline">¶</a></h2>
<p>In this tutorial we will learn how to read and prepare data for semivariogram modeling, how to manually find the best step size between lags and how to detect outliers in our data which can affect final semivariogram.</p>
<p>Variogram Point Cloud analysis is an additional, basic data preparation step which may save you a lot of headache with more sophisticated analysis. You should learn about Variogram Point Cloud analysis before you move on to the semivariogram estimation and semivariogram fitting operations.</p>
<p>We use:</p>
<ul class="simple">
<li>for point 1 and 2: DEM data which is stored in a file <code class="docutils literal notranslate"><span class="pre">sample_data/point_data/poland_dem_gorzow_wielkopolski</span></code>,</li>
<li>for point 3: Breast cancer rates data is stored in the shapefile in folder <code class="docutils literal notranslate"><span class="pre">sample_data/areal_data/breast_cancer_rate_per_area_2.shp</span></code>.</li>
</ul>
</div>
<div class="section" id="Import-packages">
<h2>Import packages<a class="headerlink" href="#Import-packages" title="Permalink to this headline">¶</a></h2>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[1]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>
<span class="kn">from</span> <span class="nn">collections</span> <span class="kn">import</span> <span class="n">OrderedDict</span>

<span class="kn">import</span> <span class="nn">matplotlib.pyplot</span> <span class="k">as</span> <span class="nn">plt</span>

<span class="kn">from</span> <span class="nn">pyinterpolate.io_ops</span> <span class="kn">import</span> <span class="n">read_point_data</span>
<span class="kn">from</span> <span class="nn">pyinterpolate.io_ops</span> <span class="kn">import</span> <span class="n">prepare_areal_shapefile</span><span class="p">,</span> <span class="n">get_points_within_area</span>
<span class="kn">from</span> <span class="nn">pyinterpolate.distance.calculate_distances</span> <span class="kn">import</span> <span class="n">calc_point_to_point_distance</span>  <span class="c1"># We need this to find max distance between points</span>
<span class="kn">from</span> <span class="nn">pyinterpolate.semivariance</span> <span class="kn">import</span> <span class="n">build_variogram_point_cloud</span><span class="p">,</span> <span class="n">show_variogram_cloud</span><span class="p">,</span> <span class="n">remove_outliers</span>
<span class="kn">from</span> <span class="nn">pyinterpolate.semivariance</span> <span class="kn">import</span> <span class="n">calculate_semivariance</span><span class="p">,</span> <span class="n">calc_semivariance_from_pt_cloud</span>
</pre></div>
</div>
</div>
</div>
<div class="section" id="1)-Read-point-data">
<h2>1) Read point data<a class="headerlink" href="#1)-Read-point-data" title="Permalink to this headline">¶</a></h2>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[2]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="n">dem</span> <span class="o">=</span> <span class="n">read_point_data</span><span class="p">(</span><span class="s1">&#39;../sample_data/point_data/poland_dem_gorzow_wielkopolski&#39;</span><span class="p">,</span> <span class="n">data_type</span><span class="o">=</span><span class="s1">&#39;txt&#39;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[3]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="c1"># Look into a first few lines of data</span>

<span class="n">dem</span><span class="p">[:</span><span class="mi">10</span><span class="p">,</span> <span class="p">:]</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[3]:
</pre></div>
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
array([[15.1152409 , 52.76514556, 91.27559662],
       [15.1152409 , 52.74279035, 96.54829407],
       [15.1152409 , 52.71070647, 51.25455093],
       [15.1152409 , 52.70884354, 48.95828247],
       [15.1152409 , 52.67137785, 16.81786346],
       [15.1152409 , 52.6498506 , 16.29390526],
       [15.1152409 , 52.62770238, 16.54066277],
       [15.1152409 , 52.60596814, 19.45093346],
       [15.1152409 , 52.60493317, 19.24267578],
       [15.1152409 , 52.57823111, 45.66201019]])
</pre></div></div>
</div>
</div>
<div class="section" id="2)-Set-proper-lag-size-with-variogram-cloud-histogram">
<h2>2) Set proper lag size with variogram cloud histogram<a class="headerlink" href="#2)-Set-proper-lag-size-with-variogram-cloud-histogram" title="Permalink to this headline">¶</a></h2>
<p>In this step we generate Variogram Point Cloud. For each proposed lag algorithm assigns point’s values which are grouped in this lag. We check and compare few different lags and step sizes and their respective point clouds.</p>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[4]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="c1"># Create analysis parameters</span>

<span class="c1"># Check max distance between points</span>
<span class="n">distances</span> <span class="o">=</span> <span class="n">calc_point_to_point_distance</span><span class="p">(</span><span class="n">dem</span><span class="p">[:,</span> <span class="p">:</span><span class="o">-</span><span class="mi">1</span><span class="p">])</span>
<span class="n">maximum_range</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">max</span><span class="p">(</span><span class="n">distances</span><span class="p">)</span>

<span class="n">number_of_lags</span> <span class="o">=</span> <span class="p">[</span><span class="mi">4</span><span class="p">,</span> <span class="mi">8</span><span class="p">,</span> <span class="mi">16</span><span class="p">,</span> <span class="mi">32</span><span class="p">]</span>
<span class="n">step_sizes</span> <span class="o">=</span> <span class="p">[</span><span class="n">maximum_range</span> <span class="o">/</span> <span class="n">x</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">number_of_lags</span><span class="p">]</span>

<span class="n">variogram_clouds</span> <span class="o">=</span> <span class="p">[]</span>

<span class="k">for</span> <span class="n">step_size</span> <span class="ow">in</span> <span class="n">step_sizes</span><span class="p">:</span>
    <span class="n">variogram_cloud</span> <span class="o">=</span> <span class="n">build_variogram_point_cloud</span><span class="p">(</span><span class="n">dem</span><span class="p">,</span> <span class="n">step_size</span><span class="p">,</span> <span class="n">maximum_range</span><span class="p">)</span>
    <span class="n">variogram_clouds</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">variogram_cloud</span><span class="p">)</span>
</pre></div>
</div>
</div>
<p>Now we check how many points are grouped for each lag:</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[5]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="k">for</span> <span class="n">idx</span><span class="p">,</span> <span class="n">lag</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">number_of_lags</span><span class="p">):</span>
    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;Lags per area: </span><span class="si">{</span><span class="n">lag</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">)</span>
    <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;&#39;</span><span class="p">)</span>
    <span class="n">var_cloud</span> <span class="o">=</span> <span class="n">variogram_clouds</span><span class="p">[</span><span class="n">idx</span><span class="p">]</span>
    <span class="k">for</span> <span class="n">jdx</span><span class="p">,</span> <span class="n">cloud</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">var_cloud</span><span class="o">.</span><span class="n">keys</span><span class="p">()):</span>
        <span class="n">l</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">var_cloud</span><span class="p">[</span><span class="n">cloud</span><span class="p">])</span>
        <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;Lag </span><span class="si">{</span><span class="n">cloud</span><span class="si">}</span><span class="s1"> has </span><span class="si">{</span><span class="n">l</span><span class="si">}</span><span class="s1"> points.&#39;</span><span class="p">)</span>

    <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;</span><span class="se">\n</span><span class="s1">###########</span><span class="se">\n</span><span class="s1">&#39;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
Lags per area: 4

Lag 0.08380184447417775 has 13317870 points.
Lag 0.1676036889483555 has 22150860 points.
Lag 0.25140553342253324 has 11317454 points.

###########

Lags per area: 8

Lag 0.041900922237088876 has 3943014 points.
Lag 0.08380184447417775 has 9374856 points.
Lag 0.12570276671126662 has 11422830 points.
Lag 0.1676036889483555 has 10728030 points.
Lag 0.2095046111854444 has 7771382 points.
Lag 0.25140553342253324 has 3546032 points.
Lag 0.2933064556596221 has 701464 points.
Lag 0.335207377896711 has 46522 points.

###########

Lags per area: 16

Lag 0.020950461118544438 has 1072668 points.
Lag 0.041900922237088876 has 2870346 points.
Lag 0.06285138335563331 has 4218280 points.
Lag 0.08380184447417775 has 5156576 points.
Lag 0.1047523055927222 has 5650886 points.
Lag 0.12570276671126662 has 5771944 points.
Lag 0.14665322782981105 has 5595860 points.
Lag 0.1676036889483555 has 5132170 points.
Lag 0.18855415006689993 has 4376408 points.
Lag 0.20950461118544436 has 3394974 points.
Lag 0.23045507230398882 has 2280544 points.
Lag 0.25140553342253324 has 1265488 points.
Lag 0.2723559945410777 has 518800 points.
Lag 0.2933064556596221 has 182664 points.
Lag 0.3142569167781666 has 43150 points.

###########

Lags per area: 32

Lag 0.010475230559272219 has 282116 points.
Lag 0.020950461118544438 has 790552 points.
Lag 0.031425691677816656 has 1239980 points.
Lag 0.041900922237088876 has 1630366 points.
Lag 0.0523761527963611 has 1969372 points.
Lag 0.06285138335563331 has 2248908 points.
Lag 0.07332661391490553 has 2491600 points.
Lag 0.08380184447417775 has 2664976 points.
Lag 0.09427707503344997 has 2792134 points.
Lag 0.10475230559272218 has 2858752 points.
Lag 0.11522753615199441 has 2886450 points.
Lag 0.12570276671126662 has 2885494 points.
Lag 0.13617799727053884 has 2839082 points.
Lag 0.14665322782981105 has 2756778 points.
Lag 0.1571284583890833 has 2644286 points.
Lag 0.1676036889483555 has 2487884 points.
Lag 0.17807891950762772 has 2300572 points.
Lag 0.18855415006689993 has 2075836 points.
Lag 0.19902938062617215 has 1829802 points.
Lag 0.2095046111854444 has 1565172 points.
Lag 0.2199798417447166 has 1286592 points.
Lag 0.23045507230398882 has 993952 points.
Lag 0.24093030286326103 has 745644 points.
Lag 0.25140553342253324 has 519844 points.
Lag 0.2618807639818055 has 322258 points.
Lag 0.27235599454107773 has 196542 points.
Lag 0.2828312251003499 has 117890 points.
Lag 0.29330645565962216 has 64774 points.
Lag 0.3037816862188944 has 31296 points.
Lag 0.3142569167781666 has 11854 points.
Lag 0.3247321473374388 has 3072 points.

###########

</pre></div></div>
</div>
<div class="section" id="Clarification:">
<h3>Clarification:<a class="headerlink" href="#Clarification:" title="Permalink to this headline">¶</a></h3>
<p>Raw numbers are hard to analyze. But we can check those informations with boxplots and that we can learn more about the data:</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[6]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="k">for</span> <span class="n">idx</span><span class="p">,</span> <span class="n">lag</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">number_of_lags</span><span class="p">):</span>
    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;Lags per area: </span><span class="si">{</span><span class="n">lag</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">)</span>
    <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;&#39;</span><span class="p">)</span>
    <span class="n">var_cloud</span> <span class="o">=</span> <span class="n">variogram_clouds</span><span class="p">[</span><span class="n">idx</span><span class="p">]</span>
    <span class="n">show_variogram_cloud</span><span class="p">(</span><span class="n">var_cloud</span><span class="p">,</span> <span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">12</span><span class="p">,</span> <span class="mi">8</span><span class="p">))</span>

    <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;</span><span class="se">\n</span><span class="s1">###########</span><span class="se">\n</span><span class="s1">&#39;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
Lags per area: 4

</pre></div></div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="../_images/tutorials_Variogram_Point_Cloud_(Basic)_11_1.png" src="../_images/tutorials_Variogram_Point_Cloud_(Basic)_11_1.png" />
</div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>

###########

Lags per area: 8

</pre></div></div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="../_images/tutorials_Variogram_Point_Cloud_(Basic)_11_3.png" src="../_images/tutorials_Variogram_Point_Cloud_(Basic)_11_3.png" />
</div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>

###########

Lags per area: 16

</pre></div></div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="../_images/tutorials_Variogram_Point_Cloud_(Basic)_11_5.png" src="../_images/tutorials_Variogram_Point_Cloud_(Basic)_11_5.png" />
</div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>

###########

Lags per area: 32

</pre></div></div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="../_images/tutorials_Variogram_Point_Cloud_(Basic)_11_7.png" src="../_images/tutorials_Variogram_Point_Cloud_(Basic)_11_7.png" />
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>

###########

</pre></div></div>
</div>
</div>
<div class="section" id="clarification-1">
<h3>Clarification:<a class="headerlink" href="#clarification-1" title="Permalink to this headline">¶</a></h3>
<p>Boxplots of each lag shows halved squared difference (semivariance) between all points grouped for specific lag. The box extends from the lower to upper quartile values of the data, with a line at the median. The whiskers extend from the box to show the range of the data. Flier points are those past the end of the whiskers. As you may observed we have multiple outliers in a dataset, especially for short- and medium-range semivariance values. This may indicate that dataset should be transformed
before analysis. Other interesting fact is that from 8 lags we are able to see specific pattern at a distance 0.18. Variogram is not constant and there is one valley in it.</p>
<p>Why do we plot those boxplots?</p>
<ol class="arabic simple">
<li>To check outliers in a data.</li>
<li>To check if each distance is well represented by specific number of measurements. This is extremely important at a short-distance scale.</li>
<li>To gain initial idea how semivariogram may be look like.</li>
</ol>
<p>For point 3.: we can check experimental semivariogram and compare it with those boxplots here. We will do it for 16 lags.</p>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[7]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="n">search_radius</span> <span class="o">=</span> <span class="n">step_sizes</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span>
<span class="n">max_range</span> <span class="o">=</span> <span class="n">maximum_range</span>

<span class="n">exp_semivar</span> <span class="o">=</span> <span class="n">calculate_semivariance</span><span class="p">(</span><span class="n">data</span><span class="o">=</span><span class="n">dem</span><span class="p">,</span> <span class="n">step_size</span><span class="o">=</span><span class="n">search_radius</span><span class="p">,</span> <span class="n">max_range</span><span class="o">=</span><span class="n">max_range</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[8]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="c1"># Plot experimental semivariogram</span>

<span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">12</span><span class="p">,</span> <span class="mi">12</span><span class="p">))</span>
<span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">exp_semivar</span><span class="p">[:,</span> <span class="mi">0</span><span class="p">],</span> <span class="n">exp_semivar</span><span class="p">[:,</span> <span class="mi">1</span><span class="p">],</span> <span class="s1">&#39;o&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">title</span><span class="p">(</span><span class="s1">&#39;Experimental semivariogram od DEM data&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">xlabel</span><span class="p">(</span><span class="s1">&#39;Range - in degrees&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="s1">&#39;Semivariance&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="../_images/tutorials_Variogram_Point_Cloud_(Basic)_14_0.png" src="../_images/tutorials_Variogram_Point_Cloud_(Basic)_14_0.png" />
</div>
</div>
</div>
<div class="section" id="clarification-2">
<h3>Clarification:<a class="headerlink" href="#clarification-2" title="Permalink to this headline">¶</a></h3>
<p>As you may noticed experimental semivariogram has drop of semivariance at 0.2 degree range, which is very close to the drop of variogram point cloud.</p>
</div>
</div>
<div class="section" id="3)-Detect-and-remove-outliers">
<h2>3) Detect and remove outliers<a class="headerlink" href="#3)-Detect-and-remove-outliers" title="Permalink to this headline">¶</a></h2>
<p>With idea how Variogram Point Cloud works we can detect and “remove” outliers from our dataset. We use for it other dataset which represents the breast cancer rates in counties of Northeastern part of the U.S. Each county will be transformed into its centroid. Those centroids are not evenly spaced and we can expect that for some number of steps dataset may be modeled incorrectly.</p>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[9]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="c1"># Read and prepare data</span>

<span class="n">areal_data_file</span> <span class="o">=</span> <span class="s1">&#39;../sample_data/areal_data/cancer_data.shp&#39;</span>
<span class="n">areal_id_column_name</span> <span class="o">=</span> <span class="s1">&#39;FIPS&#39;</span>
<span class="n">areal_val_column_name</span> <span class="o">=</span> <span class="s1">&#39;rate&#39;</span>

<span class="n">areal_data</span> <span class="o">=</span> <span class="n">prepare_areal_shapefile</span><span class="p">(</span><span class="n">areal_data_file</span><span class="p">,</span>
                                     <span class="n">id_column_name</span><span class="o">=</span><span class="n">areal_id_column_name</span><span class="p">,</span>
                                     <span class="n">value_column_name</span><span class="o">=</span><span class="n">areal_val_column_name</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[10]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="n">areal_centroids</span> <span class="o">=</span> <span class="n">areal_data</span><span class="p">[:,</span> <span class="o">-</span><span class="mi">3</span><span class="p">:]</span>
</pre></div>
</div>
</div>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[11]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="c1"># Create analysis parameters</span>

<span class="c1"># Check max distance between points</span>

<span class="n">distances</span> <span class="o">=</span> <span class="n">calc_point_to_point_distance</span><span class="p">(</span><span class="n">areal_centroids</span><span class="p">[:,</span> <span class="p">:</span><span class="o">-</span><span class="mi">1</span><span class="p">])</span>
<span class="n">maximum_range</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">max</span><span class="p">(</span><span class="n">distances</span><span class="p">)</span>

<span class="n">number_of_lags</span> <span class="o">=</span> <span class="p">[</span><span class="mi">4</span><span class="p">,</span> <span class="mi">8</span><span class="p">,</span> <span class="mi">16</span><span class="p">,</span> <span class="mi">32</span><span class="p">]</span>
<span class="n">step_sizes</span> <span class="o">=</span> <span class="p">[</span><span class="n">maximum_range</span> <span class="o">/</span> <span class="n">x</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">number_of_lags</span><span class="p">]</span>

<span class="n">variogram_clouds</span> <span class="o">=</span> <span class="p">[]</span>

<span class="k">for</span> <span class="n">step_size</span> <span class="ow">in</span> <span class="n">step_sizes</span><span class="p">:</span>
    <span class="n">variogram_cloud</span> <span class="o">=</span> <span class="n">build_variogram_point_cloud</span><span class="p">(</span><span class="n">areal_centroids</span><span class="p">,</span> <span class="n">step_size</span><span class="p">,</span> <span class="n">maximum_range</span><span class="p">)</span>
    <span class="n">variogram_clouds</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">variogram_cloud</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[12]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="k">for</span> <span class="n">idx</span><span class="p">,</span> <span class="n">lag</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">number_of_lags</span><span class="p">):</span>
    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;Lags per area: </span><span class="si">{</span><span class="n">lag</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">)</span>
    <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;&#39;</span><span class="p">)</span>
    <span class="n">var_cloud</span> <span class="o">=</span> <span class="n">variogram_clouds</span><span class="p">[</span><span class="n">idx</span><span class="p">]</span>
    <span class="k">for</span> <span class="n">jdx</span><span class="p">,</span> <span class="n">cloud</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">var_cloud</span><span class="o">.</span><span class="n">keys</span><span class="p">()):</span>
        <span class="n">l</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">var_cloud</span><span class="p">[</span><span class="n">cloud</span><span class="p">])</span>
        <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;Lag </span><span class="si">{</span><span class="n">cloud</span><span class="si">}</span><span class="s1"> has </span><span class="si">{</span><span class="n">l</span><span class="si">}</span><span class="s1"> points.&#39;</span><span class="p">)</span>

    <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;</span><span class="se">\n</span><span class="s1">###########</span><span class="se">\n</span><span class="s1">&#39;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
Lags per area: 4

Lag 301214.2660116966 has 20462 points.
Lag 602428.5320233932 has 20568 points.
Lag 903642.7980350899 has 5296 points.

###########

Lags per area: 8

Lag 150607.1330058483 has 6676 points.
Lag 301214.2660116966 has 13786 points.
Lag 451821.3990175449 has 12970 points.
Lag 602428.5320233932 has 7598 points.
Lag 753035.6650292415 has 3784 points.
Lag 903642.7980350897 has 1512 points.
Lag 1054249.9310409382 has 450 points.

###########

Lags per area: 16

Lag 75303.56650292415 has 1936 points.
Lag 150607.1330058483 has 4740 points.
Lag 225910.69950877246 has 6532 points.
Lag 301214.2660116966 has 7254 points.
Lag 376517.83251462074 has 7066 points.
Lag 451821.39901754487 has 5904 points.
Lag 527124.9655204691 has 4494 points.
Lag 602428.5320233932 has 3104 points.
Lag 677732.0985263174 has 2220 points.
Lag 753035.6650292416 has 1564 points.
Lag 828339.2315321657 has 980 points.
Lag 903642.7980350899 has 532 points.
Lag 978946.364538014 has 290 points.
Lag 1054249.931040938 has 160 points.
Lag 1129553.497543862 has 76 points.
Lag 1204857.0640467864 has 20 points.

###########

Lags per area: 32

Lag 37651.783251462075 has 360 points.
Lag 75303.56650292415 has 1576 points.
Lag 112955.34975438623 has 2094 points.
Lag 150607.1330058483 has 2646 points.
Lag 188258.91625731037 has 3114 points.
Lag 225910.69950877244 has 3418 points.
Lag 263562.48276023456 has 3634 points.
Lag 301214.2660116966 has 3620 points.
Lag 338866.0492631587 has 3648 points.
Lag 376517.8325146208 has 3418 points.
Lag 414169.61576608283 has 3064 points.
Lag 451821.3990175449 has 2840 points.
Lag 489473.182269007 has 2458 points.
Lag 527124.965520469 has 2036 points.
Lag 564776.748771931 has 1702 points.
Lag 602428.5320233932 has 1402 points.
Lag 640080.3152748552 has 1230 points.
Lag 677732.0985263173 has 990 points.
Lag 715383.8817777794 has 864 points.
Lag 753035.6650292415 has 700 points.
Lag 790687.4482807035 has 550 points.
Lag 828339.2315321657 has 430 points.
Lag 865991.0147836277 has 298 points.
Lag 903642.7980350897 has 234 points.
Lag 941294.5812865519 has 164 points.
Lag 978946.3645380139 has 126 points.
Lag 1016598.147789476 has 98 points.
Lag 1054249.931040938 has 62 points.
Lag 1091901.7142924 has 48 points.
Lag 1129553.4975438623 has 28 points.
Lag 1167205.2807953244 has 14 points.

###########

</pre></div></div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[13]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="k">for</span> <span class="n">idx</span><span class="p">,</span> <span class="n">lag</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">number_of_lags</span><span class="p">):</span>
    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;Lags per area: </span><span class="si">{</span><span class="n">lag</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">)</span>
    <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;&#39;</span><span class="p">)</span>
    <span class="n">var_cloud</span> <span class="o">=</span> <span class="n">variogram_clouds</span><span class="p">[</span><span class="n">idx</span><span class="p">]</span>
    <span class="n">show_variogram_cloud</span><span class="p">(</span><span class="n">var_cloud</span><span class="p">,</span> <span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">12</span><span class="p">,</span> <span class="mi">8</span><span class="p">))</span>

    <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;</span><span class="se">\n</span><span class="s1">###########</span><span class="se">\n</span><span class="s1">&#39;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
Lags per area: 4

</pre></div></div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="../_images/tutorials_Variogram_Point_Cloud_(Basic)_21_1.png" src="../_images/tutorials_Variogram_Point_Cloud_(Basic)_21_1.png" />
</div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>

###########

Lags per area: 8

</pre></div></div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="../_images/tutorials_Variogram_Point_Cloud_(Basic)_21_3.png" src="../_images/tutorials_Variogram_Point_Cloud_(Basic)_21_3.png" />
</div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>

###########

Lags per area: 16

</pre></div></div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="../_images/tutorials_Variogram_Point_Cloud_(Basic)_21_5.png" src="../_images/tutorials_Variogram_Point_Cloud_(Basic)_21_5.png" />
</div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>

###########

Lags per area: 32

</pre></div></div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="../_images/tutorials_Variogram_Point_Cloud_(Basic)_21_7.png" src="../_images/tutorials_Variogram_Point_Cloud_(Basic)_21_7.png" />
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>

###########

</pre></div></div>
</div>
<div class="section" id="Clarification">
<h3>Clarification<a class="headerlink" href="#Clarification" title="Permalink to this headline">¶</a></h3>
<ol class="arabic simple">
<li>There are some outliers in a dataset! To get rid of them we will remove all TOP values which are further away from the mean than 2 standard deviations (for each lag).</li>
</ol>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[14]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="n">cloud_without_outliers</span> <span class="o">=</span> <span class="n">remove_outliers</span><span class="p">(</span><span class="n">variogram_clouds</span><span class="p">[</span><span class="mi">2</span><span class="p">],</span> <span class="n">exclude_part</span><span class="o">=</span><span class="s1">&#39;top&#39;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[15]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="n">show_variogram_cloud</span><span class="p">(</span><span class="n">cloud_without_outliers</span><span class="p">,</span> <span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">12</span><span class="p">,</span> <span class="mi">8</span><span class="p">))</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="../_images/tutorials_Variogram_Point_Cloud_(Basic)_24_0.png" src="../_images/tutorials_Variogram_Point_Cloud_(Basic)_24_0.png" />
</div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[16]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="n">show_variogram_cloud</span><span class="p">(</span><span class="n">variogram_clouds</span><span class="p">[</span><span class="mi">2</span><span class="p">],</span> <span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">12</span><span class="p">,</span> <span class="mi">8</span><span class="p">))</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="../_images/tutorials_Variogram_Point_Cloud_(Basic)_25_0.png" src="../_images/tutorials_Variogram_Point_Cloud_(Basic)_25_0.png" />
</div>
</div>
</div>
<div class="section" id="clarification-4">
<h3>Clarification:<a class="headerlink" href="#clarification-4" title="Permalink to this headline">¶</a></h3>
<p>Compare y axis of two figures above. Upper figure is cleaned from outliers and lower has those values. Maximum on y axis for the upper is 1000, for the lower is 5000. Experimental semivariogram smooths outliers from initial dataset and you may compare y axis of experimental semivariogram with both variogram clouds to see it.</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[17]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="c1"># Experimental semivariogram</span>

<span class="n">search_radius</span> <span class="o">=</span> <span class="n">step_sizes</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>
<span class="n">max_range</span> <span class="o">=</span> <span class="n">maximum_range</span>

<span class="n">exp_semivar</span> <span class="o">=</span> <span class="n">calculate_semivariance</span><span class="p">(</span><span class="n">data</span><span class="o">=</span><span class="n">areal_centroids</span><span class="p">,</span> <span class="n">step_size</span><span class="o">=</span><span class="n">step_sizes</span><span class="p">[</span><span class="mi">2</span><span class="p">],</span> <span class="n">max_range</span><span class="o">=</span><span class="n">maximum_range</span><span class="p">)</span>

<span class="c1"># Plot experimental semivariogram</span>

<span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">12</span><span class="p">,</span> <span class="mi">12</span><span class="p">))</span>
<span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">exp_semivar</span><span class="p">[:,</span> <span class="mi">0</span><span class="p">],</span> <span class="n">exp_semivar</span><span class="p">[:,</span> <span class="mi">1</span><span class="p">],</span> <span class="s1">&#39;o&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">title</span><span class="p">(</span><span class="s1">&#39;Experimental semivariogram of breast cancer rates in the Northeastern U.S. counties dataset&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">xlabel</span><span class="p">(</span><span class="s1">&#39;Range - in meters&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="s1">&#39;Semivariance&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="../_images/tutorials_Variogram_Point_Cloud_(Basic)_27_0.png" src="../_images/tutorials_Variogram_Point_Cloud_(Basic)_27_0.png" />
</div>
</div>
</div>
</div>
<div class="section" id="4)-Calculate-experimental-semivariogram-from-point-cloud.">
<h2>4) Calculate experimental semivariogram from point cloud.<a class="headerlink" href="#4)-Calculate-experimental-semivariogram-from-point-cloud." title="Permalink to this headline">¶</a></h2>
<p>You may calculate semivariogram directly, like in the cell above, or from the point cloud. Latter is useful when you perform outliers detection and you remove some of them. Let’s check it for our dataset without outliers.</p>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[18]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="n">experimental_semivariogram_from_pt_cloud</span> <span class="o">=</span> <span class="n">calc_semivariance_from_pt_cloud</span><span class="p">(</span><span class="n">cloud_without_outliers</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[19]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="c1"># Plot experimental semivariogram</span>

<span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">12</span><span class="p">,</span> <span class="mi">12</span><span class="p">))</span>
<span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">experimental_semivariogram_from_pt_cloud</span><span class="p">[:,</span> <span class="mi">0</span><span class="p">],</span> <span class="n">experimental_semivariogram_from_pt_cloud</span><span class="p">[:,</span> <span class="mi">1</span><span class="p">],</span> <span class="s1">&#39;o&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">title</span><span class="p">(</span><span class="s1">&#39;Experimental semivariogram of breast cancer rates in the Northeastern U.S. counties dataset. Outliers were removed from each lag.&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">xlabel</span><span class="p">(</span><span class="s1">&#39;Range - in meters&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="s1">&#39;Semivariance&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="../_images/tutorials_Variogram_Point_Cloud_(Basic)_30_0.png" src="../_images/tutorials_Variogram_Point_Cloud_(Basic)_30_0.png" />
</div>
</div>
<p>As you may noticed, shape of the semivariogram is preserved but values of semivariance are much smaller for the data without outliers.</p>
</div>
<div class="section" id="5)-What-next?">
<h2>5) What next?<a class="headerlink" href="#5)-What-next?" title="Permalink to this headline">¶</a></h2>
<p>From this point you may look into <strong>Outliers and Their Influence on the Final Model (Intermediate)</strong> notebook where we are exploring the variogram point clouds further.</p>
<hr class="docutils" />
</div>
</div>


          </div>
          
        </div>
      </div>
      <div class="sphinxsidebar" role="navigation" aria-label="main navigation">
        <div class="sphinxsidebarwrapper">
<h1 class="logo"><a href="../index.html">Pyinterpolate</a></h1>








<h3>Navigation</h3>
<ul class="current">
<li class="toctree-l1"><a class="reference internal" href="../introduction.html">Introduction</a></li>
<li class="toctree-l1"><a class="reference internal" href="../setup.html">Setup</a></li>
<li class="toctree-l1 current"><a class="reference internal" href="../tutorials.html">Tutorials</a></li>
<li class="toctree-l1"><a class="reference internal" href="../code_documentation.html">Documentation</a></li>
<li class="toctree-l1"><a class="reference internal" href="../algorithms.html">Algorithms Explained</a></li>
<li class="toctree-l1"><a class="reference internal" href="../contribution.html">Contribution to Pyinterpolate</a></li>
<li class="toctree-l1"><a class="reference internal" href="../license.html">License</a></li>
</ul>

<div class="relations">
<h3>Related Topics</h3>
<ul>
  <li><a href="../index.html">Documentation overview</a><ul>
  <li><a href="../tutorials.html">Tutorials</a><ul>
      <li>Previous: <a href="../tutorials.html" title="previous chapter">Tutorials</a></li>
      <li>Next: <a href="Semivariogram Estimation (Basic).html" title="next chapter">Semivariogram calculation - tutorial</a></li>
  </ul></li>
  </ul></li>
</ul>
</div>
<div id="searchbox" style="display: none" role="search">
  <h3>Quick search</h3>
    <div class="searchformwrapper">
    <form class="search" action="../search.html" method="get">
      <input type="text" name="q" />
      <input type="submit" value="Go" />
      <input type="hidden" name="check_keywords" value="yes" />
      <input type="hidden" name="area" value="default" />
    </form>
    </div>
</div>
<script type="text/javascript">$('#searchbox').show(0);</script>








        </div>
      </div>
      <div class="clearer"></div>
    </div>
    <div class="footer">
      &copy;2021, Szymon Moliński.
      
      |
      Powered by <a href="http://sphinx-doc.org/">Sphinx 1.8.5</a>
      &amp; <a href="https://github.com/bitprophet/alabaster">Alabaster 0.7.12</a>
      
      |
      <a href="../_sources/tutorials/Variogram Point Cloud (Basic).ipynb.txt"
          rel="nofollow">Page source</a>
    </div>

    

    
  </body>
</html>