
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
  "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">

<html xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta http-equiv="X-UA-Compatible" content="IE=Edge" />
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    <title>Blocks to points Ordinary Kriging interpolation - tutorial &#8212; Pyinterpolate 0.2.3 documentation</title>
    <link rel="stylesheet" href="../_static/alabaster.css" type="text/css" />
    <link rel="stylesheet" href="../_static/pygments.css" type="text/css" />
    <script type="text/javascript" id="documentation_options" data-url_root="../" src="../_static/documentation_options.js"></script>
    <script type="text/javascript" src="../_static/jquery.js"></script>
    <script type="text/javascript" src="../_static/underscore.js"></script>
    <script type="text/javascript" src="../_static/doctools.js"></script>
    <script type="text/javascript" src="../_static/language_data.js"></script>
    <script crossorigin="anonymous" integrity="sha256-Ae2Vz/4ePdIu6ZyI/5ZGsYnb+m0JlOmKPjt6XZ9JJkA=" type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/require.js/2.3.4/require.min.js"></script>
    <script async="async" type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/latest.js?config=TeX-AMS-MML_HTMLorMML"></script>
    <script type="text/x-mathjax-config">MathJax.Hub.Config({"tex2jax": {"inlineMath": [["$", "$"], ["\\(", "\\)"]], "processEscapes": true, "ignoreClass": "tex2jax_ignore|mathjax_ignore|document", "processClass": "tex2jax_process|mathjax_process|math|output_area"}})</script>
    <link rel="index" title="Index" href="../genindex.html" />
    <link rel="search" title="Search" href="../search.html" />
    <link rel="next" title="Semivariogram regularization - tutorial" href="Semivariogram Regularization (Intermediate).html" />
    <link rel="prev" title="How good is my Kriging model? - tests with IDW algorithm - tutorial" href="How good is our Kriging model - test  it with IDW algorithm (Basic).html" />
   
  <link rel="stylesheet" href="../_static/custom.css" type="text/css" />
  
  
  <meta name="viewport" content="width=device-width, initial-scale=0.9, maximum-scale=0.9" />

  </head><body>
  

    <div class="document">
      <div class="documentwrapper">
        <div class="bodywrapper">
          

          <div class="body" role="main">
            
  
<style>
/* CSS for nbsphinx extension */

/* remove conflicting styling from Sphinx themes */
div.nbinput.container div.prompt *,
div.nboutput.container div.prompt *,
div.nbinput.container div.input_area pre,
div.nboutput.container div.output_area pre,
div.nbinput.container div.input_area .highlight,
div.nboutput.container div.output_area .highlight {
    border: none;
    padding: 0;
    margin: 0;
    box-shadow: none;
}

div.nbinput.container > div[class*=highlight],
div.nboutput.container > div[class*=highlight] {
    margin: 0;
}

div.nbinput.container div.prompt *,
div.nboutput.container div.prompt * {
    background: none;
}

div.nboutput.container div.output_area .highlight,
div.nboutput.container div.output_area pre {
    background: unset;
}

div.nboutput.container div.output_area div.highlight {
    color: unset;  /* override Pygments text color */
}

/* avoid gaps between output lines */
div.nboutput.container div[class*=highlight] pre {
    line-height: normal;
}

/* input/output containers */
div.nbinput.container,
div.nboutput.container {
    display: -webkit-flex;
    display: flex;
    align-items: flex-start;
    margin: 0;
    width: 100%;
}
@media (max-width: 540px) {
    div.nbinput.container,
    div.nboutput.container {
        flex-direction: column;
    }
}

/* input container */
div.nbinput.container {
    padding-top: 5px;
}

/* last container */
div.nblast.container {
    padding-bottom: 5px;
}

/* input prompt */
div.nbinput.container div.prompt pre {
    color: #307FC1;
}

/* output prompt */
div.nboutput.container div.prompt pre {
    color: #BF5B3D;
}

/* all prompts */
div.nbinput.container div.prompt,
div.nboutput.container div.prompt {
    width: 4.5ex;
    padding-top: 5px;
    position: relative;
    user-select: none;
}

div.nbinput.container div.prompt > div,
div.nboutput.container div.prompt > div {
    position: absolute;
    right: 0;
    margin-right: 0.3ex;
}

@media (max-width: 540px) {
    div.nbinput.container div.prompt,
    div.nboutput.container div.prompt {
        width: unset;
        text-align: left;
        padding: 0.4em;
    }
    div.nboutput.container div.prompt.empty {
        padding: 0;
    }

    div.nbinput.container div.prompt > div,
    div.nboutput.container div.prompt > div {
        position: unset;
    }
}

/* disable scrollbars on prompts */
div.nbinput.container div.prompt pre,
div.nboutput.container div.prompt pre {
    overflow: hidden;
}

/* input/output area */
div.nbinput.container div.input_area,
div.nboutput.container div.output_area {
    -webkit-flex: 1;
    flex: 1;
    overflow: auto;
}
@media (max-width: 540px) {
    div.nbinput.container div.input_area,
    div.nboutput.container div.output_area {
        width: 100%;
    }
}

/* input area */
div.nbinput.container div.input_area {
    border: 1px solid #e0e0e0;
    border-radius: 2px;
    /*background: #f5f5f5;*/
}

/* override MathJax center alignment in output cells */
div.nboutput.container div[class*=MathJax] {
    text-align: left !important;
}

/* override sphinx.ext.imgmath center alignment in output cells */
div.nboutput.container div.math p {
    text-align: left;
}

/* standard error */
div.nboutput.container div.output_area.stderr {
    background: #fdd;
}

/* ANSI colors */
.ansi-black-fg { color: #3E424D; }
.ansi-black-bg { background-color: #3E424D; }
.ansi-black-intense-fg { color: #282C36; }
.ansi-black-intense-bg { background-color: #282C36; }
.ansi-red-fg { color: #E75C58; }
.ansi-red-bg { background-color: #E75C58; }
.ansi-red-intense-fg { color: #B22B31; }
.ansi-red-intense-bg { background-color: #B22B31; }
.ansi-green-fg { color: #00A250; }
.ansi-green-bg { background-color: #00A250; }
.ansi-green-intense-fg { color: #007427; }
.ansi-green-intense-bg { background-color: #007427; }
.ansi-yellow-fg { color: #DDB62B; }
.ansi-yellow-bg { background-color: #DDB62B; }
.ansi-yellow-intense-fg { color: #B27D12; }
.ansi-yellow-intense-bg { background-color: #B27D12; }
.ansi-blue-fg { color: #208FFB; }
.ansi-blue-bg { background-color: #208FFB; }
.ansi-blue-intense-fg { color: #0065CA; }
.ansi-blue-intense-bg { background-color: #0065CA; }
.ansi-magenta-fg { color: #D160C4; }
.ansi-magenta-bg { background-color: #D160C4; }
.ansi-magenta-intense-fg { color: #A03196; }
.ansi-magenta-intense-bg { background-color: #A03196; }
.ansi-cyan-fg { color: #60C6C8; }
.ansi-cyan-bg { background-color: #60C6C8; }
.ansi-cyan-intense-fg { color: #258F8F; }
.ansi-cyan-intense-bg { background-color: #258F8F; }
.ansi-white-fg { color: #C5C1B4; }
.ansi-white-bg { background-color: #C5C1B4; }
.ansi-white-intense-fg { color: #A1A6B2; }
.ansi-white-intense-bg { background-color: #A1A6B2; }

.ansi-default-inverse-fg { color: #FFFFFF; }
.ansi-default-inverse-bg { background-color: #000000; }

.ansi-bold { font-weight: bold; }
.ansi-underline { text-decoration: underline; }


div.nbinput.container div.input_area div[class*=highlight] > pre,
div.nboutput.container div.output_area div[class*=highlight] > pre,
div.nboutput.container div.output_area div[class*=highlight].math,
div.nboutput.container div.output_area.rendered_html,
div.nboutput.container div.output_area > div.output_javascript,
div.nboutput.container div.output_area:not(.rendered_html) > img{
    padding: 5px;
    margin: 0;
}

/* fix copybtn overflow problem in chromium (needed for 'sphinx_copybutton') */
div.nbinput.container div.input_area > div[class^='highlight'],
div.nboutput.container div.output_area > div[class^='highlight']{
    overflow-y: hidden;
}

/* hide copybtn icon on prompts (needed for 'sphinx_copybutton') */
.prompt a.copybtn {
    display: none;
}

/* Some additional styling taken form the Jupyter notebook CSS */
div.rendered_html table {
  border: none;
  border-collapse: collapse;
  border-spacing: 0;
  color: black;
  font-size: 12px;
  table-layout: fixed;
}
div.rendered_html thead {
  border-bottom: 1px solid black;
  vertical-align: bottom;
}
div.rendered_html tr,
div.rendered_html th,
div.rendered_html td {
  text-align: right;
  vertical-align: middle;
  padding: 0.5em 0.5em;
  line-height: normal;
  white-space: normal;
  max-width: none;
  border: none;
}
div.rendered_html th {
  font-weight: bold;
}
div.rendered_html tbody tr:nth-child(odd) {
  background: #f5f5f5;
}
div.rendered_html tbody tr:hover {
  background: rgba(66, 165, 245, 0.2);
}
</style>
<div class="section" id="Blocks-to-points-Ordinary-Kriging-interpolation---tutorial">
<h1>Blocks to points Ordinary Kriging interpolation - tutorial<a class="headerlink" href="#Blocks-to-points-Ordinary-Kriging-interpolation---tutorial" title="Permalink to this headline">¶</a></h1>
<div class="section" id="Table-of-Contents:">
<h2>Table of Contents:<a class="headerlink" href="#Table-of-Contents:" title="Permalink to this headline">¶</a></h2>
<ol class="arabic simple">
<li>Read areal data,</li>
<li>Detect and remove outliers,</li>
<li>Create semivariogram model,</li>
<li>Read point data canvas,</li>
<li>Build map of interpolated values,</li>
<li>Show map of interpolated values with choropleth map of breast cancer rates.</li>
</ol>
</div>
<div class="section" id="Level:-Intermediate">
<h2>Level: Intermediate<a class="headerlink" href="#Level:-Intermediate" title="Permalink to this headline">¶</a></h2>
</div>
<div class="section" id="Changelog">
<h2>Changelog<a class="headerlink" href="#Changelog" title="Permalink to this headline">¶</a></h2>
<table border="1" class="docutils">
<colgroup>
<col width="18%" />
<col width="59%" />
<col width="23%" />
</colgroup>
<thead valign="bottom">
<tr class="row-odd"><th class="head">Date</th>
<th class="head">Change description</th>
<th class="head">Author</th>
</tr>
</thead>
<tbody valign="top">
<tr class="row-even"><td>2021-12-14</td>
<td>Sill selection was upgraded: now optimal sill is derived from the grid search within <code class="docutils literal notranslate"><span class="pre">TheoreticalSemivariogram</span></code> class</td>
<td>&#64;SimonMolinsky</td>
</tr>
<tr class="row-odd"><td>2021-12-13</td>
<td>Changed behavior of <code class="docutils literal notranslate"><span class="pre">select_values_in_range()</span></code> function</td>
<td>&#64;SimonMolinsky</td>
</tr>
<tr class="row-even"><td>2021-12-06</td>
<td>Behavior of <code class="docutils literal notranslate"><span class="pre">prepare_kriging_data()</span></code> function has changed</td>
<td>&#64;SimonMolinsky</td>
</tr>
<tr class="row-odd"><td>2021-10-13</td>
<td>Refactored TheoreticalSemivariogram (name change of class attribute) and refactored <code class="docutils literal notranslate"><span class="pre">calc_semivariance_from_pt_cloud()</span></code> functions to protect calculations from <code class="docutils literal notranslate"><span class="pre">NaN's</span></code>.</td>
<td>&#64;ethmtrgt &amp; &#64;SimonMolinsky</td>
</tr>
<tr class="row-even"><td>2021-05-11</td>
<td>Refactored TheoreticalSemivariogram class</td>
<td>&#64;SimonMolinsky</td>
</tr>
<tr class="row-odd"><td>2021-03-31</td>
<td>Update related to the change of semivariogram weighting. Updated cancer rates data.</td>
<td>&#64;SimonMolinsky</td>
</tr>
</tbody>
</table>
</div>
<div class="section" id="Introduction">
<h2>Introduction<a class="headerlink" href="#Introduction" title="Permalink to this headline">¶</a></h2>
<p>This tutorial is based on the question of user <em>&#64;ikey</em> from <em>Discord</em> channel of package (02/04/2021). Thank you <em>&#64;ikey</em> for it!</p>
<p>In short:</p>
<blockquote>
<div>Are we able to perform Semivariogram Regularization and Poisson Kriging if our point support represents only points without any values?</div></blockquote>
<p><strong>No, it’s not possible</strong>. But there is a hack which we can use - we are able to interpolate missing values from areal centroids with Ordinary and Simple Kriging just like we do it with <em>regular points</em>. Why is it not possible with unknown points?</p>
<p>The idea behind semivariogram regularization of areal aggregates is to use semivariogram of points (values). And not any points, they must reflect ongoing process. As example, in the case of epidemiology:</p>
<ol class="arabic simple">
<li>We have areal counts of infections divided by POPULATION over some area.</li>
<li>We take POPULATION blocks (points) with number of inhabitants per block and use those as a support of our map. Thus we transform choropleth map into point map, and only to the points, where someone is living ==&gt; someone may be infected. We skip large parts of map where risk of infection is not present because no one is living there.</li>
<li>And we finally obtain population-at-risk map of points or smoothed choropleth map of infection risk without large visual bias where large/small areas seems to be more important.</li>
</ol>
<p>This works when we have specific <strong>counts over area divided by other parameter</strong> (time, population, probability, volume etc.). In this scenario we can find function which links our areal counts with those underlying variables and/or processes. Without support values we are not able to perform semivariogram regularization.</p>
<p>What we want to achieve may be done with Ordinary Kriging (because our points are really unknown) and semivariogram regularization is not required (and not possible without any values).</p>
<p>In summary we will learn how to:</p>
<ul class="simple">
<li>transform areal data into points,</li>
<li>detect and remove outliers from data,</li>
<li>create interpolated map from unknown points,</li>
<li>visualize and save created map.</li>
</ul>
<p>We use:</p>
<ul class="simple">
<li>for point canvas: <code class="docutils literal notranslate"><span class="pre">sample_data/point_data/regular_grid_points.shp</span></code>,</li>
<li>for areal centroids: Breast cancer rates data is stored in the shapefile in folder <code class="docutils literal notranslate"><span class="pre">sample_data/areal_data/cancer_data.shp</span></code>.</li>
</ul>
<p>This tutorial requires understanding of concepts presented in <strong>Semivariogram Estimation</strong> and <strong>Variogram Point Cloud</strong> tutorials along with <strong>Ordinary and Simple Kriging</strong> notebook and (optionally) <strong>Semivariogram Regularization</strong> tutorial.</p>
</div>
<div class="section" id="Import-packages">
<h2>Import packages<a class="headerlink" href="#Import-packages" title="Permalink to this headline">¶</a></h2>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[1]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>
<span class="kn">import</span> <span class="nn">pandas</span> <span class="k">as</span> <span class="nn">pd</span>
<span class="kn">import</span> <span class="nn">geopandas</span> <span class="k">as</span> <span class="nn">gpd</span>

<span class="kn">import</span> <span class="nn">matplotlib.pyplot</span> <span class="k">as</span> <span class="nn">plt</span>

<span class="kn">from</span> <span class="nn">pyinterpolate.io_ops</span> <span class="kn">import</span> <span class="n">prepare_areal_shapefile</span>
<span class="kn">from</span> <span class="nn">pyinterpolate.semivariance</span> <span class="kn">import</span> <span class="n">build_variogram_point_cloud</span><span class="p">,</span> <span class="n">show_variogram_cloud</span><span class="p">,</span> <span class="n">remove_outliers</span>
<span class="kn">from</span> <span class="nn">pyinterpolate.semivariance</span> <span class="kn">import</span> <span class="n">calc_semivariance_from_pt_cloud</span>
<span class="kn">from</span> <span class="nn">pyinterpolate.semivariance</span> <span class="kn">import</span> <span class="n">TheoreticalSemivariogram</span>
<span class="kn">from</span> <span class="nn">pyinterpolate.kriging</span> <span class="kn">import</span> <span class="n">Krige</span>
</pre></div>
</div>
</div>
</div>
<div class="section" id="1)-Read-areal-data">
<h2>1) Read areal data<a class="headerlink" href="#1)-Read-areal-data" title="Permalink to this headline">¶</a></h2>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[2]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="n">areal</span> <span class="o">=</span> <span class="s1">&#39;../sample_data/areal_data/cancer_data.shp&#39;</span>
<span class="n">id_col</span> <span class="o">=</span> <span class="s1">&#39;FIPS&#39;</span>
<span class="n">val_col</span> <span class="o">=</span> <span class="s1">&#39;rate&#39;</span>
<span class="n">dataset</span> <span class="o">=</span> <span class="n">prepare_areal_shapefile</span><span class="p">(</span><span class="n">areal</span><span class="p">,</span> <span class="n">id_column_name</span><span class="o">=</span><span class="n">id_col</span><span class="p">,</span> <span class="n">value_column_name</span><span class="o">=</span><span class="n">val_col</span><span class="p">)</span>
<span class="n">dataset</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[2]:
</pre></div>
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
array([25019,
       &lt;shapely.geometry.multipolygon.MultiPolygon object at 0x7faac2192f10&gt;,
       2132629.599151873, 557971.1559491967, 192.2], dtype=object)
</pre></div></div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[3]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="n">data_centroids</span> <span class="o">=</span> <span class="n">dataset</span><span class="p">[:,</span> <span class="o">-</span><span class="mi">3</span><span class="p">:]</span>
<span class="n">data_centroids</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[3]:
</pre></div>
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
array([2132629.599151873, 557971.1559491967, 192.2], dtype=object)
</pre></div></div>
</div>
<div class="section" id="Clarification:">
<h3>Clarification:<a class="headerlink" href="#Clarification:" title="Permalink to this headline">¶</a></h3>
<p>Prepared areal shapefile has five columns: <code class="docutils literal notranslate"><span class="pre">[area</span> <span class="pre">id,</span> <span class="pre">geometry,</span> <span class="pre">centroid</span> <span class="pre">x,</span> <span class="pre">centroid</span> <span class="pre">y,</span> <span class="pre">value]</span></code>. We don’t need polygons’ geometry and areas’ id in the case of point kriging. Prepared array is sliced and in return we get array of centroids and their values. This is our base for modeling.</p>
</div>
</div>
<div class="section" id="2)-Detect-and-remove-outliers">
<h2>2) Detect and remove outliers<a class="headerlink" href="#2)-Detect-and-remove-outliers" title="Permalink to this headline">¶</a></h2>
<p>We check and clean data before semivariogram fit and Ordinary Kriging. Variogram Point Cloud is the best way to analyze data and detect outliers which may affect further analysis. We check and compare few different lags and step sizes and their respective point clouds. Then we will use those different number of ranges to create multiple semivariogram and Kriging models.</p>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[4]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="c1"># Create analysis parameters</span>

<span class="n">maximum_range</span> <span class="o">=</span> <span class="mi">300000</span>

<span class="n">number_of_lags</span> <span class="o">=</span> <span class="p">[</span><span class="mi">4</span><span class="p">,</span> <span class="mi">8</span><span class="p">,</span> <span class="mi">16</span><span class="p">]</span>
<span class="n">step_sizes</span> <span class="o">=</span> <span class="p">[</span><span class="n">maximum_range</span> <span class="o">/</span> <span class="n">x</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">number_of_lags</span><span class="p">]</span>

<span class="n">variogram_clouds</span> <span class="o">=</span> <span class="p">[]</span>

<span class="k">for</span> <span class="n">step_size</span> <span class="ow">in</span> <span class="n">step_sizes</span><span class="p">:</span>
    <span class="n">variogram_cloud</span> <span class="o">=</span> <span class="n">build_variogram_point_cloud</span><span class="p">(</span><span class="n">data_centroids</span><span class="p">,</span> <span class="n">step_size</span><span class="p">,</span> <span class="n">maximum_range</span><span class="p">)</span>
    <span class="n">variogram_clouds</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">variogram_cloud</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[5]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="k">for</span> <span class="n">idx</span><span class="p">,</span> <span class="n">lag</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">number_of_lags</span><span class="p">):</span>
    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;Lags per area: </span><span class="si">{</span><span class="n">lag</span><span class="o">-</span><span class="mi">1</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">)</span>
    <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;&#39;</span><span class="p">)</span>
    <span class="n">var_cloud</span> <span class="o">=</span> <span class="n">variogram_clouds</span><span class="p">[</span><span class="n">idx</span><span class="p">]</span>
    <span class="n">show_variogram_cloud</span><span class="p">(</span><span class="n">var_cloud</span><span class="p">,</span> <span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">12</span><span class="p">,</span> <span class="mi">8</span><span class="p">))</span>

    <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;</span><span class="se">\n</span><span class="s1">###########</span><span class="se">\n</span><span class="s1">&#39;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
Lags per area: 3

</pre></div></div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="../_images/tutorials_Blocks_to_points_Ordinary_Kriging_interpolation_(Intermediate)_9_1.png" src="../_images/tutorials_Blocks_to_points_Ordinary_Kriging_interpolation_(Intermediate)_9_1.png" />
</div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>

###########

Lags per area: 7

</pre></div></div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="../_images/tutorials_Blocks_to_points_Ordinary_Kriging_interpolation_(Intermediate)_9_3.png" src="../_images/tutorials_Blocks_to_points_Ordinary_Kriging_interpolation_(Intermediate)_9_3.png" />
</div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>

###########

Lags per area: 15

</pre></div></div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="../_images/tutorials_Blocks_to_points_Ordinary_Kriging_interpolation_(Intermediate)_9_5.png" src="../_images/tutorials_Blocks_to_points_Ordinary_Kriging_interpolation_(Intermediate)_9_5.png" />
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>

###########

</pre></div></div>
</div>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[6]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="c1"># Now remove outliers from each lag</span>

<span class="n">clouds_without_outliers</span> <span class="o">=</span> <span class="p">[</span><span class="n">remove_outliers</span><span class="p">(</span><span class="n">x</span><span class="p">)</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">variogram_clouds</span><span class="p">]</span>
</pre></div>
</div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[7]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="c1"># And show data without outliers</span>

<span class="k">for</span> <span class="n">idx</span><span class="p">,</span> <span class="n">lag</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">number_of_lags</span><span class="p">):</span>
    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;Lags per area: </span><span class="si">{</span><span class="n">lag</span><span class="o">-</span><span class="mi">1</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">)</span>
    <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;&#39;</span><span class="p">)</span>
    <span class="n">var_cloud</span> <span class="o">=</span> <span class="n">clouds_without_outliers</span><span class="p">[</span><span class="n">idx</span><span class="p">]</span>
    <span class="n">show_variogram_cloud</span><span class="p">(</span><span class="n">var_cloud</span><span class="p">,</span> <span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">12</span><span class="p">,</span> <span class="mi">8</span><span class="p">))</span>

    <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;</span><span class="se">\n</span><span class="s1">###########</span><span class="se">\n</span><span class="s1">&#39;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
Lags per area: 3

</pre></div></div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="../_images/tutorials_Blocks_to_points_Ordinary_Kriging_interpolation_(Intermediate)_11_1.png" src="../_images/tutorials_Blocks_to_points_Ordinary_Kriging_interpolation_(Intermediate)_11_1.png" />
</div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>

###########

Lags per area: 7

</pre></div></div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="../_images/tutorials_Blocks_to_points_Ordinary_Kriging_interpolation_(Intermediate)_11_3.png" src="../_images/tutorials_Blocks_to_points_Ordinary_Kriging_interpolation_(Intermediate)_11_3.png" />
</div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>

###########

Lags per area: 15

</pre></div></div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="../_images/tutorials_Blocks_to_points_Ordinary_Kriging_interpolation_(Intermediate)_11_5.png" src="../_images/tutorials_Blocks_to_points_Ordinary_Kriging_interpolation_(Intermediate)_11_5.png" />
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>

###########

</pre></div></div>
</div>
<div class="section" id="clarification-1">
<h3>Clarification:<a class="headerlink" href="#clarification-1" title="Permalink to this headline">¶</a></h3>
<p>It could be not visible, but we got rid off outliers from dataset. Look into <strong>y</strong> axes of variogram clouds with and without outliers for each lag. You hopefully see that maximum values after data cleaning are two times smaller. We can test different lags now to create semivariogram models.</p>
</div>
</div>
<div class="section" id="3.-Create-semivariogram-model">
<h2>3. Create semivariogram model<a class="headerlink" href="#3.-Create-semivariogram-model" title="Permalink to this headline">¶</a></h2>
<p>Semivariogram may be fitted manually or automatically. In this case we fit it automatically - we test multiple models and it’s easier to use <code class="docutils literal notranslate"><span class="pre">find_optimal_model()</span></code> method of <code class="docutils literal notranslate"><span class="pre">TheoreticalSemivariogram</span></code> object.</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[8]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="n">theoretical_semivariograms</span> <span class="o">=</span> <span class="p">[]</span>

<span class="k">for</span> <span class="n">idx</span><span class="p">,</span> <span class="n">cloud_model</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">clouds_without_outliers</span><span class="p">):</span>

    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;Semivariance calculated for </span><span class="si">{</span><span class="n">number_of_lags</span><span class="p">[</span><span class="n">idx</span><span class="p">]</span><span class="o">-</span><span class="mi">1</span><span class="si">}</span><span class="s1"> lags&#39;</span><span class="p">)</span>
    <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;&#39;</span><span class="p">)</span>
    <span class="c1"># Calculate experimental model</span>
    <span class="n">exp_model</span> <span class="o">=</span> <span class="n">calc_semivariance_from_pt_cloud</span><span class="p">(</span><span class="n">cloud_model</span><span class="p">)</span>

    <span class="c1"># Assign experimental model and data to TheoreticalSemivariogram</span>
    <span class="n">theo_semi</span> <span class="o">=</span> <span class="n">TheoreticalSemivariogram</span><span class="p">(</span><span class="n">points_array</span><span class="o">=</span><span class="n">data_centroids</span><span class="p">,</span>
                                         <span class="n">empirical_semivariance</span><span class="o">=</span><span class="n">exp_model</span><span class="p">,</span>
                                         <span class="n">verbose</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
    <span class="n">theo_semi</span><span class="o">.</span><span class="n">find_optimal_model</span><span class="p">(</span><span class="n">weighted</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">number_of_ranges</span><span class="o">=</span><span class="n">number_of_lags</span><span class="p">[</span><span class="n">idx</span><span class="p">])</span>
    <span class="n">theoretical_semivariograms</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">theo_semi</span><span class="p">)</span>
    <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;&#39;</span><span class="p">)</span>
    <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Model parameters:&#39;</span><span class="p">)</span>
    <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Nugget:&#39;</span><span class="p">,</span> <span class="n">theo_semi</span><span class="o">.</span><span class="n">nugget</span><span class="p">)</span>
    <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Sill:&#39;</span><span class="p">,</span> <span class="n">theo_semi</span><span class="o">.</span><span class="n">sill</span><span class="p">)</span>
    <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Range:&#39;</span><span class="p">,</span> <span class="n">theo_semi</span><span class="o">.</span><span class="n">range</span><span class="p">)</span>
    <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;&#39;</span><span class="p">)</span>
    <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;#####&#39;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
Semivariance calculated for 3 lags

Model: spherical, error value: 8.241434104749422
Model: exponential, error value: 12.299614574268972
Model: linear, error value: 15.092343387172065
Chosen model: spherical, with value of: 8.241434104749422.

Model parameters:
Nugget: 0
Sill: 109.61454851876229
Range: 150000.0

#####
Semivariance calculated for 7 lags

Model: spherical, error value: 10.49400071519736
Model: exponential, error value: 9.602477078573983
Model: linear, error value: 10.936407998381856
Chosen model: exponential, with value of: 9.602477078573983.

Model parameters:
Nugget: 0
Sill: 109.61454851876229
Range: 75000.0

#####
Semivariance calculated for 15 lags

Model: spherical, error value: 17.905475707567167
Model: exponential, error value: 13.926371661388727
Model: linear, error value: 19.2756575640517
Chosen model: exponential, with value of: 13.926371661388727.

Model parameters:
Nugget: 0
Sill: 109.61454851876229
Range: 37500.0

#####
</pre></div></div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area stderr docutils container">
<div class="highlight"><pre>
/Users/szymonmolinski/miniconda3/envs/pyint/lib/python3.7/site-packages/pyinterpolate/semivariance/semivariogram_fit/fit_semivariance.py:436: UserWarning: WARNING: linear model fitted to the experimental variogram is better than the core models!
  warnings.warn(warning_msg)
</pre></div></div>
</div>
<div class="section" id="clarification-2">
<h3>Clarification:<a class="headerlink" href="#clarification-2" title="Permalink to this headline">¶</a></h3>
<p><em>Exponential</em> model was chosen in each case. This model offers lowest error of fitting. If we look only into the error value then we may assume that the best model is for 4 lags… but when we compare different parameters of semivariogram model we see interesting things.</p>
<p><strong>Nugget</strong> of four lags is large and it’s 30 cases per 100,000 inhabitants. Why is that? Model with only four lags catches large distance near the zero origin and it introduces bias. Other lags have nugget close to 0.</p>
<p><strong>Range</strong> of the first model is very large compared to the areal bounds and it is a half of them. Range of 8 and 16 lags is closer to each other and more than two-three times smaller than range of 4 lags. It’s the same effect of large spacing for 4 lags.</p>
<p><strong>Sill</strong> is set to 109, it was derived from the grid search of potential sill values.</p>
<p>Summarizing: 4-lags model has lowest error of fit but largest nugget and range. 8- and 16-lags models have comparable nugget and range. Probably one of these models will be a better fit for Kriging.</p>
</div>
</div>
<div class="section" id="4.-Read-point-data-canvas">
<h2>4. Read point data canvas<a class="headerlink" href="#4.-Read-point-data-canvas" title="Permalink to this headline">¶</a></h2>
<p><strong>Pyinterpolate</strong> doesn’t have function for read point data directly from shapefile (2021-02-07) but we can do it with <strong>GeoPandas</strong> package. <strong>Pyinterpolate</strong> uses <strong>GeoPandas</strong> under the hood so there is no problem with import of this package.</p>
<p>We read point file as the <strong>GeoDataFrame</strong> object which stores geometry column and data features as tables.</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[9]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="n">points</span> <span class="o">=</span> <span class="s1">&#39;../sample_data/point_data/regular_grid_points.shp&#39;</span>  <span class="c1"># file with grid for analysis</span>
<span class="n">gdf_pts</span> <span class="o">=</span> <span class="n">gpd</span><span class="o">.</span><span class="n">read_file</span><span class="p">(</span><span class="n">points</span><span class="p">)</span>
<span class="n">gdf_pts</span><span class="o">.</span><span class="n">set_index</span><span class="p">(</span><span class="s1">&#39;id&#39;</span><span class="p">,</span> <span class="n">inplace</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
<span class="n">gdf_pts</span><span class="o">.</span><span class="n">head</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[9]:
</pre></div>
</div>
<div class="output_area rendered_html docutils container">
<div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>geometry</th>
    </tr>
    <tr>
      <th>id</th>
      <th></th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>81.0</th>
      <td>POINT (1277277.671 441124.507)</td>
    </tr>
    <tr>
      <th>82.0</th>
      <td>POINT (1277277.671 431124.507)</td>
    </tr>
    <tr>
      <th>83.0</th>
      <td>POINT (1277277.671 421124.507)</td>
    </tr>
    <tr>
      <th>84.0</th>
      <td>POINT (1277277.671 411124.507)</td>
    </tr>
    <tr>
      <th>85.0</th>
      <td>POINT (1277277.671 401124.507)</td>
    </tr>
  </tbody>
</table>
</div></div>
</div>
<p>Now we interpolate value for each point with Kriging. We use <code class="docutils literal notranslate"><span class="pre">apply()</span></code> on geometry column and create new columns of <em>GeoDataFrame</em> with interpolated results.</p>
</div>
<div class="section" id="5.-Build-map-of-interpolated-values">
<h2>5. Build map of interpolated values<a class="headerlink" href="#5.-Build-map-of-interpolated-values" title="Permalink to this headline">¶</a></h2>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[10]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="c1"># Set kriging models</span>

<span class="k">def</span> <span class="nf">krige_point</span><span class="p">(</span><span class="n">pt</span><span class="p">,</span> <span class="n">k_model</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Function predicts value at unknown location.</span>

<span class="sd">    INPUT:</span>

<span class="sd">    :param pt: (shapely Point),</span>
<span class="sd">    :param k_model: (Krige)</span>

<span class="sd">    OUTPUT:</span>

<span class="sd">    :return: (float)</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">xloc</span> <span class="o">=</span> <span class="n">pt</span><span class="o">.</span><span class="n">x</span>
    <span class="n">yloc</span> <span class="o">=</span> <span class="n">pt</span><span class="o">.</span><span class="n">y</span>
    <span class="n">val</span> <span class="o">=</span> <span class="n">k_model</span><span class="o">.</span><span class="n">ordinary_kriging</span><span class="p">(</span><span class="n">unknown_location</span><span class="o">=</span><span class="p">[</span><span class="n">xloc</span><span class="p">,</span> <span class="n">yloc</span><span class="p">])</span>
    <span class="k">return</span> <span class="n">pd</span><span class="o">.</span><span class="n">Series</span><span class="p">([</span><span class="n">val</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">val</span><span class="p">[</span><span class="mi">1</span><span class="p">]])</span>

<span class="n">kriging_models</span> <span class="o">=</span> <span class="p">[]</span>

<span class="k">for</span> <span class="n">idx</span><span class="p">,</span> <span class="n">semi_model</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">theoretical_semivariograms</span><span class="p">):</span>
    <span class="n">kriging_model</span> <span class="o">=</span> <span class="n">Krige</span><span class="p">(</span><span class="n">semivariogram_model</span><span class="o">=</span><span class="n">semi_model</span><span class="p">,</span> <span class="n">known_points</span><span class="o">=</span><span class="n">data_centroids</span><span class="p">)</span>
    <span class="n">col_name</span> <span class="o">=</span> <span class="s1">&#39;lags_&#39;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">number_of_lags</span><span class="p">[</span><span class="n">idx</span><span class="p">]</span><span class="o">-</span><span class="mi">1</span><span class="p">)</span>
    <span class="n">err_col_name</span> <span class="o">=</span> <span class="s1">&#39;e_&#39;</span> <span class="o">+</span> <span class="n">col_name</span>

    <span class="c1"># Interpolate missing values and uncertainty</span>
    <span class="n">gdf_pts</span><span class="p">[[</span><span class="n">col_name</span><span class="p">,</span> <span class="n">err_col_name</span><span class="p">]]</span> <span class="o">=</span> <span class="n">gdf_pts</span><span class="o">.</span><span class="n">geometry</span><span class="o">.</span><span class="n">apply</span><span class="p">(</span><span class="n">krige_point</span><span class="p">,</span> <span class="n">args</span><span class="o">=</span><span class="p">[</span><span class="n">kriging_model</span><span class="p">])</span>

    <span class="c1"># Append model</span>
    <span class="n">kriging_models</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">kriging_model</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[11]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="n">gdf_pts</span><span class="o">.</span><span class="n">head</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[11]:
</pre></div>
</div>
<div class="output_area rendered_html docutils container">
<div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>geometry</th>
      <th>lags_3</th>
      <th>e_lags_3</th>
      <th>lags_7</th>
      <th>e_lags_7</th>
      <th>lags_15</th>
      <th>e_lags_15</th>
    </tr>
    <tr>
      <th>id</th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>81.0</th>
      <td>POINT (1277277.671 441124.507)</td>
      <td>131.666933</td>
      <td>59.385887</td>
      <td>131.337370</td>
      <td>67.766214</td>
      <td>134.8</td>
      <td>130.459101</td>
    </tr>
    <tr>
      <th>82.0</th>
      <td>POINT (1277277.671 431124.507)</td>
      <td>128.719734</td>
      <td>57.028773</td>
      <td>131.168005</td>
      <td>63.188088</td>
      <td>134.8</td>
      <td>136.839561</td>
    </tr>
    <tr>
      <th>83.0</th>
      <td>POINT (1277277.671 421124.507)</td>
      <td>127.941703</td>
      <td>56.161701</td>
      <td>130.426622</td>
      <td>62.056515</td>
      <td>125.8</td>
      <td>132.505136</td>
    </tr>
    <tr>
      <th>84.0</th>
      <td>POINT (1277277.671 411124.507)</td>
      <td>127.776175</td>
      <td>55.355213</td>
      <td>129.984403</td>
      <td>61.382583</td>
      <td>125.8</td>
      <td>129.323233</td>
    </tr>
    <tr>
      <th>85.0</th>
      <td>POINT (1277277.671 401124.507)</td>
      <td>127.439055</td>
      <td>54.962963</td>
      <td>129.025893</td>
      <td>60.290506</td>
      <td>125.8</td>
      <td>133.023383</td>
    </tr>
  </tbody>
</table>
</div></div>
</div>
<div class="section" id="clarification-3">
<h3>Clarification:<a class="headerlink" href="#clarification-3" title="Permalink to this headline">¶</a></h3>
<p>This is rather complicated function in which we interpolate missing values as a new columns of <strong>GeoDataFrame</strong>. <em>Uncertainty</em> is assigned to interpolated results for further analysis.</p>
<p>Now we can save our <strong>GeoDataFrame</strong> as a shapefile…</p>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[12]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="c1"># Save interpolation results</span>

<span class="n">gdf_pts</span><span class="o">.</span><span class="n">to_file</span><span class="p">(</span><span class="s1">&#39;interpolation_results_areal_to_point.shp&#39;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<p>or check results directly in a notebook!</p>
</div>
</div>
<div class="section" id="6.-Show-map-of-interpolated-values-with-choropleth-map-of-breast-cancer-rates">
<h2>6. Show map of interpolated values with choropleth map of breast cancer rates<a class="headerlink" href="#6.-Show-map-of-interpolated-values-with-choropleth-map-of-breast-cancer-rates" title="Permalink to this headline">¶</a></h2>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[13]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="c1"># First read areal shapefile</span>

<span class="n">gdf</span> <span class="o">=</span> <span class="n">gpd</span><span class="o">.</span><span class="n">read_file</span><span class="p">(</span><span class="n">areal</span><span class="p">)</span>
<span class="n">gdf</span><span class="o">.</span><span class="n">head</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[13]:
</pre></div>
</div>
<div class="output_area rendered_html docutils container">
<div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>rate</th>
      <th>FIPS</th>
      <th>rate_float</th>
      <th>geometry</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>192.2</td>
      <td>25019</td>
      <td>192.2</td>
      <td>MULTIPOLYGON (((2115688.816 556471.240, 211569...</td>
    </tr>
    <tr>
      <th>1</th>
      <td>166.8</td>
      <td>36121</td>
      <td>166.8</td>
      <td>POLYGON ((1419423.430 564830.379, 1419729.721 ...</td>
    </tr>
    <tr>
      <th>2</th>
      <td>157.4</td>
      <td>33001</td>
      <td>157.4</td>
      <td>MULTIPOLYGON (((1937530.728 779787.978, 193751...</td>
    </tr>
    <tr>
      <th>3</th>
      <td>156.7</td>
      <td>25007</td>
      <td>156.7</td>
      <td>MULTIPOLYGON (((2074073.532 539159.504, 207411...</td>
    </tr>
    <tr>
      <th>4</th>
      <td>155.3</td>
      <td>25001</td>
      <td>155.3</td>
      <td>MULTIPOLYGON (((2095343.207 637424.961, 209528...</td>
    </tr>
  </tbody>
</table>
</div></div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[14]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="c1"># Now compare results to choropleth maps</span>

<span class="n">fs</span> <span class="o">=</span> <span class="p">(</span><span class="mi">6</span><span class="p">,</span> <span class="mi">8</span><span class="p">)</span>

<span class="k">for</span> <span class="n">lag</span> <span class="ow">in</span> <span class="n">number_of_lags</span><span class="p">:</span>
    <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Lag&#39;</span><span class="p">,</span> <span class="n">lag</span><span class="o">-</span><span class="mi">1</span><span class="p">)</span>
    <span class="n">col_name</span> <span class="o">=</span> <span class="s1">&#39;lags_&#39;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">lag</span><span class="o">-</span><span class="mi">1</span><span class="p">)</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">()</span>
    <span class="n">base</span> <span class="o">=</span> <span class="n">gdf</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="n">fs</span><span class="p">,</span> <span class="n">column</span><span class="o">=</span><span class="s1">&#39;rate&#39;</span><span class="p">,</span> <span class="n">cmap</span><span class="o">=</span><span class="s1">&#39;Spectral_r&#39;</span><span class="p">,</span> <span class="n">legend</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
    <span class="n">gdf_pts</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">ax</span><span class="o">=</span><span class="n">base</span><span class="p">,</span> <span class="n">column</span><span class="o">=</span><span class="n">col_name</span><span class="p">,</span> <span class="n">cmap</span><span class="o">=</span><span class="s1">&#39;Spectral_r&#39;</span><span class="p">)</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
    <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;######&#39;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
Lag 3
</pre></div></div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
&lt;Figure size 432x288 with 0 Axes&gt;
</pre></div></div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="../_images/tutorials_Blocks_to_points_Ordinary_Kriging_interpolation_(Intermediate)_27_2.png" src="../_images/tutorials_Blocks_to_points_Ordinary_Kriging_interpolation_(Intermediate)_27_2.png" />
</div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
######
Lag 7
</pre></div></div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
&lt;Figure size 432x288 with 0 Axes&gt;
</pre></div></div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="../_images/tutorials_Blocks_to_points_Ordinary_Kriging_interpolation_(Intermediate)_27_5.png" src="../_images/tutorials_Blocks_to_points_Ordinary_Kriging_interpolation_(Intermediate)_27_5.png" />
</div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
######
Lag 15
</pre></div></div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
&lt;Figure size 432x288 with 0 Axes&gt;
</pre></div></div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="../_images/tutorials_Blocks_to_points_Ordinary_Kriging_interpolation_(Intermediate)_27_8.png" src="../_images/tutorials_Blocks_to_points_Ordinary_Kriging_interpolation_(Intermediate)_27_8.png" />
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
######
</pre></div></div>
</div>
<div class="section" id="clarification-4">
<h3>Clarification:<a class="headerlink" href="#clarification-4" title="Permalink to this headline">¶</a></h3>
<p>Visual inspection shows that:</p>
<ol class="arabic simple">
<li>Interpolated results are more smoothed over area and in the most part of a map they are similar to the rate observed in specific county.</li>
<li>Why map with the largest number of lags has the largest areas with similar values? (Large blocks). It is related to the maximum range of analysis. Optimal range is smallest for the area with 15 lags.</li>
<li>Are differences between those maps large or small?</li>
</ol>
<p>To answer the last question we calculate the Mean Absolute Difference between each lag’s interpolated results.</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[15]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="k">for</span> <span class="n">lag1</span> <span class="ow">in</span> <span class="n">number_of_lags</span><span class="p">:</span>
    <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;LAG:&#39;</span><span class="p">,</span> <span class="n">lag1</span><span class="o">-</span><span class="mi">1</span><span class="p">)</span>
    <span class="n">col_name1</span> <span class="o">=</span> <span class="s1">&#39;lags_&#39;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">lag1</span><span class="o">-</span><span class="mi">1</span><span class="p">)</span>
    <span class="k">for</span> <span class="n">lag2</span> <span class="ow">in</span> <span class="n">number_of_lags</span><span class="p">:</span>
        <span class="k">if</span> <span class="n">lag1</span> <span class="o">==</span> <span class="n">lag2</span><span class="p">:</span>
            <span class="k">pass</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">col_name2</span> <span class="o">=</span> <span class="s1">&#39;lags_&#39;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">lag2</span><span class="o">-</span><span class="mi">1</span><span class="p">)</span>
            <span class="n">mad</span> <span class="o">=</span> <span class="n">gdf_pts</span><span class="p">[</span><span class="n">col_name1</span><span class="p">]</span> <span class="o">-</span> <span class="n">gdf_pts</span><span class="p">[</span><span class="n">col_name2</span><span class="p">]</span>
            <span class="n">mad</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">abs</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="n">mad</span><span class="p">))</span>
            <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;&#39;</span><span class="p">)</span>
            <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;Mean Absolute Difference between lag </span><span class="si">{</span><span class="n">lag1</span><span class="o">-</span><span class="mi">1</span><span class="si">}</span><span class="s1"> and lag </span><span class="si">{</span><span class="n">lag2</span><span class="o">-</span><span class="mi">1</span><span class="si">}</span><span class="s1"> is </span><span class="si">{</span><span class="n">mad</span><span class="si">:</span><span class="s1">.6f</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">)</span>
            <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;&#39;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
LAG: 3

Mean Absolute Difference between lag 3 and lag 7 is 0.035865


Mean Absolute Difference between lag 3 and lag 15 is 0.026831

LAG: 7

Mean Absolute Difference between lag 7 and lag 3 is 0.035865


Mean Absolute Difference between lag 7 and lag 15 is 0.062696

LAG: 15

Mean Absolute Difference between lag 15 and lag 3 is 0.026831


Mean Absolute Difference between lag 15 and lag 7 is 0.062696

</pre></div></div>
</div>
</div>
<div class="section" id="clarification-5">
<h3>Clarification:<a class="headerlink" href="#clarification-5" title="Permalink to this headline">¶</a></h3>
<p>As you see those differences are really small. Each semivariogram model is similar in this case. In this case we can use <strong>4-lag</strong> model. It will be calculted faster than other models and it is still very similar to other models.</p>
<hr class="docutils" />
</div>
</div>
</div>


          </div>
          
        </div>
      </div>
      <div class="sphinxsidebar" role="navigation" aria-label="main navigation">
        <div class="sphinxsidebarwrapper">
<h1 class="logo"><a href="../index.html">Pyinterpolate</a></h1>








<h3>Navigation</h3>
<ul class="current">
<li class="toctree-l1"><a class="reference internal" href="../introduction.html">Introduction</a></li>
<li class="toctree-l1"><a class="reference internal" href="../setup.html">Setup</a></li>
<li class="toctree-l1 current"><a class="reference internal" href="../tutorials.html">Tutorials</a></li>
<li class="toctree-l1"><a class="reference internal" href="../code_documentation.html">Documentation</a></li>
<li class="toctree-l1"><a class="reference internal" href="../algorithms.html">Algorithms Explained</a></li>
<li class="toctree-l1"><a class="reference internal" href="../contribution.html">Contribution to Pyinterpolate</a></li>
<li class="toctree-l1"><a class="reference internal" href="../license.html">License</a></li>
</ul>

<div class="relations">
<h3>Related Topics</h3>
<ul>
  <li><a href="../index.html">Documentation overview</a><ul>
  <li><a href="../tutorials.html">Tutorials</a><ul>
      <li>Previous: <a href="How good is our Kriging model - test  it with IDW algorithm (Basic).html" title="previous chapter">How good is my Kriging model? - tests with IDW algorithm - tutorial</a></li>
      <li>Next: <a href="Semivariogram Regularization (Intermediate).html" title="next chapter">Semivariogram regularization - tutorial</a></li>
  </ul></li>
  </ul></li>
</ul>
</div>
<div id="searchbox" style="display: none" role="search">
  <h3>Quick search</h3>
    <div class="searchformwrapper">
    <form class="search" action="../search.html" method="get">
      <input type="text" name="q" />
      <input type="submit" value="Go" />
      <input type="hidden" name="check_keywords" value="yes" />
      <input type="hidden" name="area" value="default" />
    </form>
    </div>
</div>
<script type="text/javascript">$('#searchbox').show(0);</script>








        </div>
      </div>
      <div class="clearer"></div>
    </div>
    <div class="footer">
      &copy;2021, Szymon Moliński.
      
      |
      Powered by <a href="http://sphinx-doc.org/">Sphinx 1.8.5</a>
      &amp; <a href="https://github.com/bitprophet/alabaster">Alabaster 0.7.12</a>
      
      |
      <a href="../_sources/tutorials/Blocks to points Ordinary Kriging interpolation (Intermediate).ipynb.txt"
          rel="nofollow">Page source</a>
    </div>

    

    
  </body>
</html>