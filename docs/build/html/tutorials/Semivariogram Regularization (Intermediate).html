
<!DOCTYPE html>

<html>
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Semivariogram regularization - tutorial &#8212; Pyinterpolate 0.2.0 documentation</title>
    <link rel="stylesheet" href="../_static/pygments.css" type="text/css" />
    <link rel="stylesheet" href="../_static/alabaster.css" type="text/css" />
    <script id="documentation_options" data-url_root="../" src="../_static/documentation_options.js"></script>
    <script src="../_static/jquery.js"></script>
    <script src="../_static/underscore.js"></script>
    <script src="../_static/doctools.js"></script>
    <script crossorigin="anonymous" integrity="sha256-Ae2Vz/4ePdIu6ZyI/5ZGsYnb+m0JlOmKPjt6XZ9JJkA=" src="https://cdnjs.cloudflare.com/ajax/libs/require.js/2.3.4/require.min.js"></script>
    <script async="async" src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.7/latest.js?config=TeX-AMS-MML_HTMLorMML"></script>
    <script type="text/x-mathjax-config">MathJax.Hub.Config({"tex2jax": {"inlineMath": [["$", "$"], ["\\(", "\\)"]], "processEscapes": true, "ignoreClass": "document", "processClass": "math|output_area"}})</script>
    <link rel="index" title="Index" href="../genindex.html" />
    <link rel="search" title="Search" href="../search.html" />
    <link rel="next" title="Poisson Kriging - centroid based approach - tutorial" href="Poisson%20Kriging%20-%20Centroid%20Based%20%28Advanced%29.html" />
    <link rel="prev" title="Ordinary and Simple Kriging - tutorial" href="Ordinary%20and%20Simple%20Kriging%20%28Basic%29.html" />
   
  <link rel="stylesheet" href="../_static/custom.css" type="text/css" />
  
  
  <meta name="viewport" content="width=device-width, initial-scale=0.9, maximum-scale=0.9" />

  </head><body>
  

    <div class="document">
      <div class="documentwrapper">
        <div class="bodywrapper">
          

          <div class="body" role="main">
            
  
<style>
/* CSS for nbsphinx extension */

/* remove conflicting styling from Sphinx themes */
div.nbinput.container div.prompt *,
div.nboutput.container div.prompt *,
div.nbinput.container div.input_area pre,
div.nboutput.container div.output_area pre,
div.nbinput.container div.input_area .highlight,
div.nboutput.container div.output_area .highlight {
    border: none;
    padding: 0;
    margin: 0;
    box-shadow: none;
}

div.nbinput.container > div[class*=highlight],
div.nboutput.container > div[class*=highlight] {
    margin: 0;
}

div.nbinput.container div.prompt *,
div.nboutput.container div.prompt * {
    background: none;
}

div.nboutput.container div.output_area .highlight,
div.nboutput.container div.output_area pre {
    background: unset;
}

div.nboutput.container div.output_area div.highlight {
    color: unset;  /* override Pygments text color */
}

/* avoid gaps between output lines */
div.nboutput.container div[class*=highlight] pre {
    line-height: normal;
}

/* input/output containers */
div.nbinput.container,
div.nboutput.container {
    display: -webkit-flex;
    display: flex;
    align-items: flex-start;
    margin: 0;
    width: 100%;
}
@media (max-width: 540px) {
    div.nbinput.container,
    div.nboutput.container {
        flex-direction: column;
    }
}

/* input container */
div.nbinput.container {
    padding-top: 5px;
}

/* last container */
div.nblast.container {
    padding-bottom: 5px;
}

/* input prompt */
div.nbinput.container div.prompt pre {
    color: #307FC1;
}

/* output prompt */
div.nboutput.container div.prompt pre {
    color: #BF5B3D;
}

/* all prompts */
div.nbinput.container div.prompt,
div.nboutput.container div.prompt {
    width: 4.5ex;
    padding-top: 5px;
    position: relative;
    user-select: none;
}

div.nbinput.container div.prompt > div,
div.nboutput.container div.prompt > div {
    position: absolute;
    right: 0;
    margin-right: 0.3ex;
}

@media (max-width: 540px) {
    div.nbinput.container div.prompt,
    div.nboutput.container div.prompt {
        width: unset;
        text-align: left;
        padding: 0.4em;
    }
    div.nboutput.container div.prompt.empty {
        padding: 0;
    }

    div.nbinput.container div.prompt > div,
    div.nboutput.container div.prompt > div {
        position: unset;
    }
}

/* disable scrollbars on prompts */
div.nbinput.container div.prompt pre,
div.nboutput.container div.prompt pre {
    overflow: hidden;
}

/* input/output area */
div.nbinput.container div.input_area,
div.nboutput.container div.output_area {
    -webkit-flex: 1;
    flex: 1;
    overflow: auto;
}
@media (max-width: 540px) {
    div.nbinput.container div.input_area,
    div.nboutput.container div.output_area {
        width: 100%;
    }
}

/* input area */
div.nbinput.container div.input_area {
    border: 1px solid #e0e0e0;
    border-radius: 2px;
    /*background: #f5f5f5;*/
}

/* override MathJax center alignment in output cells */
div.nboutput.container div[class*=MathJax] {
    text-align: left !important;
}

/* override sphinx.ext.imgmath center alignment in output cells */
div.nboutput.container div.math p {
    text-align: left;
}

/* standard error */
div.nboutput.container div.output_area.stderr {
    background: #fdd;
}

/* ANSI colors */
.ansi-black-fg { color: #3E424D; }
.ansi-black-bg { background-color: #3E424D; }
.ansi-black-intense-fg { color: #282C36; }
.ansi-black-intense-bg { background-color: #282C36; }
.ansi-red-fg { color: #E75C58; }
.ansi-red-bg { background-color: #E75C58; }
.ansi-red-intense-fg { color: #B22B31; }
.ansi-red-intense-bg { background-color: #B22B31; }
.ansi-green-fg { color: #00A250; }
.ansi-green-bg { background-color: #00A250; }
.ansi-green-intense-fg { color: #007427; }
.ansi-green-intense-bg { background-color: #007427; }
.ansi-yellow-fg { color: #DDB62B; }
.ansi-yellow-bg { background-color: #DDB62B; }
.ansi-yellow-intense-fg { color: #B27D12; }
.ansi-yellow-intense-bg { background-color: #B27D12; }
.ansi-blue-fg { color: #208FFB; }
.ansi-blue-bg { background-color: #208FFB; }
.ansi-blue-intense-fg { color: #0065CA; }
.ansi-blue-intense-bg { background-color: #0065CA; }
.ansi-magenta-fg { color: #D160C4; }
.ansi-magenta-bg { background-color: #D160C4; }
.ansi-magenta-intense-fg { color: #A03196; }
.ansi-magenta-intense-bg { background-color: #A03196; }
.ansi-cyan-fg { color: #60C6C8; }
.ansi-cyan-bg { background-color: #60C6C8; }
.ansi-cyan-intense-fg { color: #258F8F; }
.ansi-cyan-intense-bg { background-color: #258F8F; }
.ansi-white-fg { color: #C5C1B4; }
.ansi-white-bg { background-color: #C5C1B4; }
.ansi-white-intense-fg { color: #A1A6B2; }
.ansi-white-intense-bg { background-color: #A1A6B2; }

.ansi-default-inverse-fg { color: #FFFFFF; }
.ansi-default-inverse-bg { background-color: #000000; }

.ansi-bold { font-weight: bold; }
.ansi-underline { text-decoration: underline; }


div.nbinput.container div.input_area div[class*=highlight] > pre,
div.nboutput.container div.output_area div[class*=highlight] > pre,
div.nboutput.container div.output_area div[class*=highlight].math,
div.nboutput.container div.output_area.rendered_html,
div.nboutput.container div.output_area > div.output_javascript,
div.nboutput.container div.output_area:not(.rendered_html) > img{
    padding: 5px;
    margin: 0;
}

/* fix copybtn overflow problem in chromium (needed for 'sphinx_copybutton') */
div.nbinput.container div.input_area > div[class^='highlight'],
div.nboutput.container div.output_area > div[class^='highlight']{
    overflow-y: hidden;
}

/* hide copybtn icon on prompts (needed for 'sphinx_copybutton') */
.prompt a.copybtn {
    display: none;
}

/* Some additional styling taken form the Jupyter notebook CSS */
div.rendered_html table {
  border: none;
  border-collapse: collapse;
  border-spacing: 0;
  color: black;
  font-size: 12px;
  table-layout: fixed;
}
div.rendered_html thead {
  border-bottom: 1px solid black;
  vertical-align: bottom;
}
div.rendered_html tr,
div.rendered_html th,
div.rendered_html td {
  text-align: right;
  vertical-align: middle;
  padding: 0.5em 0.5em;
  line-height: normal;
  white-space: normal;
  max-width: none;
  border: none;
}
div.rendered_html th {
  font-weight: bold;
}
div.rendered_html tbody tr:nth-child(odd) {
  background: #f5f5f5;
}
div.rendered_html tbody tr:hover {
  background: rgba(66, 165, 245, 0.2);
}
</style>
<div class="section" id="Semivariogram-regularization---tutorial">
<h1>Semivariogram regularization - tutorial<a class="headerlink" href="#Semivariogram-regularization---tutorial" title="Permalink to this headline">¶</a></h1>
<div class="section" id="Table-of-Contents:">
<h2>Table of Contents:<a class="headerlink" href="#Table-of-Contents:" title="Permalink to this headline">¶</a></h2>
<ol class="arabic simple">
<li><p>Prepare areal and point data,</p></li>
<li><p>Set semivariogram parameters,</p></li>
<li><p>Perform regularization,</p></li>
<li><p>Visualize regularized semivariogram and analyze algorithm performance,</p></li>
<li><p>Export semivariogram to text file.</p></li>
</ol>
</div>
<div class="section" id="Level:-Intermediate">
<h2>Level: Intermediate<a class="headerlink" href="#Level:-Intermediate" title="Permalink to this headline">¶</a></h2>
</div>
<div class="section" id="Introduction">
<h2>Introduction<a class="headerlink" href="#Introduction" title="Permalink to this headline">¶</a></h2>
<p>In this tutorial we learn how to regularize semivariogram of areal dataset of irregular polygons. Procedure is described here: (1) Goovaerts P., Kriging and Semivariogram Deconvolution in the Presence of Irregular Geographical Units, Mathematical Geology 40(1), 101-128, 2008.</p>
<p>The main idea is to retrieve point support semivariogram from semivariogram of areal data with blocks of different shapes and sizes. It is the case in mining industry, where blocks of aggregates are deconvoluted into smaller units and in the epidemiology, where data is usually aggregated over big administrative units, or in ecology, where observations of species are aggregated over areas or time windows.</p>
<p>In this tutorial we use areal data of road accidents per county in Poland along with the point support data of population smaller support blocks.</p>
<blockquote>
<div><p>Road accidents data is stored in the shapefile in folder ‘sample_data/areal_data/road_accidents.shp’</p>
</div></blockquote>
<blockquote>
<div><p>Population blocks data is stored in the shapefile in folder ‘sample_data/population_data/population_centroids_poland.shp’</p>
</div></blockquote>
</div>
<div class="section" id="Import-packages">
<h2>Import packages<a class="headerlink" href="#Import-packages" title="Permalink to this headline">¶</a></h2>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[1]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>
<span class="kn">import</span> <span class="nn">geopandas</span> <span class="k">as</span> <span class="nn">gpd</span>

<span class="kn">from</span> <span class="nn">pyinterpolate.io_ops</span> <span class="kn">import</span> <span class="n">prepare_areal_shapefile</span><span class="p">,</span> <span class="n">get_points_within_area</span>  <span class="c1"># Prepare data</span>
<span class="kn">from</span> <span class="nn">pyinterpolate.semivariance</span> <span class="kn">import</span> <span class="n">calculate_semivariance</span>  <span class="c1"># Experimental semivariogram</span>
<span class="kn">from</span> <span class="nn">pyinterpolate.semivariance</span> <span class="kn">import</span> <span class="n">RegularizedSemivariogram</span>  <span class="c1"># Semivariogram regularization class</span>

<span class="kn">import</span> <span class="nn">matplotlib.pyplot</span> <span class="k">as</span> <span class="nn">plt</span>
</pre></div>
</div>
</div>
</div>
<div class="section" id="1)-Prepare-areal-and-point-data">
<h2>1) Prepare areal and point data<a class="headerlink" href="#1)-Prepare-areal-and-point-data" title="Permalink to this headline">¶</a></h2>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[2]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="n">areal_data</span> <span class="o">=</span> <span class="s1">&#39;../sample_data/areal_data/road_accidents.shp&#39;</span>
<span class="n">point_data</span> <span class="o">=</span> <span class="s1">&#39;../sample_data/population_data/population_centroids_poland.shp&#39;</span>

<span class="c1"># The important thing before analysis is to check if crs of areal data and point data are the same</span>

<span class="n">areal_crs</span> <span class="o">=</span> <span class="n">gpd</span><span class="o">.</span><span class="n">read_file</span><span class="p">(</span><span class="n">areal_data</span><span class="p">)</span><span class="o">.</span><span class="n">crs</span>
<span class="n">point_support_crs</span> <span class="o">=</span> <span class="n">gpd</span><span class="o">.</span><span class="n">read_file</span><span class="p">(</span><span class="n">point_data</span><span class="p">)</span><span class="o">.</span><span class="n">crs</span>

<span class="n">areal_crs</span> <span class="o">==</span> <span class="n">point_support_crs</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[2]:
</pre></div>
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
True
</pre></div></div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[3]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="c1"># We need to know:</span>
<span class="c1"># - id column name of areal units,</span>
<span class="c1"># - value column name of areal units (usually aggregates),</span>
<span class="c1"># - value column name of point support units (usually population)</span>

<span class="c1"># Let&#39;s check it quickly with geopandas</span>

<span class="n">areal</span> <span class="o">=</span> <span class="n">gpd</span><span class="o">.</span><span class="n">read_file</span><span class="p">(</span><span class="n">areal_data</span><span class="p">)</span>
<span class="n">areal</span><span class="o">.</span><span class="n">head</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[3]:
</pre></div>
</div>
<div class="output_area rendered_html docutils container">
<div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>ID</th>
      <th>VOIVOD</th>
      <th>NAME</th>
      <th>deaths</th>
      <th>inh</th>
      <th>rate</th>
      <th>geometry</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>915</td>
      <td>podkarpackie</td>
      <td>powiat ropczycko-sÄdziszowski</td>
      <td>3</td>
      <td>74198</td>
      <td>0.040432</td>
      <td>POLYGON ((692305.365 260282.248, 692313.646 26...</td>
    </tr>
    <tr>
      <th>1</th>
      <td>710</td>
      <td>mazowieckie</td>
      <td>powiat Åosicki</td>
      <td>6</td>
      <td>31335</td>
      <td>0.191479</td>
      <td>POLYGON ((753920.175 497017.076, 753918.822 49...</td>
    </tr>
    <tr>
      <th>2</th>
      <td>718</td>
      <td>mazowieckie</td>
      <td>powiat piaseczyÅski</td>
      <td>15</td>
      <td>182076</td>
      <td>0.082383</td>
      <td>POLYGON ((644442.384 473992.041, 644345.678 47...</td>
    </tr>
    <tr>
      <th>3</th>
      <td>727</td>
      <td>mazowieckie</td>
      <td>powiat sierpecki</td>
      <td>7</td>
      <td>52559</td>
      <td>0.133184</td>
      <td>POLYGON ((534236.749 555932.727, 534235.027 55...</td>
    </tr>
    <tr>
      <th>4</th>
      <td>730</td>
      <td>mazowieckie</td>
      <td>powiat szydÅowiecki</td>
      <td>4</td>
      <td>39938</td>
      <td>0.100155</td>
      <td>POLYGON ((625514.215 384549.238, 625545.119 38...</td>
    </tr>
  </tbody>
</table>
</div></div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[4]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="c1"># From areal file we are interested in variable deaths (value) and ID (id)</span>
<span class="c1"># Now check point support data</span>

<span class="n">point</span> <span class="o">=</span> <span class="n">gpd</span><span class="o">.</span><span class="n">read_file</span><span class="p">(</span><span class="n">point_data</span><span class="p">)</span>
<span class="n">point</span><span class="o">.</span><span class="n">head</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[4]:
</pre></div>
</div>
<div class="output_area rendered_html docutils container">
<div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>TOT</th>
      <th>geometry</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>0</td>
      <td>POINT (445700.430 775061.580)</td>
    </tr>
    <tr>
      <th>1</th>
      <td>13</td>
      <td>POINT (449649.816 774784.622)</td>
    </tr>
    <tr>
      <th>2</th>
      <td>1270</td>
      <td>POINT (454573.872 774546.994)</td>
    </tr>
    <tr>
      <th>3</th>
      <td>95</td>
      <td>POINT (457672.822 774072.742)</td>
    </tr>
    <tr>
      <th>4</th>
      <td>0</td>
      <td>POINT (425378.686 772864.038)</td>
    </tr>
  </tbody>
</table>
</div></div>
</div>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[5]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="c1"># Column TOT is interesting from our perspective</span>
<span class="c1"># Now prepare data for further processing</span>

<span class="n">areal_id</span> <span class="o">=</span> <span class="s1">&#39;ID&#39;</span>
<span class="n">areal_val</span> <span class="o">=</span> <span class="s1">&#39;deaths&#39;</span>
<span class="n">points_val</span> <span class="o">=</span> <span class="s1">&#39;TOT&#39;</span>

<span class="n">areal_data_prepared</span> <span class="o">=</span> <span class="n">prepare_areal_shapefile</span><span class="p">(</span><span class="n">areal_data</span><span class="p">,</span> <span class="n">areal_id</span><span class="p">,</span> <span class="n">areal_val</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[6]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="c1"># Check how prepared areal data looks like</span>

<span class="n">areal_data_prepared</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[6]:
</pre></div>
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
array([915, &lt;shapely.geometry.polygon.Polygon object at 0x7fc632d10250&gt;,
       689225.7862175289, 245704.52509337224, 3], dtype=object)
</pre></div></div>
</div>
<div class="section" id="Clarification:">
<h3>Clarification:<a class="headerlink" href="#Clarification:" title="Permalink to this headline">¶</a></h3>
<p>Every areal dataset is passed as an array of:</p>
<p>[area id, area geometry (polygon), areal centroid x (lon), areal centroid y (lat), value]</p>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[7]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="n">points_in_area</span> <span class="o">=</span> <span class="n">get_points_within_area</span><span class="p">(</span><span class="n">areal_data</span><span class="p">,</span> <span class="n">point_data</span><span class="p">,</span> <span class="n">areal_id_col_name</span><span class="o">=</span><span class="n">areal_id</span><span class="p">,</span>
                                        <span class="n">points_val_col_name</span><span class="o">=</span><span class="n">points_val</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[8]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="c1"># Check how prepared point data looks like</span>

<span class="n">points_in_area</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[8]:
</pre></div>
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
array([1112.0,
       array([[4.49649816e+05, 7.74784622e+05, 1.30000000e+01],
       [4.54573872e+05, 7.74546994e+05, 1.27000000e+03],
       [4.57672822e+05, 7.74072742e+05, 9.50000000e+01],
       [4.34132306e+05, 7.73217942e+05, 5.81000000e+02],
       [4.39115084e+05, 7.73011892e+05, 1.99000000e+02],
       [4.44027632e+05, 7.72564517e+05, 7.50000000e+02],
       [4.48983771e+05, 7.71947376e+05, 2.57400000e+03],
       [4.53943595e+05, 7.71324042e+05, 1.21200000e+03],
       [4.58775918e+05, 7.70575412e+05, 6.34600000e+03],
       [4.33469881e+05, 7.68864048e+05, 1.92600000e+03],
       [4.43389339e+05, 7.67616758e+05, 1.94300000e+03],
       [4.48349167e+05, 7.66993362e+05, 1.99000000e+03],
       [4.53309065e+05, 7.66370130e+05, 2.74500000e+03],
       [4.58269037e+05, 7.65747062e+05, 2.90200000e+03],
       [4.73064428e+05, 7.63569749e+05, 6.22000000e+02],
       [4.76799027e+05, 7.61514013e+05, 0.00000000e+00],
       [4.42754940e+05, 7.62662657e+05, 9.23000000e+02],
       [4.47714840e+05, 7.62039366e+05, 9.29000000e+02],
       [4.52674811e+05, 7.61416236e+05, 1.46600000e+03],
       [4.57634855e+05, 7.60793269e+05, 2.32700000e+03],
       [4.62363515e+05, 7.59981791e+05, 1.23400000e+04],
       [4.65584380e+05, 7.58641509e+05, 3.46000000e+02],
       [4.78479221e+05, 7.59743463e+05, 2.72900000e+03],
       [4.82357689e+05, 7.57078158e+05, 6.19000000e+02],
       [4.52040835e+05, 7.56462359e+05, 5.94000000e+02],
       [4.57000951e+05, 7.55839493e+05, 1.32600000e+03],
       [4.61961143e+05, 7.55216784e+05, 6.74400000e+03],
       [4.65921996e+05, 7.54103558e+05, 1.03800000e+03],
       [4.83759055e+05, 7.54175233e+05, 0.00000000e+00],
       [4.86606609e+05, 7.51932609e+05, 6.58000000e+02],
       [4.61327585e+05, 7.50263124e+05, 3.34800000e+03],
       [4.66280631e+05, 7.49636244e+05, 5.72400000e+03],
       [4.69447296e+05, 7.47858411e+05, 2.22000000e+02],
       [4.87526826e+05, 7.48594231e+05, 3.25900000e+03],
       [4.65654714e+05, 7.44687123e+05, 3.94770000e+04]])], dtype=object)
</pre></div></div>
</div>
</div>
<div class="section" id="id1">
<h3>Clarification:<a class="headerlink" href="#id1" title="Permalink to this headline">¶</a></h3>
<p>Every point support dataset is passed as an array of:</p>
<p>[area id, array of: [lon, lat, value]]</p>
</div>
</div>
<div class="section" id="2)-Set-semivariogram-parameters.">
<h2>2) Set semivariogram parameters.<a class="headerlink" href="#2)-Set-semivariogram-parameters." title="Permalink to this headline">¶</a></h2>
<p>Now we must set parameters for areal semivariogram AND point semivariogram. It is very important to understand data well to set them properly, that’s why you should always check experimental semivariograms of those datasets to understand how data behaves. We do it for prepared areal and point datasets.</p>
<p>From the practical point of view area semivariogram analysis is more important because we pass into semivariogram regularization parameters of step size and maximum search radius. But we check point’s semivariogram too. It is analytical step, to check if spatial process whoch we are using for semivariogram deconvolution is proper, as example if semivariogram shows exponential function then our process will not be properly modeled.</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[9]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="c1"># Check experimental semivariogram of areal data - this cell may be run multiple times</span>
<span class="c1"># before you find optimal parameters</span>

<span class="n">maximum_range</span> <span class="o">=</span> <span class="mi">160000</span>
<span class="n">step_size</span> <span class="o">=</span> <span class="mi">16000</span>

<span class="n">dt</span> <span class="o">=</span> <span class="n">areal_data_prepared</span><span class="p">[:,</span> <span class="mi">2</span><span class="p">:]</span>  <span class="c1"># x, y, val</span>
<span class="n">exp_semivar</span> <span class="o">=</span> <span class="n">calculate_semivariance</span><span class="p">(</span><span class="n">data</span><span class="o">=</span><span class="n">dt</span><span class="p">,</span> <span class="n">step_size</span><span class="o">=</span><span class="n">step_size</span><span class="p">,</span> <span class="n">max_range</span><span class="o">=</span><span class="n">maximum_range</span><span class="p">)</span>

<span class="c1"># Plot experimental semivariogram</span>

<span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">12</span><span class="p">,</span> <span class="mi">12</span><span class="p">))</span>
<span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">exp_semivar</span><span class="p">[:,</span> <span class="mi">0</span><span class="p">],</span> <span class="n">exp_semivar</span><span class="p">[:,</span> <span class="mi">1</span><span class="p">])</span>
<span class="n">plt</span><span class="o">.</span><span class="n">title</span><span class="p">(</span><span class="s1">&#39;Experimental semivariogram od areal centroids&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">xlabel</span><span class="p">(</span><span class="s1">&#39;Range - in meters&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="s1">&#39;Semivariance&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="../_images/tutorials_Semivariogram_Regularization_(Intermediate)_14_0.png" src="../_images/tutorials_Semivariogram_Regularization_(Intermediate)_14_0.png" />
</div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[10]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="c1"># Check experimental semivariogram of point data - this cell may be run multiple times</span>
<span class="c1"># before you find optimal parameters</span>

<span class="k">def</span> <span class="nf">build_point_array</span><span class="p">(</span><span class="n">points</span><span class="p">):</span>
    <span class="n">a</span> <span class="o">=</span> <span class="kc">None</span>

    <span class="k">for</span> <span class="n">rec</span> <span class="ow">in</span> <span class="n">points</span><span class="p">:</span>
        <span class="k">if</span> <span class="n">a</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">a</span> <span class="o">=</span> <span class="n">rec</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">a</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">vstack</span><span class="p">((</span><span class="n">a</span><span class="p">,</span> <span class="n">rec</span><span class="p">))</span>

    <span class="k">return</span> <span class="n">a</span>

<span class="n">maximum_point_range</span> <span class="o">=</span> <span class="mi">40000</span>
<span class="n">step_size_points</span> <span class="o">=</span> <span class="mi">8000</span>


<span class="n">pt</span> <span class="o">=</span> <span class="n">build_point_array</span><span class="p">(</span><span class="n">points_in_area</span><span class="p">[:,</span> <span class="mi">1</span><span class="p">])</span>  <span class="c1"># x, y, val</span>
<span class="n">exp_semivar</span> <span class="o">=</span> <span class="n">calculate_semivariance</span><span class="p">(</span><span class="n">data</span><span class="o">=</span><span class="n">pt</span><span class="p">,</span> <span class="n">step_size</span><span class="o">=</span><span class="n">step_size_points</span><span class="p">,</span> <span class="n">max_range</span><span class="o">=</span><span class="n">maximum_point_range</span><span class="p">)</span>

<span class="c1"># Plot experimental semivariogram</span>

<span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">12</span><span class="p">,</span> <span class="mi">12</span><span class="p">))</span>
<span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">exp_semivar</span><span class="p">[:,</span> <span class="mi">0</span><span class="p">],</span> <span class="n">exp_semivar</span><span class="p">[:,</span> <span class="mi">1</span><span class="p">])</span>
<span class="n">plt</span><span class="o">.</span><span class="n">title</span><span class="p">(</span><span class="s1">&#39;Experimental semivariogram od population data&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">xlabel</span><span class="p">(</span><span class="s1">&#39;Range - in meters&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="s1">&#39;Semivariance&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="../_images/tutorials_Semivariogram_Regularization_(Intermediate)_15_0.png" src="../_images/tutorials_Semivariogram_Regularization_(Intermediate)_15_0.png" />
</div>
</div>
<div class="section" id="id2">
<h3>Clarification:<a class="headerlink" href="#id2" title="Permalink to this headline">¶</a></h3>
<p>After few adjustements we have prepared semivariogram parameters for area and point support data. The next step is to create <code class="docutils literal notranslate"><span class="pre">RegularizedSemivariogram</span></code> model. We have mutiple parameters to choose and at the beginning it is hard to find the best fit, so try to avoid multiple loops because it is a time-consuming operation.</p>
<p>The program is designed to first <strong>fit()</strong> the model and later to <strong>transform()</strong> it.</p>
<p>When you <strong>fit()</strong> a model you have multiple parameters to control: * areal_data: areal data prepared with the function prepare_areal_shapefile(), where data is a numpy array in the form: [area_id, area_geometry, centroid coordinate x, centroid coordinate y, value], * areal_lags: list of lags between each distance, * areal_step_size: step size between each lag, usually it is a half of distance between lags, * point_support_data: point support data prepared with the function
get_points_within_area(), where data is a numpy array in the form: [area_id, [point_position_x, point_position_y, value]], * ranges: (int) number of ranges to test during semivariogram fitting. More steps == more accurate nugget and range prediction, but longer calculations, * weighted_lags: (bool) lags weighted by number of points; if True then during semivariogram fitting error of each model is weighted by number of points for each lag. In practice it means that more reliable data (lags)
have larger weights and semivariogram is modeled to better fit to those lags, * store_models: (bool) if True then experimental, regularized and theoretical models are stored in lists after each iteration. It is important for a debugging process.</p>
<p>We set ranges to 64, then we will weight lags and we do not store semivariograms and semivariogram models.</p>
<p>After fitting we perform <strong>transform()</strong>. This function has few parameters to control regularization process, but we leave them as default with one exception: we set max_iters parameter to 5.</p>
<p>This process of fitting and transforming takes some time, so it’s good idea to run it and do something else…</p>
</div>
</div>
<div class="section" id="3)-Regularize-semivariogram">
<h2>3) Regularize semivariogram<a class="headerlink" href="#3)-Regularize-semivariogram" title="Permalink to this headline">¶</a></h2>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[11]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="n">reg_mod</span> <span class="o">=</span> <span class="n">RegularizedSemivariogram</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[12]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">maximum_range</span><span class="p">,</span> <span class="n">step_size</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[12]:
</pre></div>
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
array([     0,  16000,  32000,  48000,  64000,  80000,  96000, 112000,
       128000, 144000])
</pre></div></div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[13]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="n">reg_mod</span><span class="o">.</span><span class="n">fit</span><span class="p">(</span><span class="n">areal_data</span><span class="o">=</span><span class="n">areal_data_prepared</span><span class="p">,</span>
            <span class="n">areal_step_size</span><span class="o">=</span><span class="n">step_size</span><span class="p">,</span> <span class="n">max_areal_range</span><span class="o">=</span><span class="n">maximum_range</span><span class="p">,</span>
            <span class="n">point_support_data</span><span class="o">=</span><span class="n">points_in_area</span><span class="p">,</span> <span class="n">ranges</span><span class="o">=</span><span class="mi">32</span><span class="p">,</span> <span class="n">weighted_lags</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">store_models</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area stderr docutils container">
<div class="highlight"><pre>
100%|██████████| 320/320 [00:00&lt;00:00, 6585.05it/s]
100%|██████████| 10/10 [00:00&lt;00:00, 81.68it/s]
100%|██████████| 320/320 [04:27&lt;00:00,  1.20it/s]
</pre></div></div>
</div>
<p>Probably something is wrong with our model and it is not well regularized by the algorithm. This may mean that our data is not spatially corellated (e.g. number of accidencts and population at risk are not correlated in space). We can check initial semivariograms to test this assumption.</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[14]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="c1"># Check initial experimental, theoretical and regularized semivariograms</span>

<span class="n">lags</span> <span class="o">=</span> <span class="n">reg_mod</span><span class="o">.</span><span class="n">experimental_semivariogram_of_areal_data</span><span class="p">[:,</span> <span class="mi">0</span><span class="p">]</span>
<span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">12</span><span class="p">,</span> <span class="mi">12</span><span class="p">))</span>
<span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">lags</span><span class="p">,</span> <span class="n">reg_mod</span><span class="o">.</span><span class="n">experimental_semivariogram_of_areal_data</span><span class="p">[:,</span> <span class="mi">1</span><span class="p">],</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;b&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">lags</span><span class="p">,</span> <span class="n">reg_mod</span><span class="o">.</span><span class="n">initial_theoretical_model_of_areal_data</span><span class="o">.</span><span class="n">predict</span><span class="p">(</span><span class="n">lags</span><span class="p">),</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;r&#39;</span><span class="p">,</span> <span class="n">linestyle</span><span class="o">=</span><span class="s1">&#39;--&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">lags</span><span class="p">,</span> <span class="n">reg_mod</span><span class="o">.</span><span class="n">initial_regularized_model</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;black&#39;</span><span class="p">,</span> <span class="n">linestyle</span><span class="o">=</span><span class="s1">&#39;dotted&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">legend</span><span class="p">([</span><span class="s1">&#39;Experimental semivariogram of areal data&#39;</span><span class="p">,</span> <span class="s1">&#39;Initial Semivariogram of areal data&#39;</span><span class="p">,</span>
            <span class="s1">&#39;Regularized data points&#39;</span><span class="p">])</span>
<span class="n">plt</span><span class="o">.</span><span class="n">title</span><span class="p">(</span><span class="s1">&#39;Semivariograms comparison. Deviation value: </span><span class="si">{}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">reg_mod</span><span class="o">.</span><span class="n">initial_deviation</span><span class="p">))</span>
<span class="n">plt</span><span class="o">.</span><span class="n">xlabel</span><span class="p">(</span><span class="s1">&#39;Distance&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="s1">&#39;Semivariance&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="../_images/tutorials_Semivariogram_Regularization_(Intermediate)_21_0.png" src="../_images/tutorials_Semivariogram_Regularization_(Intermediate)_21_0.png" />
</div>
</div>
<p>There’s a large relative difference between regularized semivariance and theoretical semivariogram of areal data. What’s more important: sill is reached approx. at 25 km distance… So there is a problem of scale: spatial correlation potentially exists but at much smaller scales than we are able to observe.</p>
<p>Anyway, we perfom the rest of tutorial with this dataset*.</p>
<p>(*) New tutorials with different datasets and scenarios will be released in November / December 2020.</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[15]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="n">reg_mod</span><span class="o">.</span><span class="n">transform</span><span class="p">(</span><span class="n">max_iters</span><span class="o">=</span><span class="mi">5</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area stderr docutils container">
<div class="highlight"><pre>
100%|██████████| 320/320 [00:00&lt;00:00, 6991.42it/s]
100%|██████████| 10/10 [00:00&lt;00:00, 87.95it/s]
100%|██████████| 320/320 [04:35&lt;00:00,  1.16it/s]
100%|██████████| 320/320 [00:00&lt;00:00, 7183.41it/s]
100%|██████████| 10/10 [00:00&lt;00:00, 84.83it/s]
100%|██████████| 320/320 [04:26&lt;00:00,  1.20it/s]
100%|██████████| 320/320 [00:00&lt;00:00, 6632.00it/s]
100%|██████████| 10/10 [00:00&lt;00:00, 108.84it/s]
100%|██████████| 320/320 [04:24&lt;00:00,  1.21it/s]
100%|██████████| 320/320 [00:00&lt;00:00, 6975.72it/s]
100%|██████████| 10/10 [00:00&lt;00:00, 84.16it/s]
100%|██████████| 320/320 [04:29&lt;00:00,  1.19it/s]
</pre></div></div>
</div>
<p><strong>NOTE:</strong></p>
<p>Operation is slow in the beta version of library so try to find some different task to do when process runs.</p>
</div>
<div class="section" id="4)-Visualize-and-check-semivariogram">
<h2>4) Visualize and check semivariogram<a class="headerlink" href="#4)-Visualize-and-check-semivariogram" title="Permalink to this headline">¶</a></h2>
<div class="section" id="id3">
<h3>Clarification:<a class="headerlink" href="#id3" title="Permalink to this headline">¶</a></h3>
<p>Process is fully automatic but we can check how it baheaved through each iteration. We can analyze deviation change (most important variable, mean absolute difference between regularized and theoretical models) with build-in method but if you are more interested in the algorithm stability you can analyze weight change over each iteration too.</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[16]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="c1"># First analyze deviation</span>

<span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">10</span><span class="p">,</span> <span class="mi">10</span><span class="p">))</span>
<span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">reg_mod</span><span class="o">.</span><span class="n">deviations</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="../_images/tutorials_Semivariogram_Regularization_(Intermediate)_25_0.png" src="../_images/tutorials_Semivariogram_Regularization_(Intermediate)_25_0.png" />
</div>
</div>
</div>
<div class="section" id="id4">
<h3>Clarification:<a class="headerlink" href="#id4" title="Permalink to this headline">¶</a></h3>
<p>Deviation is better than initial deviation after the first step of regularization and then it doesn’t change. It means that our problem is not best suited for Poisson Kriging - we should see decrease of deviation from the beginning up to the end. The reason of this fact will be better visible in semivariograms comparison in the cell below.</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[17]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="c1"># Check weights - it is important to track problems with algorithm, esepcially if sum of weights is oscillating</span>
<span class="c1"># then it may be a sign of problems with data, model or (hopefully not!) algorithm itself.</span>

<span class="n">weights</span> <span class="o">=</span> <span class="n">reg_mod</span><span class="o">.</span><span class="n">weights</span>
<span class="n">weights</span> <span class="o">=</span> <span class="p">[</span><span class="nb">sum</span><span class="p">(</span><span class="n">w</span><span class="p">)</span> <span class="k">for</span> <span class="n">w</span> <span class="ow">in</span> <span class="n">weights</span><span class="p">]</span>

<span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">10</span><span class="p">,</span><span class="mi">10</span><span class="p">))</span>
<span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">weights</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="../_images/tutorials_Semivariogram_Regularization_(Intermediate)_27_0.png" src="../_images/tutorials_Semivariogram_Regularization_(Intermediate)_27_0.png" />
</div>
</div>
<div class="section" id="NOTE:">
<h4>NOTE:<a class="headerlink" href="#NOTE:" title="Permalink to this headline">¶</a></h4>
<p>Weights are smaller with each iteration. It is normal behavior of algorithm. Unfortunately, weights should start from the 1 and then they should be smaller.</p>
</div>
<div class="section" id="note-1">
<span id="id5"></span><h4>NOTE:<a class="headerlink" href="#note-1" title="Permalink to this headline">¶</a></h4>
<p>The most important part is to compare semivariograms! You can see that Optimized Model is equal to Initial Semivariogram of areal data: our model is not better than normal kriging of areal centroids.</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[18]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="n">reg_mod</span><span class="o">.</span><span class="n">show_semivariograms</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="../_images/tutorials_Semivariogram_Regularization_(Intermediate)_29_0.png" src="../_images/tutorials_Semivariogram_Regularization_(Intermediate)_29_0.png" />
</div>
</div>
</div>
</div>
<div class="section" id="id6">
<h3>Clarification:<a class="headerlink" href="#id6" title="Permalink to this headline">¶</a></h3>
<p>Experimental semivariogram is a semivariogram of areal centroids. Then theoretical semivariogram is used to describe empirical semivariogram. Regularization process is to find semivariogram close enough to the theoretical semivariogram, which describes ongoing process with the new support (in this case with population units). You may see that experimental semivariogram has exponential growth near the origin. It means that areas are not spatially corellated.</p>
<p>Anyway, we can store this regularized semivariogram properties for the further analysis and Kriging and we will perform it, even with the parameters which are not well fitted to the data.</p>
</div>
</div>
<div class="section" id="5)-Export-semivariogram-to-text-file">
<h2>5) Export semivariogram to text file<a class="headerlink" href="#5)-Export-semivariogram-to-text-file" title="Permalink to this headline">¶</a></h2>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[20]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="c1"># Export semivariogram to the text file. This is important step because calculations are slow...</span>
<span class="c1"># and it is better to not repeat them.</span>
<span class="c1"># We will use buil-in method: export_regularized where we pass only filename our semivariogram</span>
<span class="c1"># parameters are stored for other tasks.</span>

<span class="n">reg_mod</span><span class="o">.</span><span class="n">export_regularized_model</span><span class="p">(</span><span class="s1">&#39;regularized_model.csv&#39;</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
</div>


          </div>
          
        </div>
      </div>
      <div class="sphinxsidebar" role="navigation" aria-label="main navigation">
        <div class="sphinxsidebarwrapper">
<h1 class="logo"><a href="../index.html">Pyinterpolate</a></h1>








<h3>Navigation</h3>
<ul class="current">
<li class="toctree-l1"><a class="reference internal" href="../introduction.html">Introduction</a></li>
<li class="toctree-l1"><a class="reference internal" href="../setup.html">Setup</a></li>
<li class="toctree-l1 current"><a class="reference internal" href="../tutorials.html">Tutorials</a></li>
<li class="toctree-l1"><a class="reference internal" href="../code_documentation.html">Documentation</a></li>
<li class="toctree-l1"><a class="reference internal" href="../contribution.html">Contribution to Pyinterpolate</a></li>
<li class="toctree-l1"><a class="reference internal" href="../license.html">License</a></li>
</ul>

<div class="relations">
<h3>Related Topics</h3>
<ul>
  <li><a href="../index.html">Documentation overview</a><ul>
  <li><a href="../tutorials.html">Tutorials</a><ul>
      <li>Previous: <a href="Ordinary%20and%20Simple%20Kriging%20%28Basic%29.html" title="previous chapter">Ordinary and Simple Kriging - tutorial</a></li>
      <li>Next: <a href="Poisson%20Kriging%20-%20Centroid%20Based%20%28Advanced%29.html" title="next chapter">Poisson Kriging - centroid based approach - tutorial</a></li>
  </ul></li>
  </ul></li>
</ul>
</div>
<div id="searchbox" style="display: none" role="search">
  <h3 id="searchlabel">Quick search</h3>
    <div class="searchformwrapper">
    <form class="search" action="../search.html" method="get">
      <input type="text" name="q" aria-labelledby="searchlabel" />
      <input type="submit" value="Go" />
    </form>
    </div>
</div>
<script>$('#searchbox').show(0);</script>








        </div>
      </div>
      <div class="clearer"></div>
    </div>
    <div class="footer">
      &copy;2020, Szymon Moliński.
      
      |
      Powered by <a href="http://sphinx-doc.org/">Sphinx 3.4.0</a>
      &amp; <a href="https://github.com/bitprophet/alabaster">Alabaster 0.7.12</a>
      
      |
      <a href="../_sources/tutorials/Semivariogram Regularization (Intermediate).ipynb.txt"
          rel="nofollow">Page source</a>
    </div>

    

    
  </body>
</html>