
<!DOCTYPE html>

<html>
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Semivariogram regularization - tutorial &#8212; Pyinterpolate 0.2.0 documentation</title>
    <link rel="stylesheet" href="../_static/pygments.css" type="text/css" />
    <link rel="stylesheet" href="../_static/alabaster.css" type="text/css" />
    <script id="documentation_options" data-url_root="../" src="../_static/documentation_options.js"></script>
    <script src="../_static/jquery.js"></script>
    <script src="../_static/underscore.js"></script>
    <script src="../_static/doctools.js"></script>
    <script crossorigin="anonymous" integrity="sha256-Ae2Vz/4ePdIu6ZyI/5ZGsYnb+m0JlOmKPjt6XZ9JJkA=" src="https://cdnjs.cloudflare.com/ajax/libs/require.js/2.3.4/require.min.js"></script>
    <link rel="index" title="Index" href="../genindex.html" />
    <link rel="search" title="Search" href="../search.html" />
    <link rel="next" title="Poisson Kriging - centroid based approach - tutorial" href="Poisson%20Kriging%20-%20Centroid%20Based%20%28Advanced%29.html" />
    <link rel="prev" title="Blocks to points Ordinary Kriging interpolation - tutorial" href="Blocks%20to%20points%20Ordinary%20Kriging%20interpolation%20%28Intermediate%29.html" />
   
  <link rel="stylesheet" href="../_static/custom.css" type="text/css" />
  
  
  <meta name="viewport" content="width=device-width, initial-scale=0.9, maximum-scale=0.9" />

  </head><body>
  

    <div class="document">
      <div class="documentwrapper">
        <div class="bodywrapper">
          

          <div class="body" role="main">
            
  
<style>
/* CSS for nbsphinx extension */

/* remove conflicting styling from Sphinx themes */
div.nbinput.container div.prompt *,
div.nboutput.container div.prompt *,
div.nbinput.container div.input_area pre,
div.nboutput.container div.output_area pre,
div.nbinput.container div.input_area .highlight,
div.nboutput.container div.output_area .highlight {
    border: none;
    padding: 0;
    margin: 0;
    box-shadow: none;
}

div.nbinput.container > div[class*=highlight],
div.nboutput.container > div[class*=highlight] {
    margin: 0;
}

div.nbinput.container div.prompt *,
div.nboutput.container div.prompt * {
    background: none;
}

div.nboutput.container div.output_area .highlight,
div.nboutput.container div.output_area pre {
    background: unset;
}

div.nboutput.container div.output_area div.highlight {
    color: unset;  /* override Pygments text color */
}

/* avoid gaps between output lines */
div.nboutput.container div[class*=highlight] pre {
    line-height: normal;
}

/* input/output containers */
div.nbinput.container,
div.nboutput.container {
    display: -webkit-flex;
    display: flex;
    align-items: flex-start;
    margin: 0;
    width: 100%;
}
@media (max-width: 540px) {
    div.nbinput.container,
    div.nboutput.container {
        flex-direction: column;
    }
}

/* input container */
div.nbinput.container {
    padding-top: 5px;
}

/* last container */
div.nblast.container {
    padding-bottom: 5px;
}

/* input prompt */
div.nbinput.container div.prompt pre {
    color: #307FC1;
}

/* output prompt */
div.nboutput.container div.prompt pre {
    color: #BF5B3D;
}

/* all prompts */
div.nbinput.container div.prompt,
div.nboutput.container div.prompt {
    width: 4.5ex;
    padding-top: 5px;
    position: relative;
    user-select: none;
}

div.nbinput.container div.prompt > div,
div.nboutput.container div.prompt > div {
    position: absolute;
    right: 0;
    margin-right: 0.3ex;
}

@media (max-width: 540px) {
    div.nbinput.container div.prompt,
    div.nboutput.container div.prompt {
        width: unset;
        text-align: left;
        padding: 0.4em;
    }
    div.nboutput.container div.prompt.empty {
        padding: 0;
    }

    div.nbinput.container div.prompt > div,
    div.nboutput.container div.prompt > div {
        position: unset;
    }
}

/* disable scrollbars on prompts */
div.nbinput.container div.prompt pre,
div.nboutput.container div.prompt pre {
    overflow: hidden;
}

/* input/output area */
div.nbinput.container div.input_area,
div.nboutput.container div.output_area {
    -webkit-flex: 1;
    flex: 1;
    overflow: auto;
}
@media (max-width: 540px) {
    div.nbinput.container div.input_area,
    div.nboutput.container div.output_area {
        width: 100%;
    }
}

/* input area */
div.nbinput.container div.input_area {
    border: 1px solid #e0e0e0;
    border-radius: 2px;
    /*background: #f5f5f5;*/
}

/* override MathJax center alignment in output cells */
div.nboutput.container div[class*=MathJax] {
    text-align: left !important;
}

/* override sphinx.ext.imgmath center alignment in output cells */
div.nboutput.container div.math p {
    text-align: left;
}

/* standard error */
div.nboutput.container div.output_area.stderr {
    background: #fdd;
}

/* ANSI colors */
.ansi-black-fg { color: #3E424D; }
.ansi-black-bg { background-color: #3E424D; }
.ansi-black-intense-fg { color: #282C36; }
.ansi-black-intense-bg { background-color: #282C36; }
.ansi-red-fg { color: #E75C58; }
.ansi-red-bg { background-color: #E75C58; }
.ansi-red-intense-fg { color: #B22B31; }
.ansi-red-intense-bg { background-color: #B22B31; }
.ansi-green-fg { color: #00A250; }
.ansi-green-bg { background-color: #00A250; }
.ansi-green-intense-fg { color: #007427; }
.ansi-green-intense-bg { background-color: #007427; }
.ansi-yellow-fg { color: #DDB62B; }
.ansi-yellow-bg { background-color: #DDB62B; }
.ansi-yellow-intense-fg { color: #B27D12; }
.ansi-yellow-intense-bg { background-color: #B27D12; }
.ansi-blue-fg { color: #208FFB; }
.ansi-blue-bg { background-color: #208FFB; }
.ansi-blue-intense-fg { color: #0065CA; }
.ansi-blue-intense-bg { background-color: #0065CA; }
.ansi-magenta-fg { color: #D160C4; }
.ansi-magenta-bg { background-color: #D160C4; }
.ansi-magenta-intense-fg { color: #A03196; }
.ansi-magenta-intense-bg { background-color: #A03196; }
.ansi-cyan-fg { color: #60C6C8; }
.ansi-cyan-bg { background-color: #60C6C8; }
.ansi-cyan-intense-fg { color: #258F8F; }
.ansi-cyan-intense-bg { background-color: #258F8F; }
.ansi-white-fg { color: #C5C1B4; }
.ansi-white-bg { background-color: #C5C1B4; }
.ansi-white-intense-fg { color: #A1A6B2; }
.ansi-white-intense-bg { background-color: #A1A6B2; }

.ansi-default-inverse-fg { color: #FFFFFF; }
.ansi-default-inverse-bg { background-color: #000000; }

.ansi-bold { font-weight: bold; }
.ansi-underline { text-decoration: underline; }


div.nbinput.container div.input_area div[class*=highlight] > pre,
div.nboutput.container div.output_area div[class*=highlight] > pre,
div.nboutput.container div.output_area div[class*=highlight].math,
div.nboutput.container div.output_area.rendered_html,
div.nboutput.container div.output_area > div.output_javascript,
div.nboutput.container div.output_area:not(.rendered_html) > img{
    padding: 5px;
    margin: 0;
}

/* fix copybtn overflow problem in chromium (needed for 'sphinx_copybutton') */
div.nbinput.container div.input_area > div[class^='highlight'],
div.nboutput.container div.output_area > div[class^='highlight']{
    overflow-y: hidden;
}

/* hide copybtn icon on prompts (needed for 'sphinx_copybutton') */
.prompt a.copybtn {
    display: none;
}

/* Some additional styling taken form the Jupyter notebook CSS */
div.rendered_html table {
  border: none;
  border-collapse: collapse;
  border-spacing: 0;
  color: black;
  font-size: 12px;
  table-layout: fixed;
}
div.rendered_html thead {
  border-bottom: 1px solid black;
  vertical-align: bottom;
}
div.rendered_html tr,
div.rendered_html th,
div.rendered_html td {
  text-align: right;
  vertical-align: middle;
  padding: 0.5em 0.5em;
  line-height: normal;
  white-space: normal;
  max-width: none;
  border: none;
}
div.rendered_html th {
  font-weight: bold;
}
div.rendered_html tbody tr:nth-child(odd) {
  background: #f5f5f5;
}
div.rendered_html tbody tr:hover {
  background: rgba(66, 165, 245, 0.2);
}
</style>
<div class="section" id="Semivariogram-regularization---tutorial">
<h1>Semivariogram regularization - tutorial<a class="headerlink" href="#Semivariogram-regularization---tutorial" title="Permalink to this headline">¶</a></h1>
<div class="section" id="Table-of-Contents:">
<h2>Table of Contents:<a class="headerlink" href="#Table-of-Contents:" title="Permalink to this headline">¶</a></h2>
<ol class="arabic simple">
<li><p>Prepare areal and point data,</p></li>
<li><p>Set semivariogram parameters,</p></li>
<li><p>Perform regularization,</p></li>
<li><p>Visualize regularized semivariogram and analyze algorithm performance,</p></li>
<li><p>Export semivariogram to text file.</p></li>
</ol>
</div>
<div class="section" id="Level:-Intermediate">
<h2>Level: Intermediate<a class="headerlink" href="#Level:-Intermediate" title="Permalink to this headline">¶</a></h2>
</div>
<div class="section" id="Changelog">
<h2>Changelog<a class="headerlink" href="#Changelog" title="Permalink to this headline">¶</a></h2>
<table class="docutils align-default">
<colgroup>
<col style="width: 18%" />
<col style="width: 59%" />
<col style="width: 23%" />
</colgroup>
<thead>
<tr class="row-odd"><th class="head"><p>Date</p></th>
<th class="head"><p>Change description</p></th>
<th class="head"><p>Author</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><p>2021-03-31</p></td>
<td><p>Update related to the change of semivariogram weighting. Updated cancer rates data.</p></td>
<td><p>&#64;szymon-datalions</p></td>
</tr>
</tbody>
</table>
</div>
<div class="section" id="Introduction">
<h2>Introduction<a class="headerlink" href="#Introduction" title="Permalink to this headline">¶</a></h2>
<p>In this tutorial we learn how to regularize semivariogram of areal dataset of irregular polygons. Procedure is described here: (1) Goovaerts P., Kriging and Semivariogram Deconvolution in the Presence of Irregular Geographical Units, Mathematical Geology 40(1), 101-128, 2008.</p>
<p>The main idea is to retrieve point support semivariogram from semivariogram of areal data with blocks of different shapes and sizes. It is the case in mining industry, where blocks of aggregates are deconvoluted into smaller units and in the epidemiology, where data is usually aggregated over big administrative units, or in ecology, where observations of species are aggregated over areas or time windows.</p>
<p>In this tutorial we use areal data of Breast Cancer incidence rates in Northeastern counties of U.S. and U.S. Census 2010 data for population blocks.</p>
<blockquote>
<div><p>Breast cancer rates data is stored in the shapefile in folder <code class="docutils literal notranslate"><span class="pre">sample_data/areal_data/cancer_data.shp</span></code>.</p>
</div></blockquote>
<blockquote>
<div><p>Population blocks data is stored in the shapefile in folder <code class="docutils literal notranslate"><span class="pre">sample_data/population_data/cancer_population_base.shp</span></code></p>
</div></blockquote>
</div>
<div class="section" id="Import-packages">
<h2>Import packages<a class="headerlink" href="#Import-packages" title="Permalink to this headline">¶</a></h2>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[1]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>
<span class="kn">import</span> <span class="nn">geopandas</span> <span class="k">as</span> <span class="nn">gpd</span>

<span class="kn">from</span> <span class="nn">pyinterpolate.io_ops</span> <span class="kn">import</span> <span class="n">prepare_areal_shapefile</span><span class="p">,</span> <span class="n">get_points_within_area</span>  <span class="c1"># Prepare data</span>
<span class="kn">from</span> <span class="nn">pyinterpolate.semivariance</span> <span class="kn">import</span> <span class="n">calculate_semivariance</span>  <span class="c1"># Experimental semivariogram</span>
<span class="kn">from</span> <span class="nn">pyinterpolate.semivariance</span> <span class="kn">import</span> <span class="n">RegularizedSemivariogram</span>  <span class="c1"># Semivariogram regularization class</span>

<span class="kn">import</span> <span class="nn">matplotlib.pyplot</span> <span class="k">as</span> <span class="nn">plt</span>
</pre></div>
</div>
</div>
</div>
<div class="section" id="1)-Prepare-areal-and-point-data">
<h2>1) Prepare areal and point data<a class="headerlink" href="#1)-Prepare-areal-and-point-data" title="Permalink to this headline">¶</a></h2>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[2]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="n">areal_data</span> <span class="o">=</span> <span class="s1">&#39;../sample_data/areal_data/cancer_data.shp&#39;</span>
<span class="n">point_data</span> <span class="o">=</span> <span class="s1">&#39;../sample_data/population_data/cancer_population_base.shp&#39;</span>

<span class="c1"># The important thing before analysis is to check if crs of areal data and point data are the same</span>

<span class="n">areal_crs</span> <span class="o">=</span> <span class="n">gpd</span><span class="o">.</span><span class="n">read_file</span><span class="p">(</span><span class="n">areal_data</span><span class="p">)</span><span class="o">.</span><span class="n">crs</span>
<span class="n">point_support_crs</span> <span class="o">=</span> <span class="n">gpd</span><span class="o">.</span><span class="n">read_file</span><span class="p">(</span><span class="n">point_data</span><span class="p">)</span><span class="o">.</span><span class="n">crs</span>

<span class="n">areal_crs</span> <span class="o">==</span> <span class="n">point_support_crs</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[2]:
</pre></div>
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
True
</pre></div></div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[3]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="c1"># We need to know:</span>
<span class="c1"># - id column name of areal units,</span>
<span class="c1"># - value column name of areal units (usually aggregates),</span>
<span class="c1"># - value column name of point support units (usually population)</span>

<span class="c1"># Let&#39;s check it quickly with geopandas</span>

<span class="n">areal</span> <span class="o">=</span> <span class="n">gpd</span><span class="o">.</span><span class="n">read_file</span><span class="p">(</span><span class="n">areal_data</span><span class="p">)</span>
<span class="n">areal</span><span class="o">.</span><span class="n">head</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[3]:
</pre></div>
</div>
<div class="output_area rendered_html docutils container">
<div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>rate</th>
      <th>FIPS</th>
      <th>rate_float</th>
      <th>geometry</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>192.2</td>
      <td>25019</td>
      <td>192.2</td>
      <td>MULTIPOLYGON (((2115688.816 556471.240, 211569...</td>
    </tr>
    <tr>
      <th>1</th>
      <td>166.8</td>
      <td>36121</td>
      <td>166.8</td>
      <td>POLYGON ((1419423.430 564830.379, 1419729.721 ...</td>
    </tr>
    <tr>
      <th>2</th>
      <td>157.4</td>
      <td>33001</td>
      <td>157.4</td>
      <td>MULTIPOLYGON (((1937530.728 779787.978, 193751...</td>
    </tr>
    <tr>
      <th>3</th>
      <td>156.7</td>
      <td>25007</td>
      <td>156.7</td>
      <td>MULTIPOLYGON (((2074073.532 539159.504, 207411...</td>
    </tr>
    <tr>
      <th>4</th>
      <td>155.3</td>
      <td>25001</td>
      <td>155.3</td>
      <td>MULTIPOLYGON (((2095343.207 637424.961, 209528...</td>
    </tr>
  </tbody>
</table>
</div></div>
</div>
<p>From areal file we are interested in the incidence rate (<code class="docutils literal notranslate"><span class="pre">rate</span></code>) and ID (<code class="docutils literal notranslate"><span class="pre">FIPS</span></code>).</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[4]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="c1"># Now check point support data</span>

<span class="n">point</span> <span class="o">=</span> <span class="n">gpd</span><span class="o">.</span><span class="n">read_file</span><span class="p">(</span><span class="n">point_data</span><span class="p">)</span>
<span class="n">point</span><span class="o">.</span><span class="n">head</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[4]:
</pre></div>
</div>
<div class="output_area rendered_html docutils container">
<div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>id</th>
      <th>left</th>
      <th>top</th>
      <th>right</th>
      <th>bottom</th>
      <th>POP10</th>
      <th>geometry</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>81.0</td>
      <td>1.271504e+06</td>
      <td>446124.5068</td>
      <td>1.283051e+06</td>
      <td>436124.5068</td>
      <td>1866.0</td>
      <td>POINT (1277277.671 441124.507)</td>
    </tr>
    <tr>
      <th>1</th>
      <td>82.0</td>
      <td>1.271504e+06</td>
      <td>436124.5068</td>
      <td>1.283051e+06</td>
      <td>426124.5068</td>
      <td>2093.0</td>
      <td>POINT (1277277.671 431124.507)</td>
    </tr>
    <tr>
      <th>2</th>
      <td>83.0</td>
      <td>1.271504e+06</td>
      <td>426124.5068</td>
      <td>1.283051e+06</td>
      <td>416124.5068</td>
      <td>590.0</td>
      <td>POINT (1277277.671 421124.507)</td>
    </tr>
    <tr>
      <th>3</th>
      <td>84.0</td>
      <td>1.271504e+06</td>
      <td>416124.5068</td>
      <td>1.283051e+06</td>
      <td>406124.5068</td>
      <td>636.0</td>
      <td>POINT (1277277.671 411124.507)</td>
    </tr>
    <tr>
      <th>4</th>
      <td>85.0</td>
      <td>1.271504e+06</td>
      <td>406124.5068</td>
      <td>1.283051e+06</td>
      <td>396124.5068</td>
      <td>582.0</td>
      <td>POINT (1277277.671 401124.507)</td>
    </tr>
  </tbody>
</table>
</div></div>
</div>
<p><code class="docutils literal notranslate"><span class="pre">POP10</span></code> is our column of interest.</p>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[5]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="c1"># Now prepare data for further processing</span>

<span class="n">areal_id</span> <span class="o">=</span> <span class="s1">&#39;FIPS&#39;</span>
<span class="n">areal_val</span> <span class="o">=</span> <span class="s1">&#39;rate&#39;</span>
<span class="n">points_val</span> <span class="o">=</span> <span class="s1">&#39;POP10&#39;</span>

<span class="n">areal_data_prepared</span> <span class="o">=</span> <span class="n">prepare_areal_shapefile</span><span class="p">(</span><span class="n">areal_data</span><span class="p">,</span> <span class="n">areal_id</span><span class="p">,</span> <span class="n">areal_val</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[6]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="c1"># Check how prepared areal data looks like</span>

<span class="n">areal_data_prepared</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[6]:
</pre></div>
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
array([25019,
       &lt;shapely.geometry.multipolygon.MultiPolygon object at 0x7f185b3d7ed0&gt;,
       2132629.599151873, 557971.1559491967, 192.2], dtype=object)
</pre></div></div>
</div>
<div class="section" id="Clarification:">
<h3>Clarification:<a class="headerlink" href="#Clarification:" title="Permalink to this headline">¶</a></h3>
<p>Every areal dataset is passed as an array of:</p>
<p>[area id, area geometry (polygon), areal centroid x (lon), areal centroid y (lat), value]</p>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[7]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="n">points_in_area</span> <span class="o">=</span> <span class="n">get_points_within_area</span><span class="p">(</span><span class="n">areal_data</span><span class="p">,</span> <span class="n">point_data</span><span class="p">,</span> <span class="n">areal_id_col_name</span><span class="o">=</span><span class="n">areal_id</span><span class="p">,</span>
                                        <span class="n">points_val_col_name</span><span class="o">=</span><span class="n">points_val</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[8]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="c1"># Check how prepared point data looks like</span>

<span class="n">points_in_area</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[8]:
</pre></div>
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
array([42049.0,
       array([[1277277.6705919 ,  441124.50679998,    1866.        ],
       [1277277.6705919 ,  431124.50679999,    2093.        ],
       [1285937.92462974,  446124.50679999,   10191.        ],
       [1285937.92462974,  436124.50679999,    3271.        ],
       [1285937.92462974,  426124.50679999,    5400.        ],
       [1294598.17866759,  451124.50679998,   23133.        ],
       [1294598.17866759,  441124.50679999,    2616.        ],
       [1294598.17866759,  431124.50679999,    1610.        ],
       [1303258.43270543,  456124.50679999,  110912.        ],
       [1303258.43270543,  446124.50679999,    6793.        ],
       [1303258.43270543,  436124.50679999,    8493.        ],
       [1311918.68674328,  461124.50679999,   44605.        ],
       [1311918.68674328,  451124.50679999,    5710.        ],
       [1311918.68674328,  441124.50679999,    4700.        ],
       [1311918.68674328,  431124.50679999,    2483.        ],
       [1320578.94078112,  466124.50679999,    3372.        ],
       [1320578.94078112,  456124.50679999,    3226.        ],
       [1320578.94078112,  446124.50679998,    1664.        ],
       [1320578.94078112,  436124.50679999,    1956.        ],
       [1329239.19481896,  461124.50679999,    1441.        ],
       [1329239.19481897,  451124.50679998,    1712.        ],
       [1329239.19481896,  441124.50679999,    4814.        ],
       [1337899.44885681,  446124.50679999,    1933.        ],
       [1337899.44885681,  436124.50679998,    1370.        ],
       [1346559.70289465,  441124.50679999,    7430.        ]])],
      dtype=object)
</pre></div></div>
</div>
</div>
<div class="section" id="id1">
<h3>Clarification:<a class="headerlink" href="#id1" title="Permalink to this headline">¶</a></h3>
<p>Every point support dataset is passed as an array of:</p>
<p>[area id, array of: [lon, lat, value]]</p>
</div>
</div>
<div class="section" id="2)-Set-semivariogram-parameters.">
<h2>2) Set semivariogram parameters.<a class="headerlink" href="#2)-Set-semivariogram-parameters." title="Permalink to this headline">¶</a></h2>
<p>Now we must set parameters for areal semivariogram AND point semivariogram. It is very important to understand data well to set them properly, that’s why you should always check experimental semivariograms of those datasets to understand how data behaves. We do it for prepared areal and point datasets.</p>
<p>From the practical point of view area semivariogram analysis is more important because we pass into semivariogram regularization parameters of step size and maximum search radius. But we check point’s semivariogram too. It is analytical step, to check if spatial process whoch we are using for semivariogram deconvolution is proper, as example if semivariogram shows exponential function then our process will not be properly modeled.</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[9]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="c1"># Check experimental semivariogram of areal data - this cell may be run multiple times</span>
<span class="c1"># before you find optimal parameters</span>

<span class="n">maximum_range</span> <span class="o">=</span> <span class="mi">300000</span>
<span class="n">step_size</span> <span class="o">=</span> <span class="mi">30000</span>

<span class="n">dt</span> <span class="o">=</span> <span class="n">areal_data_prepared</span><span class="p">[:,</span> <span class="mi">2</span><span class="p">:]</span>  <span class="c1"># x, y, val</span>
<span class="n">exp_semivar</span> <span class="o">=</span> <span class="n">calculate_semivariance</span><span class="p">(</span><span class="n">data</span><span class="o">=</span><span class="n">dt</span><span class="p">,</span> <span class="n">step_size</span><span class="o">=</span><span class="n">step_size</span><span class="p">,</span> <span class="n">max_range</span><span class="o">=</span><span class="n">maximum_range</span><span class="p">)</span>

<span class="c1"># Plot experimental semivariogram</span>

<span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">12</span><span class="p">,</span> <span class="mi">12</span><span class="p">))</span>
<span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">exp_semivar</span><span class="p">[:,</span> <span class="mi">0</span><span class="p">],</span> <span class="n">exp_semivar</span><span class="p">[:,</span> <span class="mi">1</span><span class="p">])</span>
<span class="n">plt</span><span class="o">.</span><span class="n">title</span><span class="p">(</span><span class="s1">&#39;Experimental semivariogram od areal centroids&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">xlabel</span><span class="p">(</span><span class="s1">&#39;Range - in meters&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="s1">&#39;Semivariance&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="../_images/tutorials_Semivariogram_Regularization_(Intermediate)_16_0.png" src="../_images/tutorials_Semivariogram_Regularization_(Intermediate)_16_0.png" />
</div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[10]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="c1"># Check experimental semivariogram of point data - this cell may be run multiple times</span>
<span class="c1"># before you find optimal parameters</span>

<span class="k">def</span> <span class="nf">build_point_array</span><span class="p">(</span><span class="n">points</span><span class="p">):</span>
    <span class="n">a</span> <span class="o">=</span> <span class="kc">None</span>

    <span class="k">for</span> <span class="n">rec</span> <span class="ow">in</span> <span class="n">points</span><span class="p">:</span>
        <span class="k">if</span> <span class="n">a</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">a</span> <span class="o">=</span> <span class="n">rec</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">a</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">vstack</span><span class="p">((</span><span class="n">a</span><span class="p">,</span> <span class="n">rec</span><span class="p">))</span>

    <span class="k">return</span> <span class="n">a</span>

<span class="n">maximum_point_range</span> <span class="o">=</span> <span class="mi">300000</span>
<span class="n">step_size_points</span> <span class="o">=</span> <span class="mi">10000</span>


<span class="n">pt</span> <span class="o">=</span> <span class="n">build_point_array</span><span class="p">(</span><span class="n">points_in_area</span><span class="p">[:,</span> <span class="mi">1</span><span class="p">])</span>  <span class="c1"># x, y, val</span>
<span class="n">exp_semivar</span> <span class="o">=</span> <span class="n">calculate_semivariance</span><span class="p">(</span><span class="n">data</span><span class="o">=</span><span class="n">pt</span><span class="p">,</span> <span class="n">step_size</span><span class="o">=</span><span class="n">step_size_points</span><span class="p">,</span> <span class="n">max_range</span><span class="o">=</span><span class="n">maximum_point_range</span><span class="p">)</span>

<span class="c1"># Plot experimental semivariogram</span>

<span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">12</span><span class="p">,</span> <span class="mi">12</span><span class="p">))</span>
<span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">exp_semivar</span><span class="p">[:,</span> <span class="mi">0</span><span class="p">],</span> <span class="n">exp_semivar</span><span class="p">[:,</span> <span class="mi">1</span><span class="p">])</span>
<span class="n">plt</span><span class="o">.</span><span class="n">title</span><span class="p">(</span><span class="s1">&#39;Experimental semivariogram od population data&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">xlabel</span><span class="p">(</span><span class="s1">&#39;Range - in meters&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="s1">&#39;Semivariance&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="../_images/tutorials_Semivariogram_Regularization_(Intermediate)_17_0.png" src="../_images/tutorials_Semivariogram_Regularization_(Intermediate)_17_0.png" />
</div>
</div>
<div class="section" id="id2">
<h3>Clarification:<a class="headerlink" href="#id2" title="Permalink to this headline">¶</a></h3>
<p>After few adjustements we have prepared semivariogram parameters for area and point support data. The next step is to create <code class="docutils literal notranslate"><span class="pre">RegularizedSemivariogram</span></code> model. We have mutiple parameters to choose and at the beginning it is hard to find the best fit, so try to avoid multiple loops because it is a time-consuming operation.</p>
<p>The program is designed to first <strong>fit()</strong> the model and later to <strong>transform()</strong> it.</p>
<p>When you <strong>fit()</strong> a model you have multiple parameters to control: * areal_data: areal data prepared with the function prepare_areal_shapefile(), where data is a numpy array in the form: [area_id, area_geometry, centroid coordinate x, centroid coordinate y, value], * areal_lags: list of lags between each distance, * areal_step_size: step size between each lag, usually it is a half of distance between lags, * point_support_data: point support data prepared with the function
get_points_within_area(), where data is a numpy array in the form: [area_id, [point_position_x, point_position_y, value]], * ranges: (int) number of ranges to test during semivariogram fitting. More steps == more accurate nugget and range prediction, but longer calculations, * weighted_lags: (bool) lags weighted by number of points; if True then during semivariogram fitting error of each model is weighted by number of points for each lag. In practice it means that more reliable data (lags)
have larger weights and semivariogram is modeled to better fit to those lags, * store_models: (bool) if True then experimental, regularized and theoretical models are stored in lists after each iteration. It is important for a debugging process.</p>
<p>We set ranges to 8, then we will weight lags and we do not store semivariograms and semivariogram models.</p>
<p>After fitting we perform <strong>transform()</strong>. This function has few parameters to control regularization process, but we leave them as default with one exception: we set max_iters parameter to 5.</p>
<p>This process of fitting and transforming takes some time, so it’s good idea to run it and do something else…</p>
</div>
</div>
<div class="section" id="3)-Regularize-semivariogram">
<h2>3) Regularize semivariogram<a class="headerlink" href="#3)-Regularize-semivariogram" title="Permalink to this headline">¶</a></h2>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[11]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="n">reg_mod</span> <span class="o">=</span> <span class="n">RegularizedSemivariogram</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[12]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="n">reg_mod</span><span class="o">.</span><span class="n">fit</span><span class="p">(</span><span class="n">areal_data</span><span class="o">=</span><span class="n">areal_data_prepared</span><span class="p">,</span>
            <span class="n">areal_step_size</span><span class="o">=</span><span class="n">step_size</span><span class="p">,</span> <span class="n">max_areal_range</span><span class="o">=</span><span class="n">maximum_range</span><span class="p">,</span>
            <span class="n">point_support_data</span><span class="o">=</span><span class="n">points_in_area</span><span class="p">,</span> <span class="n">ranges</span><span class="o">=</span><span class="mi">8</span><span class="p">,</span> <span class="n">weighted_lags</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">store_models</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area stderr docutils container">
<div class="highlight"><pre>
100%|██████████| 217/217 [00:00&lt;00:00, 7193.61it/s]
100%|██████████| 10/10 [00:00&lt;00:00, 95.46it/s]
100%|██████████| 217/217 [00:25&lt;00:00,  8.57it/s]
</pre></div></div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[13]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="c1"># Check initial experimental, theoretical and regularized semivariograms</span>

<span class="n">lags</span> <span class="o">=</span> <span class="n">reg_mod</span><span class="o">.</span><span class="n">experimental_semivariogram_of_areal_data</span><span class="p">[:,</span> <span class="mi">0</span><span class="p">]</span>
<span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">12</span><span class="p">,</span> <span class="mi">12</span><span class="p">))</span>
<span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">lags</span><span class="p">,</span> <span class="n">reg_mod</span><span class="o">.</span><span class="n">experimental_semivariogram_of_areal_data</span><span class="p">[:,</span> <span class="mi">1</span><span class="p">],</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;b&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">lags</span><span class="p">,</span> <span class="n">reg_mod</span><span class="o">.</span><span class="n">initial_theoretical_model_of_areal_data</span><span class="o">.</span><span class="n">predict</span><span class="p">(</span><span class="n">lags</span><span class="p">),</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;r&#39;</span><span class="p">,</span> <span class="n">linestyle</span><span class="o">=</span><span class="s1">&#39;--&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">lags</span><span class="p">,</span> <span class="n">reg_mod</span><span class="o">.</span><span class="n">initial_regularized_model</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;black&#39;</span><span class="p">,</span> <span class="n">linestyle</span><span class="o">=</span><span class="s1">&#39;dotted&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">legend</span><span class="p">([</span><span class="s1">&#39;Experimental semivariogram of areal data&#39;</span><span class="p">,</span> <span class="s1">&#39;Initial Semivariogram of areal data&#39;</span><span class="p">,</span>
            <span class="s1">&#39;Regularized data points&#39;</span><span class="p">])</span>
<span class="n">plt</span><span class="o">.</span><span class="n">title</span><span class="p">(</span><span class="s1">&#39;Semivariograms comparison. Deviation value: </span><span class="si">{}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">reg_mod</span><span class="o">.</span><span class="n">initial_deviation</span><span class="p">))</span>
<span class="n">plt</span><span class="o">.</span><span class="n">xlabel</span><span class="p">(</span><span class="s1">&#39;Distance&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="s1">&#39;Semivariance&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="../_images/tutorials_Semivariogram_Regularization_(Intermediate)_21_0.png" src="../_images/tutorials_Semivariogram_Regularization_(Intermediate)_21_0.png" />
</div>
</div>
<p>Sill of experimental variogram is reached fast at the first lag. On the other hand sill of regularized semivariogram is reached at a larger distance which is a promising result for further processing and semivariogram deconvolution procedure.</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[14]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="n">reg_mod</span><span class="o">.</span><span class="n">transform</span><span class="p">(</span><span class="n">max_iters</span><span class="o">=</span><span class="mi">25</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area stderr docutils container">
<div class="highlight"><pre>
100%|██████████| 217/217 [00:00&lt;00:00, 11442.13it/s]
100%|██████████| 10/10 [00:00&lt;00:00, 70.57it/s]
100%|██████████| 217/217 [00:35&lt;00:00,  6.16it/s]
100%|██████████| 217/217 [00:00&lt;00:00, 11648.16it/s]
100%|██████████| 10/10 [00:00&lt;00:00, 130.55it/s]
100%|██████████| 217/217 [00:35&lt;00:00,  6.19it/s]
100%|██████████| 217/217 [00:00&lt;00:00, 11637.73it/s]
100%|██████████| 10/10 [00:00&lt;00:00, 65.02it/s]
100%|██████████| 217/217 [00:35&lt;00:00,  6.17it/s]
100%|██████████| 217/217 [00:00&lt;00:00, 11413.86it/s]
100%|██████████| 10/10 [00:00&lt;00:00, 133.48it/s]
100%|██████████| 217/217 [00:34&lt;00:00,  6.23it/s]
100%|██████████| 217/217 [00:00&lt;00:00, 11920.01it/s]
100%|██████████| 10/10 [00:00&lt;00:00, 106.05it/s]
100%|██████████| 217/217 [00:35&lt;00:00,  6.18it/s]
</pre></div></div>
</div>
<p><strong>NOTE:</strong></p>
<p>Operation stops automatically if calculated error is not changing after few iterations.</p>
</div>
<div class="section" id="4)-Visualize-and-check-semivariogram">
<h2>4) Visualize and check semivariogram<a class="headerlink" href="#4)-Visualize-and-check-semivariogram" title="Permalink to this headline">¶</a></h2>
<div class="section" id="id3">
<h3>Clarification:<a class="headerlink" href="#id3" title="Permalink to this headline">¶</a></h3>
<p>Process is fully automatic but we can check how it baheaved through each iteration. We can analyze deviation change (most important variable, mean absolute difference between regularized and theoretical models) with build-in method but if you are more interested in the algorithm stability you can analyze weight change over each iteration too.</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[15]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="c1"># First analyze deviation</span>

<span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">10</span><span class="p">,</span> <span class="mi">10</span><span class="p">))</span>
<span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">reg_mod</span><span class="o">.</span><span class="n">deviations</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="../_images/tutorials_Semivariogram_Regularization_(Intermediate)_25_0.png" src="../_images/tutorials_Semivariogram_Regularization_(Intermediate)_25_0.png" />
</div>
</div>
</div>
<div class="section" id="id4">
<h3>Clarification:<a class="headerlink" href="#id4" title="Permalink to this headline">¶</a></h3>
<p>Deviation between regularized semivariogram and theoretical model is smaller in each step but largest improvement can be seen after the first step and then it slows down. That’s why semivariogram regularization usually does not require many steps. However, if there are many lags then optimization may require more steps to achieve meaningful result. Below are deviation changes from the first step to show relative change:</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[23]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="c1"># First analyze deviation - exclude initial value</span>

<span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">10</span><span class="p">,</span> <span class="mi">10</span><span class="p">))</span>
<span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">reg_mod</span><span class="o">.</span><span class="n">deviations</span><span class="p">[</span><span class="mi">1</span><span class="p">:])</span>
<span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="../_images/tutorials_Semivariogram_Regularization_(Intermediate)_27_0.png" src="../_images/tutorials_Semivariogram_Regularization_(Intermediate)_27_0.png" />
</div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[16]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="c1"># Check weights - it is important to track problems with algorithm, esepcially if sum of weights is oscillating</span>
<span class="c1"># then it may be a sign of problems with data, model or (hopefully not!) algorithm itself.</span>

<span class="n">weights</span> <span class="o">=</span> <span class="n">reg_mod</span><span class="o">.</span><span class="n">weights</span>
<span class="n">weights</span> <span class="o">=</span> <span class="p">[</span><span class="nb">sum</span><span class="p">(</span><span class="n">w</span><span class="p">)</span> <span class="k">for</span> <span class="n">w</span> <span class="ow">in</span> <span class="n">weights</span><span class="p">]</span>

<span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">10</span><span class="p">,</span><span class="mi">10</span><span class="p">))</span>
<span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">weights</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="../_images/tutorials_Semivariogram_Regularization_(Intermediate)_28_0.png" src="../_images/tutorials_Semivariogram_Regularization_(Intermediate)_28_0.png" />
</div>
</div>
<div class="section" id="NOTE:">
<h4>NOTE:<a class="headerlink" href="#NOTE:" title="Permalink to this headline">¶</a></h4>
<p>Weights are smaller with each iteration. It is normal behavior of algorithm. General trend goes downward, and small oscillations may occur due to the optimization process.</p>
<p>The most important part is to compare semivariograms! You can see that Optimized Model is different than initial semivariogram. It is the result of regularization. Now population is taken into account in the cases of variogram development and further kriging interpolation.</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[17]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="n">reg_mod</span><span class="o">.</span><span class="n">show_semivariograms</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="../_images/tutorials_Semivariogram_Regularization_(Intermediate)_30_0.png" src="../_images/tutorials_Semivariogram_Regularization_(Intermediate)_30_0.png" />
</div>
</div>
</div>
</div>
<div class="section" id="id5">
<h3>Clarification:<a class="headerlink" href="#id5" title="Permalink to this headline">¶</a></h3>
<p>Experimental semivariogram is a semivariogram of areal centroids. Then theoretical semivariogram is used to describe this experimental (empirical) semivariogram. Regularization process is to find semivariogram close enough to the theoretical semivariogram, which describes ongoing process with the new support (in this case with population units). You may see that experimental semivariogram has exponential growth near the origin. It could mean that in this scale of analysis we lost some
information. But with population data we can retrive it and regularized semivariogram better describes process near the origin. We gain a new insights approximately 2-3 lags ahead of the initial model.</p>
<p>We can store regularized semivariogram output parameters for the further analysis and Kriging.</p>
</div>
</div>
<div class="section" id="5)-Export-semivariogram-to-text-file">
<h2>5) Export semivariogram to text file<a class="headerlink" href="#5)-Export-semivariogram-to-text-file" title="Permalink to this headline">¶</a></h2>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[19]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="c1"># Export semivariogram to the text file. This is important step because calculations are slow...</span>
<span class="c1"># and it is better to not repeat them.</span>
<span class="c1"># We will use buil-in method: export_regularized where we pass only filename our semivariogram</span>
<span class="c1"># parameters are stored for other tasks.</span>

<span class="n">reg_mod</span><span class="o">.</span><span class="n">export_regularized_model</span><span class="p">(</span><span class="s1">&#39;regularized_model.csv&#39;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<hr class="docutils" />
</div>
</div>


          </div>
          
        </div>
      </div>
      <div class="sphinxsidebar" role="navigation" aria-label="main navigation">
        <div class="sphinxsidebarwrapper">
<h1 class="logo"><a href="../index.html">Pyinterpolate</a></h1>








<h3>Navigation</h3>
<ul class="current">
<li class="toctree-l1"><a class="reference internal" href="../introduction.html">Introduction</a></li>
<li class="toctree-l1"><a class="reference internal" href="../setup.html">Setup</a></li>
<li class="toctree-l1 current"><a class="reference internal" href="../tutorials.html">Tutorials</a></li>
<li class="toctree-l1"><a class="reference internal" href="../code_documentation.html">Documentation</a></li>
<li class="toctree-l1"><a class="reference internal" href="../contribution.html">Contribution to Pyinterpolate</a></li>
<li class="toctree-l1"><a class="reference internal" href="../license.html">License</a></li>
</ul>

<div class="relations">
<h3>Related Topics</h3>
<ul>
  <li><a href="../index.html">Documentation overview</a><ul>
  <li><a href="../tutorials.html">Tutorials</a><ul>
      <li>Previous: <a href="Blocks%20to%20points%20Ordinary%20Kriging%20interpolation%20%28Intermediate%29.html" title="previous chapter">Blocks to points Ordinary Kriging interpolation - tutorial</a></li>
      <li>Next: <a href="Poisson%20Kriging%20-%20Centroid%20Based%20%28Advanced%29.html" title="next chapter">Poisson Kriging - centroid based approach - tutorial</a></li>
  </ul></li>
  </ul></li>
</ul>
</div>
<div id="searchbox" style="display: none" role="search">
  <h3 id="searchlabel">Quick search</h3>
    <div class="searchformwrapper">
    <form class="search" action="../search.html" method="get">
      <input type="text" name="q" aria-labelledby="searchlabel" />
      <input type="submit" value="Go" />
    </form>
    </div>
</div>
<script>$('#searchbox').show(0);</script>








        </div>
      </div>
      <div class="clearer"></div>
    </div>
    <div class="footer">
      &copy;2020, Szymon Moliński.
      
      |
      Powered by <a href="http://sphinx-doc.org/">Sphinx 3.5.3</a>
      &amp; <a href="https://github.com/bitprophet/alabaster">Alabaster 0.7.12</a>
      
      |
      <a href="../_sources/tutorials/Semivariogram Regularization (Intermediate).ipynb.txt"
          rel="nofollow">Page source</a>
    </div>

    

    
  </body>
</html>