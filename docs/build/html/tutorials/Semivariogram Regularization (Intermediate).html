
<!DOCTYPE html>

<html>
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Semivariogram regularization - tutorial &#8212; Pyinterpolate 0.2.0 documentation</title>
    <link rel="stylesheet" href="../_static/pygments.css" type="text/css" />
    <link rel="stylesheet" href="../_static/alabaster.css" type="text/css" />
    <script id="documentation_options" data-url_root="../" src="../_static/documentation_options.js"></script>
    <script src="../_static/jquery.js"></script>
    <script src="../_static/underscore.js"></script>
    <script src="../_static/doctools.js"></script>
    <script crossorigin="anonymous" integrity="sha256-Ae2Vz/4ePdIu6ZyI/5ZGsYnb+m0JlOmKPjt6XZ9JJkA=" src="https://cdnjs.cloudflare.com/ajax/libs/require.js/2.3.4/require.min.js"></script>
    <link rel="index" title="Index" href="../genindex.html" />
    <link rel="search" title="Search" href="../search.html" />
    <link rel="next" title="Poisson Kriging - centroid based approach - tutorial" href="Poisson%20Kriging%20-%20Centroid%20Based%20%28Advanced%29.html" />
    <link rel="prev" title="Blocks to points Ordinary Kriging interpolation - tutorial" href="Blocks%20to%20points%20Ordinary%20Kriging%20interpolation%20%28Intermediate%29.html" />
   
  <link rel="stylesheet" href="../_static/custom.css" type="text/css" />
  
  
  <meta name="viewport" content="width=device-width, initial-scale=0.9, maximum-scale=0.9" />

  </head><body>
  

    <div class="document">
      <div class="documentwrapper">
        <div class="bodywrapper">
          

          <div class="body" role="main">
            
  
<style>
/* CSS for nbsphinx extension */

/* remove conflicting styling from Sphinx themes */
div.nbinput.container div.prompt *,
div.nboutput.container div.prompt *,
div.nbinput.container div.input_area pre,
div.nboutput.container div.output_area pre,
div.nbinput.container div.input_area .highlight,
div.nboutput.container div.output_area .highlight {
    border: none;
    padding: 0;
    margin: 0;
    box-shadow: none;
}

div.nbinput.container > div[class*=highlight],
div.nboutput.container > div[class*=highlight] {
    margin: 0;
}

div.nbinput.container div.prompt *,
div.nboutput.container div.prompt * {
    background: none;
}

div.nboutput.container div.output_area .highlight,
div.nboutput.container div.output_area pre {
    background: unset;
}

div.nboutput.container div.output_area div.highlight {
    color: unset;  /* override Pygments text color */
}

/* avoid gaps between output lines */
div.nboutput.container div[class*=highlight] pre {
    line-height: normal;
}

/* input/output containers */
div.nbinput.container,
div.nboutput.container {
    display: -webkit-flex;
    display: flex;
    align-items: flex-start;
    margin: 0;
    width: 100%;
}
@media (max-width: 540px) {
    div.nbinput.container,
    div.nboutput.container {
        flex-direction: column;
    }
}

/* input container */
div.nbinput.container {
    padding-top: 5px;
}

/* last container */
div.nblast.container {
    padding-bottom: 5px;
}

/* input prompt */
div.nbinput.container div.prompt pre {
    color: #307FC1;
}

/* output prompt */
div.nboutput.container div.prompt pre {
    color: #BF5B3D;
}

/* all prompts */
div.nbinput.container div.prompt,
div.nboutput.container div.prompt {
    width: 4.5ex;
    padding-top: 5px;
    position: relative;
    user-select: none;
}

div.nbinput.container div.prompt > div,
div.nboutput.container div.prompt > div {
    position: absolute;
    right: 0;
    margin-right: 0.3ex;
}

@media (max-width: 540px) {
    div.nbinput.container div.prompt,
    div.nboutput.container div.prompt {
        width: unset;
        text-align: left;
        padding: 0.4em;
    }
    div.nboutput.container div.prompt.empty {
        padding: 0;
    }

    div.nbinput.container div.prompt > div,
    div.nboutput.container div.prompt > div {
        position: unset;
    }
}

/* disable scrollbars on prompts */
div.nbinput.container div.prompt pre,
div.nboutput.container div.prompt pre {
    overflow: hidden;
}

/* input/output area */
div.nbinput.container div.input_area,
div.nboutput.container div.output_area {
    -webkit-flex: 1;
    flex: 1;
    overflow: auto;
}
@media (max-width: 540px) {
    div.nbinput.container div.input_area,
    div.nboutput.container div.output_area {
        width: 100%;
    }
}

/* input area */
div.nbinput.container div.input_area {
    border: 1px solid #e0e0e0;
    border-radius: 2px;
    /*background: #f5f5f5;*/
}

/* override MathJax center alignment in output cells */
div.nboutput.container div[class*=MathJax] {
    text-align: left !important;
}

/* override sphinx.ext.imgmath center alignment in output cells */
div.nboutput.container div.math p {
    text-align: left;
}

/* standard error */
div.nboutput.container div.output_area.stderr {
    background: #fdd;
}

/* ANSI colors */
.ansi-black-fg { color: #3E424D; }
.ansi-black-bg { background-color: #3E424D; }
.ansi-black-intense-fg { color: #282C36; }
.ansi-black-intense-bg { background-color: #282C36; }
.ansi-red-fg { color: #E75C58; }
.ansi-red-bg { background-color: #E75C58; }
.ansi-red-intense-fg { color: #B22B31; }
.ansi-red-intense-bg { background-color: #B22B31; }
.ansi-green-fg { color: #00A250; }
.ansi-green-bg { background-color: #00A250; }
.ansi-green-intense-fg { color: #007427; }
.ansi-green-intense-bg { background-color: #007427; }
.ansi-yellow-fg { color: #DDB62B; }
.ansi-yellow-bg { background-color: #DDB62B; }
.ansi-yellow-intense-fg { color: #B27D12; }
.ansi-yellow-intense-bg { background-color: #B27D12; }
.ansi-blue-fg { color: #208FFB; }
.ansi-blue-bg { background-color: #208FFB; }
.ansi-blue-intense-fg { color: #0065CA; }
.ansi-blue-intense-bg { background-color: #0065CA; }
.ansi-magenta-fg { color: #D160C4; }
.ansi-magenta-bg { background-color: #D160C4; }
.ansi-magenta-intense-fg { color: #A03196; }
.ansi-magenta-intense-bg { background-color: #A03196; }
.ansi-cyan-fg { color: #60C6C8; }
.ansi-cyan-bg { background-color: #60C6C8; }
.ansi-cyan-intense-fg { color: #258F8F; }
.ansi-cyan-intense-bg { background-color: #258F8F; }
.ansi-white-fg { color: #C5C1B4; }
.ansi-white-bg { background-color: #C5C1B4; }
.ansi-white-intense-fg { color: #A1A6B2; }
.ansi-white-intense-bg { background-color: #A1A6B2; }

.ansi-default-inverse-fg { color: #FFFFFF; }
.ansi-default-inverse-bg { background-color: #000000; }

.ansi-bold { font-weight: bold; }
.ansi-underline { text-decoration: underline; }


div.nbinput.container div.input_area div[class*=highlight] > pre,
div.nboutput.container div.output_area div[class*=highlight] > pre,
div.nboutput.container div.output_area div[class*=highlight].math,
div.nboutput.container div.output_area.rendered_html,
div.nboutput.container div.output_area > div.output_javascript,
div.nboutput.container div.output_area:not(.rendered_html) > img{
    padding: 5px;
    margin: 0;
}

/* fix copybtn overflow problem in chromium (needed for 'sphinx_copybutton') */
div.nbinput.container div.input_area > div[class^='highlight'],
div.nboutput.container div.output_area > div[class^='highlight']{
    overflow-y: hidden;
}

/* hide copybtn icon on prompts (needed for 'sphinx_copybutton') */
.prompt a.copybtn {
    display: none;
}

/* Some additional styling taken form the Jupyter notebook CSS */
div.rendered_html table {
  border: none;
  border-collapse: collapse;
  border-spacing: 0;
  color: black;
  font-size: 12px;
  table-layout: fixed;
}
div.rendered_html thead {
  border-bottom: 1px solid black;
  vertical-align: bottom;
}
div.rendered_html tr,
div.rendered_html th,
div.rendered_html td {
  text-align: right;
  vertical-align: middle;
  padding: 0.5em 0.5em;
  line-height: normal;
  white-space: normal;
  max-width: none;
  border: none;
}
div.rendered_html th {
  font-weight: bold;
}
div.rendered_html tbody tr:nth-child(odd) {
  background: #f5f5f5;
}
div.rendered_html tbody tr:hover {
  background: rgba(66, 165, 245, 0.2);
}
</style>
<div class="section" id="Semivariogram-regularization---tutorial">
<h1>Semivariogram regularization - tutorial<a class="headerlink" href="#Semivariogram-regularization---tutorial" title="Permalink to this headline">¶</a></h1>
<div class="section" id="Table-of-Contents:">
<h2>Table of Contents:<a class="headerlink" href="#Table-of-Contents:" title="Permalink to this headline">¶</a></h2>
<ol class="arabic simple">
<li><p>Prepare areal and point data,</p></li>
<li><p>Set semivariogram parameters,</p></li>
<li><p>Perform regularization,</p></li>
<li><p>Visualize regularized semivariogram and analyze algorithm performance,</p></li>
<li><p>Export semivariogram to text file.</p></li>
</ol>
</div>
<div class="section" id="Level:-Intermediate">
<h2>Level: Intermediate<a class="headerlink" href="#Level:-Intermediate" title="Permalink to this headline">¶</a></h2>
</div>
<div class="section" id="Introduction">
<h2>Introduction<a class="headerlink" href="#Introduction" title="Permalink to this headline">¶</a></h2>
<p>In this tutorial we learn how to regularize semivariogram of areal dataset of irregular polygons. Procedure is described here: (1) Goovaerts P., Kriging and Semivariogram Deconvolution in the Presence of Irregular Geographical Units, Mathematical Geology 40(1), 101-128, 2008.</p>
<p>The main idea is to retrieve point support semivariogram from semivariogram of areal data with blocks of different shapes and sizes. It is the case in mining industry, where blocks of aggregates are deconvoluted into smaller units and in the epidemiology, where data is usually aggregated over big administrative units, or in ecology, where observations of species are aggregated over areas or time windows.</p>
<p>In this tutorial we use areal data of Breast Cancer incidence rates in Pennsylvania counties and U.S. Census 2010 data for population blocks.</p>
<blockquote>
<div><p>Breast cancer rates data is stored in the shapefile in folder <code class="docutils literal notranslate"><span class="pre">sample_data/areal_data/breast_cancer_rate_per_area_2.shp</span></code>.</p>
</div></blockquote>
<blockquote>
<div><p>Population blocks data is stored in the shapefile in folder <code class="docutils literal notranslate"><span class="pre">sample_data/population_data/population_blocks.shp</span></code></p>
</div></blockquote>
</div>
<div class="section" id="Import-packages">
<h2>Import packages<a class="headerlink" href="#Import-packages" title="Permalink to this headline">¶</a></h2>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[1]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>
<span class="kn">import</span> <span class="nn">geopandas</span> <span class="k">as</span> <span class="nn">gpd</span>

<span class="kn">from</span> <span class="nn">pyinterpolate.io_ops</span> <span class="kn">import</span> <span class="n">prepare_areal_shapefile</span><span class="p">,</span> <span class="n">get_points_within_area</span>  <span class="c1"># Prepare data</span>
<span class="kn">from</span> <span class="nn">pyinterpolate.semivariance</span> <span class="kn">import</span> <span class="n">calculate_semivariance</span>  <span class="c1"># Experimental semivariogram</span>
<span class="kn">from</span> <span class="nn">pyinterpolate.semivariance</span> <span class="kn">import</span> <span class="n">RegularizedSemivariogram</span>  <span class="c1"># Semivariogram regularization class</span>

<span class="kn">import</span> <span class="nn">matplotlib.pyplot</span> <span class="k">as</span> <span class="nn">plt</span>
</pre></div>
</div>
</div>
</div>
<div class="section" id="1)-Prepare-areal-and-point-data">
<h2>1) Prepare areal and point data<a class="headerlink" href="#1)-Prepare-areal-and-point-data" title="Permalink to this headline">¶</a></h2>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[2]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="n">areal_data</span> <span class="o">=</span> <span class="s1">&#39;../sample_data/areal_data/breast_cancer_rate_per_area_2.shp&#39;</span>
<span class="n">point_data</span> <span class="o">=</span> <span class="s1">&#39;../sample_data/population_data/population_blocks.shp&#39;</span>

<span class="c1"># The important thing before analysis is to check if crs of areal data and point data are the same</span>

<span class="n">areal_crs</span> <span class="o">=</span> <span class="n">gpd</span><span class="o">.</span><span class="n">read_file</span><span class="p">(</span><span class="n">areal_data</span><span class="p">)</span><span class="o">.</span><span class="n">crs</span>
<span class="n">point_support_crs</span> <span class="o">=</span> <span class="n">gpd</span><span class="o">.</span><span class="n">read_file</span><span class="p">(</span><span class="n">point_data</span><span class="p">)</span><span class="o">.</span><span class="n">crs</span>

<span class="n">areal_crs</span> <span class="o">==</span> <span class="n">point_support_crs</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[2]:
</pre></div>
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
True
</pre></div></div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[3]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="c1"># We need to know:</span>
<span class="c1"># - id column name of areal units,</span>
<span class="c1"># - value column name of areal units (usually aggregates),</span>
<span class="c1"># - value column name of point support units (usually population)</span>

<span class="c1"># Let&#39;s check it quickly with geopandas</span>

<span class="n">areal</span> <span class="o">=</span> <span class="n">gpd</span><span class="o">.</span><span class="n">read_file</span><span class="p">(</span><span class="n">areal_data</span><span class="p">)</span>
<span class="n">areal</span><span class="o">.</span><span class="n">head</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[3]:
</pre></div>
</div>
<div class="output_area rendered_html docutils container">
<div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>name</th>
      <th>rate</th>
      <th>id</th>
      <th>geometry</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>bradford</td>
      <td>129.0</td>
      <td>0</td>
      <td>POLYGON ((-76.14569 41.99885, -76.14364 41.977...</td>
    </tr>
    <tr>
      <th>1</th>
      <td>bucks</td>
      <td>140.9</td>
      <td>1</td>
      <td>POLYGON ((-75.19130 40.58570, -75.19156 40.585...</td>
    </tr>
    <tr>
      <th>2</th>
      <td>tioga</td>
      <td>127.4</td>
      <td>2</td>
      <td>POLYGON ((-77.17156 41.99967, -77.16142 41.999...</td>
    </tr>
    <tr>
      <th>3</th>
      <td>union</td>
      <td>118.0</td>
      <td>3</td>
      <td>POLYGON ((-76.91306 40.88454, -76.91356 40.884...</td>
    </tr>
    <tr>
      <th>4</th>
      <td>venango</td>
      <td>126.0</td>
      <td>4</td>
      <td>POLYGON ((-79.98155 41.51290, -79.98149 41.512...</td>
    </tr>
  </tbody>
</table>
</div></div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[4]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="c1"># From areal file we are interested in variable deaths (value) and ID (id)</span>
<span class="c1"># Now check point support data</span>

<span class="n">point</span> <span class="o">=</span> <span class="n">gpd</span><span class="o">.</span><span class="n">read_file</span><span class="p">(</span><span class="n">point_data</span><span class="p">)</span>
<span class="n">point</span><span class="o">.</span><span class="n">head</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[4]:
</pre></div>
</div>
<div class="output_area rendered_html docutils container">
<div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>STATEFP</th>
      <th>COUNTYFP</th>
      <th>TRACTCE</th>
      <th>BLKGRPCE</th>
      <th>POPULATION</th>
      <th>LATITUDE</th>
      <th>LONGITUDE</th>
      <th>geometry</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>42</td>
      <td>1</td>
      <td>30101</td>
      <td>1</td>
      <td>2580</td>
      <td>40.015805</td>
      <td>-77.081172</td>
      <td>POINT (-77.08117 40.01581)</td>
    </tr>
    <tr>
      <th>1</th>
      <td>42</td>
      <td>1</td>
      <td>30102</td>
      <td>1</td>
      <td>1136</td>
      <td>39.940818</td>
      <td>-76.995904</td>
      <td>POINT (-76.99590 39.94082)</td>
    </tr>
    <tr>
      <th>2</th>
      <td>42</td>
      <td>1</td>
      <td>30102</td>
      <td>2</td>
      <td>2434</td>
      <td>39.980590</td>
      <td>-77.035933</td>
      <td>POINT (-77.03593 39.98059)</td>
    </tr>
    <tr>
      <th>3</th>
      <td>42</td>
      <td>1</td>
      <td>30102</td>
      <td>3</td>
      <td>2210</td>
      <td>39.929089</td>
      <td>-77.057235</td>
      <td>POINT (-77.05724 39.92909)</td>
    </tr>
    <tr>
      <th>4</th>
      <td>42</td>
      <td>1</td>
      <td>30200</td>
      <td>1</td>
      <td>3202</td>
      <td>40.000254</td>
      <td>-77.137559</td>
      <td>POINT (-77.13756 40.00025)</td>
    </tr>
  </tbody>
</table>
</div></div>
</div>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[6]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="c1"># Column TOT is interesting from our perspective</span>
<span class="c1"># Now prepare data for further processing</span>

<span class="n">areal_id</span> <span class="o">=</span> <span class="s1">&#39;id&#39;</span>
<span class="n">areal_val</span> <span class="o">=</span> <span class="s1">&#39;rate&#39;</span>
<span class="n">points_val</span> <span class="o">=</span> <span class="s1">&#39;POPULATION&#39;</span>

<span class="n">areal_data_prepared</span> <span class="o">=</span> <span class="n">prepare_areal_shapefile</span><span class="p">(</span><span class="n">areal_data</span><span class="p">,</span> <span class="n">areal_id</span><span class="p">,</span> <span class="n">areal_val</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[7]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="c1"># Check how prepared areal data looks like</span>

<span class="n">areal_data_prepared</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[7]:
</pre></div>
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
array([0, &lt;shapely.geometry.polygon.Polygon object at 0x7f9102f9d6d0&gt;,
       -76.51541607859876, 41.78864564848121, 129.0], dtype=object)
</pre></div></div>
</div>
<div class="section" id="Clarification:">
<h3>Clarification:<a class="headerlink" href="#Clarification:" title="Permalink to this headline">¶</a></h3>
<p>Every areal dataset is passed as an array of:</p>
<p>[area id, area geometry (polygon), areal centroid x (lon), areal centroid y (lat), value]</p>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[8]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="n">points_in_area</span> <span class="o">=</span> <span class="n">get_points_within_area</span><span class="p">(</span><span class="n">areal_data</span><span class="p">,</span> <span class="n">point_data</span><span class="p">,</span> <span class="n">areal_id_col_name</span><span class="o">=</span><span class="n">areal_id</span><span class="p">,</span>
                                        <span class="n">points_val_col_name</span><span class="o">=</span><span class="n">points_val</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[9]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="c1"># Check how prepared point data looks like</span>

<span class="n">points_in_area</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[9]:
</pre></div>
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
array([57.0,
       array([[ -77.081172,   40.015805, 2580.      ],
       [ -76.995904,   39.940818, 1136.      ],
       [ -77.035933,   39.98059 , 2434.      ],
       [ -77.057235,   39.929089, 2210.      ],
       [ -77.137559,   40.000254, 3202.      ],
       [ -77.160354,   39.95907 , 2298.      ],
       [ -77.318327,   39.973414, 2251.      ],
       [ -77.240078,   39.985105, 1905.      ],
       [ -77.406954,   39.915855, 1446.      ],
       [ -77.298505,   39.923503,  979.      ],
       [ -77.307547,   39.878509, 1289.      ],
       [ -77.360488,   39.873705, 1312.      ],
       [ -77.412175,   39.880362,  803.      ],
       [ -77.227283,   39.926149, 2179.      ],
       [ -77.26064 ,   39.921269, 1588.      ],
       [ -77.173147,   39.868602, 1455.      ],
       [ -77.144613,   39.894567, 1310.      ],
       [ -77.197063,   39.839027, 2163.      ],
       [ -77.119613,   39.84048 , 2646.      ],
       [ -77.106559,   39.807127, 2047.      ],
       [ -77.133681,   39.808798, 1800.      ],
       [ -76.978816,   39.935873, 1521.      ],
       [ -77.021869,   39.900686, 2189.      ],
       [ -76.99146 ,   39.885828, 1407.      ],
       [ -76.991111,   39.861894, 2334.      ],
       [ -77.061948,   39.86404 , 1752.      ],
       [ -77.05219 ,   39.868851, 1810.      ],
       [ -77.038619,   39.857219, 2831.      ],
       [ -77.063652,   39.842697,  907.      ],
       [ -77.027236,   39.816071, 1781.      ],
       [ -77.024943,   39.802265, 1358.      ],
       [ -77.015872,   39.805741, 1680.      ],
       [ -77.005054,   39.802861, 2125.      ],
       [ -77.033649,   39.794506, 3179.      ],
       [ -77.186341,   39.75204 , 1892.      ],
       [ -77.180639,   39.79953 , 1778.      ],
       [ -77.103434,   39.737394, 2700.      ],
       [ -77.048888,   39.750129, 3148.      ],
       [ -77.092351,   39.742506, 2699.      ],
       [ -77.084641,   39.746572, 1735.      ],
       [ -77.243604,   39.858199, 2324.      ],
       [ -77.270967,   39.835409, 1651.      ],
       [ -77.254646,   39.814023,  918.      ],
       [ -77.247134,   39.765904, 1269.      ],
       [ -77.234276,   39.835615, 2139.      ],
       [ -77.22914 ,   39.83533 , 1176.      ],
       [ -77.237274,   39.831159, 1244.      ],
       [ -77.236135,   39.827837, 1041.      ],
       [ -77.235265,   39.822907,  793.      ],
       [ -77.226393,   39.830304, 1227.      ],
       [ -77.325282,   39.82366 ,  943.      ],
       [ -77.297636,   39.754058,  831.      ],
       [ -77.388552,   39.744591, 3260.      ],
       [ -77.355943,   39.761226, 1853.      ],
       [ -77.405762,   39.817622, 1231.      ],
       [ -77.396045,   39.771022, 1648.      ]])], dtype=object)
</pre></div></div>
</div>
</div>
<div class="section" id="id1">
<h3>Clarification:<a class="headerlink" href="#id1" title="Permalink to this headline">¶</a></h3>
<p>Every point support dataset is passed as an array of:</p>
<p>[area id, array of: [lon, lat, value]]</p>
</div>
</div>
<div class="section" id="2)-Set-semivariogram-parameters.">
<h2>2) Set semivariogram parameters.<a class="headerlink" href="#2)-Set-semivariogram-parameters." title="Permalink to this headline">¶</a></h2>
<p>Now we must set parameters for areal semivariogram AND point semivariogram. It is very important to understand data well to set them properly, that’s why you should always check experimental semivariograms of those datasets to understand how data behaves. We do it for prepared areal and point datasets.</p>
<p>From the practical point of view area semivariogram analysis is more important because we pass into semivariogram regularization parameters of step size and maximum search radius. But we check point’s semivariogram too. It is analytical step, to check if spatial process whoch we are using for semivariogram deconvolution is proper, as example if semivariogram shows exponential function then our process will not be properly modeled.</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[10]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="c1"># Check experimental semivariogram of areal data - this cell may be run multiple times</span>
<span class="c1"># before you find optimal parameters</span>

<span class="n">maximum_range</span> <span class="o">=</span> <span class="mi">4</span>
<span class="n">step_size</span> <span class="o">=</span> <span class="mf">0.2</span>

<span class="n">dt</span> <span class="o">=</span> <span class="n">areal_data_prepared</span><span class="p">[:,</span> <span class="mi">2</span><span class="p">:]</span>  <span class="c1"># x, y, val</span>
<span class="n">exp_semivar</span> <span class="o">=</span> <span class="n">calculate_semivariance</span><span class="p">(</span><span class="n">data</span><span class="o">=</span><span class="n">dt</span><span class="p">,</span> <span class="n">step_size</span><span class="o">=</span><span class="n">step_size</span><span class="p">,</span> <span class="n">max_range</span><span class="o">=</span><span class="n">maximum_range</span><span class="p">)</span>

<span class="c1"># Plot experimental semivariogram</span>

<span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">12</span><span class="p">,</span> <span class="mi">12</span><span class="p">))</span>
<span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">exp_semivar</span><span class="p">[:,</span> <span class="mi">0</span><span class="p">],</span> <span class="n">exp_semivar</span><span class="p">[:,</span> <span class="mi">1</span><span class="p">])</span>
<span class="n">plt</span><span class="o">.</span><span class="n">title</span><span class="p">(</span><span class="s1">&#39;Experimental semivariogram od areal centroids&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">xlabel</span><span class="p">(</span><span class="s1">&#39;Range - in meters&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="s1">&#39;Semivariance&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="../_images/tutorials_Semivariogram_Regularization_(Intermediate)_14_0.png" src="../_images/tutorials_Semivariogram_Regularization_(Intermediate)_14_0.png" />
</div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[11]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="c1"># Check experimental semivariogram of point data - this cell may be run multiple times</span>
<span class="c1"># before you find optimal parameters</span>

<span class="k">def</span> <span class="nf">build_point_array</span><span class="p">(</span><span class="n">points</span><span class="p">):</span>
    <span class="n">a</span> <span class="o">=</span> <span class="kc">None</span>

    <span class="k">for</span> <span class="n">rec</span> <span class="ow">in</span> <span class="n">points</span><span class="p">:</span>
        <span class="k">if</span> <span class="n">a</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">a</span> <span class="o">=</span> <span class="n">rec</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">a</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">vstack</span><span class="p">((</span><span class="n">a</span><span class="p">,</span> <span class="n">rec</span><span class="p">))</span>

    <span class="k">return</span> <span class="n">a</span>

<span class="n">maximum_point_range</span> <span class="o">=</span> <span class="mi">4</span>
<span class="n">step_size_points</span> <span class="o">=</span> <span class="mf">0.1</span>


<span class="n">pt</span> <span class="o">=</span> <span class="n">build_point_array</span><span class="p">(</span><span class="n">points_in_area</span><span class="p">[:,</span> <span class="mi">1</span><span class="p">])</span>  <span class="c1"># x, y, val</span>
<span class="n">exp_semivar</span> <span class="o">=</span> <span class="n">calculate_semivariance</span><span class="p">(</span><span class="n">data</span><span class="o">=</span><span class="n">pt</span><span class="p">,</span> <span class="n">step_size</span><span class="o">=</span><span class="n">step_size_points</span><span class="p">,</span> <span class="n">max_range</span><span class="o">=</span><span class="n">maximum_point_range</span><span class="p">)</span>

<span class="c1"># Plot experimental semivariogram</span>

<span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">12</span><span class="p">,</span> <span class="mi">12</span><span class="p">))</span>
<span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">exp_semivar</span><span class="p">[:,</span> <span class="mi">0</span><span class="p">],</span> <span class="n">exp_semivar</span><span class="p">[:,</span> <span class="mi">1</span><span class="p">])</span>
<span class="n">plt</span><span class="o">.</span><span class="n">title</span><span class="p">(</span><span class="s1">&#39;Experimental semivariogram od population data&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">xlabel</span><span class="p">(</span><span class="s1">&#39;Range - in meters&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="s1">&#39;Semivariance&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="../_images/tutorials_Semivariogram_Regularization_(Intermediate)_15_0.png" src="../_images/tutorials_Semivariogram_Regularization_(Intermediate)_15_0.png" />
</div>
</div>
<div class="section" id="id2">
<h3>Clarification:<a class="headerlink" href="#id2" title="Permalink to this headline">¶</a></h3>
<p>After few adjustements we have prepared semivariogram parameters for area and point support data. The next step is to create <code class="docutils literal notranslate"><span class="pre">RegularizedSemivariogram</span></code> model. We have mutiple parameters to choose and at the beginning it is hard to find the best fit, so try to avoid multiple loops because it is a time-consuming operation.</p>
<p>The program is designed to first <strong>fit()</strong> the model and later to <strong>transform()</strong> it.</p>
<p>When you <strong>fit()</strong> a model you have multiple parameters to control: * areal_data: areal data prepared with the function prepare_areal_shapefile(), where data is a numpy array in the form: [area_id, area_geometry, centroid coordinate x, centroid coordinate y, value], * areal_lags: list of lags between each distance, * areal_step_size: step size between each lag, usually it is a half of distance between lags, * point_support_data: point support data prepared with the function
get_points_within_area(), where data is a numpy array in the form: [area_id, [point_position_x, point_position_y, value]], * ranges: (int) number of ranges to test during semivariogram fitting. More steps == more accurate nugget and range prediction, but longer calculations, * weighted_lags: (bool) lags weighted by number of points; if True then during semivariogram fitting error of each model is weighted by number of points for each lag. In practice it means that more reliable data (lags)
have larger weights and semivariogram is modeled to better fit to those lags, * store_models: (bool) if True then experimental, regularized and theoretical models are stored in lists after each iteration. It is important for a debugging process.</p>
<p>We set ranges to 64, then we will weight lags and we do not store semivariograms and semivariogram models.</p>
<p>After fitting we perform <strong>transform()</strong>. This function has few parameters to control regularization process, but we leave them as default with one exception: we set max_iters parameter to 5.</p>
<p>This process of fitting and transforming takes some time, so it’s good idea to run it and do something else…</p>
</div>
</div>
<div class="section" id="3)-Regularize-semivariogram">
<h2>3) Regularize semivariogram<a class="headerlink" href="#3)-Regularize-semivariogram" title="Permalink to this headline">¶</a></h2>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[12]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="n">reg_mod</span> <span class="o">=</span> <span class="n">RegularizedSemivariogram</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[14]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="n">reg_mod</span><span class="o">.</span><span class="n">fit</span><span class="p">(</span><span class="n">areal_data</span><span class="o">=</span><span class="n">areal_data_prepared</span><span class="p">,</span>
            <span class="n">areal_step_size</span><span class="o">=</span><span class="n">step_size</span><span class="p">,</span> <span class="n">max_areal_range</span><span class="o">=</span><span class="n">maximum_range</span><span class="p">,</span>
            <span class="n">point_support_data</span><span class="o">=</span><span class="n">points_in_area</span><span class="p">,</span> <span class="n">ranges</span><span class="o">=</span><span class="mi">32</span><span class="p">,</span> <span class="n">weighted_lags</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">store_models</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area stderr docutils container">
<div class="highlight"><pre>
100%|██████████| 67/67 [00:00&lt;00:00, 594.51it/s]
100%|██████████| 20/20 [00:00&lt;00:00, 980.89it/s]
100%|██████████| 67/67 [01:25&lt;00:00,  1.28s/it]
</pre></div></div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[15]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="c1"># Check initial experimental, theoretical and regularized semivariograms</span>

<span class="n">lags</span> <span class="o">=</span> <span class="n">reg_mod</span><span class="o">.</span><span class="n">experimental_semivariogram_of_areal_data</span><span class="p">[:,</span> <span class="mi">0</span><span class="p">]</span>
<span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">12</span><span class="p">,</span> <span class="mi">12</span><span class="p">))</span>
<span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">lags</span><span class="p">,</span> <span class="n">reg_mod</span><span class="o">.</span><span class="n">experimental_semivariogram_of_areal_data</span><span class="p">[:,</span> <span class="mi">1</span><span class="p">],</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;b&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">lags</span><span class="p">,</span> <span class="n">reg_mod</span><span class="o">.</span><span class="n">initial_theoretical_model_of_areal_data</span><span class="o">.</span><span class="n">predict</span><span class="p">(</span><span class="n">lags</span><span class="p">),</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;r&#39;</span><span class="p">,</span> <span class="n">linestyle</span><span class="o">=</span><span class="s1">&#39;--&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">lags</span><span class="p">,</span> <span class="n">reg_mod</span><span class="o">.</span><span class="n">initial_regularized_model</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;black&#39;</span><span class="p">,</span> <span class="n">linestyle</span><span class="o">=</span><span class="s1">&#39;dotted&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">legend</span><span class="p">([</span><span class="s1">&#39;Experimental semivariogram of areal data&#39;</span><span class="p">,</span> <span class="s1">&#39;Initial Semivariogram of areal data&#39;</span><span class="p">,</span>
            <span class="s1">&#39;Regularized data points&#39;</span><span class="p">])</span>
<span class="n">plt</span><span class="o">.</span><span class="n">title</span><span class="p">(</span><span class="s1">&#39;Semivariograms comparison. Deviation value: </span><span class="si">{}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">reg_mod</span><span class="o">.</span><span class="n">initial_deviation</span><span class="p">))</span>
<span class="n">plt</span><span class="o">.</span><span class="n">xlabel</span><span class="p">(</span><span class="s1">&#39;Distance&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="s1">&#39;Semivariance&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="../_images/tutorials_Semivariogram_Regularization_(Intermediate)_19_0.png" src="../_images/tutorials_Semivariogram_Regularization_(Intermediate)_19_0.png" />
</div>
</div>
<p>There’s a large relative difference between regularized semivariance and theoretical semivariogram of areal data. What’s more important: sill is reached approx. at 1 degree distance… So there is a problem of scale: spatial correlation potentially exists but at much smaller scales than we are able to observe and we lost some information near the origin.</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[16]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="n">reg_mod</span><span class="o">.</span><span class="n">transform</span><span class="p">(</span><span class="n">max_iters</span><span class="o">=</span><span class="mi">5</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area stderr docutils container">
<div class="highlight"><pre>
100%|██████████| 67/67 [00:00&lt;00:00, 514.94it/s]
100%|██████████| 20/20 [00:00&lt;00:00, 866.65it/s]
100%|██████████| 67/67 [01:26&lt;00:00,  1.29s/it]
100%|██████████| 67/67 [00:00&lt;00:00, 935.73it/s]
100%|██████████| 20/20 [00:00&lt;00:00, 701.84it/s]
100%|██████████| 67/67 [02:02&lt;00:00,  1.83s/it]
100%|██████████| 67/67 [00:00&lt;00:00, 394.32it/s]
100%|██████████| 20/20 [00:00&lt;00:00, 770.16it/s]
100%|██████████| 67/67 [02:27&lt;00:00,  2.21s/it]
100%|██████████| 67/67 [00:00&lt;00:00, 937.93it/s]
100%|██████████| 20/20 [00:00&lt;00:00, 764.00it/s]
100%|██████████| 67/67 [02:01&lt;00:00,  1.81s/it]
</pre></div></div>
</div>
<p><strong>NOTE:</strong></p>
<p>Operation is slow in the beta version of library so try to find some different task to do when process runs.</p>
</div>
<div class="section" id="4)-Visualize-and-check-semivariogram">
<h2>4) Visualize and check semivariogram<a class="headerlink" href="#4)-Visualize-and-check-semivariogram" title="Permalink to this headline">¶</a></h2>
<div class="section" id="id3">
<h3>Clarification:<a class="headerlink" href="#id3" title="Permalink to this headline">¶</a></h3>
<p>Process is fully automatic but we can check how it baheaved through each iteration. We can analyze deviation change (most important variable, mean absolute difference between regularized and theoretical models) with build-in method but if you are more interested in the algorithm stability you can analyze weight change over each iteration too.</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[17]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="c1"># First analyze deviation</span>

<span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">10</span><span class="p">,</span> <span class="mi">10</span><span class="p">))</span>
<span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">reg_mod</span><span class="o">.</span><span class="n">deviations</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="../_images/tutorials_Semivariogram_Regularization_(Intermediate)_23_0.png" src="../_images/tutorials_Semivariogram_Regularization_(Intermediate)_23_0.png" />
</div>
</div>
</div>
<div class="section" id="id4">
<h3>Clarification:<a class="headerlink" href="#id4" title="Permalink to this headline">¶</a></h3>
<p>Deviation between regularized semivariogram and theoretical model is smaller with each step which is a good sign that our algorithm works properlly. We’ve performed only five iterations and we may expect that deviation drops later too.</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[18]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="c1"># Check weights - it is important to track problems with algorithm, esepcially if sum of weights is oscillating</span>
<span class="c1"># then it may be a sign of problems with data, model or (hopefully not!) algorithm itself.</span>

<span class="n">weights</span> <span class="o">=</span> <span class="n">reg_mod</span><span class="o">.</span><span class="n">weights</span>
<span class="n">weights</span> <span class="o">=</span> <span class="p">[</span><span class="nb">sum</span><span class="p">(</span><span class="n">w</span><span class="p">)</span> <span class="k">for</span> <span class="n">w</span> <span class="ow">in</span> <span class="n">weights</span><span class="p">]</span>

<span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">10</span><span class="p">,</span><span class="mi">10</span><span class="p">))</span>
<span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">weights</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="../_images/tutorials_Semivariogram_Regularization_(Intermediate)_25_0.png" src="../_images/tutorials_Semivariogram_Regularization_(Intermediate)_25_0.png" />
</div>
</div>
<div class="section" id="NOTE:">
<h4>NOTE:<a class="headerlink" href="#NOTE:" title="Permalink to this headline">¶</a></h4>
<p>Weights are smaller with each iteration. It is normal behavior of algorithm.</p>
</div>
<div class="section" id="note-1">
<span id="id5"></span><h4>NOTE:<a class="headerlink" href="#note-1" title="Permalink to this headline">¶</a></h4>
<p>The most important part is to compare semivariograms! You can see that Optimized Model is equal to Initial Semivariogram of areal data: our model is not better than normal kriging of areal centroids.</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[19]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="n">reg_mod</span><span class="o">.</span><span class="n">show_semivariograms</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="../_images/tutorials_Semivariogram_Regularization_(Intermediate)_27_0.png" src="../_images/tutorials_Semivariogram_Regularization_(Intermediate)_27_0.png" />
</div>
</div>
</div>
</div>
<div class="section" id="id6">
<h3>Clarification:<a class="headerlink" href="#id6" title="Permalink to this headline">¶</a></h3>
<p>Experimental semivariogram is a semivariogram of areal centroids. Then theoretical semivariogram is used to describe this experimental (empirical) semivariogram. Regularization process is to find semivariogram close enough to the theoretical semivariogram, which describes ongoing process with the new support (in this case with population units). You may see that experimental semivariogram has exponential growth near the origin. It could mean that in this scale of analysis we lost some
information.</p>
<p>Anyway, we can store this regularized semivariogram properties for the further analysis and Kriging and we will perform it, even with the parameters which are not well fitted to the data.</p>
</div>
</div>
<div class="section" id="5)-Export-semivariogram-to-text-file">
<h2>5) Export semivariogram to text file<a class="headerlink" href="#5)-Export-semivariogram-to-text-file" title="Permalink to this headline">¶</a></h2>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[21]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="c1"># Export semivariogram to the text file. This is important step because calculations are slow...</span>
<span class="c1"># and it is better to not repeat them.</span>
<span class="c1"># We will use buil-in method: export_regularized where we pass only filename our semivariogram</span>
<span class="c1"># parameters are stored for other tasks.</span>

<span class="n">reg_mod</span><span class="o">.</span><span class="n">export_regularized_model</span><span class="p">(</span><span class="s1">&#39;regularized_model.csv&#39;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<hr class="docutils" />
</div>
</div>


          </div>
          
        </div>
      </div>
      <div class="sphinxsidebar" role="navigation" aria-label="main navigation">
        <div class="sphinxsidebarwrapper">
<h1 class="logo"><a href="../index.html">Pyinterpolate</a></h1>








<h3>Navigation</h3>
<ul class="current">
<li class="toctree-l1"><a class="reference internal" href="../introduction.html">Introduction</a></li>
<li class="toctree-l1"><a class="reference internal" href="../setup.html">Setup</a></li>
<li class="toctree-l1 current"><a class="reference internal" href="../tutorials.html">Tutorials</a></li>
<li class="toctree-l1"><a class="reference internal" href="../code_documentation.html">Documentation</a></li>
<li class="toctree-l1"><a class="reference internal" href="../contribution.html">Contribution to Pyinterpolate</a></li>
<li class="toctree-l1"><a class="reference internal" href="../license.html">License</a></li>
</ul>

<div class="relations">
<h3>Related Topics</h3>
<ul>
  <li><a href="../index.html">Documentation overview</a><ul>
  <li><a href="../tutorials.html">Tutorials</a><ul>
      <li>Previous: <a href="Blocks%20to%20points%20Ordinary%20Kriging%20interpolation%20%28Intermediate%29.html" title="previous chapter">Blocks to points Ordinary Kriging interpolation - tutorial</a></li>
      <li>Next: <a href="Poisson%20Kriging%20-%20Centroid%20Based%20%28Advanced%29.html" title="next chapter">Poisson Kriging - centroid based approach - tutorial</a></li>
  </ul></li>
  </ul></li>
</ul>
</div>
<div id="searchbox" style="display: none" role="search">
  <h3 id="searchlabel">Quick search</h3>
    <div class="searchformwrapper">
    <form class="search" action="../search.html" method="get">
      <input type="text" name="q" aria-labelledby="searchlabel" />
      <input type="submit" value="Go" />
    </form>
    </div>
</div>
<script>$('#searchbox').show(0);</script>








        </div>
      </div>
      <div class="clearer"></div>
    </div>
    <div class="footer">
      &copy;2020, Szymon Moliński.
      
      |
      Powered by <a href="http://sphinx-doc.org/">Sphinx 3.5.2</a>
      &amp; <a href="https://github.com/bitprophet/alabaster">Alabaster 0.7.12</a>
      
      |
      <a href="../_sources/tutorials/Semivariogram Regularization (Intermediate).ipynb.txt"
          rel="nofollow">Page source</a>
    </div>

    

    
  </body>
</html>