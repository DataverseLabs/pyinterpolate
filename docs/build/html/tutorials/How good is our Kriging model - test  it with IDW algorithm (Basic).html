
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
  "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">

<html xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta http-equiv="X-UA-Compatible" content="IE=Edge" />
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    <title>How good is my Kriging model? - tests with IDW algorithm - tutorial &#8212; Pyinterpolate 0.2.3 documentation</title>
    <link rel="stylesheet" href="../_static/alabaster.css" type="text/css" />
    <link rel="stylesheet" href="../_static/pygments.css" type="text/css" />
    <script type="text/javascript" id="documentation_options" data-url_root="../" src="../_static/documentation_options.js"></script>
    <script type="text/javascript" src="../_static/jquery.js"></script>
    <script type="text/javascript" src="../_static/underscore.js"></script>
    <script type="text/javascript" src="../_static/doctools.js"></script>
    <script type="text/javascript" src="../_static/language_data.js"></script>
    <script crossorigin="anonymous" integrity="sha256-Ae2Vz/4ePdIu6ZyI/5ZGsYnb+m0JlOmKPjt6XZ9JJkA=" type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/require.js/2.3.4/require.min.js"></script>
    <script async="async" type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/latest.js?config=TeX-AMS-MML_HTMLorMML"></script>
    <script type="text/x-mathjax-config">MathJax.Hub.Config({"tex2jax": {"inlineMath": [["$", "$"], ["\\(", "\\)"]], "processEscapes": true, "ignoreClass": "tex2jax_ignore|mathjax_ignore|document", "processClass": "tex2jax_process|mathjax_process|math|output_area"}})</script>
    <link rel="index" title="Index" href="../genindex.html" />
    <link rel="search" title="Search" href="../search.html" />
    <link rel="next" title="Blocks to points Ordinary Kriging interpolation - tutorial" href="Blocks to points Ordinary Kriging interpolation (Intermediate).html" />
    <link rel="prev" title="Ordinary and Simple Kriging - tutorial" href="Ordinary and Simple Kriging (Basic).html" />
   
  <link rel="stylesheet" href="../_static/custom.css" type="text/css" />
  
  
  <meta name="viewport" content="width=device-width, initial-scale=0.9, maximum-scale=0.9" />

  </head><body>
  

    <div class="document">
      <div class="documentwrapper">
        <div class="bodywrapper">
          

          <div class="body" role="main">
            
  
<style>
/* CSS for nbsphinx extension */

/* remove conflicting styling from Sphinx themes */
div.nbinput.container div.prompt *,
div.nboutput.container div.prompt *,
div.nbinput.container div.input_area pre,
div.nboutput.container div.output_area pre,
div.nbinput.container div.input_area .highlight,
div.nboutput.container div.output_area .highlight {
    border: none;
    padding: 0;
    margin: 0;
    box-shadow: none;
}

div.nbinput.container > div[class*=highlight],
div.nboutput.container > div[class*=highlight] {
    margin: 0;
}

div.nbinput.container div.prompt *,
div.nboutput.container div.prompt * {
    background: none;
}

div.nboutput.container div.output_area .highlight,
div.nboutput.container div.output_area pre {
    background: unset;
}

div.nboutput.container div.output_area div.highlight {
    color: unset;  /* override Pygments text color */
}

/* avoid gaps between output lines */
div.nboutput.container div[class*=highlight] pre {
    line-height: normal;
}

/* input/output containers */
div.nbinput.container,
div.nboutput.container {
    display: -webkit-flex;
    display: flex;
    align-items: flex-start;
    margin: 0;
    width: 100%;
}
@media (max-width: 540px) {
    div.nbinput.container,
    div.nboutput.container {
        flex-direction: column;
    }
}

/* input container */
div.nbinput.container {
    padding-top: 5px;
}

/* last container */
div.nblast.container {
    padding-bottom: 5px;
}

/* input prompt */
div.nbinput.container div.prompt pre {
    color: #307FC1;
}

/* output prompt */
div.nboutput.container div.prompt pre {
    color: #BF5B3D;
}

/* all prompts */
div.nbinput.container div.prompt,
div.nboutput.container div.prompt {
    width: 4.5ex;
    padding-top: 5px;
    position: relative;
    user-select: none;
}

div.nbinput.container div.prompt > div,
div.nboutput.container div.prompt > div {
    position: absolute;
    right: 0;
    margin-right: 0.3ex;
}

@media (max-width: 540px) {
    div.nbinput.container div.prompt,
    div.nboutput.container div.prompt {
        width: unset;
        text-align: left;
        padding: 0.4em;
    }
    div.nboutput.container div.prompt.empty {
        padding: 0;
    }

    div.nbinput.container div.prompt > div,
    div.nboutput.container div.prompt > div {
        position: unset;
    }
}

/* disable scrollbars on prompts */
div.nbinput.container div.prompt pre,
div.nboutput.container div.prompt pre {
    overflow: hidden;
}

/* input/output area */
div.nbinput.container div.input_area,
div.nboutput.container div.output_area {
    -webkit-flex: 1;
    flex: 1;
    overflow: auto;
}
@media (max-width: 540px) {
    div.nbinput.container div.input_area,
    div.nboutput.container div.output_area {
        width: 100%;
    }
}

/* input area */
div.nbinput.container div.input_area {
    border: 1px solid #e0e0e0;
    border-radius: 2px;
    /*background: #f5f5f5;*/
}

/* override MathJax center alignment in output cells */
div.nboutput.container div[class*=MathJax] {
    text-align: left !important;
}

/* override sphinx.ext.imgmath center alignment in output cells */
div.nboutput.container div.math p {
    text-align: left;
}

/* standard error */
div.nboutput.container div.output_area.stderr {
    background: #fdd;
}

/* ANSI colors */
.ansi-black-fg { color: #3E424D; }
.ansi-black-bg { background-color: #3E424D; }
.ansi-black-intense-fg { color: #282C36; }
.ansi-black-intense-bg { background-color: #282C36; }
.ansi-red-fg { color: #E75C58; }
.ansi-red-bg { background-color: #E75C58; }
.ansi-red-intense-fg { color: #B22B31; }
.ansi-red-intense-bg { background-color: #B22B31; }
.ansi-green-fg { color: #00A250; }
.ansi-green-bg { background-color: #00A250; }
.ansi-green-intense-fg { color: #007427; }
.ansi-green-intense-bg { background-color: #007427; }
.ansi-yellow-fg { color: #DDB62B; }
.ansi-yellow-bg { background-color: #DDB62B; }
.ansi-yellow-intense-fg { color: #B27D12; }
.ansi-yellow-intense-bg { background-color: #B27D12; }
.ansi-blue-fg { color: #208FFB; }
.ansi-blue-bg { background-color: #208FFB; }
.ansi-blue-intense-fg { color: #0065CA; }
.ansi-blue-intense-bg { background-color: #0065CA; }
.ansi-magenta-fg { color: #D160C4; }
.ansi-magenta-bg { background-color: #D160C4; }
.ansi-magenta-intense-fg { color: #A03196; }
.ansi-magenta-intense-bg { background-color: #A03196; }
.ansi-cyan-fg { color: #60C6C8; }
.ansi-cyan-bg { background-color: #60C6C8; }
.ansi-cyan-intense-fg { color: #258F8F; }
.ansi-cyan-intense-bg { background-color: #258F8F; }
.ansi-white-fg { color: #C5C1B4; }
.ansi-white-bg { background-color: #C5C1B4; }
.ansi-white-intense-fg { color: #A1A6B2; }
.ansi-white-intense-bg { background-color: #A1A6B2; }

.ansi-default-inverse-fg { color: #FFFFFF; }
.ansi-default-inverse-bg { background-color: #000000; }

.ansi-bold { font-weight: bold; }
.ansi-underline { text-decoration: underline; }


div.nbinput.container div.input_area div[class*=highlight] > pre,
div.nboutput.container div.output_area div[class*=highlight] > pre,
div.nboutput.container div.output_area div[class*=highlight].math,
div.nboutput.container div.output_area.rendered_html,
div.nboutput.container div.output_area > div.output_javascript,
div.nboutput.container div.output_area:not(.rendered_html) > img{
    padding: 5px;
    margin: 0;
}

/* fix copybtn overflow problem in chromium (needed for 'sphinx_copybutton') */
div.nbinput.container div.input_area > div[class^='highlight'],
div.nboutput.container div.output_area > div[class^='highlight']{
    overflow-y: hidden;
}

/* hide copybtn icon on prompts (needed for 'sphinx_copybutton') */
.prompt a.copybtn {
    display: none;
}

/* Some additional styling taken form the Jupyter notebook CSS */
div.rendered_html table {
  border: none;
  border-collapse: collapse;
  border-spacing: 0;
  color: black;
  font-size: 12px;
  table-layout: fixed;
}
div.rendered_html thead {
  border-bottom: 1px solid black;
  vertical-align: bottom;
}
div.rendered_html tr,
div.rendered_html th,
div.rendered_html td {
  text-align: right;
  vertical-align: middle;
  padding: 0.5em 0.5em;
  line-height: normal;
  white-space: normal;
  max-width: none;
  border: none;
}
div.rendered_html th {
  font-weight: bold;
}
div.rendered_html tbody tr:nth-child(odd) {
  background: #f5f5f5;
}
div.rendered_html tbody tr:hover {
  background: rgba(66, 165, 245, 0.2);
}
</style>
<div class="section" id="How-good-is-my-Kriging-model?---tests-with-IDW-algorithm---tutorial">
<h1>How good is my Kriging model? - tests with IDW algorithm - tutorial<a class="headerlink" href="#How-good-is-my-Kriging-model?---tests-with-IDW-algorithm---tutorial" title="Permalink to this headline">¶</a></h1>
<div class="section" id="Table-of-Contents:">
<h2>Table of Contents:<a class="headerlink" href="#Table-of-Contents:" title="Permalink to this headline">¶</a></h2>
<ol class="arabic simple">
<li>Read point data,</li>
<li>Divide dataset into two sets: modeling and validation set,</li>
<li>Perform IDW and evaluate it,</li>
<li>Perform variogram modeling on the modeling set,</li>
<li>Validate Kriging and compare Kriging and IDW validation results,</li>
<li>Bonus scenario: only 5% of values are known!</li>
</ol>
</div>
<div class="section" id="Level:-Basic">
<h2>Level: Basic<a class="headerlink" href="#Level:-Basic" title="Permalink to this headline">¶</a></h2>
</div>
<div class="section" id="Changelog">
<h2>Changelog<a class="headerlink" href="#Changelog" title="Permalink to this headline">¶</a></h2>
<table border="1" class="docutils">
<colgroup>
<col width="18%" />
<col width="59%" />
<col width="23%" />
</colgroup>
<thead valign="bottom">
<tr class="row-odd"><th class="head">Date</th>
<th class="head">Change description</th>
<th class="head">Author</th>
</tr>
</thead>
<tbody valign="top">
<tr class="row-even"><td>2021-12-14</td>
<td>Sill selection was upgraded: now optimal sill is derived from the grid search within <code class="docutils literal notranslate"><span class="pre">TheoreticalSemivariogram</span></code> class</td>
<td>&#64;SimonMolinsky</td>
</tr>
<tr class="row-odd"><td>2021-12-13</td>
<td>Changed behavior of <code class="docutils literal notranslate"><span class="pre">select_values_in_range()</span></code> function</td>
<td>&#64;SimonMolinsky</td>
</tr>
<tr class="row-even"><td>2021-12-08</td>
<td>Behavior of <code class="docutils literal notranslate"><span class="pre">prepare_kriging_data()</span></code> function has changed</td>
<td>&#64;SimonMolinsky</td>
</tr>
<tr class="row-odd"><td>2021-05-12</td>
<td>First version of tutorial</td>
<td>&#64;SimonMolinsky</td>
</tr>
</tbody>
</table>
</div>
<div class="section" id="Introduction">
<h2>Introduction<a class="headerlink" href="#Introduction" title="Permalink to this headline">¶</a></h2>
<p>In this tutorial we will learn about the one method of validation of our Kriging model. We’ll compare it to the Inverse Distance Weighting function where the unknown point value is interpolated as the weighted mean of it’s neighbours. Weights are assigned by the inverted distance raised to the n-th power.</p>
<ol class="arabic simple">
<li><strong>GENERAL FORM OF IDW</strong></li>
</ol>
<div class="math notranslate nohighlight">
\[z(u) = \frac{\sum_{i}\lambda_{i}*z_{i}}{\sum_{i}\lambda_{i}}\]</div>
<p>where:</p>
<ul class="simple">
<li><span class="math notranslate nohighlight">\(z(u)\)</span>: is the value at unknown location,</li>
<li><span class="math notranslate nohighlight">\(i\)</span>: is a i-th known location,</li>
<li><span class="math notranslate nohighlight">\(z_{i}\)</span>: is a value at known location <span class="math notranslate nohighlight">\(i\)</span>,</li>
<li><span class="math notranslate nohighlight">\(\lambda_{i}\)</span>: is a weight assigned to the known location <span class="math notranslate nohighlight">\(i\)</span>.</li>
</ul>
<ol class="arabic simple" start="2">
<li><strong>WEIGHTING PARAMETER</strong></li>
</ol>
<div class="math notranslate nohighlight">
\[\lambda_{i} = \frac{1}{d^{p}_{i}}\]</div>
<p>where:</p>
<ul class="simple">
<li><span class="math notranslate nohighlight">\(d\)</span>: is a distance from known point <span class="math notranslate nohighlight">\(z_{i}\)</span> to the unknown point <span class="math notranslate nohighlight">\(z(u)\)</span>,</li>
<li><span class="math notranslate nohighlight">\(p\)</span>: is a hyperparameter which controls how strong is a relationship between known point and unknown point. You may set large <span class="math notranslate nohighlight">\(p\)</span> if you want to show strong relationship between closest point and very weak influence of distant points. On the other hand, you may set small <span class="math notranslate nohighlight">\(p\)</span> to emphasize fact that points are influencing each other with the same power irrespectively of their distance.</li>
</ul>
<hr class="docutils" />
<p>As you noticed <strong>IDW</strong> is a simple but powerful technique. Unfortunately it has major drawback: <strong>we must set ``p`` - power - manually</strong> and it isn’t derived from the data and variogram. That’s why it can be used for other tasks. Example is to use IDW as a baseline for comparison to the other techniques.</p>
</div>
<div class="section" id="Import-packages">
<h2>Import packages<a class="headerlink" href="#Import-packages" title="Permalink to this headline">¶</a></h2>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[1]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>

<span class="kn">import</span> <span class="nn">matplotlib.pyplot</span> <span class="k">as</span> <span class="nn">plt</span>

<span class="kn">from</span> <span class="nn">pyinterpolate.idw</span> <span class="kn">import</span> <span class="n">inverse_distance_weighting</span>  <span class="c1"># function for idw</span>
<span class="kn">from</span> <span class="nn">pyinterpolate.io_ops</span> <span class="kn">import</span> <span class="n">read_point_data</span>
<span class="kn">from</span> <span class="nn">pyinterpolate.semivariance</span> <span class="kn">import</span> <span class="n">calculate_semivariance</span>  <span class="c1"># experimental semivariogram</span>
<span class="kn">from</span> <span class="nn">pyinterpolate.semivariance</span> <span class="kn">import</span> <span class="n">TheoreticalSemivariogram</span>  <span class="c1"># theoretical models</span>
<span class="kn">from</span> <span class="nn">pyinterpolate.kriging</span> <span class="kn">import</span> <span class="n">Krige</span>  <span class="c1"># kriging models</span>
</pre></div>
</div>
</div>
</div>
<div class="section" id="1)-Read-point-data">
<h2>1) Read point data<a class="headerlink" href="#1)-Read-point-data" title="Permalink to this headline">¶</a></h2>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[2]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="n">dem</span> <span class="o">=</span> <span class="n">read_point_data</span><span class="p">(</span><span class="s1">&#39;../sample_data/point_data/poland_dem_gorzow_wielkopolski&#39;</span><span class="p">,</span> <span class="n">data_type</span><span class="o">=</span><span class="s1">&#39;txt&#39;</span><span class="p">)</span>
<span class="n">dem</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[2]:
</pre></div>
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
array([[15.1152409 , 52.76514556, 91.27559662],
       [15.1152409 , 52.74279035, 96.54829407],
       [15.1152409 , 52.71070647, 51.25455093],
       ...,
       [15.37034993, 52.68338343, 40.30933762],
       [15.37034993, 52.67096386, 21.94326782],
       [15.37034993, 52.64239886, 51.52513504]])
</pre></div></div>
</div>
</div>
<div class="section" id="2)-Divide-dataset-into-two-sets:-modeling-and-validation-set">
<h2>2) Divide dataset into two sets: modeling and validation set<a class="headerlink" href="#2)-Divide-dataset-into-two-sets:-modeling-and-validation-set" title="Permalink to this headline">¶</a></h2>
<p>In this step we will divide our dataset into two sets:</p>
<ul class="simple">
<li>modeling set (50%): points used for variogram modeling,</li>
<li>validation set (50%): points used for prediction and results validation.</li>
</ul>
<p>Baseline dataset will be divided randomly.</p>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[3]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="c1"># Create modeling and validation sets</span>

<span class="k">def</span> <span class="nf">create_model_validation_sets</span><span class="p">(</span><span class="n">dataset</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">,</span> <span class="n">frac</span><span class="o">=</span><span class="mf">0.5</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Function divides base dataset into modeling and validation sets</span>

<span class="sd">    INPUT:</span>
<span class="sd">    :param dataset: (numpy array) array with rows of records,</span>
<span class="sd">    :param frac: (float) number of elements in a validation set</span>

<span class="sd">    OUTPUT:</span>
<span class="sd">    return: modeling_set (numpy array), validation_set (numpy array)</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="n">removed_idx</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">randint</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="n">dem</span><span class="p">)</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="n">size</span><span class="o">=</span><span class="nb">int</span><span class="p">(</span><span class="n">frac</span> <span class="o">*</span> <span class="nb">len</span><span class="p">(</span><span class="n">dem</span><span class="p">)))</span>
    <span class="n">validation_set</span> <span class="o">=</span> <span class="n">dem</span><span class="p">[</span><span class="n">removed_idx</span><span class="p">]</span>
    <span class="n">modeling_set</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">delete</span><span class="p">(</span><span class="n">dem</span><span class="p">,</span> <span class="n">removed_idx</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">modeling_set</span><span class="p">,</span> <span class="n">validation_set</span>

<span class="n">known_points</span><span class="p">,</span> <span class="n">unknown_points</span> <span class="o">=</span> <span class="n">create_model_validation_sets</span><span class="p">(</span><span class="n">dem</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<div class="section" id="3)-Perform-IDW-and-evaluate-it">
<h2>3) Perform IDW and evaluate it<a class="headerlink" href="#3)-Perform-IDW-and-evaluate-it" title="Permalink to this headline">¶</a></h2>
<p>Inverse Distance Weighting doesn’t require variogram modeling or other steps. We pass power to which we want raise distance in weight denominator. Things to remember are:</p>
<ul class="simple">
<li>Large <code class="docutils literal notranslate"><span class="pre">power</span></code> -&gt; closer neighbours are more important,</li>
<li><code class="docutils literal notranslate"><span class="pre">power</span></code> which is close to the <strong>zero</strong> -&gt; all neighbours are important and we assume that distant process has the same effect on our variable as the closest events.</li>
</ul>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[4]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="n">IDW_POWER</span> <span class="o">=</span> <span class="mi">2</span>
<span class="n">NUMBER_OF_NEIGHBOURS</span> <span class="o">=</span> <span class="o">-</span><span class="mi">1</span>  <span class="c1"># Include all points in weighting process (equation 1)</span>

<span class="n">idw_predictions</span> <span class="o">=</span> <span class="p">[]</span>

<span class="k">for</span> <span class="n">pt</span> <span class="ow">in</span> <span class="n">unknown_points</span><span class="p">:</span>
    <span class="n">idw_result</span> <span class="o">=</span> <span class="n">inverse_distance_weighting</span><span class="p">(</span><span class="n">known_points</span><span class="p">,</span> <span class="n">pt</span><span class="p">[:</span><span class="o">-</span><span class="mi">1</span><span class="p">],</span> <span class="n">NUMBER_OF_NEIGHBOURS</span><span class="p">,</span> <span class="n">IDW_POWER</span><span class="p">)</span>
    <span class="n">idw_predictions</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">idw_result</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[5]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="c1"># Evaluation</span>

<span class="n">idw_rmse</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">((</span><span class="n">unknown_points</span><span class="p">[:,</span> <span class="o">-</span><span class="mi">1</span><span class="p">]</span> <span class="o">-</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">idw_predictions</span><span class="p">))</span><span class="o">**</span><span class="mi">2</span><span class="p">))</span>
<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;Root Mean Squared Error of prediction with IDW is </span><span class="si">{</span><span class="n">idw_rmse</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
Root Mean Squared Error of prediction with IDW is 5.182182467881956
</pre></div></div>
</div>
<p><strong>Clarification:</strong> Obtained Root Mean Squared Error could serve as a baseline for further model development. To build better reference, we create four IDW models of powers:</p>
<ol class="arabic simple">
<li>0.5,</li>
<li>1,</li>
<li>2,</li>
<li><ol class="first arabic" start="4">
<li></li>
</ol>
</li>
</ol>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[6]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="n">IDW_POWERS</span> <span class="o">=</span> <span class="p">[</span><span class="mf">0.5</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">4</span><span class="p">]</span>
<span class="n">idw_rmse</span> <span class="o">=</span> <span class="p">{}</span>

<span class="k">for</span> <span class="n">pw</span> <span class="ow">in</span> <span class="n">IDW_POWERS</span><span class="p">:</span>
    <span class="n">results</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="k">for</span> <span class="n">pt</span> <span class="ow">in</span> <span class="n">unknown_points</span><span class="p">:</span>
        <span class="n">idw_result</span> <span class="o">=</span> <span class="n">inverse_distance_weighting</span><span class="p">(</span><span class="n">known_points</span><span class="p">,</span> <span class="n">pt</span><span class="p">[:</span><span class="o">-</span><span class="mi">1</span><span class="p">],</span> <span class="n">NUMBER_OF_NEIGHBOURS</span><span class="p">,</span> <span class="n">pw</span><span class="p">)</span>
        <span class="n">results</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">idw_result</span><span class="p">)</span>
    <span class="n">idw_rmse</span><span class="p">[</span><span class="n">pw</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">((</span><span class="n">unknown_points</span><span class="p">[:,</span> <span class="o">-</span><span class="mi">1</span><span class="p">]</span> <span class="o">-</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">results</span><span class="p">))</span><span class="o">**</span><span class="mi">2</span><span class="p">))</span>
</pre></div>
</div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[7]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="k">for</span> <span class="n">pw</span> <span class="ow">in</span> <span class="n">IDW_POWERS</span><span class="p">:</span>
    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;Root Mean Squared Error of prediction with IDW of power </span><span class="si">{</span><span class="n">pw</span><span class="si">}</span><span class="s1"> is </span><span class="si">{</span><span class="n">idw_rmse</span><span class="p">[</span><span class="n">pw</span><span class="p">]</span><span class="si">:</span><span class="s1">.4f</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
Root Mean Squared Error of prediction with IDW of power 0.5 is 17.3953
Root Mean Squared Error of prediction with IDW of power 1 is 14.4409
Root Mean Squared Error of prediction with IDW of power 2 is 5.1822
Root Mean Squared Error of prediction with IDW of power 4 is 1.9178
</pre></div></div>
</div>
</div>
<div class="section" id="4)-Perform-variogram-modeling-on-the-modeling-set">
<h2>4) Perform variogram modeling on the modeling set<a class="headerlink" href="#4)-Perform-variogram-modeling-on-the-modeling-set" title="Permalink to this headline">¶</a></h2>
<p>In this step we will go through semivariogram modeling for Kriging interpolation.</p>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[8]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="n">search_radius</span> <span class="o">=</span> <span class="mf">0.01</span>
<span class="n">max_range</span> <span class="o">=</span> <span class="mf">0.32</span>
<span class="n">number_of_ranges</span> <span class="o">=</span> <span class="mi">32</span>

<span class="n">exp_semivar</span> <span class="o">=</span> <span class="n">calculate_semivariance</span><span class="p">(</span><span class="n">data</span><span class="o">=</span><span class="n">known_points</span><span class="p">,</span> <span class="n">step_size</span><span class="o">=</span><span class="n">search_radius</span><span class="p">,</span> <span class="n">max_range</span><span class="o">=</span><span class="n">max_range</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[9]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="n">semivar</span> <span class="o">=</span> <span class="n">TheoreticalSemivariogram</span><span class="p">(</span><span class="n">points_array</span><span class="o">=</span><span class="n">known_points</span><span class="p">,</span> <span class="n">empirical_semivariance</span><span class="o">=</span><span class="n">exp_semivar</span><span class="p">)</span>
<span class="n">semivar</span><span class="o">.</span><span class="n">find_optimal_model</span><span class="p">(</span><span class="n">weighted</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">number_of_ranges</span><span class="o">=</span><span class="n">number_of_ranges</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[9]:
</pre></div>
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
&#39;linear&#39;
</pre></div></div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[10]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="n">semivar</span><span class="o">.</span><span class="n">show_semivariogram</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="../_images/tutorials_How_good_is_our_Kriging_model_-_test__it_with_IDW_algorithm_(Basic)_16_0.png" src="../_images/tutorials_How_good_is_our_Kriging_model_-_test__it_with_IDW_algorithm_(Basic)_16_0.png" />
</div>
</div>
</div>
<div class="section" id="5)-Validate-Kriging-and-compare-Kriging-and-IDW-validation-results">
<h2>5) Validate Kriging and compare Kriging and IDW validation results<a class="headerlink" href="#5)-Validate-Kriging-and-compare-Kriging-and-IDW-validation-results" title="Permalink to this headline">¶</a></h2>
<p>In the last we perform Kriging interpolation and compare rersults to the <strong>IDW</strong> models. We use all points to weight values at unknown locations and semivariogram model chosen in the previous step.</p>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[11]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="c1"># Set Kriging model</span>

<span class="n">model</span> <span class="o">=</span> <span class="n">Krige</span><span class="p">(</span><span class="n">semivariogram_model</span><span class="o">=</span><span class="n">semivar</span><span class="p">,</span> <span class="n">known_points</span><span class="o">=</span><span class="n">known_points</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[12]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="n">kriging_preds</span> <span class="o">=</span> <span class="p">[]</span>

<span class="k">for</span> <span class="n">pt</span> <span class="ow">in</span> <span class="n">unknown_points</span><span class="p">:</span>

    <span class="n">result</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">ordinary_kriging</span><span class="p">(</span><span class="n">pt</span><span class="p">[:</span><span class="o">-</span><span class="mi">1</span><span class="p">],</span> <span class="n">test_anomalies</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
    <span class="n">kriging_preds</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">result</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
</pre></div>
</div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[13]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="c1"># Evaluation</span>

<span class="n">kriging_rmse</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">((</span><span class="n">unknown_points</span><span class="p">[:,</span> <span class="o">-</span><span class="mi">1</span><span class="p">]</span> <span class="o">-</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">kriging_preds</span><span class="p">))</span><span class="o">**</span><span class="mi">2</span><span class="p">))</span>
<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;Root Mean Squared Error of prediction with Kriging is </span><span class="si">{</span><span class="n">kriging_rmse</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
Root Mean Squared Error of prediction with Kriging is 1.643199932985393
</pre></div></div>
</div>
<p><strong>Clarification</strong>: Kriging is better than any from the IDW models and we may assume that our modeling approach gives us more insights into the spatial process which we are observing. But this is not the end… let’s consider more complex scenario!</p>
</div>
<div class="section" id="6)-Bonus-scenario:-only-5%-of-values-are-known!">
<h2>6) Bonus scenario: only 5% of values are known!<a class="headerlink" href="#6)-Bonus-scenario:-only-5%-of-values-are-known!" title="Permalink to this headline">¶</a></h2>
<p>Real world data are rarely as good as sample from the tutorial. It is too expensive to densily sample every location and usually we get only small percent of area covered by data. That’s why it is good to compare <strong>IDW vs Kriging</strong> in this scenario! We repeat steps 1-5 with change in division for modeling / validation set. (I encourage you to try it do alone and then compare your code and results with those given in this notebook).</p>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[14]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="c1"># Data preparation</span>

<span class="n">known_points</span><span class="p">,</span> <span class="n">unknown_points</span> <span class="o">=</span> <span class="n">create_model_validation_sets</span><span class="p">(</span><span class="n">dem</span><span class="p">,</span> <span class="mf">0.95</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[15]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="c1"># IDW tests</span>

<span class="n">IDW_POWERS</span> <span class="o">=</span> <span class="p">[</span><span class="mf">0.5</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">4</span><span class="p">]</span>
<span class="n">idw_rmse</span> <span class="o">=</span> <span class="p">{}</span>

<span class="k">for</span> <span class="n">pw</span> <span class="ow">in</span> <span class="n">IDW_POWERS</span><span class="p">:</span>
    <span class="n">results</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="k">for</span> <span class="n">pt</span> <span class="ow">in</span> <span class="n">unknown_points</span><span class="p">:</span>
        <span class="n">idw_result</span> <span class="o">=</span> <span class="n">inverse_distance_weighting</span><span class="p">(</span><span class="n">known_points</span><span class="p">,</span> <span class="n">pt</span><span class="p">[:</span><span class="o">-</span><span class="mi">1</span><span class="p">],</span> <span class="n">NUMBER_OF_NEIGHBOURS</span><span class="p">,</span> <span class="n">pw</span><span class="p">)</span>
        <span class="n">results</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">idw_result</span><span class="p">)</span>
    <span class="n">idw_rmse</span><span class="p">[</span><span class="n">pw</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">((</span><span class="n">unknown_points</span><span class="p">[:,</span> <span class="o">-</span><span class="mi">1</span><span class="p">]</span> <span class="o">-</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">results</span><span class="p">))</span><span class="o">**</span><span class="mi">2</span><span class="p">))</span>
</pre></div>
</div>
</div>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[16]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="c1"># Variogram</span>

<span class="n">search_radius</span> <span class="o">=</span> <span class="mf">0.01</span>
<span class="n">max_range</span> <span class="o">=</span> <span class="mf">0.32</span>
<span class="n">number_of_ranges</span> <span class="o">=</span> <span class="mi">32</span>

<span class="n">exp_semivar</span> <span class="o">=</span> <span class="n">calculate_semivariance</span><span class="p">(</span><span class="n">data</span><span class="o">=</span><span class="n">known_points</span><span class="p">,</span> <span class="n">step_size</span><span class="o">=</span><span class="n">search_radius</span><span class="p">,</span> <span class="n">max_range</span><span class="o">=</span><span class="n">max_range</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[17]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="n">semivar</span> <span class="o">=</span> <span class="n">TheoreticalSemivariogram</span><span class="p">(</span><span class="n">points_array</span><span class="o">=</span><span class="n">known_points</span><span class="p">,</span> <span class="n">empirical_semivariance</span><span class="o">=</span><span class="n">exp_semivar</span><span class="p">)</span>
<span class="n">semivar</span><span class="o">.</span><span class="n">find_optimal_model</span><span class="p">(</span><span class="n">weighted</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">number_of_ranges</span><span class="o">=</span><span class="n">number_of_ranges</span><span class="p">)</span>
<span class="n">semivar</span><span class="o">.</span><span class="n">show_semivariogram</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="../_images/tutorials_How_good_is_our_Kriging_model_-_test__it_with_IDW_algorithm_(Basic)_26_0.png" src="../_images/tutorials_How_good_is_our_Kriging_model_-_test__it_with_IDW_algorithm_(Basic)_26_0.png" />
</div>
</div>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[18]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="c1"># Set Kriging model</span>

<span class="n">model</span> <span class="o">=</span> <span class="n">Krige</span><span class="p">(</span><span class="n">semivariogram_model</span><span class="o">=</span><span class="n">semivar</span><span class="p">,</span> <span class="n">known_points</span><span class="o">=</span><span class="n">known_points</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[19]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="n">kriging_preds</span> <span class="o">=</span> <span class="p">[]</span>

<span class="k">for</span> <span class="n">pt</span> <span class="ow">in</span> <span class="n">unknown_points</span><span class="p">:</span>

    <span class="n">result</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">ordinary_kriging</span><span class="p">(</span><span class="n">pt</span><span class="p">[:</span><span class="o">-</span><span class="mi">1</span><span class="p">],</span> <span class="n">min_no_neighbors</span><span class="o">=</span><span class="mi">16</span><span class="p">,</span> <span class="n">test_anomalies</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
    <span class="n">kriging_preds</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">result</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>

<span class="n">kriging_rmse</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">((</span><span class="n">unknown_points</span><span class="p">[:,</span> <span class="o">-</span><span class="mi">1</span><span class="p">]</span> <span class="o">-</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">kriging_preds</span><span class="p">))</span><span class="o">**</span><span class="mi">2</span><span class="p">))</span>
</pre></div>
</div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[20]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="c1"># Comparison</span>

<span class="k">for</span> <span class="n">pw</span> <span class="ow">in</span> <span class="n">IDW_POWERS</span><span class="p">:</span>
    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;Root Mean Squared Error of prediction with IDW of power </span><span class="si">{</span><span class="n">pw</span><span class="si">}</span><span class="s1"> is </span><span class="si">{</span><span class="n">idw_rmse</span><span class="p">[</span><span class="n">pw</span><span class="p">]</span><span class="si">:</span><span class="s1">.4f</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;Root Mean Squared Error of prediction with Kriging is </span><span class="si">{</span><span class="n">kriging_rmse</span><span class="si">:</span><span class="s1">.4f</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
Root Mean Squared Error of prediction with IDW of power 0.5 is 17.5698
Root Mean Squared Error of prediction with IDW of power 1 is 14.5844
Root Mean Squared Error of prediction with IDW of power 2 is 5.5657
Root Mean Squared Error of prediction with IDW of power 4 is 2.3090
Root Mean Squared Error of prediction with Kriging is 2.0523
</pre></div></div>
</div>
<p>Your results may be different but in the most cases Kriging will be better than IDW. What’s even more important is the fact that for the single data source with low number of samples we don’t have opportunity to perform validation step and we’re not able to guess how big should be the power parameter. With Kriging we model variogram and <em>voila!</em> - model works.</p>
<hr class="docutils" />
</div>
</div>


          </div>
          
        </div>
      </div>
      <div class="sphinxsidebar" role="navigation" aria-label="main navigation">
        <div class="sphinxsidebarwrapper">
<h1 class="logo"><a href="../index.html">Pyinterpolate</a></h1>








<h3>Navigation</h3>
<ul class="current">
<li class="toctree-l1"><a class="reference internal" href="../introduction.html">Introduction</a></li>
<li class="toctree-l1"><a class="reference internal" href="../setup.html">Setup</a></li>
<li class="toctree-l1 current"><a class="reference internal" href="../tutorials.html">Tutorials</a></li>
<li class="toctree-l1"><a class="reference internal" href="../code_documentation.html">Documentation</a></li>
<li class="toctree-l1"><a class="reference internal" href="../algorithms.html">Algorithms Explained</a></li>
<li class="toctree-l1"><a class="reference internal" href="../contribution.html">Contribution to Pyinterpolate</a></li>
<li class="toctree-l1"><a class="reference internal" href="../license.html">License</a></li>
</ul>

<div class="relations">
<h3>Related Topics</h3>
<ul>
  <li><a href="../index.html">Documentation overview</a><ul>
  <li><a href="../tutorials.html">Tutorials</a><ul>
      <li>Previous: <a href="Ordinary and Simple Kriging (Basic).html" title="previous chapter">Ordinary and Simple Kriging - tutorial</a></li>
      <li>Next: <a href="Blocks to points Ordinary Kriging interpolation (Intermediate).html" title="next chapter">Blocks to points Ordinary Kriging interpolation - tutorial</a></li>
  </ul></li>
  </ul></li>
</ul>
</div>
<div id="searchbox" style="display: none" role="search">
  <h3>Quick search</h3>
    <div class="searchformwrapper">
    <form class="search" action="../search.html" method="get">
      <input type="text" name="q" />
      <input type="submit" value="Go" />
      <input type="hidden" name="check_keywords" value="yes" />
      <input type="hidden" name="area" value="default" />
    </form>
    </div>
</div>
<script type="text/javascript">$('#searchbox').show(0);</script>








        </div>
      </div>
      <div class="clearer"></div>
    </div>
    <div class="footer">
      &copy;2021, Szymon Moliński.
      
      |
      Powered by <a href="http://sphinx-doc.org/">Sphinx 1.8.5</a>
      &amp; <a href="https://github.com/bitprophet/alabaster">Alabaster 0.7.12</a>
      
      |
      <a href="../_sources/tutorials/How good is our Kriging model - test  it with IDW algorithm (Basic).ipynb.txt"
          rel="nofollow">Page source</a>
    </div>

    

    
  </body>
</html>