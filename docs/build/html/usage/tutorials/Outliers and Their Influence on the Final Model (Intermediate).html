

<!DOCTYPE html>


<html lang="en" >

  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" /><meta name="generator" content="Docutils 0.19: https://docutils.sourceforge.io/" />

    <title>Outliers and Their Influence on the Final Model &#8212; Pyinterpolate 0.4 documentation</title>
  
  
  
  <script data-cfasync="false">
    document.documentElement.dataset.mode = localStorage.getItem("mode") || "";
    document.documentElement.dataset.theme = localStorage.getItem("theme") || "light";
  </script>
  
  <!-- Loaded before other Sphinx assets -->
  <link href="../../_static/styles/theme.css?digest=e353d410970836974a52" rel="stylesheet" />
<link href="../../_static/styles/bootstrap.css?digest=e353d410970836974a52" rel="stylesheet" />
<link href="../../_static/styles/pydata-sphinx-theme.css?digest=e353d410970836974a52" rel="stylesheet" />

  
  <link href="../../_static/vendor/fontawesome/6.1.2/css/all.min.css?digest=e353d410970836974a52" rel="stylesheet" />
  <link rel="preload" as="font" type="font/woff2" crossorigin href="../../_static/vendor/fontawesome/6.1.2/webfonts/fa-solid-900.woff2" />
<link rel="preload" as="font" type="font/woff2" crossorigin href="../../_static/vendor/fontawesome/6.1.2/webfonts/fa-brands-400.woff2" />
<link rel="preload" as="font" type="font/woff2" crossorigin href="../../_static/vendor/fontawesome/6.1.2/webfonts/fa-regular-400.woff2" />

    <link rel="stylesheet" type="text/css" href="../../_static/pygments.css" />
    <link rel="stylesheet" type="text/css" href="../../_static/copybutton.css" />
    <link rel="stylesheet" type="text/css" href="../../_static/nbsphinx-code-cells.css" />
  
  <!-- Pre-loaded scripts that we'll load fully later -->
  <link rel="preload" as="script" href="../../_static/scripts/bootstrap.js?digest=e353d410970836974a52" />
<link rel="preload" as="script" href="../../_static/scripts/pydata-sphinx-theme.js?digest=e353d410970836974a52" />

    <script data-url_root="../../" id="documentation_options" src="../../_static/documentation_options.js"></script>
    <script src="../../_static/jquery.js"></script>
    <script src="../../_static/underscore.js"></script>
    <script src="../../_static/_sphinx_javascript_frameworks_compat.js"></script>
    <script src="../../_static/doctools.js"></script>
    <script src="../../_static/sphinx_highlight.js"></script>
    <script src="../../_static/clipboard.min.js"></script>
    <script src="../../_static/copybutton.js"></script>
    <script crossorigin="anonymous" integrity="sha256-Ae2Vz/4ePdIu6ZyI/5ZGsYnb+m0JlOmKPjt6XZ9JJkA=" src="https://cdnjs.cloudflare.com/ajax/libs/require.js/2.3.4/require.min.js"></script>
    <script>window.MathJax = {"tex": {"inlineMath": [["$", "$"], ["\\(", "\\)"]], "processEscapes": true}, "options": {"ignoreHtmlClass": "tex2jax_ignore|mathjax_ignore|document", "processHtmlClass": "tex2jax_process|mathjax_process|math|output_area"}}</script>
    <script defer="defer" src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js"></script>
    <script>DOCUMENTATION_OPTIONS.pagename = 'usage/tutorials/Outliers and Their Influence on the Final Model (Intermediate)';</script>
    <link rel="index" title="Index" href="../../genindex.html" />
    <link rel="search" title="Search" href="../../search.html" />
    <link rel="next" title="Poisson Kriging - centroid based approach" href="Poisson%20Kriging%20-%20Centroid%20Based%20%28Advanced%29.html" />
    <link rel="prev" title="Directional Ordinary Kriging" href="Directional%20Ordinary%20Kriging%20%28Intermediate%29.html" />
  <meta name="viewport" content="width=device-width, initial-scale=1"/>
  <meta name="docsearch:language" content="en"/>
  </head>
  
  
  <body data-bs-spy="scroll" data-bs-target=".bd-toc-nav" data-offset="180" data-bs-root-margin="0px 0px -60%" data-default-mode="">

  
  
  <a class="skip-link" href="#main-content">Skip to main content</a>
  
  <input type="checkbox"
          class="sidebar-toggle"
          name="__primary"
          id="__primary"/>
  <label class="overlay overlay-primary" for="__primary"></label>
  
  <input type="checkbox"
          class="sidebar-toggle"
          name="__secondary"
          id="__secondary"/>
  <label class="overlay overlay-secondary" for="__secondary"></label>
  
  <div class="search-button__wrapper">
    <div class="search-button__overlay"></div>
    <div class="search-button__search-container">
<form class="bd-search d-flex align-items-center"
      action="../../search.html"
      method="get">
  <i class="fa-solid fa-magnifying-glass"></i>
  <input type="search"
         class="form-control"
         name="q"
         id="search-input"
         placeholder="Search the docs ..."
         aria-label="Search the docs ..."
         autocomplete="off"
         autocorrect="off"
         autocapitalize="off"
         spellcheck="false"/>
  <span class="search-button__kbd-shortcut"><kbd class="kbd-shortcut__modifier">Ctrl</kbd>+<kbd>K</kbd></span>
</form></div>
  </div>
  
    <nav class="bd-header navbar navbar-expand-lg bd-navbar">
<div class="bd-header__inner bd-page-width">
  <label class="sidebar-toggle primary-toggle" for="__primary">
    <span class="fa-solid fa-bars"></span>
  </label>
  
  <div class="navbar-header-items__start">
    
      <div class="navbar-item">
  

<a class="navbar-brand logo" href="../../index.html">
  
  
  
  
  
    <p class="title logo__title">Pyinterpolate 0.4 documentation</p>
  
</a></div>
    
  </div>
  
  
  <div class="col-lg-9 navbar-header-items">
    
    <div class="me-auto navbar-header-items__center">
      
        <div class="navbar-item"><nav class="navbar-nav">
  <p class="sidebar-header-items__title"
     role="heading"
     aria-level="1"
     aria-label="Site Navigation">
    Site Navigation
  </p>
  <ul class="bd-navbar-elements navbar-nav">
    
                    <li class="nav-item">
                      <a class="nav-link nav-internal" href="../../setup/setup.html">
                        Setup
                      </a>
                    </li>
                

                    <li class="nav-item">
                      <a class="nav-link nav-internal" href="../quickstart.html">
                        Quickstart
                      </a>
                    </li>
                

                    <li class="nav-item current active">
                      <a class="nav-link nav-internal" href="../tutorials.html">
                        Tutorials
                      </a>
                    </li>
                

                    <li class="nav-item">
                      <a class="nav-link nav-internal" href="../../science/cite.html">
                        How to cite
                      </a>
                    </li>
                

                    <li class="nav-item">
                      <a class="nav-link nav-internal" href="../../api/api.html">
                        API
                      </a>
                    </li>
                
            <div class="nav-item dropdown">
                <button class="btn dropdown-toggle nav-item" type="button" data-bs-toggle="dropdown" aria-haspopup="true" aria-expanded="false">
                    More
                </button>
                <div class="dropdown-menu">
                    
                    <li class="nav-item">
                      <a class="nav-link nav-internal" href="../../developer/dev.html">
                        Development
                      </a>
                    </li>
                

                    <li class="nav-item">
                      <a class="nav-link nav-internal" href="../../community/community.html">
                        Community
                      </a>
                    </li>
                

                    <li class="nav-item">
                      <a class="nav-link nav-internal" href="../learning_materials.html">
                        Learning Materials
                      </a>
                    </li>
                

                    <li class="nav-item">
                      <a class="nav-link nav-internal" href="../../science/biblio.html">
                        Bibliography
                      </a>
                    </li>
                
                </div>
            </div>
            
  </ul>
</nav></div>
      
    </div>
    
    
    <div class="navbar-header-items__end">
      
        <div class="navbar-item navbar-persistent--container">
          
<script>
document.write(`
  <button class="btn btn-sm navbar-btn search-button search-button__button" title="Search" aria-label="Search" data-bs-placement="bottom" data-bs-toggle="tooltip">
    <i class="fa-solid fa-magnifying-glass"></i>
  </button>
`);
</script>
        </div>
      
      
        <div class="navbar-item">
<script>
document.write(`
  <button class="theme-switch-button btn btn-sm btn-outline-primary navbar-btn rounded-circle" title="light/dark" aria-label="light/dark" data-bs-placement="bottom" data-bs-toggle="tooltip">
    <span class="theme-switch" data-mode="light"><i class="fa-solid fa-sun"></i></span>
    <span class="theme-switch" data-mode="dark"><i class="fa-solid fa-moon"></i></span>
    <span class="theme-switch" data-mode="auto"><i class="fa-solid fa-circle-half-stroke"></i></span>
  </button>
`);
</script></div>
      
    </div>
    
  </div>
  
  
    <div class="navbar-persistent--mobile">
<script>
document.write(`
  <button class="btn btn-sm navbar-btn search-button search-button__button" title="Search" aria-label="Search" data-bs-placement="bottom" data-bs-toggle="tooltip">
    <i class="fa-solid fa-magnifying-glass"></i>
  </button>
`);
</script>
    </div>
  

  
    <label class="sidebar-toggle secondary-toggle" for="__secondary">
      <span class="fa-solid fa-outdent"></span>
    </label>
  
</div>

    </nav>
  
  <div class="bd-container">
    <div class="bd-container__inner bd-page-width">
      
      <div class="bd-sidebar-primary bd-sidebar">
        

  
  <div class="sidebar-header-items sidebar-primary__section">
    
    
      <div class="sidebar-header-items__center">
        
          <div class="navbar-item"><nav class="navbar-nav">
  <p class="sidebar-header-items__title"
     role="heading"
     aria-level="1"
     aria-label="Site Navigation">
    Site Navigation
  </p>
  <ul class="bd-navbar-elements navbar-nav">
    
                    <li class="nav-item">
                      <a class="nav-link nav-internal" href="../../setup/setup.html">
                        Setup
                      </a>
                    </li>
                

                    <li class="nav-item">
                      <a class="nav-link nav-internal" href="../quickstart.html">
                        Quickstart
                      </a>
                    </li>
                

                    <li class="nav-item current active">
                      <a class="nav-link nav-internal" href="../tutorials.html">
                        Tutorials
                      </a>
                    </li>
                

                    <li class="nav-item">
                      <a class="nav-link nav-internal" href="../../science/cite.html">
                        How to cite
                      </a>
                    </li>
                

                    <li class="nav-item">
                      <a class="nav-link nav-internal" href="../../api/api.html">
                        API
                      </a>
                    </li>
                
            <div class="nav-item dropdown">
                <button class="btn dropdown-toggle nav-item" type="button" data-bs-toggle="dropdown" aria-haspopup="true" aria-expanded="false">
                    More
                </button>
                <div class="dropdown-menu">
                    
                    <li class="nav-item">
                      <a class="nav-link nav-internal" href="../../developer/dev.html">
                        Development
                      </a>
                    </li>
                

                    <li class="nav-item">
                      <a class="nav-link nav-internal" href="../../community/community.html">
                        Community
                      </a>
                    </li>
                

                    <li class="nav-item">
                      <a class="nav-link nav-internal" href="../learning_materials.html">
                        Learning Materials
                      </a>
                    </li>
                

                    <li class="nav-item">
                      <a class="nav-link nav-internal" href="../../science/biblio.html">
                        Bibliography
                      </a>
                    </li>
                
                </div>
            </div>
            
  </ul>
</nav></div>
        
      </div>
    
    
    
      <div class="sidebar-header-items__end">
        
          <div class="navbar-item">
<script>
document.write(`
  <button class="theme-switch-button btn btn-sm btn-outline-primary navbar-btn rounded-circle" title="light/dark" aria-label="light/dark" data-bs-placement="bottom" data-bs-toggle="tooltip">
    <span class="theme-switch" data-mode="light"><i class="fa-solid fa-sun"></i></span>
    <span class="theme-switch" data-mode="dark"><i class="fa-solid fa-moon"></i></span>
    <span class="theme-switch" data-mode="auto"><i class="fa-solid fa-circle-half-stroke"></i></span>
  </button>
`);
</script></div>
        
      </div>
    
  </div>
  
    <div class="sidebar-primary-items__start sidebar-primary__section">
        <div class="sidebar-primary-item"><nav class="bd-docs-nav bd-links"
     aria-label="Section Navigation">
  <p class="bd-links__title" role="heading" aria-level="1">Section Navigation</p>
  <div class="bd-toc-item navbar-nav"><ul class="nav bd-sidenav">
<li class="toctree-l1"><a class="reference internal" href="Semivariogram%20Estimation%20%28Basic%29.html">Semivariogram Estimation</a></li>
<li class="toctree-l1"><a class="reference internal" href="Theoretical%20Models%20%28Basic%29.html">Semivariogram models</a></li>
<li class="toctree-l1"><a class="reference internal" href="Variogram%20Point%20Cloud%20%28Basic%29.html">Variogram Point Cloud</a></li>
<li class="toctree-l1"><a class="reference internal" href="Directional%20Semivariograms%20%28Basic%29.html">Directional semivariograms</a></li>
<li class="toctree-l1"><a class="reference internal" href="Ordinary%20and%20Simple%20Kriging%20%28Basic%29.html">Ordinary and Simple Kriging</a></li>
<li class="toctree-l1"><a class="reference internal" href="How%20good%20is%20our%20Kriging%20model%20-%20test%20it%20against%20IDW%20algorithm%20%28Basic%29.html">How good is my Kriging model? - tests with IDW algorithm</a></li>
</ul>
<ul class="current nav bd-sidenav">
<li class="toctree-l1"><a class="reference internal" href="Semivariogram%20Regularization%20%28Intermediate%29.html">Semivariogram regularization</a></li>
<li class="toctree-l1"><a class="reference internal" href="Blocks%20to%20points%20Ordinary%20Kriging%20interpolation%20%28Intermediate%29.html">Blocks to points Ordinary Kriging interpolation</a></li>
<li class="toctree-l1"><a class="reference internal" href="Directional%20Ordinary%20Kriging%20%28Intermediate%29.html">Directional Ordinary Kriging</a></li>
<li class="toctree-l1 current active"><a class="current reference internal" href="#">Outliers and Their Influence on the Final Model</a></li>
</ul>
<ul class="nav bd-sidenav">
<li class="toctree-l1"><a class="reference internal" href="Poisson%20Kriging%20-%20Centroid%20Based%20%28Advanced%29.html">Poisson Kriging - centroid based approach</a></li>
<li class="toctree-l1"><a class="reference internal" href="Poisson%20Kriging%20-%20Area%20to%20Area%20%28Advanced%29.html">Poisson Kriging - Area to Area Kriging</a></li>
<li class="toctree-l1"><a class="reference internal" href="Poisson%20Kriging%20-%20Area%20to%20Point%20%28Advanced%29.html">Poisson Kriging - Area to Point Kriging</a></li>
</ul>
</div>
</nav></div>
    </div>
  
  
  <div class="sidebar-primary-items__end sidebar-primary__section">
  </div>
  
  <div id="rtd-footer-container"></div>


      </div>
      
      <main id="main-content" class="bd-main">
        
        
          <div class="bd-content">
            <div class="bd-article-container">
              
              <div class="bd-header-article">
<div class="header-article-items header-article__inner">
  
    <div class="header-article-items__start">
      
        <div class="header-article-item">



<nav aria-label="Breadcrumbs">
  <ul class="bd-breadcrumbs" role="navigation" aria-label="Breadcrumb">
    
    <li class="breadcrumb-item breadcrumb-home">
      <a href="../../index.html" class="nav-link" aria-label="Home">
        <i class="fa-solid fa-home"></i>
      </a>
    </li>
    
    <li class="breadcrumb-item"><a href="../tutorials.html" class="nav-link">Tutorials</a></li>
    
    <li class="breadcrumb-item active" aria-current="page">Outliers and Their Influence on the Final Model</li>
  </ul>
</nav>
</div>
      
    </div>
  
  
</div>
</div>
              
              
              
                
<div id="searchbox"></div>
                <article class="bd-article" role="main">
                  
  <section id="Outliers-and-Their-Influence-on-the-Final-Model">
<h1>Outliers and Their Influence on the Final Model<a class="headerlink" href="#Outliers-and-Their-Influence-on-the-Final-Model" title="Permalink to this heading">#</a></h1>
<section id="Table-of-Contents:">
<h2>Table of Contents:<a class="headerlink" href="#Table-of-Contents:" title="Permalink to this heading">#</a></h2>
<ol class="arabic simple">
<li><p>Read point data and take 10% of it as a sample for the further analysis (dataset A),</p></li>
<li><p>Check if outliers are present in a data and create additional dataset without outliers (dataset B),</p></li>
<li><p>Create the Variogram Point Cloud model for the datasets A and B,</p></li>
<li><p>Remove outliers from the datasets A and B,</p></li>
<li><p>Create four Ordinary Kriging models and compare their performance.</p></li>
</ol>
</section>
<section id="Level:-Intermediate">
<h2>Level: Intermediate<a class="headerlink" href="#Level:-Intermediate" title="Permalink to this heading">#</a></h2>
</section>
<section id="Changelog">
<h2>Changelog<a class="headerlink" href="#Changelog" title="Permalink to this heading">#</a></h2>
<table class="table">
<thead>
<tr class="row-odd"><th class="head"><p>Date</p></th>
<th class="head"><p>Change description</p></th>
<th class="head"><p>Author</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><p>2022-11-05</p></td>
<td><p>Tutorial updated for the 0.3.5 version of the package</p></td>
<td><p>&#64;SimonMolinsky</p></td>
</tr>
<tr class="row-odd"><td><p>2022-10-08</p></td>
<td><p>The tutorial updated to the version 0.3.2 of the package</p></td>
<td><p>&#64;SimonMolinsky</p></td>
</tr>
<tr class="row-even"><td><p>2022-08-27</p></td>
<td><p>The tutorial updated to the version 0.3.0 of the package</p></td>
<td><p>&#64;SimonMolinsky</p></td>
</tr>
<tr class="row-odd"><td><p>2021-12-14</p></td>
<td><p>Sill selection was upgraded: now optimal sill is derived from the grid search within <code class="docutils literal notranslate"><span class="pre">TheoreticalSemivariogram</span></code> class</p></td>
<td><p>&#64;SimonMolinsky</p></td>
</tr>
<tr class="row-even"><td><p>2021-12-13</p></td>
<td><p>Changed behavior of <code class="docutils literal notranslate"><span class="pre">select_values_in_range()</span></code> function</p></td>
<td><p>&#64;SimonMolinsky</p></td>
</tr>
<tr class="row-odd"><td><p>2021-12-11</p></td>
<td><p>Behavior of <code class="docutils literal notranslate"><span class="pre">prepare_kriging_data()</span></code> function has benn changed</p></td>
<td><p>&#64;SimonMolinsky</p></td>
</tr>
<tr class="row-even"><td><p>2021-10-13</p></td>
<td><p>Refactored TheoreticalSemivariogram (name change of class attribute) and refactored <code class="docutils literal notranslate"><span class="pre">calc_semivariance_from_pt_cloud()</span></code> function to protect calculations from <code class="docutils literal notranslate"><span class="pre">NaN's</span></code>.</p></td>
<td><p>&#64;ethmtrgt &amp;
&#64;SimonMolinsky</p></td>
</tr>
<tr class="row-odd"><td><p>2021-08-22</p></td>
<td><p>Initial release</p></td>
<td><p>&#64;SimonMolinsky</p></td>
</tr>
</tbody>
</table>
</section>
<section id="Introduction">
<h2>Introduction<a class="headerlink" href="#Introduction" title="Permalink to this heading">#</a></h2>
<p>Outliers may affect our analysis and the final interpolation results. In this tutorial, we learn about their influence on the final model and compare interpolation errors for different scenarios where data is cleaned differently.</p>
<p>We can remove too high or too low values at the preprocessing stage (check part 2 of the tutorial) or remove outliers directly from the variogram point cloud (part 4). Results from each type of preprocessing (and a raw dataset analysis) are different, and we will compare them.</p>
<p>We use:</p>
<ul class="simple">
<li><p>DEM data which is stored in a file <code class="docutils literal notranslate"><span class="pre">samples/point_data/txt/pl_dem_epsg2180.txt</span></code>.</p></li>
</ul>
</section>
<section id="Import-packages">
<h2>Import packages<a class="headerlink" href="#Import-packages" title="Permalink to this heading">#</a></h2>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[1]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span>import numpy as np
import pandas as pd
import matplotlib.pyplot as plt

from pyinterpolate import calc_point_to_point_distance, read_txt, kriging, TheoreticalVariogram, VariogramCloud
</pre></div>
</div>
</div>
</section>
<section id="1)-Read-point-data-and-divide-it-into-training-and-test-set">
<h2>1) Read point data and divide it into training and test set<a class="headerlink" href="#1)-Read-point-data-and-divide-it-into-training-and-test-set" title="Permalink to this heading">#</a></h2>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[2]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span># Read data from file

dem = read_txt(&#39;samples/point_data/txt/pl_dem_epsg2180.txt&#39;)
</pre></div>
</div>
</div>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[23]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span># Divide data into training and test set

def create_train_test(data, training_fraction):
    idxs = np.arange(0, len(data))
    number_of_training_samples = int(len(data) * training_fraction)
    training_idxs = np.random.choice(idxs, size=number_of_training_samples, replace=False)
    test_idxs = [i for i in idxs if i not in training_idxs]
    training_set = data[training_idxs, :]
    test_set = data[test_idxs, :]

    return training_set, test_set
</pre></div>
</div>
</div>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[24]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span>train, test = create_train_test(dem, 0.1)
</pre></div>
</div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[25]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span>train[:3]
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[25]:
</pre></div>
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
array([[2.45696744e+05, 5.48612222e+05, 3.30628319e+01],
       [2.47963443e+05, 5.34007849e+05, 4.99749527e+01],
       [2.47986176e+05, 5.36520936e+05, 2.78247375e+01]])
</pre></div></div>
</div>
</section>
<section id="2)-Check-outliers:-analyze-the-distribution-of-the-values">
<h2>2) Check outliers: analyze the distribution of the values<a class="headerlink" href="#2)-Check-outliers:-analyze-the-distribution-of-the-values" title="Permalink to this heading">#</a></h2>
<p>We will inspect all values in the <code class="docutils literal notranslate"><span class="pre">train</span></code> set to determine if our dataset contains outliers. In the beginning, we plot data distribution with the <code class="docutils literal notranslate"><span class="pre">violinplot</span></code>.</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[26]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span># Distribution plot

plt.figure(figsize=(10, 6))
plt.violinplot(train[:, -1])
plt.show()
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="../../_images/usage_tutorials_Outliers_and_Their_Influence_on_the_Final_Model_%28Intermediate%29_9_0.png" src="../../_images/usage_tutorials_Outliers_and_Their_Influence_on_the_Final_Model_%28Intermediate%29_9_0.png" />
</div>
</div>
<blockquote>
<div><p><strong>NOTE:</strong> Your plot may be different than the tutorial’s. Why is that? Because we take a random sample of 10% of values, and after each iteration, the algorithm takes different points for the analysis.</p>
</div></blockquote>
<p><strong>Clarification:</strong></p>
<p>Investigation of the plot tells us that our data is:</p>
<ul class="simple">
<li><p>grouped around the lowest values, and most of the values are below 50 meters,</p></li>
<li><p>has (probably) three different distributions mixed, which can be a sign that the Digital Elevation Model covers three different types of elevation. One is grouped around 20 meters, the next around 50 meters, and the faintest is visible around 70 meters.</p></li>
</ul>
<p><strong>Violinplot</strong> is suitable for the distribution analysis. Especially if we are looking for complex patterns in the dataset, reading outliers from it may be challenging. We should change a plot type to understand if outliers exist in a dataset. The excellent choice is the <code class="docutils literal notranslate"><span class="pre">boxplot</span></code>:</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[27]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span># Boxplot

plt.figure(figsize=(10, 6))
plt.boxplot(train[:, -1])
plt.show()
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="../../_images/usage_tutorials_Outliers_and_Their_Influence_on_the_Final_Model_%28Intermediate%29_11_0.png" src="../../_images/usage_tutorials_Outliers_and_Their_Influence_on_the_Final_Model_%28Intermediate%29_11_0.png" />
</div>
</div>
<p><strong>Boxplot</strong> is a unique and handy data visualization tool. Let’s analyze this plot from the bottom up to the top.</p>
<blockquote>
<div><p><strong>NOTE:</strong> Boxplot represents values sorted in ascending order and their statistical properties: quartiles, median, and outliers.</p>
</div></blockquote>
<ul class="simple">
<li><p>The bottom whisker (horizontal line) represents the lower range of values in our dataset,</p></li>
<li><p>The box lower line is the first quartile of data or, in other words, 25% of values of our dataset are below this point. We name it Q1.</p></li>
<li><p>The middle line is the median of our dataset, and we name it Q2 or median.</p></li>
<li><p>The upper line is the third quartile of a data or, in other words, 75% of values are below this point,</p></li>
<li><p>The top whisker represents the upper range of values in our dataset. We name it Q3.</p></li>
<li><p>Individual points (if they exist, then we see them as points below the bottom whisker or above the top whisker) are considered outliers. They could be outliers in the upper range as well as lower range of our data. The significant distance between Q1 and the bottom whisker or between Q3 and the top whisker indicates potential outliers. Points below or above this distance are treated as outliers. The outlier distance is calculated as the <span class="math notranslate nohighlight">\(weight * (Q3 - Q1)\)</span> where we can set the
<code class="docutils literal notranslate"><span class="pre">weight</span></code> manually, but other parameters are read directly from the data.</p></li>
</ul>
<p>We use this knowledge to remove outliers from the dataset, assuming that <em>outliers are anomalies rather than unbiased readings</em>. We will perform the outlier removal from the data assuming that outliers are placed one standard deviation from Q1 (down) and Q3 (up).</p>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[28]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span># Create training set without outliers

q1 = np.quantile(train[:, -1], 0.25)
q3 = np.quantile(train[:, -1], 0.75)

top_limit = q3 + (q3 - q1)

train_without_outliers = train[train[:, -1] &lt; top_limit]
</pre></div>
</div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[29]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span>print(&#39;Length of the full training set is {} records&#39;.format(len(train)))
print(&#39;Length of the pre-processed training set is {} records&#39;.format(len(train_without_outliers)))
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
Length of the full training set is 689 records
Length of the pre-processed training set is 681 records
</pre></div></div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[30]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span>fig, ax = plt.subplots(nrows=1, ncols=2, figsize=(16, 6))
ax[0].violinplot(train_without_outliers[:, -1])
ax[0].set_title(&#39;Distribution of the training set without outliers&#39;)
ax[1].boxplot(train_without_outliers[:, -1])
ax[1].set_title(&#39;Statistics of the training set without outliers&#39;)
plt.show()
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="../../_images/usage_tutorials_Outliers_and_Their_Influence_on_the_Final_Model_%28Intermediate%29_15_0.png" src="../../_images/usage_tutorials_Outliers_and_Their_Influence_on_the_Final_Model_%28Intermediate%29_15_0.png" />
</div>
</div>
<p><strong>Clarification</strong>: We have cut some records from the baseline training dataset. The distribution plot (<code class="docutils literal notranslate"><span class="pre">violinplot</span></code>) has a shorter tail and ends more abruptly upwards. The <code class="docutils literal notranslate"><span class="pre">boxplot</span></code> of the new data doesn’t have any outliers. The one crucial thing to notice is that the observations are still skewed, but this is not a problem for this concrete tutorial.</p>
<blockquote>
<div><p><strong>NOTE</strong>: if you are eager to know how to deal with skewed datasets, we recommend the article <a class="reference external" href="https://anatomisebiostats.com/biostatistics-blog/transforming-skewed-data/">Transforming Skewed Data</a>.</p>
</div></blockquote>
</section>
<section id="3)-Create-the-Variogram-Point-Cloud-model-for-datasets-A-and-B">
<h2>3) Create the Variogram Point Cloud model for datasets A and B<a class="headerlink" href="#3)-Create-the-Variogram-Point-Cloud-model-for-datasets-A-and-B" title="Permalink to this heading">#</a></h2>
<p>Now we are going one step further, and we will transform both datasets with- and without- outliers and calculate variogram point clouds. Then we compare both clouds.</p>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[31]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span>def get_variogram_point_cloud(dataset, max_range, number_of_lags=8):
    step_size = max_range / number_of_lags
    cloud = VariogramCloud(input_array=dataset, step_size=step_size, max_range=max_range, calculate_on_creation=True)
    return cloud
</pre></div>
</div>
</div>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[32]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span>whole_distance = np.max(calc_point_to_point_distance(train[:, :-1]))

cloud_raw = get_variogram_point_cloud(train, whole_distance)
cloud_processed = get_variogram_point_cloud(train_without_outliers, whole_distance)
</pre></div>
</div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[33]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span># Show variogram cloud: initial training dataset

cloud_raw.plot(&#39;box&#39;)
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="../../_images/usage_tutorials_Outliers_and_Their_Influence_on_the_Final_Model_%28Intermediate%29_20_0.png" src="../../_images/usage_tutorials_Outliers_and_Their_Influence_on_the_Final_Model_%28Intermediate%29_20_0.png" />
</div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[34]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span># Show variogram cloud: pre-processed training dataset

cloud_processed.plot(&#39;box&#39;)
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="../../_images/usage_tutorials_Outliers_and_Their_Influence_on_the_Final_Model_%28Intermediate%29_21_0.png" src="../../_images/usage_tutorials_Outliers_and_Their_Influence_on_the_Final_Model_%28Intermediate%29_21_0.png" />
</div>
</div>
<p><strong>Clarification:</strong> a quick look into the results shows that calculated semivariances are skewed into significant positive values for each lag, but most profoundly within middle lags (~15:21 km). The processed dataset has lower semivariances than the raw readings, and both variograms have a similar shape.</p>
<p>In the next cell, we will check a standard deviation of the per lag variances.</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[35]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span>for k, v in cloud_raw.experimental_point_cloud.items():
    print(&#39;Lag {:.2f}&#39;.format(k))

    v_raw = int(np.std(v))
    v_pro = int(np.std(cloud_processed.experimental_point_cloud[k]))
    v_smape = 100 * (np.abs(v_raw - v_pro) / (0.5 * (v_raw + v_pro)))

    print(&#39;Standard Deviation raw dataset:&#39;, v_raw)
    print(&#39;Standard Deviation processed dataset:&#39;, v_pro)
    print(&#39;Symmetric Mean Absolute Percentage Error of Variances: {:.2f}&#39;.format(v_smape))
    print(&#39;&#39;)
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
Lag 3597.72
Standard Deviation raw dataset: 586
Standard Deviation processed dataset: 585
Symmetric Mean Absolute Percentage Error of Variances: 0.17

Lag 7195.44
Standard Deviation raw dataset: 1114
Standard Deviation processed dataset: 1068
Symmetric Mean Absolute Percentage Error of Variances: 4.22

Lag 10793.15
Standard Deviation raw dataset: 1348
Standard Deviation processed dataset: 1252
Symmetric Mean Absolute Percentage Error of Variances: 7.38

Lag 14390.87
Standard Deviation raw dataset: 1411
Standard Deviation processed dataset: 1294
Symmetric Mean Absolute Percentage Error of Variances: 8.65

Lag 17988.59
Standard Deviation raw dataset: 1321
Standard Deviation processed dataset: 1196
Symmetric Mean Absolute Percentage Error of Variances: 9.93

Lag 21586.31
Standard Deviation raw dataset: 1025
Standard Deviation processed dataset: 961
Symmetric Mean Absolute Percentage Error of Variances: 6.45

Lag 25184.03
Standard Deviation raw dataset: 810
Standard Deviation processed dataset: 788
Symmetric Mean Absolute Percentage Error of Variances: 2.75

Lag 28781.74
Standard Deviation raw dataset: 754
Standard Deviation processed dataset: 762
Symmetric Mean Absolute Percentage Error of Variances: 1.06

</pre></div></div>
</div>
<p><strong>Clarification:</strong> The differences (sMAPE) per lag vary greatly. We can see that the preprocessing of raw values introduces the information lost, and it is especially painful for the closest neighbors. It doesn’t mean that the preprocessing of raw observations is not recommended, but it is a good idea to include the <strong>spatial component</strong> in the outliers’ detection process.</p>
<p>Not everything is wrong. Data cleaning has lowered the semivariances dispersion for the middle lags (where we have the largest number of point pairs for the analysis).</p>
<p>At this point, we cannot judge which dataset is better for the modeling. Instead, we will remove outliers from both <strong>variograms</strong> (instead of the <strong>raw data</strong>).</p>
</section>
<section id="4)-Remove-outliers-from-the-variograms">
<h2>4) Remove outliers from the variograms<a class="headerlink" href="#4)-Remove-outliers-from-the-variograms" title="Permalink to this heading">#</a></h2>
<p>In this step, we will use <strong>pyinterpolate’s</strong> function <code class="docutils literal notranslate"><span class="pre">remove_outliers()</span></code> to build two additional variogram point clouds from the raw and processed datasets. We delete the top part outliers of the <strong>semivariance values</strong> rather than the raw readings.</p>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[36]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span>raw_without_outliers = cloud_raw.remove_outliers(method=&#39;zscore&#39;, z_lower_limit=-2, z_upper_limit=2, inplace=False)
prep_without_outliers = cloud_processed.remove_outliers(method=&#39;zscore&#39;, z_lower_limit=-2, z_upper_limit=2, inplace=False)
</pre></div>
</div>
</div>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[37]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span>data_raw = [x for x in cloud_raw.experimental_point_cloud.values()]
data_raw_not_out = [x for x in raw_without_outliers.experimental_point_cloud.values()]
data_prep = [x for x in cloud_processed.experimental_point_cloud.values()]
data_prep_not_out = [x for x in prep_without_outliers.experimental_point_cloud.values()]
</pre></div>
</div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[38]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span>fig, ax = plt.subplots(nrows=2, ncols=2, figsize=(16, 14))

ax[0, 0].boxplot(data_raw)
ax[0, 0].set_title(&#39;Semivariances Distribution in the Raw Dataset&#39;)
ax[0, 0].set_xlabel(&#39;Lag number&#39;)
ax[0, 0].set_ylabel(&#39;Semivariance value&#39;)

ax[0, 1].boxplot(data_raw_not_out)
ax[0, 1].set_title(&#39;Raw Dataset after the Outliers Detection and Removal&#39;)
ax[0, 1].set_xlabel(&#39;Lag number&#39;)
ax[0, 1].set_ylabel(&#39;Semivariance value&#39;)

ax[1, 0].boxplot(data_prep)
ax[1, 0].set_title(&#39;Semivariances Distribution in the Preprocessed Dataset&#39;)
ax[1, 0].set_xlabel(&#39;Lag number&#39;)
ax[1, 0].set_ylabel(&#39;Semivariance value&#39;)

ax[1, 1].boxplot(data_prep_not_out)
ax[1, 1].set_title(&#39;Preprocessed Dataset after the Outliers Detection and Removal&#39;)
ax[1, 1].set_xlabel(&#39;Lag number&#39;)
ax[1, 1].set_ylabel(&#39;Semivariance value&#39;)

plt.show()
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="../../_images/usage_tutorials_Outliers_and_Their_Influence_on_the_Final_Model_%28Intermediate%29_28_0.png" src="../../_images/usage_tutorials_Outliers_and_Their_Influence_on_the_Final_Model_%28Intermediate%29_28_0.png" />
</div>
</div>
<p><strong>Clarification:</strong> Comparison of multiple variogram clouds could be hard. We see that the largest semivariances are present in the raw data. Heavily processed data has the lowest number of outliers. The medians in each dataset are distributed over a similar pattern. How is it similar? We can check if we transform the variogram point cloud into the experimental semivariogram. Pyinterpolate has a method for it: <code class="docutils literal notranslate"><span class="pre">.calculate_experimental_variogram()</span></code>. We use it and compare four plots of
semivariances to gain more insight into the transformations.</p>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[39]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span>raw_semivar = cloud_raw.calculate_experimental_variogram()
raw_semivar_not_out = raw_without_outliers.calculate_experimental_variogram()
prep_semivar = cloud_processed.calculate_experimental_variogram()
prep_semivar_not_out = prep_without_outliers.calculate_experimental_variogram()
</pre></div>
</div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[40]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span>plt.figure(figsize=(14, 6))
plt.plot(raw_semivar[:, 1], c=&#39;#a6611a&#39;)
plt.plot(raw_semivar_not_out[:, 1], c=&#39;#dfc27d&#39;)
plt.plot(prep_semivar[:, 1], &#39;--&#39;, c=&#39;#80cdc1&#39;)
plt.plot(prep_semivar_not_out[:, 1], &#39;--&#39;, c=&#39;#018571&#39;)
plt.title(&#39;Comparison of experimental semivariograms created with the different data preprocessing techniques&#39;)
plt.ylabel(&#39;Semivariance&#39;)
plt.xlabel(&#39;Lag number&#39;)
plt.legend([&#39;Raw&#39;, &#39;Raw | Filtered Semivariances&#39;, &#39;Preprocessed&#39;, &#39;Preprocessed | Filtered Semivariances&#39;])
plt.show()
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="../../_images/usage_tutorials_Outliers_and_Their_Influence_on_the_Final_Model_%28Intermediate%29_31_0.png" src="../../_images/usage_tutorials_Outliers_and_Their_Influence_on_the_Final_Model_%28Intermediate%29_31_0.png" />
</div>
</div>
<p><strong>Clarification:</strong> An understanding of those plots is not an easy task. Let’s divide reasoning into multiple points:</p>
<ul class="simple">
<li><p>Raw dataset and preprocessed raw dataset show a similar pattern. The differences are more pronounced for the distant lags than for the closest point pairs,</p></li>
<li><p>Datasets with the cleaned variograms are different from the raw data. The absolute semivariance values per lag are smaller, and the semivariogram pattern is slightly different. Interestingly, the possible two distributions within the dataset are more visible in the cleaned variograms (one distribution with a peak around the 6th lag and the other with a peak around the 13th lag).</p></li>
<li><p>The differences between semivariograms are mostly visible at larger distances, and differences are minor for the closest point pairs.</p></li>
<li><p><strong>Filtering semivariance</strong> sharply lowers the weights per lag, and <strong>removing outliers</strong> from the input data only slightly corrects variogram.</p></li>
</ul>
<p>Let’s check how different variograms work with real-world data.</p>
</section>
<section id="5)-Create-Four-Ordinary-Kriging-models-based-on-the-four-Variogram-Point-Clouds-and-compare-their-performance">
<h2>5) Create Four Ordinary Kriging models based on the four Variogram Point Clouds and compare their performance<a class="headerlink" href="#5)-Create-Four-Ordinary-Kriging-models-based-on-the-four-Variogram-Point-Clouds-and-compare-their-performance" title="Permalink to this heading">#</a></h2>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[41]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span># Fit different semivariogram models into prepared datasets and variograms

# Raw
raw_theo = TheoreticalVariogram()
raw_theo.autofit(experimental_variogram=raw_semivar, return_params=False)

# Raw with cleaned variogram
raw_theo_no_out = TheoreticalVariogram()
raw_theo_no_out.autofit(experimental_variogram=raw_semivar_not_out, return_params=False)

# Preprocessed
prep_theo = TheoreticalVariogram()
prep_theo.autofit(experimental_variogram=prep_semivar, return_params=False)

# Preprocessed with cleaned variogram
prep_theo_no_out = TheoreticalVariogram()
prep_theo_no_out.autofit(experimental_variogram=prep_semivar_not_out, return_params=False)
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area stderr docutils container">
<div class="highlight"><pre>
/home/szymon/Documents/Programming/Repositories/pyinterpolate-environment/pyinterpolate/pyinterpolate/variogram/theoretical/semivariogram.py:472: UserWarning: If you provide experimental variogram as a numpy array you must remember that the direction parameter must be set if it is a directional variogram. Otherwise, algorithm assumes that variogram is isotropic.
  warnings.warn(msg)
</pre></div></div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[44]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span># Set Kriging models

# Raw
raw_model = kriging(observations=train, theoretical_model=raw_theo, points=test[:, :-1], allow_approx_solutions=True)

# Raw &amp; cleaned
c_raw_model = kriging(observations=train, theoretical_model=raw_theo_no_out, points=test[:, :-1], allow_approx_solutions=True)

# Preprocessed
prep_model = kriging(observations=train, theoretical_model=prep_theo, points=test[:, :-1], allow_approx_solutions=True)

# Preprocessed &amp; cleaned
c_prep_model = kriging(observations=train, theoretical_model=prep_theo_no_out, points=test[:, :-1], allow_approx_solutions=True)
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area stderr docutils container">
<div class="highlight"><pre>
  0%|          | 0/6204 [00:00&lt;?, ?it/s]/home/szymon/Documents/Programming/Repositories/pyinterpolate-environment/pyinterpolate/pyinterpolate/kriging/utils/process.py:124: UserWarning: &#39;Kriging system solution is based on the approximate solution, output may be incorrect!&#39;
  warnings.warn(LeastSquaresApproximationWarning().__str__())
/home/szymon/Documents/Programming/Repositories/pyinterpolate-environment/pyinterpolate/pyinterpolate/kriging/utils/process.py:125: FutureWarning: `rcond` parameter will change to the default of machine precision times ``max(M, N)`` where M and N are the input matrix dimensions.
To use the future default and silence this warning we advise to pass `rcond=None`, to keep using the old, explicitly pass `rcond=-1`.
  solved = np.linalg.lstsq(weights, k)
100%|██████████| 6204/6204 [00:01&lt;00:00, 5375.28it/s]
100%|██████████| 6204/6204 [00:01&lt;00:00, 5430.79it/s]
100%|██████████| 6204/6204 [00:01&lt;00:00, 5783.57it/s]
100%|██████████| 6204/6204 [00:01&lt;00:00, 5453.96it/s]
</pre></div></div>
</div>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[45]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span># Build test function

def calculate_model_deviation(modeled_values, test_set):
    mse = ((test_set[:, -1] - modeled_values[:, 0])**2)
    return mse
</pre></div>
</div>
</div>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[46]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span>r_test = calculate_model_deviation(raw_model, test)
</pre></div>
</div>
</div>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[47]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span>cr_test = calculate_model_deviation(c_raw_model, test)
</pre></div>
</div>
</div>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[48]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span>p_test = calculate_model_deviation(prep_model, test)
</pre></div>
</div>
</div>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[49]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span>cp_test = calculate_model_deviation(c_prep_model, test)
</pre></div>
</div>
</div>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[50]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span>df = pd.DataFrame(data=np.array([r_test, cr_test, p_test, cp_test]).transpose(),
                  columns=[&#39;Raw&#39;, &#39;Raw-cleaned&#39;, &#39;Preprocessed&#39;, &#39;Preprocessed-cleaned&#39;])
</pre></div>
</div>
</div>
<p>We will use <code class="docutils literal notranslate"><span class="pre">.describe()</span></code> method from <strong>pandas</strong> to get the errors statistic:</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[51]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span>df.describe()
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[51]:
</pre></div>
</div>
<div class="output_area rendered_html docutils container">
<div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>Raw</th>
      <th>Raw-cleaned</th>
      <th>Preprocessed</th>
      <th>Preprocessed-cleaned</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>count</th>
      <td>6.204000e+03</td>
      <td>6.204000e+03</td>
      <td>6.204000e+03</td>
      <td>6.204000e+03</td>
    </tr>
    <tr>
      <th>mean</th>
      <td>1.582548e+03</td>
      <td>6.880615e+02</td>
      <td>2.492439e+01</td>
      <td>6.549241e+02</td>
    </tr>
    <tr>
      <th>std</th>
      <td>5.848006e+04</td>
      <td>7.889110e+03</td>
      <td>8.482168e+01</td>
      <td>1.103712e+04</td>
    </tr>
    <tr>
      <th>min</th>
      <td>9.395315e-08</td>
      <td>8.463271e-08</td>
      <td>1.413464e-08</td>
      <td>6.346717e-09</td>
    </tr>
    <tr>
      <th>25%</th>
      <td>9.649726e-01</td>
      <td>1.047185e+00</td>
      <td>3.311757e-01</td>
      <td>9.618957e-01</td>
    </tr>
    <tr>
      <th>50%</th>
      <td>8.331637e+00</td>
      <td>8.258679e+00</td>
      <td>2.199820e+00</td>
      <td>7.747687e+00</td>
    </tr>
    <tr>
      <th>75%</th>
      <td>6.577995e+01</td>
      <td>6.087209e+01</td>
      <td>1.555325e+01</td>
      <td>5.930928e+01</td>
    </tr>
    <tr>
      <th>max</th>
      <td>4.559088e+06</td>
      <td>3.662049e+05</td>
      <td>1.665672e+03</td>
      <td>7.282200e+05</td>
    </tr>
  </tbody>
</table>
</div></div>
</div>
<p>The view of this table may be different each time you run this tutorial (and it is related to the training-test division process). For some cases, you may get better results for the cleaned dataset; for others, results will be better for raw data. That’s why we should always have a validation set to compare different scenarios. The other idea is to use all of the models and create a distribution of predictions and errors per point - we can use it later for decisions.</p>
<blockquote>
<div><p><strong>NOTE:</strong> The example in this tutorial is related to the Digital Elevation Model, which the data provider preprocessed (<em>Copernicus Land Monitoring Services</em>). You shouldn’t get the impression that raw data preprocessing and filtering are not required for the analysis. There are cases where the sensor may produce unreliable and biased results, such as a satellite camera’s saturated pixel. It is better to remove it with the specific noise-filtering algorithm before the variogram point cloud
development.</p>
</div></blockquote>
<hr class="docutils" />
</section>
</section>


                </article>
              
              
              
                <footer class="bd-footer-article">
                  
<div class="footer-article-items footer-article__inner">
  
    <div class="footer-article-item"><!-- Previous / next buttons -->
<div class="prev-next-area">
    <a class="left-prev"
       href="Directional%20Ordinary%20Kriging%20%28Intermediate%29.html"
       title="previous page">
      <i class="fa-solid fa-angle-left"></i>
      <div class="prev-next-info">
        <p class="prev-next-subtitle">previous</p>
        <p class="prev-next-title">Directional Ordinary Kriging</p>
      </div>
    </a>
    <a class="right-next"
       href="Poisson%20Kriging%20-%20Centroid%20Based%20%28Advanced%29.html"
       title="next page">
      <div class="prev-next-info">
        <p class="prev-next-subtitle">next</p>
        <p class="prev-next-title">Poisson Kriging - centroid based approach</p>
      </div>
      <i class="fa-solid fa-angle-right"></i>
    </a>
</div></div>
  
</div>

                </footer>
              
            </div>
            
            
              
                <div class="bd-sidebar-secondary bd-toc"><div class="sidebar-secondary-items sidebar-secondary__inner">

  <div class="sidebar-secondary-item">
  <div class="page-toc tocsection onthispage">
    <i class="fa-solid fa-list"></i> On this page
  </div>
  <nav class="bd-toc-nav page-toc">
    <ul class="visible nav section-nav flex-column">
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#Table-of-Contents:">Table of Contents:</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#Level:-Intermediate">Level: Intermediate</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#Changelog">Changelog</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#Introduction">Introduction</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#Import-packages">Import packages</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#1)-Read-point-data-and-divide-it-into-training-and-test-set">1) Read point data and divide it into training and test set</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#2)-Check-outliers:-analyze-the-distribution-of-the-values">2) Check outliers: analyze the distribution of the values</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#3)-Create-the-Variogram-Point-Cloud-model-for-datasets-A-and-B">3) Create the Variogram Point Cloud model for datasets A and B</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#4)-Remove-outliers-from-the-variograms">4) Remove outliers from the variograms</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#5)-Create-Four-Ordinary-Kriging-models-based-on-the-four-Variogram-Point-Clouds-and-compare-their-performance">5) Create Four Ordinary Kriging models based on the four Variogram Point Clouds and compare their performance</a></li>
</ul>
  </nav></div>

  <div class="sidebar-secondary-item">
  <div class="tocsection sourcelink">
    <a href="../../_sources/usage/tutorials/Outliers and Their Influence on the Final Model (Intermediate).ipynb.txt">
      <i class="fa-solid fa-file-lines"></i> Show Source
    </a>
  </div>
</div>

</div></div>
              
            
          </div>
          <footer class="bd-footer-content">
            
          </footer>
        
      </main>
    </div>
  </div>
  
  <!-- Scripts loaded after <body> so the DOM is not blocked -->
  <script src="../../_static/scripts/bootstrap.js?digest=e353d410970836974a52"></script>
<script src="../../_static/scripts/pydata-sphinx-theme.js?digest=e353d410970836974a52"></script>

  <footer class="bd-footer">
<div class="bd-footer__inner bd-page-width">
  
    <div class="footer-items__start">
      
        <div class="footer-item">
  <p class="copyright">
    
      © Copyright 2023, Szymon Moliński.
      <br/>
    
  </p>
</div>
      
        <div class="footer-item">
  <p class="sphinx-version">
    Created using <a href="https://www.sphinx-doc.org/">Sphinx</a> 5.3.0.
    <br/>
  </p>
</div>
      
    </div>
  
  
    <div class="footer-items__end">
      
        <div class="footer-item"><p class="theme-version">
  Built with the <a href="https://pydata-sphinx-theme.readthedocs.io/en/stable/index.html">PyData Sphinx Theme</a> 0.13.3.
</p></div>
      
    </div>
  
</div>

  </footer>
  </body>
</html>