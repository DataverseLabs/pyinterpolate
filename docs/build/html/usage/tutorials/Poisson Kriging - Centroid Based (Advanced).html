<!DOCTYPE html>
<html lang="en-gb">
<head>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">


<title>Pyinterpolate - Poisson Kriging - centroid based approach</title>

<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/4.7.0/css/font-awesome.css" integrity="sha256-NuCn4IvuZXdBaFKJOAcsU2Q3ZpwbdFisd5dux4jkQ5w=" crossorigin="anonymous"/>
<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@3.4.1/dist/css/bootstrap.min.css" integrity="sha256-bZLfwXAP04zRMK2BjiO8iu9pf4FbLqX6zitd+tIvLhE=" crossorigin="anonymous">
<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@3.4.1/dist/css/bootstrap-theme.min.css" integrity="sha256-8uHMIn1ru0GS5KO+zf7Zccf8Uw12IA5DrdEcmMuWLFM=" crossorigin="anonymous">
<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/tooltipster@4.2.8/dist/css/tooltipster.bundle.min.css" integrity="sha256-Qc4lCfqZWYaHF5hgEOFrYzSIX9Rrxk0NPHRac+08QeQ=" crossorigin="anonymous">
<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/tooltipster@4.2.8/dist/css/plugins/tooltipster/sideTip/themes/tooltipster-sideTip-light.min.css" integrity="sha256-Wa1I4jhSXeWd3N6RhfPlkqr1WlT+zS3Vh2YGCg0129E=" crossorigin="anonymous">
<link href="https://fonts.googleapis.com/css?family=Open+Sans|Source+Code+Pro|Source+Sans+Pro|Source+Serif+Pro|Roboto|Roboto+Mono" rel="stylesheet">
<link href="https://fonts.red-dove.com/iosevka-ss09-regular/webfont.css" rel="stylesheet">

    <link rel="stylesheet" href="../../_static/pygments.css" type="text/css" />
    <link rel="stylesheet" href="../../_static/css/sizzle.css" type="text/css" />
    <link rel="stylesheet" href="../../_static/pygments.css" type="text/css" />
    <link rel="stylesheet" href="../../_static/css/sizzle.css" type="text/css" />
    <link rel="stylesheet" href="../../_static/copybutton.css" type="text/css" />
<script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.6.0/jquery.min.js" integrity="sha512-894YE6QWD5I59HgZOGReFYm4dnWc1Qt5NtvYSaNcOP+u1T9qYdvdihz0PPSiiqn/+/3e7Jo4EaG7TubfWGUrMQ==" crossorigin="anonymous" referrerpolicy="no-referrer"></script>
<script src="https://cdn.jsdelivr.net/npm/bootstrap@3.4.1/dist/js/bootstrap.min.js" integrity="sha256-nuL8/2cJ5NDSSwnKD8VqreErSWHtnEP9E7AySL+1ev4=" crossorigin="anonymous"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/underscore.js/1.9.1/underscore-min.js" integrity="sha256-G7A4JrJjJlFqP0yamznwPjAApIKPkadeHfyIwiaa9e0=" crossorigin="anonymous"></script>
<script src="https://cdn.jsdelivr.net/npm/tooltipster@4.2.8/dist/js/tooltipster.bundle.min.js" integrity="sha256-v8akIv8SCqn5f3mbVB7vEWprIizxPh6oV0yhao/dbB4=" crossorigin="anonymous"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.4/clipboard.min.js" integrity="sha256-FiZwavyI2V6+EXO1U+xzLG3IKldpiTFf3153ea9zikQ=" crossorigin="anonymous"></script>
    <script>
      var DOCUMENTATION_OPTIONS = {
        URL_ROOT:    '',
        VERSION:     '0.3.3',
        COLLAPSE_INDEX: false,
        FILE_SUFFIX: '.html',
        LINK_SUFFIX: '.html',
        HAS_SOURCE:  false,
        SOURCELINK_SUFFIX: '.txt'
      };
      $(document).data('sizzle', {on_load: []});
    </script>
    <script src="../../_static/underscore.js"></script>
    <script src="../../_static/_sphinx_javascript_frameworks_compat.js"></script>
    <script src="../../_static/doctools.js"></script>
    <script src="../../_static/sphinx_highlight.js"></script>
    <script src="../../_static/clipboard.min.js"></script>
    <script src="../../_static/copybutton.js"></script>
    <script crossorigin="anonymous" integrity="sha256-Ae2Vz/4ePdIu6ZyI/5ZGsYnb+m0JlOmKPjt6XZ9JJkA=" src="https://cdnjs.cloudflare.com/ajax/libs/require.js/2.3.4/require.min.js"></script>
    <script>window.MathJax = {"tex": {"inlineMath": [["$", "$"], ["\\(", "\\)"]], "processEscapes": true}, "options": {"ignoreHtmlClass": "tex2jax_ignore|mathjax_ignore|document", "processHtmlClass": "tex2jax_process|mathjax_process|math|output_area"}}</script>
    <script defer="defer" src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js"></script>
    <script src="../../app-data.js"></script>
<link rel="index" title="Index" href="../../genindex.html" />
<link rel="search" title="Search" href="../../search.html" />
<link rel="next" title="Poisson Kriging - Area to Area Kriging" href="Poisson%20Kriging%20-%20Area%20to%20Area%20%28Advanced%29.html" />
<link rel="prev" title="Outliers and Their Influence on the Final Model" href="Outliers%20and%20Their%20Influence%20on%20the%20Final%20Model%20%28Intermediate%29.html" />

</head>
<body class="full-height test">
<noscript>
  <div>
    <div id="noscript-message">JavaScript is not enabled. It is needed for this website to work.</div>
  </div>
</noscript>
<div id="whole-page" class="container-fluid content full-height">
  <div id="header-row" class="row">
    <div id="header-container" class="col-md-12">
      <div id="hdr-left">
        <i class="fa fa-bars menu-toggle"></i>
        
<a href="../../index.html" class="text-logo">Pyinterpolate 0.3.3 documentation</a>

      </div>
      <div id="hdr-centre" class="text-center stretch">
        <h3 title="Poisson Kriging - centroid based approach">Poisson Kriging - centroid based approach</h3>
        <h6>Poisson Kriging - centroid based approach</h6>
      </div>
      <div id="hdr-search">
        
<div class="input-group" title="Enter something to search for and then either press Enter or click the magnifying glass">
  <input type="text" class="form-control search-query" placeholder="Search docs ...">
  <div class="input-group-addon">
    <i class="fa fa-search"></i>
  </div>
</div>
      </div>

      <div id="hdr-index">
        <a href="../../genindex.html" class="btn btn-default" title="Go to the index"><i class="fa fa-list"></i></a>
      </div>

      <div id="hdr-source">
        <a href="../../_sources/usage/tutorials/Poisson Kriging - Centroid Based (Advanced).ipynb.txt" class="btn btn-default" title="See the source for this page"><i class="fa fa-code"></i></a>
      </div>

      <div id="hdr-right">
        
  
  <div class="prev-next">
    
      <div class="pull-left">
        <a class="btn btn-default prev" href="Outliers%20and%20Their%20Influence%20on%20the%20Final%20Model%20%28Intermediate%29.html" title="Previous chapter (Outliers and Their Influence on the Final Model)"><i class="fa fa-chevron-left mr-1em" aria-hidden="true"></i><span class="btn-text">Outliers and Their Influence on the Final Model</span></a>
      </div>
    
      <div class="pull-right">
        <a class="btn btn-default next" href="Poisson%20Kriging%20-%20Area%20to%20Area%20%28Advanced%29.html" title="Next chapter (Poisson Kriging - Area to Area Kriging)"><span class="btn-text">Poisson Kriging - Area to Area Kriging</span>&nbsp;<i class="fa fa-chevron-right ml-1em" aria-hidden="true"></i></a>
      </div>
    </div>
  
      </div>
      <div id="alt-hdr-right">

        <a href="Outliers%20and%20Their%20Influence%20on%20the%20Final%20Model%20%28Intermediate%29.html"><i class="fa fa-chevron-left mr-8"></i></a>


        <a href="../../index.html"><i class="fa fa-home mr-8"></i></a>


        <a href="../../search.html"><i class="fa fa-search mr-8"></i></a>


        <a href="../../genindex.html"><i class="fa fa-list mr-8"></i></a>


        <a href="Poisson%20Kriging%20-%20Area%20to%20Area%20%28Advanced%29.html"><i class="fa fa-chevron-right"></i></a>

      </div>
    </div>
  </div>

  <div id="content-row" class="row">
    <div id="page-content" class="col-md-12 flex-col">
      <div id="content-container">
        <div id="nav">
          
  <div class="navsidebar">
    <div id="sidebar-search">
      
<div class="input-group" title="Enter something to search for and then either press Enter or click the magnifying glass">
  <input type="text" class="form-control search-query" placeholder="Search docs ...">
  <div class="input-group-addon">
    <i class="fa fa-search"></i>
  </div>
</div>
    </div>
      <div class="sidebar-block">
        <div class="sidebar-tocheading">
          <div class="pull-left">
            <h2>Table Of Contents</h2>
          </div>
          <div class="pull-right" title="Hide this sidebar (hover at left edge to bring it back)"><i class="fa fa-chevron-left hidetoc"></i></div>
        </div>
        <div class="sidebar-toc">
      
          <div id="toc-filter" title="Type in here to show only matching topics">
            <input class="form-control" id="toc-filter-query" placeholder="Filter by title ...">
          </div>
      
        
  
    <ul class="current">
<li class="toctree-l1"><a class="reference internal" href="../../setup/setup.html">Setup</a></li>
<li class="toctree-l1"><a class="reference internal" href="../quickstart.html">Quickstart</a></li>
<li class="toctree-l1 current"><a class="reference internal" href="../tutorials.html">Tutorials</a><ul class="current">
<li class="toctree-l2"><a class="reference internal" href="../tutorials.html#beginner">Beginner</a></li>
<li class="toctree-l2"><a class="reference internal" href="../tutorials.html#intermediate">Intermediate</a></li>
<li class="toctree-l2 current"><a class="reference internal" href="../tutorials.html#advanced">Advanced</a><ul class="current">
<li class="toctree-l3 current"><a class="current reference internal" href="#Poisson-Kriging---centroid-based-approach">Poisson Kriging - centroid based approach</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#Table-of-Contents:">Table of Contents:</a></li>
<li class="toctree-l4"><a class="reference internal" href="#Level:-Advanced">Level: Advanced</a></li>
<li class="toctree-l4"><a class="reference internal" href="#Changelog">Changelog</a></li>
<li class="toctree-l4"><a class="reference internal" href="#Introduction">Introduction</a></li>
<li class="toctree-l4"><a class="reference internal" href="#1)-Read-and-explore-data">1) Read and explore data</a></li>
<li class="toctree-l4"><a class="reference internal" href="#2)-Load-semivariogram-model">2) Load semivariogram model</a></li>
<li class="toctree-l4"><a class="reference internal" href="#3)-Prepare-training-and-test-data.">3) Prepare training and test data.</a></li>
<li class="toctree-l4"><a class="reference internal" href="#4)-Predict-values-at-unknown-locations-and-calculate-forecast-bias-and-root-mean-squared-error.">4) Predict values at unknown locations and calculate forecast bias and root mean squared error.</a></li>
<li class="toctree-l4"><a class="reference internal" href="#5)-Analyze-Forecast-Bias-and-Root-Mean-Squared-Error-of-prediction">5) Analyze Forecast Bias and Root Mean Squared Error of prediction</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="Poisson%20Kriging%20-%20Area%20to%20Area%20%28Advanced%29.html">Poisson Kriging - Area to Area Kriging</a></li>
<li class="toctree-l3"><a class="reference internal" href="Poisson%20Kriging%20-%20Area%20to%20Point%20%28Advanced%29.html">Poisson Kriging - Area to Point Kriging</a></li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../../science/cite.html">How to cite</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../api/api.html#api">API</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../developer/dev.html">Development</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../community/community.html">Community</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../science/biblio.html">Bibliography</a></li>
</ul>

  
        </div>
      </div>
  </div>
        </div>
        <div id="content" tabindex="0" class="stretch">
          <div id="mnav">
            
  
    <ul class="current">
<li class="toctree-l1"><a class="reference internal" href="../../setup/setup.html">Setup</a></li>
<li class="toctree-l1"><a class="reference internal" href="../quickstart.html">Quickstart</a></li>
<li class="toctree-l1 current"><a class="reference internal" href="../tutorials.html">Tutorials</a><ul class="current">
<li class="toctree-l2"><a class="reference internal" href="../tutorials.html#beginner">Beginner</a></li>
<li class="toctree-l2"><a class="reference internal" href="../tutorials.html#intermediate">Intermediate</a></li>
<li class="toctree-l2 current"><a class="reference internal" href="../tutorials.html#advanced">Advanced</a><ul class="current">
<li class="toctree-l3 current"><a class="current reference internal" href="#Poisson-Kriging---centroid-based-approach">Poisson Kriging - centroid based approach</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#Table-of-Contents:">Table of Contents:</a></li>
<li class="toctree-l4"><a class="reference internal" href="#Level:-Advanced">Level: Advanced</a></li>
<li class="toctree-l4"><a class="reference internal" href="#Changelog">Changelog</a></li>
<li class="toctree-l4"><a class="reference internal" href="#Introduction">Introduction</a></li>
<li class="toctree-l4"><a class="reference internal" href="#1)-Read-and-explore-data">1) Read and explore data</a></li>
<li class="toctree-l4"><a class="reference internal" href="#2)-Load-semivariogram-model">2) Load semivariogram model</a></li>
<li class="toctree-l4"><a class="reference internal" href="#3)-Prepare-training-and-test-data.">3) Prepare training and test data.</a></li>
<li class="toctree-l4"><a class="reference internal" href="#4)-Predict-values-at-unknown-locations-and-calculate-forecast-bias-and-root-mean-squared-error.">4) Predict values at unknown locations and calculate forecast bias and root mean squared error.</a></li>
<li class="toctree-l4"><a class="reference internal" href="#5)-Analyze-Forecast-Bias-and-Root-Mean-Squared-Error-of-prediction">5) Analyze Forecast Bias and Root Mean Squared Error of prediction</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="Poisson%20Kriging%20-%20Area%20to%20Area%20%28Advanced%29.html">Poisson Kriging - Area to Area Kriging</a></li>
<li class="toctree-l3"><a class="reference internal" href="Poisson%20Kriging%20-%20Area%20to%20Point%20%28Advanced%29.html">Poisson Kriging - Area to Point Kriging</a></li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../../science/cite.html">How to cite</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../api/api.html#api">API</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../developer/dev.html">Development</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../community/community.html">Community</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../science/biblio.html">Bibliography</a></li>
</ul>

  
          </div>
          <div class="body">
            
  
<style>
/* CSS for nbsphinx extension */

/* remove conflicting styling from Sphinx themes */
div.nbinput.container div.prompt *,
div.nboutput.container div.prompt *,
div.nbinput.container div.input_area pre,
div.nboutput.container div.output_area pre,
div.nbinput.container div.input_area .highlight,
div.nboutput.container div.output_area .highlight {
    border: none;
    padding: 0;
    margin: 0;
    box-shadow: none;
}

div.nbinput.container > div[class*=highlight],
div.nboutput.container > div[class*=highlight] {
    margin: 0;
}

div.nbinput.container div.prompt *,
div.nboutput.container div.prompt * {
    background: none;
}

div.nboutput.container div.output_area .highlight,
div.nboutput.container div.output_area pre {
    background: unset;
}

div.nboutput.container div.output_area div.highlight {
    color: unset;  /* override Pygments text color */
}

/* avoid gaps between output lines */
div.nboutput.container div[class*=highlight] pre {
    line-height: normal;
}

/* input/output containers */
div.nbinput.container,
div.nboutput.container {
    display: -webkit-flex;
    display: flex;
    align-items: flex-start;
    margin: 0;
    width: 100%;
}
@media (max-width: 540px) {
    div.nbinput.container,
    div.nboutput.container {
        flex-direction: column;
    }
}

/* input container */
div.nbinput.container {
    padding-top: 5px;
}

/* last container */
div.nblast.container {
    padding-bottom: 5px;
}

/* input prompt */
div.nbinput.container div.prompt pre {
    color: #307FC1;
}

/* output prompt */
div.nboutput.container div.prompt pre {
    color: #BF5B3D;
}

/* all prompts */
div.nbinput.container div.prompt,
div.nboutput.container div.prompt {
    width: 4.5ex;
    padding-top: 5px;
    position: relative;
    user-select: none;
}

div.nbinput.container div.prompt > div,
div.nboutput.container div.prompt > div {
    position: absolute;
    right: 0;
    margin-right: 0.3ex;
}

@media (max-width: 540px) {
    div.nbinput.container div.prompt,
    div.nboutput.container div.prompt {
        width: unset;
        text-align: left;
        padding: 0.4em;
    }
    div.nboutput.container div.prompt.empty {
        padding: 0;
    }

    div.nbinput.container div.prompt > div,
    div.nboutput.container div.prompt > div {
        position: unset;
    }
}

/* disable scrollbars on prompts */
div.nbinput.container div.prompt pre,
div.nboutput.container div.prompt pre {
    overflow: hidden;
}

/* input/output area */
div.nbinput.container div.input_area,
div.nboutput.container div.output_area {
    -webkit-flex: 1;
    flex: 1;
    overflow: auto;
}
@media (max-width: 540px) {
    div.nbinput.container div.input_area,
    div.nboutput.container div.output_area {
        width: 100%;
    }
}

/* input area */
div.nbinput.container div.input_area {
    border: 1px solid #e0e0e0;
    border-radius: 2px;
    /*background: #f5f5f5;*/
}

/* override MathJax center alignment in output cells */
div.nboutput.container div[class*=MathJax] {
    text-align: left !important;
}

/* override sphinx.ext.imgmath center alignment in output cells */
div.nboutput.container div.math p {
    text-align: left;
}

/* standard error */
div.nboutput.container div.output_area.stderr {
    background: #fdd;
}

/* ANSI colors */
.ansi-black-fg { color: #3E424D; }
.ansi-black-bg { background-color: #3E424D; }
.ansi-black-intense-fg { color: #282C36; }
.ansi-black-intense-bg { background-color: #282C36; }
.ansi-red-fg { color: #E75C58; }
.ansi-red-bg { background-color: #E75C58; }
.ansi-red-intense-fg { color: #B22B31; }
.ansi-red-intense-bg { background-color: #B22B31; }
.ansi-green-fg { color: #00A250; }
.ansi-green-bg { background-color: #00A250; }
.ansi-green-intense-fg { color: #007427; }
.ansi-green-intense-bg { background-color: #007427; }
.ansi-yellow-fg { color: #DDB62B; }
.ansi-yellow-bg { background-color: #DDB62B; }
.ansi-yellow-intense-fg { color: #B27D12; }
.ansi-yellow-intense-bg { background-color: #B27D12; }
.ansi-blue-fg { color: #208FFB; }
.ansi-blue-bg { background-color: #208FFB; }
.ansi-blue-intense-fg { color: #0065CA; }
.ansi-blue-intense-bg { background-color: #0065CA; }
.ansi-magenta-fg { color: #D160C4; }
.ansi-magenta-bg { background-color: #D160C4; }
.ansi-magenta-intense-fg { color: #A03196; }
.ansi-magenta-intense-bg { background-color: #A03196; }
.ansi-cyan-fg { color: #60C6C8; }
.ansi-cyan-bg { background-color: #60C6C8; }
.ansi-cyan-intense-fg { color: #258F8F; }
.ansi-cyan-intense-bg { background-color: #258F8F; }
.ansi-white-fg { color: #C5C1B4; }
.ansi-white-bg { background-color: #C5C1B4; }
.ansi-white-intense-fg { color: #A1A6B2; }
.ansi-white-intense-bg { background-color: #A1A6B2; }

.ansi-default-inverse-fg { color: #FFFFFF; }
.ansi-default-inverse-bg { background-color: #000000; }

.ansi-bold { font-weight: bold; }
.ansi-underline { text-decoration: underline; }


div.nbinput.container div.input_area div[class*=highlight] > pre,
div.nboutput.container div.output_area div[class*=highlight] > pre,
div.nboutput.container div.output_area div[class*=highlight].math,
div.nboutput.container div.output_area.rendered_html,
div.nboutput.container div.output_area > div.output_javascript,
div.nboutput.container div.output_area:not(.rendered_html) > img{
    padding: 5px;
    margin: 0;
}

/* fix copybtn overflow problem in chromium (needed for 'sphinx_copybutton') */
div.nbinput.container div.input_area > div[class^='highlight'],
div.nboutput.container div.output_area > div[class^='highlight']{
    overflow-y: hidden;
}

/* hide copybtn icon on prompts (needed for 'sphinx_copybutton') */
.prompt .copybtn {
    display: none;
}

/* Some additional styling taken form the Jupyter notebook CSS */
.jp-RenderedHTMLCommon table,
div.rendered_html table {
  border: none;
  border-collapse: collapse;
  border-spacing: 0;
  color: black;
  font-size: 12px;
  table-layout: fixed;
}
.jp-RenderedHTMLCommon thead,
div.rendered_html thead {
  border-bottom: 1px solid black;
  vertical-align: bottom;
}
.jp-RenderedHTMLCommon tr,
.jp-RenderedHTMLCommon th,
.jp-RenderedHTMLCommon td,
div.rendered_html tr,
div.rendered_html th,
div.rendered_html td {
  text-align: right;
  vertical-align: middle;
  padding: 0.5em 0.5em;
  line-height: normal;
  white-space: normal;
  max-width: none;
  border: none;
}
.jp-RenderedHTMLCommon th,
div.rendered_html th {
  font-weight: bold;
}
.jp-RenderedHTMLCommon tbody tr:nth-child(odd),
div.rendered_html tbody tr:nth-child(odd) {
  background: #f5f5f5;
}
.jp-RenderedHTMLCommon tbody tr:hover,
div.rendered_html tbody tr:hover {
  background: rgba(66, 165, 245, 0.2);
}
</style>
<div class="section" id="Poisson-Kriging---centroid-based-approach">
<h1>Poisson Kriging - centroid based approach<a class="headerlink" href="#Poisson-Kriging---centroid-based-approach" title="Permalink to this heading">¶</a></h1>
<div class="section" id="Table-of-Contents:">
<h2>Table of Contents:<a class="headerlink" href="#Table-of-Contents:" title="Permalink to this heading">¶</a></h2>
<ol class="arabic simple">
<li>Load areal and point data,</li>
<li>Load semivariogram (regularized),</li>
<li>Remove 10% of areal dataset,</li>
<li>Predict values at unknown locations,</li>
<li>Analyse Forecast Bias and Root Mean Squared Error of prediction.</li>
</ol>
</div>
<div class="section" id="Level:-Advanced">
<h2>Level: Advanced<a class="headerlink" href="#Level:-Advanced" title="Permalink to this heading">¶</a></h2>
</div>
<div class="section" id="Changelog">
<h2>Changelog<a class="headerlink" href="#Changelog" title="Permalink to this heading">¶</a></h2>
<table>
<colgroup>
<col width="8%" />
<col width="86%" />
<col width="5%" />
</colgroup>
<thead valign="bottom">
<tr class="row-odd"><th class="head">Date</th>
<th class="head">Change description</th>
<th class="head">Author</th>
</tr>
</thead>
<tbody valign="top">
<tr class="row-even"><td>2022-10-21</td>
<td>Tutorial updated for the 0.3.4 version of the package</td>
<td>&#64;SimonMolinsky</td>
</tr>
<tr class="row-odd"><td>2022-08-27</td>
<td>Tutorial updated for the 0.3.0 version of the package</td>
<td>&#64;SimonMolinsky</td>
</tr>
<tr class="row-even"><td>2021-12-14</td>
<td>Sill selection was upgraded: now optimal sill is derived from the grid search within <code class="docutils literal notranslate"><span class="pre">TheoreticalSemivariogram</span></code> class</td>
<td>&#64;SimonMolinsky</td>
</tr>
<tr class="row-odd"><td>2021-12-13</td>
<td>Changed behavior of <code class="docutils literal notranslate"><span class="pre">select_values_in_range()</span></code> function</td>
<td>&#64;SimonMolinsky</td>
</tr>
<tr class="row-even"><td>2021-12-11</td>
<td>Behavior of <code class="docutils literal notranslate"><span class="pre">prepare_kriging_data()</span></code> function has benn changed</td>
<td>&#64;SimonMolinsky</td>
</tr>
<tr class="row-odd"><td>2021-05-28</td>
<td>Updated paths for input/output data</td>
<td>&#64;SimonMolinsky</td>
</tr>
<tr class="row-even"><td>2021-05-11</td>
<td>Refactored TheoreticalSemivariogram class</td>
<td>&#64;SimonMolinsky</td>
</tr>
<tr class="row-odd"><td>2021-03-31</td>
<td>Update related to the change of semivariogram weighting. Updated cancer rates data.</td>
<td>&#64;SimonMolinsky</td>
</tr>
</tbody>
</table>
</div>
<div class="section" id="Introduction">
<h2>Introduction<a class="headerlink" href="#Introduction" title="Permalink to this heading">¶</a></h2>
<p>Before starting this tutorial, be sure you understand concepts in the <strong>Ordinary and Simple Kriging</strong> and <strong>Semivariogram Regularization</strong> tutorials.</p>
<p>The Poisson Kriging technique is used to model spatial count data. We will analyze a particular case where values are counted over blocks, and those blocks may have irregular shapes and sizes. We will try to predict the breast cancer rates in the Northeastern counties of the U.S. We will use U.S. Census 2010 data to create point support for blocks.</p>
<blockquote>
<div>The breast cancer rates data and the point support population counts are located in the geopackage in a directory: <code class="docutils literal notranslate"><span class="pre">samples/regularization/cancer_data.gpkg</span></code></div></blockquote>
<p>Even if our areal data has units with irregular shapes and sizes, for the case of this tutorial, we assume that each region may be represented by its centroid. This is a huge simplification; we can do it at our own risk. There are cases when we can use this method instead of the Area-to-Area Kriging. Those cases are:</p>
<ul class="simple">
<li>We must do our calculations fast, and the processing time is crucial,</li>
<li>or blocks have similar shapes and sizes.</li>
</ul>
<p>Centroid-based Poisson Kriging is much faster than Area-to-Area or Area-to-Point Poisson Kriging, and for some applications, it may be desired property.</p>
<p>The tutorial covers the following steps:</p>
<ol class="arabic simple">
<li>Read and explore data,</li>
<li>Load semivariogram model,</li>
<li>Prepare training and test data,</li>
<li>Predict values of unknown locations and calculate forecast bias and root mean squared error,</li>
<li>Analyze error metrics.</li>
</ol>
</div>
<div class="section" id="1)-Read-and-explore-data">
<h2>1) Read and explore data<a class="headerlink" href="#1)-Read-and-explore-data" title="Permalink to this heading">¶</a></h2>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[6]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>
<span class="kn">import</span> <span class="nn">pandas</span> <span class="k">as</span> <span class="nn">pd</span>

<span class="kn">from</span> <span class="nn">pyinterpolate</span> <span class="kn">import</span> <span class="n">TheoreticalVariogram</span>
<span class="kn">from</span> <span class="nn">pyinterpolate</span> <span class="kn">import</span> <span class="n">Blocks</span><span class="p">,</span> <span class="n">PointSupport</span>
<span class="kn">from</span> <span class="nn">pyinterpolate</span> <span class="kn">import</span> <span class="n">centroid_poisson_kriging</span>
</pre></div>
</div>
</div>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[7]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">DATASET</span> <span class="o">=</span> <span class="s1">&#39;samples/regularization/cancer_data.gpkg&#39;</span>
<span class="n">OUTPUT</span> <span class="o">=</span> <span class="s1">&#39;samples/regularization/regularized_variogram.json&#39;</span>
<span class="n">POLYGON_LAYER</span> <span class="o">=</span> <span class="s1">&#39;areas&#39;</span>
<span class="n">POPULATION_LAYER</span> <span class="o">=</span> <span class="s1">&#39;points&#39;</span>
<span class="n">POP10</span> <span class="o">=</span> <span class="s1">&#39;POP10&#39;</span>
<span class="n">GEOMETRY_COL</span> <span class="o">=</span> <span class="s1">&#39;geometry&#39;</span>
<span class="n">POLYGON_ID</span> <span class="o">=</span> <span class="s1">&#39;FIPS&#39;</span>
<span class="n">POLYGON_VALUE</span> <span class="o">=</span> <span class="s1">&#39;rate&#39;</span>

<span class="n">blocks</span> <span class="o">=</span> <span class="n">Blocks</span><span class="p">()</span>
<span class="n">blocks</span><span class="o">.</span><span class="n">from_file</span><span class="p">(</span><span class="n">DATASET</span><span class="p">,</span> <span class="n">value_col</span><span class="o">=</span><span class="n">POLYGON_VALUE</span><span class="p">,</span> <span class="n">index_col</span><span class="o">=</span><span class="n">POLYGON_ID</span><span class="p">,</span> <span class="n">layer_name</span><span class="o">=</span><span class="n">POLYGON_LAYER</span><span class="p">)</span>

<span class="n">point_support</span> <span class="o">=</span> <span class="n">PointSupport</span><span class="p">()</span>
<span class="n">point_support</span><span class="o">.</span><span class="n">from_files</span><span class="p">(</span><span class="n">point_support_data_file</span><span class="o">=</span><span class="n">DATASET</span><span class="p">,</span>
                         <span class="n">blocks_file</span><span class="o">=</span><span class="n">DATASET</span><span class="p">,</span>
                         <span class="n">point_support_geometry_col</span><span class="o">=</span><span class="n">GEOMETRY_COL</span><span class="p">,</span>
                         <span class="n">point_support_val_col</span><span class="o">=</span><span class="n">POP10</span><span class="p">,</span>
                         <span class="n">blocks_geometry_col</span><span class="o">=</span><span class="n">GEOMETRY_COL</span><span class="p">,</span>
                         <span class="n">blocks_index_col</span><span class="o">=</span><span class="n">POLYGON_ID</span><span class="p">,</span>
                         <span class="n">use_point_support_crs</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
                         <span class="n">point_support_layer_name</span><span class="o">=</span><span class="n">POPULATION_LAYER</span><span class="p">,</span>
                         <span class="n">blocks_layer_name</span><span class="o">=</span><span class="n">POLYGON_LAYER</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[8]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Lets take a look into a map of areal counts</span>

<span class="n">blocks</span><span class="o">.</span><span class="n">data</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">column</span><span class="o">=</span><span class="n">blocks</span><span class="o">.</span><span class="n">value_column_name</span><span class="p">,</span> <span class="n">cmap</span><span class="o">=</span><span class="s1">&#39;Spectral_r&#39;</span><span class="p">,</span> <span class="n">legend</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">12</span><span class="p">,</span> <span class="mi">8</span><span class="p">))</span>
</pre></div>
</div>
</div>
<div class="nboutput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[8]:
</pre></div>
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
&lt;AxesSubplot:&gt;
</pre></div></div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="../../_images/usage_tutorials_Poisson_Kriging_-_Centroid_Based_(Advanced)_4_1.png" src="../../_images/usage_tutorials_Poisson_Kriging_-_Centroid_Based_(Advanced)_4_1.png" />
</div>
</div>
<p><strong>Clarification</strong>: It is a good idea to look into the spatial patterns in a dataset and to visually check if our data do not have any NaN values. We use the geopandas <code class="docutils literal notranslate"><span class="pre">GeoDataFrame.plot()</span></code> function with a color map that diverges regions based on the cancer incidence rates. The output choropleth map is not ideal, and (probably) it has a few unreliable results, for example:</p>
<ul class="simple">
<li>in counties with a small population, where the ratio number of cases to population size is high even if the number of cases is low,</li>
<li>counties that are very big and sparsely populated may draw more of our attention instead of densely populated counties,</li>
<li>transitions of colors (rates) between counties may be too abrupt, even if we know, that neighboring counties should have closer results.</li>
</ul>
<p>We can overcome those problems using Centroid-based Poisson Kriging for filtering and denoising. But we must be aware that this method introduces a bias: each polygon falls into its centroid, but polygons’ shapes and sizes differ, so centroid representation erases spatial patterns.</p>
</div>
<div class="section" id="2)-Load-semivariogram-model">
<h2>2) Load semivariogram model<a class="headerlink" href="#2)-Load-semivariogram-model" title="Permalink to this heading">¶</a></h2>
<p>In this step, we load regularized semivariogram from the tutorial <strong>Semivariogram Regularization (Intermediate)</strong>. You can always perform semivariogram regularization along with the Poisson Kriging, but it is a very long process, and it is more convenient to separate those two steps.</p>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[9]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">semivariogram</span> <span class="o">=</span> <span class="n">TheoreticalVariogram</span><span class="p">()</span>  <span class="c1"># Create TheoreticalSemivariogram object</span>
<span class="n">semivariogram</span><span class="o">.</span><span class="n">from_json</span><span class="p">(</span><span class="s1">&#39;output/regularized_model.json&#39;</span><span class="p">)</span>  <span class="c1"># Load regularized semivariogram</span>
</pre></div>
</div>
</div>
</div>
<div class="section" id="3)-Prepare-training-and-test-data.">
<h2>3) Prepare training and test data.<a class="headerlink" href="#3)-Prepare-training-and-test-data." title="Permalink to this heading">¶</a></h2>
<p>We simply remove 40% of random ID’s from the areal dataset (the same for points) and create four arrays: two training arrays with areal and point geometry and values and two test arrays with the same categories of data.</p>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[10]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Remove 40% of rows (values) to test our model</span>

<span class="k">def</span> <span class="nf">create_test_areal_set</span><span class="p">(</span><span class="n">areal_dataset</span><span class="p">:</span> <span class="n">Blocks</span><span class="p">,</span> <span class="n">points_dataset</span><span class="p">:</span> <span class="n">PointSupport</span><span class="p">,</span> <span class="n">frac</span><span class="o">=</span><span class="mf">0.4</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    areal_dataset : Blocks</span>
<span class="sd">    points_dataset : PointSupport</span>
<span class="sd">    frac : float</span>

<span class="sd">    Returns</span>
<span class="sd">    -------</span>
<span class="sd">    : List</span>
<span class="sd">        [[training_areas, test_areas, training_points, test_points]]</span>
<span class="sd">            equal to:</span>
<span class="sd">        [np.ndarray, np.ndarray, np.ndarray, np.ndarray]</span>
<span class="sd">            where:</span>
<span class="sd">        - areas: [[block index, centroid x, centroid y, value]]</span>
<span class="sd">        - point support: [[block id, x, y, value]]</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">block_id_col</span> <span class="o">=</span> <span class="n">areal_dataset</span><span class="o">.</span><span class="n">index_column_name</span>
    <span class="n">block_data</span> <span class="o">=</span> <span class="n">areal_dataset</span><span class="o">.</span><span class="n">data</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
    <span class="n">all_ids</span> <span class="o">=</span> <span class="n">block_data</span><span class="p">[</span><span class="n">block_id_col</span><span class="p">]</span><span class="o">.</span><span class="n">unique</span><span class="p">()</span>
    <span class="n">training_set_size</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">all_ids</span><span class="p">)</span> <span class="o">*</span> <span class="p">(</span><span class="mi">1</span> <span class="o">-</span> <span class="n">frac</span><span class="p">))</span>

    <span class="n">training_ids</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">choice</span><span class="p">(</span><span class="n">all_ids</span><span class="p">,</span>
                                    <span class="n">size</span><span class="o">=</span><span class="n">training_set_size</span><span class="p">,</span>
                                    <span class="n">replace</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>

    <span class="n">training_areas</span> <span class="o">=</span> <span class="n">block_data</span><span class="p">[</span><span class="n">block_data</span><span class="p">[</span><span class="n">block_id_col</span><span class="p">]</span><span class="o">.</span><span class="n">isin</span><span class="p">(</span><span class="n">training_ids</span><span class="p">)]</span>
    <span class="n">training_areas</span> <span class="o">=</span> <span class="n">training_areas</span><span class="p">[[</span><span class="n">block_id_col</span><span class="p">,</span> <span class="s1">&#39;centroid_x&#39;</span><span class="p">,</span> <span class="s1">&#39;centroid_y&#39;</span><span class="p">,</span> <span class="n">areal_dataset</span><span class="o">.</span><span class="n">value_column_name</span><span class="p">]]</span><span class="o">.</span><span class="n">values</span>
    <span class="n">test_areas</span> <span class="o">=</span> <span class="n">block_data</span><span class="p">[</span><span class="o">~</span><span class="n">block_data</span><span class="p">[</span><span class="n">block_id_col</span><span class="p">]</span><span class="o">.</span><span class="n">isin</span><span class="p">(</span><span class="n">training_ids</span><span class="p">)]</span>
    <span class="n">test_areas</span> <span class="o">=</span> <span class="n">test_areas</span><span class="p">[[</span><span class="n">block_id_col</span><span class="p">,</span> <span class="s1">&#39;centroid_x&#39;</span><span class="p">,</span> <span class="s1">&#39;centroid_y&#39;</span><span class="p">,</span> <span class="n">areal_dataset</span><span class="o">.</span><span class="n">value_column_name</span><span class="p">]]</span><span class="o">.</span><span class="n">values</span>

    <span class="n">ps_data</span> <span class="o">=</span> <span class="n">points_dataset</span><span class="o">.</span><span class="n">point_support</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
    <span class="n">ps_ids</span> <span class="o">=</span> <span class="n">points_dataset</span><span class="o">.</span><span class="n">block_index_column</span>

    <span class="n">training_points</span> <span class="o">=</span> <span class="n">ps_data</span><span class="p">[</span><span class="n">ps_data</span><span class="p">[</span><span class="n">ps_ids</span><span class="p">]</span><span class="o">.</span><span class="n">isin</span><span class="p">(</span><span class="n">training_ids</span><span class="p">)]</span>
    <span class="n">training_points</span> <span class="o">=</span> <span class="n">training_points</span><span class="p">[[</span><span class="n">ps_ids</span><span class="p">,</span>
                                       <span class="n">points_dataset</span><span class="o">.</span><span class="n">x_col</span><span class="p">,</span>
                                       <span class="n">points_dataset</span><span class="o">.</span><span class="n">y_col</span><span class="p">,</span>
                                       <span class="n">points_dataset</span><span class="o">.</span><span class="n">value_column</span><span class="p">]]</span><span class="o">.</span><span class="n">values</span>
    <span class="n">test_points</span> <span class="o">=</span> <span class="n">ps_data</span><span class="p">[</span><span class="o">~</span><span class="n">ps_data</span><span class="p">[</span><span class="n">ps_ids</span><span class="p">]</span><span class="o">.</span><span class="n">isin</span><span class="p">(</span><span class="n">training_ids</span><span class="p">)]</span>
    <span class="n">test_points</span> <span class="o">=</span> <span class="n">test_points</span><span class="p">[[</span><span class="n">ps_ids</span><span class="p">,</span>
                               <span class="n">points_dataset</span><span class="o">.</span><span class="n">x_col</span><span class="p">,</span>
                               <span class="n">points_dataset</span><span class="o">.</span><span class="n">y_col</span><span class="p">,</span>
                               <span class="n">points_dataset</span><span class="o">.</span><span class="n">value_column</span><span class="p">]]</span><span class="o">.</span><span class="n">values</span>


    <span class="n">output</span> <span class="o">=</span> <span class="p">[</span><span class="n">training_areas</span><span class="p">,</span> <span class="n">test_areas</span><span class="p">,</span> <span class="n">training_points</span><span class="p">,</span> <span class="n">test_points</span><span class="p">]</span>
    <span class="k">return</span> <span class="n">output</span>

<span class="n">ar_train</span><span class="p">,</span> <span class="n">ar_test</span><span class="p">,</span> <span class="n">pt_train</span><span class="p">,</span> <span class="n">pt_test</span> <span class="o">=</span> <span class="n">create_test_areal_set</span><span class="p">(</span><span class="n">blocks</span><span class="p">,</span> <span class="n">point_support</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<div class="section" id="4)-Predict-values-at-unknown-locations-and-calculate-forecast-bias-and-root-mean-squared-error.">
<h2>4) Predict values at unknown locations and calculate forecast bias and root mean squared error.<a class="headerlink" href="#4)-Predict-values-at-unknown-locations-and-calculate-forecast-bias-and-root-mean-squared-error." title="Permalink to this heading">¶</a></h2>
<p>You may start work with predictions with a fitted semivariogram model. Centroid-based Poisson Kriging takes five arguments during the run:</p>
<ul class="simple">
<li>semivariogram model (fitted semivariogram model),</li>
<li>known areas (training set),</li>
<li>known points (training set),</li>
<li>unknown-block (without rate value),</li>
<li>unknown block’s point support.</li>
</ul>
<p>Additional two parameters control the process of interpolation:</p>
<ul class="simple">
<li><strong>number of observations</strong> (the most critical parameter - how many neighbors are affecting your area of analysis),</li>
<li><strong>weighted</strong> by population (bool parameter, if True, then distances are weighted by population between points - default is True for Poisson Kriging).</li>
</ul>
<p>The algorithm in the cell below iteratively picks one area from the test set and performs prediction. Then forecast bias, the difference between actual and predicted value, is calculated. Forecast Bias is helpful in understanding if our algorithm predictions are too low or too high (under- or overestimation). The following parameter is Root Mean Squared Error. This measure tells us more about outliers and huge differences between predictions and actual values. We will see it in the last part of
the tutorial.</p>
<p>Your work with Poisson Kriging (or Kriging) will usually be the same: - prepare training and test data, - use training data to train the semivariogram model, - test different hyperparameters with a test set to find the optimal number of neighbors which are affecting your area of analysis, - predict values at unseen locations OR perform data smoothing.</p>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[11]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">number_of_obs</span> <span class="o">=</span> <span class="mi">4</span>

<span class="n">predslist</span> <span class="o">=</span> <span class="p">[]</span>
<span class="k">for</span> <span class="n">unknown_area</span> <span class="ow">in</span> <span class="n">ar_test</span><span class="p">:</span>
    <span class="n">upts</span> <span class="o">=</span> <span class="n">pt_test</span><span class="p">[</span><span class="n">pt_test</span><span class="p">[:,</span> <span class="mi">0</span><span class="p">]</span> <span class="o">==</span> <span class="n">unknown_area</span><span class="p">[</span><span class="mi">0</span><span class="p">]]</span>
    <span class="n">upts</span> <span class="o">=</span> <span class="n">upts</span><span class="p">[:,</span> <span class="mi">1</span><span class="p">:]</span>
    <span class="k">try</span><span class="p">:</span>
        <span class="n">kriging_preds</span> <span class="o">=</span> <span class="n">centroid_poisson_kriging</span><span class="p">(</span><span class="n">semivariogram_model</span><span class="o">=</span><span class="n">semivariogram</span><span class="p">,</span>
                                                 <span class="n">blocks</span><span class="o">=</span><span class="n">ar_train</span><span class="p">,</span>
                                                 <span class="n">point_support</span><span class="o">=</span><span class="n">pt_train</span><span class="p">,</span>
                                                 <span class="n">unknown_block</span><span class="o">=</span><span class="n">unknown_area</span><span class="p">[:</span><span class="o">-</span><span class="mi">1</span><span class="p">],</span>
                                                 <span class="n">unknown_block_point_support</span><span class="o">=</span><span class="n">upts</span><span class="p">,</span>
                                                 <span class="n">number_of_neighbors</span><span class="o">=</span><span class="n">number_of_obs</span><span class="p">,</span>
                                                 <span class="n">is_weighted_by_point_support</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
                                                 <span class="n">raise_when_negative_prediction</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
                                                 <span class="n">raise_when_negative_error</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
    <span class="k">except</span> <span class="ne">ValueError</span> <span class="k">as</span> <span class="n">_</span><span class="p">:</span>
        <span class="n">predslist</span><span class="o">.</span><span class="n">append</span><span class="p">([</span><span class="n">unknown_area</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">np</span><span class="o">.</span><span class="n">nan</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">nan</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">nan</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">nan</span><span class="p">])</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">rmse</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">((</span><span class="n">kriging_preds</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">-</span> <span class="n">unknown_area</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">])</span><span class="o">**</span><span class="mi">2</span><span class="p">)</span>
        <span class="n">fb</span> <span class="o">=</span> <span class="n">unknown_area</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span> <span class="o">-</span> <span class="n">kriging_preds</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>
        <span class="n">kriging_preds</span><span class="o">.</span><span class="n">extend</span><span class="p">([</span><span class="n">rmse</span><span class="p">,</span> <span class="n">fb</span><span class="p">])</span>
        <span class="n">predslist</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">kriging_preds</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[12]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># [unknown block index, prediction, error, rmse, fb]</span>
<span class="n">predslist</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">predslist</span><span class="p">)</span>
<span class="n">pred_df</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="n">data</span><span class="o">=</span><span class="n">predslist</span><span class="p">[:,</span> <span class="mi">1</span><span class="p">:],</span>
                       <span class="n">index</span><span class="o">=</span><span class="n">predslist</span><span class="p">[:,</span> <span class="mi">0</span><span class="p">],</span>
                       <span class="n">columns</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;predicted&#39;</span><span class="p">,</span> <span class="s1">&#39;err&#39;</span><span class="p">,</span> <span class="s1">&#39;rmse&#39;</span><span class="p">,</span> <span class="s1">&#39;fb&#39;</span><span class="p">])</span>  <span class="c1"># Store results in DataFrame</span>
</pre></div>
</div>
</div>
</div>
<div class="section" id="5)-Analyze-Forecast-Bias-and-Root-Mean-Squared-Error-of-prediction">
<h2>5) Analyze Forecast Bias and Root Mean Squared Error of prediction<a class="headerlink" href="#5)-Analyze-Forecast-Bias-and-Root-Mean-Squared-Error-of-prediction" title="Permalink to this heading">¶</a></h2>
<p>The last step is the analysis of errors. We plot two histograms: forecast bias and root mean squared error then we calculate the base statistics of a dataset.</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[13]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Show histograms of errors</span>

<span class="n">pred_df</span><span class="p">[</span><span class="s1">&#39;fb&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">plot</span><span class="o">.</span><span class="n">hist</span><span class="p">(</span><span class="n">bins</span><span class="o">=</span><span class="mi">10</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[13]:
</pre></div>
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
&lt;AxesSubplot:ylabel=&#39;Frequency&#39;&gt;
</pre></div></div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="../../_images/usage_tutorials_Poisson_Kriging_-_Centroid_Based_(Advanced)_15_1.png" src="../../_images/usage_tutorials_Poisson_Kriging_-_Centroid_Based_(Advanced)_15_1.png" />
</div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[14]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">pred_df</span><span class="p">[</span><span class="s1">&#39;rmse&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">plot</span><span class="o">.</span><span class="n">hist</span><span class="p">(</span><span class="n">bins</span><span class="o">=</span><span class="mi">10</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[14]:
</pre></div>
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
&lt;AxesSubplot:ylabel=&#39;Frequency&#39;&gt;
</pre></div></div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="../../_images/usage_tutorials_Poisson_Kriging_-_Centroid_Based_(Advanced)_16_1.png" src="../../_images/usage_tutorials_Poisson_Kriging_-_Centroid_Based_(Advanced)_16_1.png" />
</div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[15]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">pred_df</span><span class="o">.</span><span class="n">describe</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[15]:
</pre></div>
</div>
<div class="output_area rendered_html docutils container">
<div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>predicted</th>
      <th>err</th>
      <th>rmse</th>
      <th>fb</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>count</th>
      <td>64.000000</td>
      <td>64.000000</td>
      <td>64.000000</td>
      <td>64.000000</td>
    </tr>
    <tr>
      <th>mean</th>
      <td>129.595855</td>
      <td>7.248985</td>
      <td>12.242527</td>
      <td>1.136958</td>
    </tr>
    <tr>
      <th>std</th>
      <td>14.294882</td>
      <td>2.441648</td>
      <td>10.735140</td>
      <td>16.315285</td>
    </tr>
    <tr>
      <th>min</th>
      <td>102.558753</td>
      <td>2.008337</td>
      <td>0.274073</td>
      <td>-31.275298</td>
    </tr>
    <tr>
      <th>25%</th>
      <td>121.836469</td>
      <td>5.475371</td>
      <td>3.777442</td>
      <td>-8.798016</td>
    </tr>
    <tr>
      <th>50%</th>
      <td>130.028818</td>
      <td>7.129151</td>
      <td>8.892945</td>
      <td>0.436432</td>
    </tr>
    <tr>
      <th>75%</th>
      <td>138.656975</td>
      <td>8.698757</td>
      <td>16.470977</td>
      <td>8.860611</td>
    </tr>
    <tr>
      <th>max</th>
      <td>167.363158</td>
      <td>13.505133</td>
      <td>43.588486</td>
      <td>43.588486</td>
    </tr>
  </tbody>
</table>
</div></div>
</div>
<p><strong>Clarification</strong>: Analysis of <strong>Forecast Bias</strong> and <strong>Root Mean Squared Error</strong> - their distribution and basic properties - could be a handy tool to analyze model performance. However, consider that table above is a single test case (realization) and can be misleading. The good idea is to repeat the test dozens of times with a different training/test set division each time. After this, we average results from multiple tests and get insight into how our model behaves.</p>
<p><strong>Note 1</strong>: Those results are not decisive. Our sample has been selected randomly, and there is a chance that it is not a spatially representative sample! (E.g., areas only from one region). The good idea is to repeat the experiment multiple times with other samples and average results to determine how well the model performs.</p>
<p><strong>Note 2</strong>: If we analyze errors’ statistics, we should consider not only the <em>mean</em> value of an error. Let’s take a look at different pieces of information:</p>
<ul class="simple">
<li>Histograms clearly show us how dispersed and grouped are errors, and what’s most important, we directly see the worse predictions and how many of them are generated by our model.</li>
<li>What is plotted on a histogram, is described by statistics. We may check the max and the min error, but the true power comes when we analyze quartiles and standard deviation.</li>
<li>The standard deviation is a good measurement of our model’s variance, the less, the better.</li>
<li>Sometimes, we have to look into quartiles. A very high mean but relatively low median (or even the 3rd quartile) indicates that we have only a few wrong predictions, most of which are acceptable.</li>
</ul>
<hr class="docutils" />
</div>
</div>


          </div>
        </div>
      </div>
    </div>
  </div>
  <div id="footer-row" class="row">

    <div class="col-md-12">
        <span title="Built on 2022-10-21" class="pull-right">&copy; Copyright 2022, Szymon Moliński.
        Built with <a href="https://www.sphinx-doc.org/">Sphinx</a> 5.2.3 and the
        <a href="https://pypi.org/project/sphinx-sizzle-theme/"

           title="0.1.1/6a5828d9 [2022-05-03T16:20:16]"

        >Sizzle</a> theme.</span>
    </div>

  </div>
</div>

<div id="tooltips" class="hidden">
</div>

<script>
$(document).ready(function() {
  'use strict';
  var $search = $('.search-query');

  var $filter = $('#toc-filter-query');
  var $toclist = $('.sidebar-toc > ul').find('li');

  if ($toclist.length === 0) {
    $toclist = $('.localtoc > ul').find('li');
  }


  var $nav = $('#nav');

  //$('#whole-page').removeClass('hidden');
  var nav_width = $nav.width();


  var search_url = '../../search.html';

  function perform_search(e) {
    var $elem;

    if (e.type === 'keypress') {
      $elem = $(e.target);
    }
    else if (e.type === 'click') {
      $elem = $(e.target).parents('.input-group').find('input');
    }
    var q = $elem.val().trim();

    if (q) {
      var url = search_url + '?q=' + q + '&check_keywords=yes&area=default';

      location.href = url;
    }
  }


  function apply_filter() {
    var s = $filter.val().trim().toLowerCase();

    $toclist.find('a').removeClass('hidden');
    $toclist.each(function() {
      var $this = $(this);
      var $link = $this.find('> a');
      var t = $link.text().toLowerCase();
      var show = t.indexOf(s) >= 0;

      if (!show) {
        $link.addClass('hidden');
      }
    });
  }

  $filter.on('keyup', function(e) {
    apply_filter();
  });



  $search.on('keypress', function(e) {
    if (e.which == 13) {
      perform_search(e);
    }
  });
  $search.parents('.input-group').find('.input-group-addon').on('click', perform_search);
  $(document).on('click', '.summary .fa-caret-right', function(e) {
    var $elem = $(e.target).parents('li');
    var $next = $elem.next();
    $elem.addClass('hidden');
    $next.removeClass('hidden');
  });
  $(document).on('click', '.detail .fa-caret-down', function(e) {
    var $elem = $(e.target).parents('li');
    var $prev = $elem.prev();
    $elem.addClass('hidden');
    $prev.removeClass('hidden');
  });

  $('#content').on('click', function() {
    $('#mnav').hide();
  });

  var counter = 0;
  var timer = null;

  function show_nav() {
    $('#content').off('mousemove', track_mouse);
    if (timer !== null) {
      clearTimeout(timer);
      timer = null;
    }
    $nav.show();
  }

  function track_mouse(e) {
    var x = e.clientX;

    if (x < 15) {
      ++counter;
      if (timer === null) {
        timer = setTimeout(show_nav, 2000);
      }
    }
    else {
      counter = 0;
    }
    if (counter >= 20) {
      show_nav();
    }
  };

  function hide_nav() {
    $nav.hide();
    counter = 0;
    $('#content').on('mousemove', track_mouse);
  }

  $('.hidetoc').on('click', hide_nav);

  $(document).on('keyup', function(e) {
    if (e.ctrlKey) {
      if (e.which == 37) {      // Ctrl+left arrow
        hide_nav();
      }
      else if (e.which == 39) { // Ctrl+right arrow
        show_nav();
      }
    }
  });

  $('.menu-toggle').on('click', function(e) {
    $('#mnav').toggle();
  });

  function scroll_nav(frag) {
    var sel = '#nav ' + (frag ? 'a[href="' + frag + '"]' : '.toctree-l1 a.current');

    var $link = $(sel);

    if ($link.length > 0) {
      $link[0].scrollIntoView({block: 'center'});
    }
  }

  // If the navigator is long, then the item we clicked on to get here might
  // not be in view. Try to scroll it into the view - a slight delay is needed
  // to get it to sync properly with other stuff going on (as the page has just
  // loaded). Hence the setTimeout with a timeout of 0.

  function do_scroll() {
    scroll_nav(window.location.hash);
  }

  setTimeout(do_scroll, 0);

  function adjust_size() {
    // we need to set the height explicitly so that scrolling regions in the
    // content area work properly.
    var h = $('#page-content').height();

    $('#nav, #content').height(h);
    if ($('#nav').is(':visible')) {
      $('#mnav').hide();
    }
  }

  adjust_size();

  $(window).on('resize', adjust_size);

  function focus_content() {
    $('#content').focus();  // so that keyboard can be used to scroll, etc.
  }

  setTimeout(focus_content, 150);

  var sizzle = $(document).data('sizzle');

  function make_tooltip(id, h, b) {
    var $e = $('<div>').attr('id', id);
    var $b = $('<div>').addClass('tc-body').html(b);

    if (h) {
      var $h = $('<div>').addClass('tc-heading').html(h);
      $e.append($h);
    }
    $e.append($b);
    return $e;
  }

  var default_tt_options = {
    theme: ['tooltipster-light', 'tooltipster-light-customized'],
    interactive: true,
    maxWidth: 600,
    contentCloning: true
  };

  function activate_tooltips() {
    var $tt = $('.tt');

    //console.log('tt links:', $tt.length);
    $tt.tooltipster(default_tt_options);
  }



  function add_glossary_tooltips() {
    var links = $('a');  // can qualify with .reference.internal
    var glinks = {};
    var pat = /(.*)\.html#(term-.*)$/;
    var found = false;  // links in this document

    $.each(links, function(i, link) {
        var $link = $(link);
        var href = $link.attr('href');
        var m = href.match(pat);

        if (m) {
          var s = m[1].replace(/^(\.\.\/)+/, '');

          if (s === sizzle.app_data.glossary.document) {
            var k = m[2];

            if (k in glinks) {
              glinks[k].push($link);
            }
            else {
              glinks[k] = [$link];
            }
            found = true;
          }
        }
    });
    if (found) {
      var $t = $('#tooltips');
      var data = sizzle.app_data.glossary.terms;

      $.each(glinks, function(k, v) {
        var d = data[k];

        if (d) {  // as a sanity check
          var s = 'tc-'+ k;
          var $e = make_tooltip(s, d.term, d.defn);
          $t.append($e);

          $.each(v, function(i, link) {
            link.addClass('tt').attr('data-tooltip-content', '#' + s);
          });
        }
      });
    }
  }

  if (sizzle.app_data && sizzle.app_data.glossary &&
      sizzle.app_data.glossary.document) {
    add_glossary_tooltips();
  }




  function add_custom_tooltips() {
    if (!sizzle.app_data) {
      return;
    }

    var info_tips = sizzle.app_data.custom_data['info-tips'] || {};

    if ($.isEmptyObject(info_tips)) {
      return;
    }

    var tt_options = $.extend({contentAsHTML: true}, default_tt_options);

    $('.tc-info').each(function() {
      var $elem = $(this).prev();
      var classes = $elem.attr('class');
      var m = /\btci-([\S]+)/.exec(classes);

      if (m !== null) {
        var key = m[1];

        if (key in info_tips) {
          var v = info_tips[key];
          var tt = $elem.tooltipster(tt_options).tooltipster('content', v);
        }
      }
    });
  }

  add_custom_tooltips();

  setTimeout(activate_tooltips, 1000);


  // Clipboard copy for code blocks with captions

  $('.code-block-caption').each(function() {
    var $cap = $(this);
    var $btn = $('<span class="clip-copy"><span class="copied hidden">Copied!</span><i class="fa fa-clipboard" title="Copy contents"></i></span>');
    var $code = $cap.parent().find('.highlight');

    $cap.append($btn);
    $btn.find('.fa-clipboard').data('clip-text', $code.text());
  });

  var clipboard = new ClipboardJS('.code-block-caption .fa-clipboard', {
    'text': function(trigger) {
      return $(trigger).data('clip-text');
    }
  });

  clipboard.on('success', function(e) {
    var $copied = $(e.trigger).prev();

    $copied.removeClass('hidden');

    setTimeout(function() {$copied.addClass('hidden'); }, 1000);
  });

  if (sizzle.on_load) {
    sizzle.on_load.forEach(function(f) {
      f();
    });
  }
});
</script>
</body>
</html>