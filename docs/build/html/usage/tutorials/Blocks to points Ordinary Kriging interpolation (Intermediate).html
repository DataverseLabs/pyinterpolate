<!DOCTYPE html>
<html lang="en-gb">
<head>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">


<title>Pyinterpolate - Blocks to points Ordinary Kriging interpolation</title>

<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/4.7.0/css/font-awesome.css" integrity="sha256-NuCn4IvuZXdBaFKJOAcsU2Q3ZpwbdFisd5dux4jkQ5w=" crossorigin="anonymous"/>
<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@3.4.1/dist/css/bootstrap.min.css" integrity="sha256-bZLfwXAP04zRMK2BjiO8iu9pf4FbLqX6zitd+tIvLhE=" crossorigin="anonymous">
<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@3.4.1/dist/css/bootstrap-theme.min.css" integrity="sha256-8uHMIn1ru0GS5KO+zf7Zccf8Uw12IA5DrdEcmMuWLFM=" crossorigin="anonymous">
<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/tooltipster@4.2.8/dist/css/tooltipster.bundle.min.css" integrity="sha256-Qc4lCfqZWYaHF5hgEOFrYzSIX9Rrxk0NPHRac+08QeQ=" crossorigin="anonymous">
<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/tooltipster@4.2.8/dist/css/plugins/tooltipster/sideTip/themes/tooltipster-sideTip-light.min.css" integrity="sha256-Wa1I4jhSXeWd3N6RhfPlkqr1WlT+zS3Vh2YGCg0129E=" crossorigin="anonymous">
<link href="https://fonts.googleapis.com/css?family=Open+Sans|Source+Code+Pro|Source+Sans+Pro|Source+Serif+Pro|Roboto|Roboto+Mono" rel="stylesheet">
<link href="https://fonts.red-dove.com/iosevka-ss09-regular/webfont.css" rel="stylesheet">

    <link rel="stylesheet" href="../../_static/pygments.css" type="text/css" />
    <link rel="stylesheet" href="../../_static/css/sizzle.css" type="text/css" />
    <link rel="stylesheet" href="../../_static/pygments.css" type="text/css" />
    <link rel="stylesheet" href="../../_static/css/sizzle.css" type="text/css" />
    <link rel="stylesheet" href="../../_static/copybutton.css" type="text/css" />
<script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.6.0/jquery.min.js" integrity="sha512-894YE6QWD5I59HgZOGReFYm4dnWc1Qt5NtvYSaNcOP+u1T9qYdvdihz0PPSiiqn/+/3e7Jo4EaG7TubfWGUrMQ==" crossorigin="anonymous" referrerpolicy="no-referrer"></script>
<script src="https://cdn.jsdelivr.net/npm/bootstrap@3.4.1/dist/js/bootstrap.min.js" integrity="sha256-nuL8/2cJ5NDSSwnKD8VqreErSWHtnEP9E7AySL+1ev4=" crossorigin="anonymous"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/underscore.js/1.9.1/underscore-min.js" integrity="sha256-G7A4JrJjJlFqP0yamznwPjAApIKPkadeHfyIwiaa9e0=" crossorigin="anonymous"></script>
<script src="https://cdn.jsdelivr.net/npm/tooltipster@4.2.8/dist/js/tooltipster.bundle.min.js" integrity="sha256-v8akIv8SCqn5f3mbVB7vEWprIizxPh6oV0yhao/dbB4=" crossorigin="anonymous"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.4/clipboard.min.js" integrity="sha256-FiZwavyI2V6+EXO1U+xzLG3IKldpiTFf3153ea9zikQ=" crossorigin="anonymous"></script>
    <script>
      var DOCUMENTATION_OPTIONS = {
        URL_ROOT:    '',
        VERSION:     '0.3.2',
        COLLAPSE_INDEX: false,
        FILE_SUFFIX: '.html',
        LINK_SUFFIX: '.html',
        HAS_SOURCE:  false,
        SOURCELINK_SUFFIX: '.txt'
      };
      $(document).data('sizzle', {on_load: []});
    </script>
    <script src="../../_static/underscore.js"></script>
    <script src="../../_static/_sphinx_javascript_frameworks_compat.js"></script>
    <script src="../../_static/doctools.js"></script>
    <script src="../../_static/sphinx_highlight.js"></script>
    <script src="../../_static/clipboard.min.js"></script>
    <script src="../../_static/copybutton.js"></script>
    <script crossorigin="anonymous" integrity="sha256-Ae2Vz/4ePdIu6ZyI/5ZGsYnb+m0JlOmKPjt6XZ9JJkA=" src="https://cdnjs.cloudflare.com/ajax/libs/require.js/2.3.4/require.min.js"></script>
    <script>window.MathJax = {"tex": {"inlineMath": [["$", "$"], ["\\(", "\\)"]], "processEscapes": true}, "options": {"ignoreHtmlClass": "tex2jax_ignore|mathjax_ignore|document", "processHtmlClass": "tex2jax_process|mathjax_process|math|output_area"}}</script>
    <script defer="defer" src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js"></script>
    <script src="../../app-data.js"></script>
<link rel="index" title="Index" href="../../genindex.html" />
<link rel="search" title="Search" href="../../search.html" />
<link rel="next" title="Outliers and Their Influence on the Final Model" href="Outliers%20and%20Their%20Influence%20on%20the%20Final%20Model%20%28Intermediate%29.html" />
<link rel="prev" title="Semivariogram regularization" href="Semivariogram%20Regularization%20%28Intermediate%29.html" />

</head>
<body class="full-height test">
<noscript>
  <div>
    <div id="noscript-message">JavaScript is not enabled. It is needed for this website to work.</div>
  </div>
</noscript>
<div id="whole-page" class="container-fluid content full-height">
  <div id="header-row" class="row">
    <div id="header-container" class="col-md-12">
      <div id="hdr-left">
        <i class="fa fa-bars menu-toggle"></i>
        
<a href="../../index.html" class="text-logo">Pyinterpolate 0.3.2 documentation</a>

      </div>
      <div id="hdr-centre" class="text-center stretch">
        <h3 title="Blocks to points Ordinary Kriging interpolation">Blocks to points Ordinary Kriging interpolation</h3>
        <h6>Blocks to points Ordinary Kriging interpolation</h6>
      </div>
      <div id="hdr-search">
        
<div class="input-group" title="Enter something to search for and then either press Enter or click the magnifying glass">
  <input type="text" class="form-control search-query" placeholder="Search docs ...">
  <div class="input-group-addon">
    <i class="fa fa-search"></i>
  </div>
</div>
      </div>

      <div id="hdr-index">
        <a href="../../genindex.html" class="btn btn-default" title="Go to the index"><i class="fa fa-list"></i></a>
      </div>

      <div id="hdr-source">
        <a href="../../_sources/usage/tutorials/Blocks to points Ordinary Kriging interpolation (Intermediate).ipynb.txt" class="btn btn-default" title="See the source for this page"><i class="fa fa-code"></i></a>
      </div>

      <div id="hdr-right">
        
  
  <div class="prev-next">
    
      <div class="pull-left">
        <a class="btn btn-default prev" href="Semivariogram%20Regularization%20%28Intermediate%29.html" title="Previous chapter (Semivariogram regularization)"><i class="fa fa-chevron-left mr-1em" aria-hidden="true"></i><span class="btn-text">Semivariogram regularization</span></a>
      </div>
    
      <div class="pull-right">
        <a class="btn btn-default next" href="Outliers%20and%20Their%20Influence%20on%20the%20Final%20Model%20%28Intermediate%29.html" title="Next chapter (Outliers and Their Influence on the Final Model)"><span class="btn-text">Outliers and Their Influence on the Final Model</span>&nbsp;<i class="fa fa-chevron-right ml-1em" aria-hidden="true"></i></a>
      </div>
    </div>
  
      </div>
      <div id="alt-hdr-right">

        <a href="Semivariogram%20Regularization%20%28Intermediate%29.html"><i class="fa fa-chevron-left mr-8"></i></a>


        <a href="../../index.html"><i class="fa fa-home mr-8"></i></a>


        <a href="../../search.html"><i class="fa fa-search mr-8"></i></a>


        <a href="../../genindex.html"><i class="fa fa-list mr-8"></i></a>


        <a href="Outliers%20and%20Their%20Influence%20on%20the%20Final%20Model%20%28Intermediate%29.html"><i class="fa fa-chevron-right"></i></a>

      </div>
    </div>
  </div>

  <div id="content-row" class="row">
    <div id="page-content" class="col-md-12 flex-col">
      <div id="content-container">
        <div id="nav">
          
  <div class="navsidebar">
    <div id="sidebar-search">
      
<div class="input-group" title="Enter something to search for and then either press Enter or click the magnifying glass">
  <input type="text" class="form-control search-query" placeholder="Search docs ...">
  <div class="input-group-addon">
    <i class="fa fa-search"></i>
  </div>
</div>
    </div>
      <div class="sidebar-block">
        <div class="sidebar-tocheading">
          <div class="pull-left">
            <h2>Table Of Contents</h2>
          </div>
          <div class="pull-right" title="Hide this sidebar (hover at left edge to bring it back)"><i class="fa fa-chevron-left hidetoc"></i></div>
        </div>
        <div class="sidebar-toc">
      
          <div id="toc-filter" title="Type in here to show only matching topics">
            <input class="form-control" id="toc-filter-query" placeholder="Filter by title ...">
          </div>
      
        
  
    <ul class="current">
<li class="toctree-l1"><a class="reference internal" href="../../setup/setup.html#setup">Setup</a></li>
<li class="toctree-l1"><a class="reference internal" href="../quickstart.html">Quickstart</a></li>
<li class="toctree-l1 current"><a class="reference internal" href="../tutorials.html">Tutorials</a><ul class="current">
<li class="toctree-l2"><a class="reference internal" href="../tutorials.html#beginner">Beginner</a></li>
<li class="toctree-l2 current"><a class="reference internal" href="../tutorials.html#intermediate">Intermediate</a><ul class="current">
<li class="toctree-l3"><a class="reference internal" href="Semivariogram%20Regularization%20%28Intermediate%29.html">Semivariogram regularization</a></li>
<li class="toctree-l3 current"><a class="current reference internal" href="#Blocks-to-points-Ordinary-Kriging-interpolation">Blocks to points Ordinary Kriging interpolation</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#Table-of-Contents:">Table of Contents:</a></li>
<li class="toctree-l4"><a class="reference internal" href="#Level:-Intermediate">Level: Intermediate</a></li>
<li class="toctree-l4"><a class="reference internal" href="#Changelog">Changelog</a></li>
<li class="toctree-l4"><a class="reference internal" href="#Introduction">Introduction</a></li>
<li class="toctree-l4"><a class="reference internal" href="#Import-packages">Import packages</a></li>
<li class="toctree-l4"><a class="reference internal" href="#1)-Read-areal-data">1) Read areal data</a></li>
<li class="toctree-l4"><a class="reference internal" href="#2)-Detect-and-remove-outliers">2) Detect and remove outliers</a></li>
<li class="toctree-l4"><a class="reference internal" href="#3.-Create-a-theoretical-semivariogram-model">3. Create a theoretical semivariogram model</a></li>
<li class="toctree-l4"><a class="reference internal" href="#4.-Read-point-data-canvas">4. Read point data canvas</a></li>
<li class="toctree-l4"><a class="reference internal" href="#5.-Build-a-map-of-interpolated-values">5. Build a map of interpolated values</a></li>
<li class="toctree-l4"><a class="reference internal" href="#6.-Show-a-map-of-interpolated-values-with-a-choropleth-map-of-the-breast-cancer-rates">6. Show a map of interpolated values with a choropleth map of the breast cancer rates</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="Outliers%20and%20Their%20Influence%20on%20the%20Final%20Model%20%28Intermediate%29.html">Outliers and Their Influence on the Final Model</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../tutorials.html#advanced">Advanced</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../../science/cite.html#how-to-cite">How to cite</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../api/api.html#api">API</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../developer/dev.html#development">Development</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../community/community.html#community">Community</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../science/biblio.html#bibliography">Bibliography</a></li>
</ul>

  
        </div>
      </div>
  </div>
        </div>
        <div id="content" tabindex="0" class="stretch">
          <div id="mnav">
            
  
    <ul class="current">
<li class="toctree-l1"><a class="reference internal" href="../../setup/setup.html#setup">Setup</a></li>
<li class="toctree-l1"><a class="reference internal" href="../quickstart.html">Quickstart</a></li>
<li class="toctree-l1 current"><a class="reference internal" href="../tutorials.html">Tutorials</a><ul class="current">
<li class="toctree-l2"><a class="reference internal" href="../tutorials.html#beginner">Beginner</a></li>
<li class="toctree-l2 current"><a class="reference internal" href="../tutorials.html#intermediate">Intermediate</a><ul class="current">
<li class="toctree-l3"><a class="reference internal" href="Semivariogram%20Regularization%20%28Intermediate%29.html">Semivariogram regularization</a></li>
<li class="toctree-l3 current"><a class="current reference internal" href="#Blocks-to-points-Ordinary-Kriging-interpolation">Blocks to points Ordinary Kriging interpolation</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#Table-of-Contents:">Table of Contents:</a></li>
<li class="toctree-l4"><a class="reference internal" href="#Level:-Intermediate">Level: Intermediate</a></li>
<li class="toctree-l4"><a class="reference internal" href="#Changelog">Changelog</a></li>
<li class="toctree-l4"><a class="reference internal" href="#Introduction">Introduction</a></li>
<li class="toctree-l4"><a class="reference internal" href="#Import-packages">Import packages</a></li>
<li class="toctree-l4"><a class="reference internal" href="#1)-Read-areal-data">1) Read areal data</a></li>
<li class="toctree-l4"><a class="reference internal" href="#2)-Detect-and-remove-outliers">2) Detect and remove outliers</a></li>
<li class="toctree-l4"><a class="reference internal" href="#3.-Create-a-theoretical-semivariogram-model">3. Create a theoretical semivariogram model</a></li>
<li class="toctree-l4"><a class="reference internal" href="#4.-Read-point-data-canvas">4. Read point data canvas</a></li>
<li class="toctree-l4"><a class="reference internal" href="#5.-Build-a-map-of-interpolated-values">5. Build a map of interpolated values</a></li>
<li class="toctree-l4"><a class="reference internal" href="#6.-Show-a-map-of-interpolated-values-with-a-choropleth-map-of-the-breast-cancer-rates">6. Show a map of interpolated values with a choropleth map of the breast cancer rates</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="Outliers%20and%20Their%20Influence%20on%20the%20Final%20Model%20%28Intermediate%29.html">Outliers and Their Influence on the Final Model</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../tutorials.html#advanced">Advanced</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../../science/cite.html#how-to-cite">How to cite</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../api/api.html#api">API</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../developer/dev.html#development">Development</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../community/community.html#community">Community</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../science/biblio.html#bibliography">Bibliography</a></li>
</ul>

  
          </div>
          <div class="body">
            
  
<style>
/* CSS for nbsphinx extension */

/* remove conflicting styling from Sphinx themes */
div.nbinput.container div.prompt *,
div.nboutput.container div.prompt *,
div.nbinput.container div.input_area pre,
div.nboutput.container div.output_area pre,
div.nbinput.container div.input_area .highlight,
div.nboutput.container div.output_area .highlight {
    border: none;
    padding: 0;
    margin: 0;
    box-shadow: none;
}

div.nbinput.container > div[class*=highlight],
div.nboutput.container > div[class*=highlight] {
    margin: 0;
}

div.nbinput.container div.prompt *,
div.nboutput.container div.prompt * {
    background: none;
}

div.nboutput.container div.output_area .highlight,
div.nboutput.container div.output_area pre {
    background: unset;
}

div.nboutput.container div.output_area div.highlight {
    color: unset;  /* override Pygments text color */
}

/* avoid gaps between output lines */
div.nboutput.container div[class*=highlight] pre {
    line-height: normal;
}

/* input/output containers */
div.nbinput.container,
div.nboutput.container {
    display: -webkit-flex;
    display: flex;
    align-items: flex-start;
    margin: 0;
    width: 100%;
}
@media (max-width: 540px) {
    div.nbinput.container,
    div.nboutput.container {
        flex-direction: column;
    }
}

/* input container */
div.nbinput.container {
    padding-top: 5px;
}

/* last container */
div.nblast.container {
    padding-bottom: 5px;
}

/* input prompt */
div.nbinput.container div.prompt pre {
    color: #307FC1;
}

/* output prompt */
div.nboutput.container div.prompt pre {
    color: #BF5B3D;
}

/* all prompts */
div.nbinput.container div.prompt,
div.nboutput.container div.prompt {
    width: 4.5ex;
    padding-top: 5px;
    position: relative;
    user-select: none;
}

div.nbinput.container div.prompt > div,
div.nboutput.container div.prompt > div {
    position: absolute;
    right: 0;
    margin-right: 0.3ex;
}

@media (max-width: 540px) {
    div.nbinput.container div.prompt,
    div.nboutput.container div.prompt {
        width: unset;
        text-align: left;
        padding: 0.4em;
    }
    div.nboutput.container div.prompt.empty {
        padding: 0;
    }

    div.nbinput.container div.prompt > div,
    div.nboutput.container div.prompt > div {
        position: unset;
    }
}

/* disable scrollbars on prompts */
div.nbinput.container div.prompt pre,
div.nboutput.container div.prompt pre {
    overflow: hidden;
}

/* input/output area */
div.nbinput.container div.input_area,
div.nboutput.container div.output_area {
    -webkit-flex: 1;
    flex: 1;
    overflow: auto;
}
@media (max-width: 540px) {
    div.nbinput.container div.input_area,
    div.nboutput.container div.output_area {
        width: 100%;
    }
}

/* input area */
div.nbinput.container div.input_area {
    border: 1px solid #e0e0e0;
    border-radius: 2px;
    /*background: #f5f5f5;*/
}

/* override MathJax center alignment in output cells */
div.nboutput.container div[class*=MathJax] {
    text-align: left !important;
}

/* override sphinx.ext.imgmath center alignment in output cells */
div.nboutput.container div.math p {
    text-align: left;
}

/* standard error */
div.nboutput.container div.output_area.stderr {
    background: #fdd;
}

/* ANSI colors */
.ansi-black-fg { color: #3E424D; }
.ansi-black-bg { background-color: #3E424D; }
.ansi-black-intense-fg { color: #282C36; }
.ansi-black-intense-bg { background-color: #282C36; }
.ansi-red-fg { color: #E75C58; }
.ansi-red-bg { background-color: #E75C58; }
.ansi-red-intense-fg { color: #B22B31; }
.ansi-red-intense-bg { background-color: #B22B31; }
.ansi-green-fg { color: #00A250; }
.ansi-green-bg { background-color: #00A250; }
.ansi-green-intense-fg { color: #007427; }
.ansi-green-intense-bg { background-color: #007427; }
.ansi-yellow-fg { color: #DDB62B; }
.ansi-yellow-bg { background-color: #DDB62B; }
.ansi-yellow-intense-fg { color: #B27D12; }
.ansi-yellow-intense-bg { background-color: #B27D12; }
.ansi-blue-fg { color: #208FFB; }
.ansi-blue-bg { background-color: #208FFB; }
.ansi-blue-intense-fg { color: #0065CA; }
.ansi-blue-intense-bg { background-color: #0065CA; }
.ansi-magenta-fg { color: #D160C4; }
.ansi-magenta-bg { background-color: #D160C4; }
.ansi-magenta-intense-fg { color: #A03196; }
.ansi-magenta-intense-bg { background-color: #A03196; }
.ansi-cyan-fg { color: #60C6C8; }
.ansi-cyan-bg { background-color: #60C6C8; }
.ansi-cyan-intense-fg { color: #258F8F; }
.ansi-cyan-intense-bg { background-color: #258F8F; }
.ansi-white-fg { color: #C5C1B4; }
.ansi-white-bg { background-color: #C5C1B4; }
.ansi-white-intense-fg { color: #A1A6B2; }
.ansi-white-intense-bg { background-color: #A1A6B2; }

.ansi-default-inverse-fg { color: #FFFFFF; }
.ansi-default-inverse-bg { background-color: #000000; }

.ansi-bold { font-weight: bold; }
.ansi-underline { text-decoration: underline; }


div.nbinput.container div.input_area div[class*=highlight] > pre,
div.nboutput.container div.output_area div[class*=highlight] > pre,
div.nboutput.container div.output_area div[class*=highlight].math,
div.nboutput.container div.output_area.rendered_html,
div.nboutput.container div.output_area > div.output_javascript,
div.nboutput.container div.output_area:not(.rendered_html) > img{
    padding: 5px;
    margin: 0;
}

/* fix copybtn overflow problem in chromium (needed for 'sphinx_copybutton') */
div.nbinput.container div.input_area > div[class^='highlight'],
div.nboutput.container div.output_area > div[class^='highlight']{
    overflow-y: hidden;
}

/* hide copybtn icon on prompts (needed for 'sphinx_copybutton') */
.prompt .copybtn {
    display: none;
}

/* Some additional styling taken form the Jupyter notebook CSS */
.jp-RenderedHTMLCommon table,
div.rendered_html table {
  border: none;
  border-collapse: collapse;
  border-spacing: 0;
  color: black;
  font-size: 12px;
  table-layout: fixed;
}
.jp-RenderedHTMLCommon thead,
div.rendered_html thead {
  border-bottom: 1px solid black;
  vertical-align: bottom;
}
.jp-RenderedHTMLCommon tr,
.jp-RenderedHTMLCommon th,
.jp-RenderedHTMLCommon td,
div.rendered_html tr,
div.rendered_html th,
div.rendered_html td {
  text-align: right;
  vertical-align: middle;
  padding: 0.5em 0.5em;
  line-height: normal;
  white-space: normal;
  max-width: none;
  border: none;
}
.jp-RenderedHTMLCommon th,
div.rendered_html th {
  font-weight: bold;
}
.jp-RenderedHTMLCommon tbody tr:nth-child(odd),
div.rendered_html tbody tr:nth-child(odd) {
  background: #f5f5f5;
}
.jp-RenderedHTMLCommon tbody tr:hover,
div.rendered_html tbody tr:hover {
  background: rgba(66, 165, 245, 0.2);
}
</style>
<div class="section" id="Blocks-to-points-Ordinary-Kriging-interpolation">
<h1>Blocks to points Ordinary Kriging interpolation<a class="headerlink" href="#Blocks-to-points-Ordinary-Kriging-interpolation" title="Permalink to this heading">¶</a></h1>
<div class="section" id="Table-of-Contents:">
<h2>Table of Contents:<a class="headerlink" href="#Table-of-Contents:" title="Permalink to this heading">¶</a></h2>
<ol class="arabic simple">
<li>Read block data,</li>
<li>Detect and remove outliers,</li>
<li>Create semivariogram model,</li>
<li>Read point data canvas,</li>
<li>Build map of interpolated values,</li>
<li>Show map of interpolated values with choropleth map of the breast cancer rates.</li>
</ol>
</div>
<div class="section" id="Level:-Intermediate">
<h2>Level: Intermediate<a class="headerlink" href="#Level:-Intermediate" title="Permalink to this heading">¶</a></h2>
</div>
<div class="section" id="Changelog">
<h2>Changelog<a class="headerlink" href="#Changelog" title="Permalink to this heading">¶</a></h2>
<table>
<colgroup>
<col width="12%" />
<col width="73%" />
<col width="16%" />
</colgroup>
<thead valign="bottom">
<tr class="row-odd"><th class="head">Date</th>
<th class="head">Change description</th>
<th class="head">Author</th>
</tr>
</thead>
<tbody valign="top">
<tr class="row-even"><td>2022-08-23</td>
<td>Tutorial updated for the 0.3.0 version of the package</td>
<td>&#64;SimonMolinsky</td>
</tr>
<tr class="row-odd"><td>2021-12-14</td>
<td>Sill selection was upgraded: now optimal sill is derived from the grid search within <code class="docutils literal notranslate"><span class="pre">TheoreticalSemivariogram</span></code> class</td>
<td>&#64;SimonMolinsky</td>
</tr>
<tr class="row-even"><td>2021-12-13</td>
<td>Changed behavior of <code class="docutils literal notranslate"><span class="pre">select_values_in_range()</span></code> function</td>
<td>&#64;SimonMolinsky</td>
</tr>
<tr class="row-odd"><td>2021-12-06</td>
<td>Behavior of <code class="docutils literal notranslate"><span class="pre">prepare_kriging_data()</span></code> function has changed</td>
<td>&#64;SimonMolinsky</td>
</tr>
<tr class="row-even"><td>2021-10-13</td>
<td>Refactored TheoreticalSemivariogram (name change of class attribute) and refactored <code class="docutils literal notranslate"><span class="pre">calc_semivariance_from_pt_cloud()</span></code> functions to protect calculations from <code class="docutils literal notranslate"><span class="pre">NaN's</span></code>.</td>
<td>&#64;ethmtrgt &amp; &#64;SimonMolinsky</td>
</tr>
<tr class="row-odd"><td>2021-05-11</td>
<td>Refactored TheoreticalSemivariogram class</td>
<td>&#64;SimonMolinsky</td>
</tr>
<tr class="row-even"><td>2021-03-31</td>
<td>Update related to the change of semivariogram weighting. Updated cancer rates data.</td>
<td>&#64;SimonMolinsky</td>
</tr>
</tbody>
</table>
</div>
<div class="section" id="Introduction">
<h2>Introduction<a class="headerlink" href="#Introduction" title="Permalink to this heading">¶</a></h2>
<p>This tutorial is based on the question of user <em>&#64;ikey</em> from <em>Discord</em> channel of the package (02/04/2021). Thank you <em>&#64;ikey</em> for your engagement!</p>
<p>In short:</p>
<blockquote>
<div>Are we able to perform Semivariogram Regularization and Poisson Kriging if our point support represents only points without any values?</div></blockquote>
<p><strong>No, it’s not possible</strong>. But there is a hack that we can use - we can interpolate missing values from areal centroids with Ordinary and Simple Kriging just like we do with <em>regular points</em>. Why is it not possible with unknown points?</p>
<p>The idea behind semivariogram regularization of areal aggregates is to use semivariogram of point support. Point support must reflect an ongoing process. For example, in the case of epidemiology:</p>
<ol class="arabic simple">
<li>We have areal counts of infections divided by POPULATION over some areas.</li>
<li>We take POPULATION blocks (points) with a number of inhabitants per block and use those as support for our map. Thus we transform the choropleth map into the point map, and only to the points where someone is living ==&gt; someone may be infected. We skip large parts of the map where the risk of infection is not present because no one is living there.</li>
<li>We finally obtain the population-at-risk map of points or smoothed choropleth map of infection risk without large visual bias where large/small areas seem to be more important.</li>
</ol>
<p>This works when we have specific <strong>counts over area divided by another parameter</strong> (time, population, probability, volume, etc.). In this scenario, we can find a function that links our areal counts with those underlying variables and/or processes. Without support values, we are not able to perform semivariogram regularization.</p>
<p>What we want to achieve may be done with Ordinary Kriging (because our points are unknown), and semivariogram regularization is not required (and not possible without any values).</p>
<p>In summary, we will learn how to:</p>
<ul class="simple">
<li>transform areal data into points,</li>
<li>detect and remove outliers from data,</li>
<li>create an interpolated map from unknown points,</li>
<li>visualize and save the created map.</li>
</ul>
<p>We use:</p>
<ul class="simple">
<li>for point canvas: <code class="docutils literal notranslate"><span class="pre">samples/point_data/shapefile/regular_grid_points.shp</span></code>,</li>
<li>for areal centroids: Breast cancer rates data is stored in the shapefile <code class="docutils literal notranslate"><span class="pre">samples/regularization/cancer_data.gpkg</span></code>.</li>
</ul>
<p>This tutorial requires understanding concepts presented in <strong>Semivariogram Estimation</strong> and <strong>Variogram Point Cloud</strong> tutorials along with <strong>Ordinary and Simple Kriging</strong> notebook and (optionally) <strong>Semivariogram Regularization</strong> tutorial.</p>
</div>
<div class="section" id="Import-packages">
<h2>Import packages<a class="headerlink" href="#Import-packages" title="Permalink to this heading">¶</a></h2>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[1]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>
<span class="kn">import</span> <span class="nn">geopandas</span> <span class="k">as</span> <span class="nn">gpd</span>

<span class="kn">import</span> <span class="nn">matplotlib.pyplot</span> <span class="k">as</span> <span class="nn">plt</span>

<span class="kn">from</span> <span class="nn">pyinterpolate</span> <span class="kn">import</span> <span class="n">Blocks</span><span class="p">,</span> <span class="n">VariogramCloud</span><span class="p">,</span> <span class="n">TheoreticalVariogram</span><span class="p">,</span> <span class="n">kriging</span>
</pre></div>
</div>
</div>
</div>
<div class="section" id="1)-Read-areal-data">
<h2>1) Read areal data<a class="headerlink" href="#1)-Read-areal-data" title="Permalink to this heading">¶</a></h2>
<p>The block data represents the breast cancer rates in the Northeastern part of the United States. Rate is the number of new cases divided by the population in a county, and this fraction is multiplied by a constant factor of 100,000.</p>
<p>We read data from <code class="docutils literal notranslate"><span class="pre">geopackage</span></code> and use only <code class="docutils literal notranslate"><span class="pre">rate</span></code>, <code class="docutils literal notranslate"><span class="pre">centroid.x</span></code>, and <code class="docutils literal notranslate"><span class="pre">centroid.y</span></code> columns.</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[2]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Read and prepare data</span>

<span class="n">DATASET</span> <span class="o">=</span> <span class="s1">&#39;samples/regularization/cancer_data.gpkg&#39;</span>
<span class="n">POLYGON_LAYER</span> <span class="o">=</span> <span class="s1">&#39;areas&#39;</span>
<span class="n">GEOMETRY_COL</span> <span class="o">=</span> <span class="s1">&#39;geometry&#39;</span>
<span class="n">POLYGON_ID</span> <span class="o">=</span> <span class="s1">&#39;FIPS&#39;</span>
<span class="n">POLYGON_VALUE</span> <span class="o">=</span> <span class="s1">&#39;rate&#39;</span>
<span class="n">MAX_RANGE</span> <span class="o">=</span> <span class="mi">400000</span>
<span class="n">STEP_SIZE</span> <span class="o">=</span> <span class="mi">40000</span>

<span class="n">AREAL_INPUT</span> <span class="o">=</span> <span class="n">Blocks</span><span class="p">()</span>
<span class="n">AREAL_INPUT</span><span class="o">.</span><span class="n">from_file</span><span class="p">(</span><span class="n">DATASET</span><span class="p">,</span> <span class="n">value_col</span><span class="o">=</span><span class="n">POLYGON_VALUE</span><span class="p">,</span> <span class="n">index_col</span><span class="o">=</span><span class="n">POLYGON_ID</span><span class="p">,</span> <span class="n">layer_name</span><span class="o">=</span><span class="n">POLYGON_LAYER</span><span class="p">)</span>

<span class="n">AREAL_INPUT</span><span class="o">.</span><span class="n">data</span><span class="o">.</span><span class="n">head</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[2]:
</pre></div>
</div>
<div class="output_area rendered_html docutils container">
<div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>FIPS</th>
      <th>geometry</th>
      <th>rate</th>
      <th>centroid.x</th>
      <th>centroid.y</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>25019</td>
      <td>MULTIPOLYGON (((2115688.816 556471.240, 211569...</td>
      <td>192.2</td>
      <td>2.132630e+06</td>
      <td>557971.155949</td>
    </tr>
    <tr>
      <th>1</th>
      <td>36121</td>
      <td>POLYGON ((1419423.430 564830.379, 1419729.721 ...</td>
      <td>166.8</td>
      <td>1.442153e+06</td>
      <td>550673.935704</td>
    </tr>
    <tr>
      <th>2</th>
      <td>33001</td>
      <td>MULTIPOLYGON (((1937530.728 779787.978, 193751...</td>
      <td>157.4</td>
      <td>1.958207e+06</td>
      <td>766008.383446</td>
    </tr>
    <tr>
      <th>3</th>
      <td>25007</td>
      <td>MULTIPOLYGON (((2074073.532 539159.504, 207411...</td>
      <td>156.7</td>
      <td>2.082188e+06</td>
      <td>556830.822367</td>
    </tr>
    <tr>
      <th>4</th>
      <td>25001</td>
      <td>MULTIPOLYGON (((2095343.207 637424.961, 209528...</td>
      <td>155.3</td>
      <td>2.100747e+06</td>
      <td>600235.845891</td>
    </tr>
  </tbody>
</table>
</div></div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[3]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">areal_centroids</span> <span class="o">=</span> <span class="n">AREAL_INPUT</span><span class="o">.</span><span class="n">data</span><span class="p">[[</span><span class="s1">&#39;centroid.x&#39;</span><span class="p">,</span> <span class="s1">&#39;centroid.y&#39;</span><span class="p">,</span> <span class="s1">&#39;rate&#39;</span><span class="p">]]</span><span class="o">.</span><span class="n">values</span>
<span class="n">areal_centroids</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[3]:
</pre></div>
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
array([2.13262960e+06, 5.57971156e+05, 1.92200000e+02])
</pre></div></div>
</div>
</div>
<div class="section" id="2)-Detect-and-remove-outliers">
<h2>2) Detect and remove outliers<a class="headerlink" href="#2)-Detect-and-remove-outliers" title="Permalink to this heading">¶</a></h2>
<p>We check and clean data before the semivariogram fitting and the Ordinary Kriging interpolation. Variogram Point Cloud is the best way to analyze data and detect outliers. We inspect and compare different lags and step sizes and their respective point clouds. Then we will create multiple variograms and Kriging models.</p>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[4]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Create analysis parameters</span>

<span class="n">maximum_range</span> <span class="o">=</span> <span class="mi">300000</span>

<span class="n">number_of_lags</span> <span class="o">=</span> <span class="p">[</span><span class="mi">4</span><span class="p">,</span> <span class="mi">8</span><span class="p">,</span> <span class="mi">16</span><span class="p">]</span>
<span class="n">step_sizes</span> <span class="o">=</span> <span class="p">[</span><span class="n">maximum_range</span> <span class="o">/</span> <span class="n">x</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">number_of_lags</span><span class="p">]</span>

<span class="n">variogram_clouds</span> <span class="o">=</span> <span class="p">[]</span>

<span class="k">for</span> <span class="n">step_size</span> <span class="ow">in</span> <span class="n">step_sizes</span><span class="p">:</span>
    <span class="n">vc</span> <span class="o">=</span> <span class="n">VariogramCloud</span><span class="p">(</span><span class="n">input_array</span><span class="o">=</span><span class="n">areal_centroids</span><span class="p">,</span> <span class="n">step_size</span><span class="o">=</span><span class="n">step_size</span><span class="p">,</span> <span class="n">max_range</span><span class="o">=</span><span class="n">maximum_range</span><span class="o">+</span><span class="n">step_size</span><span class="p">)</span>
    <span class="n">variogram_clouds</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">vc</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[5]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="k">for</span> <span class="n">vc</span> <span class="ow">in</span> <span class="n">variogram_clouds</span><span class="p">:</span>
    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;Lags per area: </span><span class="si">{</span><span class="nb">len</span><span class="p">(</span><span class="n">vc</span><span class="o">.</span><span class="n">lags</span><span class="p">)</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">)</span>
    <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;&#39;</span><span class="p">)</span>
    <span class="n">vc</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="s1">&#39;violin&#39;</span><span class="p">)</span>
    <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;</span><span class="se">\n</span><span class="s1">###########</span><span class="se">\n</span><span class="s1">&#39;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
Lags per area: 4

</pre></div></div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="../../_images/usage_tutorials_Blocks_to_points_Ordinary_Kriging_interpolation_(Intermediate)_8_1.png" src="../../_images/usage_tutorials_Blocks_to_points_Ordinary_Kriging_interpolation_(Intermediate)_8_1.png" />
</div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>

###########

Lags per area: 8

</pre></div></div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="../../_images/usage_tutorials_Blocks_to_points_Ordinary_Kriging_interpolation_(Intermediate)_8_3.png" src="../../_images/usage_tutorials_Blocks_to_points_Ordinary_Kriging_interpolation_(Intermediate)_8_3.png" />
</div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>

###########

Lags per area: 16

</pre></div></div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="../../_images/usage_tutorials_Blocks_to_points_Ordinary_Kriging_interpolation_(Intermediate)_8_5.png" src="../../_images/usage_tutorials_Blocks_to_points_Ordinary_Kriging_interpolation_(Intermediate)_8_5.png" />
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>

###########

</pre></div></div>
</div>
<p>What does a fast check tell us?</p>
<ul class="simple">
<li>point to point errors per lag are skewed toward positive values (the mean is always greater than the median),</li>
<li>less lags == less variability,</li>
<li>variability in the last case (32 lags) seems to be too high,</li>
<li>variability in the first case (4 lags) seems to be too small,</li>
<li>there are extreme semivariance values, and the largest extremities are present for the most distant lags.</li>
</ul>
<p>What can we do?</p>
<ul class="simple">
<li>remove outliers (extremely high semivariances) per each lag,</li>
<li>use a small number of neighbors and a range close to 200,000 to avoid unnecessary computations.</li>
</ul>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[6]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Now remove outliers from each lag</span>

<span class="n">_</span> <span class="o">=</span> <span class="p">[</span><span class="n">vc</span><span class="o">.</span><span class="n">remove_outliers</span><span class="p">(</span><span class="n">method</span><span class="o">=</span><span class="s1">&#39;iqr&#39;</span><span class="p">,</span> <span class="n">iqr_lower_limit</span><span class="o">=</span><span class="mi">3</span><span class="p">,</span> <span class="n">iqr_upper_limit</span><span class="o">=</span><span class="mf">1.5</span><span class="p">,</span> <span class="n">inplace</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span> <span class="k">for</span> <span class="n">vc</span> <span class="ow">in</span> <span class="n">variogram_clouds</span><span class="p">]</span>
</pre></div>
</div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[7]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># And show data without outliers</span>

<span class="k">for</span> <span class="n">vc</span> <span class="ow">in</span> <span class="n">variogram_clouds</span><span class="p">:</span>
    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;Lags per area: </span><span class="si">{</span><span class="nb">len</span><span class="p">(</span><span class="n">vc</span><span class="o">.</span><span class="n">lags</span><span class="p">)</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">)</span>
    <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;&#39;</span><span class="p">)</span>
    <span class="n">vc</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="s1">&#39;violin&#39;</span><span class="p">)</span>
    <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;</span><span class="se">\n</span><span class="s1">###########</span><span class="se">\n</span><span class="s1">&#39;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
Lags per area: 4

</pre></div></div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="../../_images/usage_tutorials_Blocks_to_points_Ordinary_Kriging_interpolation_(Intermediate)_11_1.png" src="../../_images/usage_tutorials_Blocks_to_points_Ordinary_Kriging_interpolation_(Intermediate)_11_1.png" />
</div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>

###########

Lags per area: 8

</pre></div></div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="../../_images/usage_tutorials_Blocks_to_points_Ordinary_Kriging_interpolation_(Intermediate)_11_3.png" src="../../_images/usage_tutorials_Blocks_to_points_Ordinary_Kriging_interpolation_(Intermediate)_11_3.png" />
</div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>

###########

Lags per area: 16

</pre></div></div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="../../_images/usage_tutorials_Blocks_to_points_Ordinary_Kriging_interpolation_(Intermediate)_11_5.png" src="../../_images/usage_tutorials_Blocks_to_points_Ordinary_Kriging_interpolation_(Intermediate)_11_5.png" />
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>

###########

</pre></div></div>
</div>
<p>If we compare the <strong>y axis</strong> before and after removing outliers, we may see that values are now smaller and densely populated. After outlier removal, we see also that 32 lags are too much, and especially for the first lag, it generates too much noise. We can expect that model based on this division will work poorly.</p>
</div>
<div class="section" id="3.-Create-a-theoretical-semivariogram-model">
<h2>3. Create a theoretical semivariogram model<a class="headerlink" href="#3.-Create-a-theoretical-semivariogram-model" title="Permalink to this heading">¶</a></h2>
<p>Semivariogram may be fitted manually or automatically. In this case, we fit it automatically - we test multiple models, and it’s easier to use the <code class="docutils literal notranslate"><span class="pre">autofit()</span></code> method of the <code class="docutils literal notranslate"><span class="pre">TheoreticalVariogram</span></code> object. We didn’t force any model to see how different results we would get.</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[8]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">theoretical_semivariograms</span> <span class="o">=</span> <span class="p">[]</span>

<span class="k">for</span> <span class="n">idx</span><span class="p">,</span> <span class="n">vc</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">variogram_clouds</span><span class="p">):</span>

    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;Semivariance calculated for </span><span class="si">{</span><span class="n">vc</span><span class="o">.</span><span class="n">lags</span><span class="si">}</span><span class="s1"> lags.&#39;</span><span class="p">)</span>
    <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;&#39;</span><span class="p">)</span>
    <span class="c1"># Calculate experimental model</span>
    <span class="n">exp_model</span> <span class="o">=</span> <span class="n">vc</span><span class="o">.</span><span class="n">calculate_experimental_variogram</span><span class="p">()</span>

    <span class="c1"># Assign experimental model and data to TheoreticalSemivariogram</span>

    <span class="n">theo_semi</span> <span class="o">=</span> <span class="n">TheoreticalVariogram</span><span class="p">()</span>
    <span class="n">theo_semi</span><span class="o">.</span><span class="n">autofit</span><span class="p">(</span><span class="n">experimental_variogram</span><span class="o">=</span><span class="n">exp_model</span><span class="p">)</span>
    <span class="n">theoretical_semivariograms</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">theo_semi</span><span class="p">)</span>
    <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;&#39;</span><span class="p">)</span>
    <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Model parameters:&#39;</span><span class="p">)</span>
    <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Model type:&#39;</span><span class="p">,</span> <span class="n">theo_semi</span><span class="o">.</span><span class="n">name</span><span class="p">)</span>
    <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Nugget:&#39;</span><span class="p">,</span> <span class="n">theo_semi</span><span class="o">.</span><span class="n">nugget</span><span class="p">)</span>
    <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Sill:&#39;</span><span class="p">,</span> <span class="n">theo_semi</span><span class="o">.</span><span class="n">sill</span><span class="p">)</span>
    <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Range:&#39;</span><span class="p">,</span> <span class="n">theo_semi</span><span class="o">.</span><span class="n">rang</span><span class="p">)</span>
    <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Model error:&#39;</span><span class="p">,</span> <span class="n">theo_semi</span><span class="o">.</span><span class="n">rmse</span><span class="p">)</span>
    <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;&#39;</span><span class="p">)</span>
    <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;#####&#39;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
Semivariance calculated for [ 75000. 150000. 225000. 300000.] lags.


Model parameters:
Model type: circular
Nugget: 0
Sill: 104.18060667237297
Range: 102380.95238095238
Model error: 7.416168111798283

#####
Semivariance calculated for [ 37500.  75000. 112500. 150000. 187500. 225000. 262500. 300000.] lags.


Model parameters:
Model type: exponential
Nugget: 0
Sill: 111.82982174537467
Range: 37619.04761904762
Model error: 6.604433069510002

#####
Semivariance calculated for [ 18750.  37500.  56250.  75000.  93750. 112500. 131250. 150000. 168750.
 187500. 206250. 225000. 243750. 262500. 281250. 300000.] lags.


Model parameters:
Model type: cubic
Nugget: 0
Sill: 107.66421388064023
Range: 30000.0
Model error: 19.320002753214663

#####
</pre></div></div>
</div>
<p>Each case has a different model type, a different sill, and a different range! How do we choose the model parameters appropriately in this scenario? Error rises with the number of lags but is it a good indicator of the semivariogram fit? No, and we should be careful when choosing variograms with a few lags instead of variograms with multiple lags. We may miss some spatial patterns that will be averaged with a smaller number of lags. The 8-lag variogram seems to be the best because RMSE is the
lowest. On the other hand, 32-lags variograms work poorly!</p>
</div>
<div class="section" id="4.-Read-point-data-canvas">
<h2>4. Read point data canvas<a class="headerlink" href="#4.-Read-point-data-canvas" title="Permalink to this heading">¶</a></h2>
<p>Our variogram model is ready to load the point file as the <strong>GeoDataFrame</strong> object, which stores the geometry column and data features as tables.</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[9]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">points</span> <span class="o">=</span> <span class="s1">&#39;samples/point_data/shapefile/regular_grid_points.shp&#39;</span>  <span class="c1"># file with grid for analysis</span>
<span class="n">gdf_pts</span> <span class="o">=</span> <span class="n">gpd</span><span class="o">.</span><span class="n">read_file</span><span class="p">(</span><span class="n">points</span><span class="p">)</span>
<span class="n">gdf_pts</span><span class="o">.</span><span class="n">set_index</span><span class="p">(</span><span class="s1">&#39;id&#39;</span><span class="p">,</span> <span class="n">inplace</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
<span class="n">gdf_pts</span><span class="p">[</span><span class="s1">&#39;x&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">gdf_pts</span><span class="o">.</span><span class="n">geometry</span><span class="o">.</span><span class="n">x</span>
<span class="n">gdf_pts</span><span class="p">[</span><span class="s1">&#39;y&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">gdf_pts</span><span class="o">.</span><span class="n">geometry</span><span class="o">.</span><span class="n">y</span>
<span class="n">gdf_pts</span><span class="o">.</span><span class="n">head</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[9]:
</pre></div>
</div>
<div class="output_area rendered_html docutils container">
<div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>geometry</th>
      <th>x</th>
      <th>y</th>
    </tr>
    <tr>
      <th>id</th>
      <th></th>
      <th></th>
      <th></th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>81.0</th>
      <td>POINT (1277277.671 441124.507)</td>
      <td>1.277278e+06</td>
      <td>441124.5068</td>
    </tr>
    <tr>
      <th>82.0</th>
      <td>POINT (1277277.671 431124.507)</td>
      <td>1.277278e+06</td>
      <td>431124.5068</td>
    </tr>
    <tr>
      <th>83.0</th>
      <td>POINT (1277277.671 421124.507)</td>
      <td>1.277278e+06</td>
      <td>421124.5068</td>
    </tr>
    <tr>
      <th>84.0</th>
      <td>POINT (1277277.671 411124.507)</td>
      <td>1.277278e+06</td>
      <td>411124.5068</td>
    </tr>
    <tr>
      <th>85.0</th>
      <td>POINT (1277277.671 401124.507)</td>
      <td>1.277278e+06</td>
      <td>401124.5068</td>
    </tr>
  </tbody>
</table>
</div></div>
</div>
</div>
<div class="section" id="5.-Build-a-map-of-interpolated-values">
<h2>5. Build a map of interpolated values<a class="headerlink" href="#5.-Build-a-map-of-interpolated-values" title="Permalink to this heading">¶</a></h2>
<p>We can model all values in a batch. If we set the <code class="docutils literal notranslate"><span class="pre">number_of_workers</span></code> parameter to <code class="docutils literal notranslate"><span class="pre">-1</span></code> or a positive integer, then the algorithm will use parallel processing functions to speed up calculations.</p>
<p>Based on the learning from a semivariogram modeling step, we will set a number of neighboring areas to 8 and range to 200000. We will append interpolated values and errors to an existing data frame and plot them to compare results.</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[10]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">preds_cols</span> <span class="o">=</span> <span class="p">[]</span>
<span class="n">errs_cols</span> <span class="o">=</span> <span class="p">[]</span>

<span class="k">for</span> <span class="n">semi_model</span> <span class="ow">in</span> <span class="n">theoretical_semivariograms</span><span class="p">:</span>
    <span class="n">kriged</span> <span class="o">=</span> <span class="n">kriging</span><span class="p">(</span><span class="n">observations</span><span class="o">=</span><span class="n">areal_centroids</span><span class="p">,</span>
                     <span class="n">theoretical_model</span><span class="o">=</span><span class="n">semi_model</span><span class="p">,</span>
                     <span class="n">points</span><span class="o">=</span><span class="n">gdf_pts</span><span class="p">[[</span><span class="s1">&#39;x&#39;</span><span class="p">,</span> <span class="s1">&#39;y&#39;</span><span class="p">]]</span><span class="o">.</span><span class="n">values</span><span class="p">,</span>
                     <span class="n">neighbors_range</span><span class="o">=</span><span class="mi">200000</span><span class="p">,</span>
                     <span class="n">no_neighbors</span><span class="o">=</span><span class="mi">8</span><span class="p">,</span>
                     <span class="n">number_of_workers</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span>
                     <span class="n">use_all_neighbors_in_range</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>

    <span class="c1"># Interpolate missing values and uncertainty</span>
    <span class="n">pred_col_name</span> <span class="o">=</span> <span class="s1">&#39;p &#39;</span> <span class="o">+</span> <span class="n">semi_model</span><span class="o">.</span><span class="n">name</span><span class="p">[:</span><span class="mi">3</span><span class="p">]</span> <span class="o">+</span> <span class="s1">&#39; &#39;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">semi_model</span><span class="o">.</span><span class="n">lags</span><span class="p">))</span>
    <span class="n">uncertainty_col_name</span> <span class="o">=</span> <span class="s1">&#39;e &#39;</span> <span class="o">+</span> <span class="n">semi_model</span><span class="o">.</span><span class="n">name</span><span class="p">[:</span><span class="mi">3</span><span class="p">]</span> <span class="o">+</span> <span class="s1">&#39; &#39;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">semi_model</span><span class="o">.</span><span class="n">lags</span><span class="p">))</span>
    <span class="n">gdf_pts</span><span class="p">[</span><span class="n">pred_col_name</span><span class="p">]</span> <span class="o">=</span> <span class="n">kriged</span><span class="p">[:,</span> <span class="mi">0</span><span class="p">]</span>
    <span class="n">gdf_pts</span><span class="p">[</span><span class="n">uncertainty_col_name</span><span class="p">]</span> <span class="o">=</span> <span class="n">kriged</span><span class="p">[:,</span> <span class="mi">1</span><span class="p">]</span>
    <span class="n">preds_cols</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">pred_col_name</span><span class="p">)</span>
    <span class="n">errs_cols</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">uncertainty_col_name</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area stderr docutils container">
<div class="highlight"><pre>
100%|█████████████████████████████████████| 5419/5419 [00:03&lt;00:00, 1441.76it/s]
100%|█████████████████████████████████████| 5419/5419 [00:03&lt;00:00, 1664.50it/s]
100%|█████████████████████████████████████| 5419/5419 [00:03&lt;00:00, 1383.55it/s]
</pre></div></div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[11]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">gdf_pts</span><span class="o">.</span><span class="n">head</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[11]:
</pre></div>
</div>
<div class="output_area rendered_html docutils container">
<div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>geometry</th>
      <th>x</th>
      <th>y</th>
      <th>p cir 4</th>
      <th>e cir 4</th>
      <th>p exp 8</th>
      <th>e exp 8</th>
      <th>p cub 16</th>
      <th>e cub 16</th>
    </tr>
    <tr>
      <th>id</th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>81.0</th>
      <td>POINT (1277277.671 441124.507)</td>
      <td>1.277278e+06</td>
      <td>441124.5068</td>
      <td>133.085189</td>
      <td>63.322684</td>
      <td>132.828256</td>
      <td>93.647290</td>
      <td>131.969565</td>
      <td>112.345267</td>
    </tr>
    <tr>
      <th>82.0</th>
      <td>POINT (1277277.671 431124.507)</td>
      <td>1.277278e+06</td>
      <td>431124.5068</td>
      <td>131.879395</td>
      <td>62.251709</td>
      <td>131.171342</td>
      <td>92.859017</td>
      <td>130.604348</td>
      <td>112.345267</td>
    </tr>
    <tr>
      <th>83.0</th>
      <td>POINT (1277277.671 421124.507)</td>
      <td>1.277278e+06</td>
      <td>421124.5068</td>
      <td>130.817630</td>
      <td>61.932193</td>
      <td>130.542053</td>
      <td>92.252755</td>
      <td>130.604348</td>
      <td>112.345267</td>
    </tr>
    <tr>
      <th>84.0</th>
      <td>POINT (1277277.671 411124.507)</td>
      <td>1.277278e+06</td>
      <td>411124.5068</td>
      <td>129.655109</td>
      <td>61.666624</td>
      <td>130.101171</td>
      <td>91.857396</td>
      <td>130.604348</td>
      <td>112.345267</td>
    </tr>
    <tr>
      <th>85.0</th>
      <td>POINT (1277277.671 401124.507)</td>
      <td>1.277278e+06</td>
      <td>401124.5068</td>
      <td>128.853456</td>
      <td>60.872324</td>
      <td>130.114977</td>
      <td>91.603116</td>
      <td>130.860000</td>
      <td>111.970782</td>
    </tr>
  </tbody>
</table>
</div></div>
</div>
<p>This is the somewhat complicated function in which we interpolate missing values as new columns of <strong>GeoDataFrame</strong>. <em>Uncertainty</em> is assigned to interpolated results for further analysis.</p>
<p>Now we can save our <strong>GeoDataFrame</strong> as a shapefile.</p>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[12]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Save interpolation results</span>

<span class="n">gdf_pts</span><span class="o">.</span><span class="n">to_file</span><span class="p">(</span><span class="s1">&#39;output/interpolation_results_areal_to_point.shp&#39;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<p>Now we will check the results directly in the notebook.</p>
</div>
<div class="section" id="6.-Show-a-map-of-interpolated-values-with-a-choropleth-map-of-the-breast-cancer-rates">
<h2>6. Show a map of interpolated values with a choropleth map of the breast cancer rates<a class="headerlink" href="#6.-Show-a-map-of-interpolated-values-with-a-choropleth-map-of-the-breast-cancer-rates" title="Permalink to this heading">¶</a></h2>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[13]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Now compare results to choropleth maps</span>
<span class="n">fig</span><span class="p">,</span> <span class="n">axes</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="n">nrows</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span> <span class="n">ncols</span><span class="o">=</span><span class="mi">3</span><span class="p">,</span> <span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">16</span><span class="p">,</span> <span class="mi">16</span><span class="p">),</span> <span class="n">sharex</span><span class="o">=</span><span class="s1">&#39;all&#39;</span><span class="p">,</span> <span class="n">sharey</span><span class="o">=</span><span class="s1">&#39;all&#39;</span><span class="p">)</span>

<span class="n">base1</span> <span class="o">=</span> <span class="n">AREAL_INPUT</span><span class="o">.</span><span class="n">data</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">ax</span><span class="o">=</span><span class="n">axes</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">],</span> <span class="n">legend</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">edgecolor</span><span class="o">=</span><span class="s1">&#39;black&#39;</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;white&#39;</span><span class="p">)</span>
<span class="n">base2</span> <span class="o">=</span> <span class="n">AREAL_INPUT</span><span class="o">.</span><span class="n">data</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">ax</span><span class="o">=</span><span class="n">axes</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">],</span> <span class="n">legend</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">edgecolor</span><span class="o">=</span><span class="s1">&#39;black&#39;</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;white&#39;</span><span class="p">)</span>
<span class="n">base3</span> <span class="o">=</span> <span class="n">AREAL_INPUT</span><span class="o">.</span><span class="n">data</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">ax</span><span class="o">=</span><span class="n">axes</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">2</span><span class="p">],</span> <span class="n">legend</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">edgecolor</span><span class="o">=</span><span class="s1">&#39;black&#39;</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;white&#39;</span><span class="p">)</span>
<span class="n">base4</span> <span class="o">=</span> <span class="n">AREAL_INPUT</span><span class="o">.</span><span class="n">data</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">ax</span><span class="o">=</span><span class="n">axes</span><span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">],</span> <span class="n">legend</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">edgecolor</span><span class="o">=</span><span class="s1">&#39;black&#39;</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;white&#39;</span><span class="p">)</span>
<span class="n">base5</span> <span class="o">=</span> <span class="n">AREAL_INPUT</span><span class="o">.</span><span class="n">data</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">ax</span><span class="o">=</span><span class="n">axes</span><span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">],</span> <span class="n">legend</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">edgecolor</span><span class="o">=</span><span class="s1">&#39;black&#39;</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;white&#39;</span><span class="p">)</span>
<span class="n">base6</span> <span class="o">=</span> <span class="n">AREAL_INPUT</span><span class="o">.</span><span class="n">data</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">ax</span><span class="o">=</span><span class="n">axes</span><span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">],</span> <span class="n">legend</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">edgecolor</span><span class="o">=</span><span class="s1">&#39;black&#39;</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;white&#39;</span><span class="p">)</span>

<span class="n">gdf_pts</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">ax</span><span class="o">=</span><span class="n">base1</span><span class="p">,</span> <span class="n">column</span><span class="o">=</span><span class="n">preds_cols</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">cmap</span><span class="o">=</span><span class="s1">&#39;Spectral_r&#39;</span><span class="p">,</span> <span class="n">alpha</span><span class="o">=</span><span class="mf">0.3</span><span class="p">)</span>
<span class="n">gdf_pts</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">ax</span><span class="o">=</span><span class="n">base2</span><span class="p">,</span> <span class="n">column</span><span class="o">=</span><span class="n">preds_cols</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">cmap</span><span class="o">=</span><span class="s1">&#39;Spectral_r&#39;</span><span class="p">,</span> <span class="n">alpha</span><span class="o">=</span><span class="mf">0.3</span><span class="p">)</span>
<span class="n">gdf_pts</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">ax</span><span class="o">=</span><span class="n">base3</span><span class="p">,</span> <span class="n">column</span><span class="o">=</span><span class="n">preds_cols</span><span class="p">[</span><span class="mi">2</span><span class="p">],</span> <span class="n">cmap</span><span class="o">=</span><span class="s1">&#39;Spectral_r&#39;</span><span class="p">,</span> <span class="n">alpha</span><span class="o">=</span><span class="mf">0.3</span><span class="p">)</span>
<span class="n">gdf_pts</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">ax</span><span class="o">=</span><span class="n">base4</span><span class="p">,</span> <span class="n">column</span><span class="o">=</span><span class="n">errs_cols</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">cmap</span><span class="o">=</span><span class="s1">&#39;Reds&#39;</span><span class="p">,</span> <span class="n">alpha</span><span class="o">=</span><span class="mf">0.3</span><span class="p">)</span>
<span class="n">gdf_pts</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">ax</span><span class="o">=</span><span class="n">base5</span><span class="p">,</span> <span class="n">column</span><span class="o">=</span><span class="n">errs_cols</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">cmap</span><span class="o">=</span><span class="s1">&#39;Reds&#39;</span><span class="p">,</span> <span class="n">alpha</span><span class="o">=</span><span class="mf">0.3</span><span class="p">)</span>
<span class="n">gdf_pts</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">ax</span><span class="o">=</span><span class="n">base6</span><span class="p">,</span> <span class="n">column</span><span class="o">=</span><span class="n">errs_cols</span><span class="p">[</span><span class="mi">2</span><span class="p">],</span> <span class="n">cmap</span><span class="o">=</span><span class="s1">&#39;Reds&#39;</span><span class="p">,</span> <span class="n">alpha</span><span class="o">=</span><span class="mf">0.3</span><span class="p">)</span>

<span class="n">axes</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="n">preds_cols</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
<span class="n">axes</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="n">preds_cols</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span>
<span class="n">axes</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">2</span><span class="p">]</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="n">preds_cols</span><span class="p">[</span><span class="mi">2</span><span class="p">])</span>
<span class="n">axes</span><span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="n">errs_cols</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
<span class="n">axes</span><span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="n">errs_cols</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span>
<span class="n">axes</span><span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">]</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="n">errs_cols</span><span class="p">[</span><span class="mi">2</span><span class="p">])</span>

<span class="n">plt</span><span class="o">.</span><span class="n">suptitle</span><span class="p">(</span><span class="s1">&#39;Comparison of different Kriging models outputs&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="../../_images/usage_tutorials_Blocks_to_points_Ordinary_Kriging_interpolation_(Intermediate)_25_0.png" src="../../_images/usage_tutorials_Blocks_to_points_Ordinary_Kriging_interpolation_(Intermediate)_25_0.png" />
</div>
</div>
<p>Visual inspection shows that:</p>
<blockquote>
<div>The circular model and the exponential model have created the smoothest results. An interesting pattern emerges on uncertainty maps. The variance errors are smoother on the first map (the circular model). The middle map produces a higher variance in output, but it still works as a filter. The last model doesn’t perform well, has too strict distance constraints, and the final outcome is not smooth. Sharply increasing variance errors on the uncertainty map of the cubic model tell us that maybe
we have chosen the wrong model - we are not able to retrieve meaningful information from it.</div></blockquote>
<p>Are absolute errors between maps large or not? Let’s check it in the last step:</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[14]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="k">for</span> <span class="n">pcol1</span> <span class="ow">in</span> <span class="n">preds_cols</span><span class="p">:</span>
    <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Column:&#39;</span><span class="p">,</span> <span class="n">pcol1</span><span class="p">)</span>
    <span class="k">for</span> <span class="n">pcol2</span> <span class="ow">in</span> <span class="n">preds_cols</span><span class="p">:</span>
        <span class="k">if</span> <span class="n">pcol1</span> <span class="o">==</span> <span class="n">pcol2</span><span class="p">:</span>
            <span class="k">pass</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">mad</span> <span class="o">=</span> <span class="n">gdf_pts</span><span class="p">[</span><span class="n">pcol1</span><span class="p">]</span> <span class="o">-</span> <span class="n">gdf_pts</span><span class="p">[</span><span class="n">pcol2</span><span class="p">]</span>
            <span class="n">mad</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">abs</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="n">mad</span><span class="p">))</span>
            <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;Mean Absolute Difference with </span><span class="si">{</span><span class="n">pcol2</span><span class="si">}</span><span class="s1"> is </span><span class="si">{</span><span class="n">mad</span><span class="si">:</span><span class="s1">.4f</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">)</span>
    <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;&#39;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
Column: p cir 4
Mean Absolute Difference with p exp 8 is 0.2259
Mean Absolute Difference with p cub 16 is 0.6819

Column: p exp 8
Mean Absolute Difference with p cir 4 is 0.2259
Mean Absolute Difference with p cub 16 is 0.4561

Column: p cub 16
Mean Absolute Difference with p cir 4 is 0.6819
Mean Absolute Difference with p exp 8 is 0.4561

</pre></div></div>
</div>
<p>That differences are tiny, so we shouldn’t throw away one model after another. Semivariogram models are comparable. I prefer the <strong>8-lag</strong> theoretical variogram with an exponential model, and it has the best bias-to-variance ratio and a low RMSE error.</p>
<hr class="docutils" />
</div>
</div>


          </div>
        </div>
      </div>
    </div>
  </div>
  <div id="footer-row" class="row">

    <div class="col-md-12">
        <span title="Built on 2022-10-10" class="pull-right">&copy; Copyright 2022, Szymon Moliński.
        Built with <a href="https://www.sphinx-doc.org/">Sphinx</a> 5.2.3 and the
        <a href="https://pypi.org/project/sphinx-sizzle-theme/"

           title="0.1.1/6a5828d9 [2022-05-03T16:20:16]"

        >Sizzle</a> theme.</span>
    </div>

  </div>
</div>

<div id="tooltips" class="hidden">
</div>

<script>
$(document).ready(function() {
  'use strict';
  var $search = $('.search-query');

  var $filter = $('#toc-filter-query');
  var $toclist = $('.sidebar-toc > ul').find('li');

  if ($toclist.length === 0) {
    $toclist = $('.localtoc > ul').find('li');
  }


  var $nav = $('#nav');

  //$('#whole-page').removeClass('hidden');
  var nav_width = $nav.width();


  var search_url = '../../search.html';

  function perform_search(e) {
    var $elem;

    if (e.type === 'keypress') {
      $elem = $(e.target);
    }
    else if (e.type === 'click') {
      $elem = $(e.target).parents('.input-group').find('input');
    }
    var q = $elem.val().trim();

    if (q) {
      var url = search_url + '?q=' + q + '&check_keywords=yes&area=default';

      location.href = url;
    }
  }


  function apply_filter() {
    var s = $filter.val().trim().toLowerCase();

    $toclist.find('a').removeClass('hidden');
    $toclist.each(function() {
      var $this = $(this);
      var $link = $this.find('> a');
      var t = $link.text().toLowerCase();
      var show = t.indexOf(s) >= 0;

      if (!show) {
        $link.addClass('hidden');
      }
    });
  }

  $filter.on('keyup', function(e) {
    apply_filter();
  });



  $search.on('keypress', function(e) {
    if (e.which == 13) {
      perform_search(e);
    }
  });
  $search.parents('.input-group').find('.input-group-addon').on('click', perform_search);
  $(document).on('click', '.summary .fa-caret-right', function(e) {
    var $elem = $(e.target).parents('li');
    var $next = $elem.next();
    $elem.addClass('hidden');
    $next.removeClass('hidden');
  });
  $(document).on('click', '.detail .fa-caret-down', function(e) {
    var $elem = $(e.target).parents('li');
    var $prev = $elem.prev();
    $elem.addClass('hidden');
    $prev.removeClass('hidden');
  });

  $('#content').on('click', function() {
    $('#mnav').hide();
  });

  var counter = 0;
  var timer = null;

  function show_nav() {
    $('#content').off('mousemove', track_mouse);
    if (timer !== null) {
      clearTimeout(timer);
      timer = null;
    }
    $nav.show();
  }

  function track_mouse(e) {
    var x = e.clientX;

    if (x < 15) {
      ++counter;
      if (timer === null) {
        timer = setTimeout(show_nav, 2000);
      }
    }
    else {
      counter = 0;
    }
    if (counter >= 20) {
      show_nav();
    }
  };

  function hide_nav() {
    $nav.hide();
    counter = 0;
    $('#content').on('mousemove', track_mouse);
  }

  $('.hidetoc').on('click', hide_nav);

  $(document).on('keyup', function(e) {
    if (e.ctrlKey) {
      if (e.which == 37) {      // Ctrl+left arrow
        hide_nav();
      }
      else if (e.which == 39) { // Ctrl+right arrow
        show_nav();
      }
    }
  });

  $('.menu-toggle').on('click', function(e) {
    $('#mnav').toggle();
  });

  function scroll_nav(frag) {
    var sel = '#nav ' + (frag ? 'a[href="' + frag + '"]' : '.toctree-l1 a.current');

    var $link = $(sel);

    if ($link.length > 0) {
      $link[0].scrollIntoView({block: 'center'});
    }
  }

  // If the navigator is long, then the item we clicked on to get here might
  // not be in view. Try to scroll it into the view - a slight delay is needed
  // to get it to sync properly with other stuff going on (as the page has just
  // loaded). Hence the setTimeout with a timeout of 0.

  function do_scroll() {
    scroll_nav(window.location.hash);
  }

  setTimeout(do_scroll, 0);

  function adjust_size() {
    // we need to set the height explicitly so that scrolling regions in the
    // content area work properly.
    var h = $('#page-content').height();

    $('#nav, #content').height(h);
    if ($('#nav').is(':visible')) {
      $('#mnav').hide();
    }
  }

  adjust_size();

  $(window).on('resize', adjust_size);

  function focus_content() {
    $('#content').focus();  // so that keyboard can be used to scroll, etc.
  }

  setTimeout(focus_content, 150);

  var sizzle = $(document).data('sizzle');

  function make_tooltip(id, h, b) {
    var $e = $('<div>').attr('id', id);
    var $b = $('<div>').addClass('tc-body').html(b);

    if (h) {
      var $h = $('<div>').addClass('tc-heading').html(h);
      $e.append($h);
    }
    $e.append($b);
    return $e;
  }

  var default_tt_options = {
    theme: ['tooltipster-light', 'tooltipster-light-customized'],
    interactive: true,
    maxWidth: 600,
    contentCloning: true
  };

  function activate_tooltips() {
    var $tt = $('.tt');

    //console.log('tt links:', $tt.length);
    $tt.tooltipster(default_tt_options);
  }



  function add_glossary_tooltips() {
    var links = $('a');  // can qualify with .reference.internal
    var glinks = {};
    var pat = /(.*)\.html#(term-.*)$/;
    var found = false;  // links in this document

    $.each(links, function(i, link) {
        var $link = $(link);
        var href = $link.attr('href');
        var m = href.match(pat);

        if (m) {
          var s = m[1].replace(/^(\.\.\/)+/, '');

          if (s === sizzle.app_data.glossary.document) {
            var k = m[2];

            if (k in glinks) {
              glinks[k].push($link);
            }
            else {
              glinks[k] = [$link];
            }
            found = true;
          }
        }
    });
    if (found) {
      var $t = $('#tooltips');
      var data = sizzle.app_data.glossary.terms;

      $.each(glinks, function(k, v) {
        var d = data[k];

        if (d) {  // as a sanity check
          var s = 'tc-'+ k;
          var $e = make_tooltip(s, d.term, d.defn);
          $t.append($e);

          $.each(v, function(i, link) {
            link.addClass('tt').attr('data-tooltip-content', '#' + s);
          });
        }
      });
    }
  }

  if (sizzle.app_data && sizzle.app_data.glossary &&
      sizzle.app_data.glossary.document) {
    add_glossary_tooltips();
  }




  function add_custom_tooltips() {
    if (!sizzle.app_data) {
      return;
    }

    var info_tips = sizzle.app_data.custom_data['info-tips'] || {};

    if ($.isEmptyObject(info_tips)) {
      return;
    }

    var tt_options = $.extend({contentAsHTML: true}, default_tt_options);

    $('.tc-info').each(function() {
      var $elem = $(this).prev();
      var classes = $elem.attr('class');
      var m = /\btci-([\S]+)/.exec(classes);

      if (m !== null) {
        var key = m[1];

        if (key in info_tips) {
          var v = info_tips[key];
          var tt = $elem.tooltipster(tt_options).tooltipster('content', v);
        }
      }
    });
  }

  add_custom_tooltips();

  setTimeout(activate_tooltips, 1000);


  // Clipboard copy for code blocks with captions

  $('.code-block-caption').each(function() {
    var $cap = $(this);
    var $btn = $('<span class="clip-copy"><span class="copied hidden">Copied!</span><i class="fa fa-clipboard" title="Copy contents"></i></span>');
    var $code = $cap.parent().find('.highlight');

    $cap.append($btn);
    $btn.find('.fa-clipboard').data('clip-text', $code.text());
  });

  var clipboard = new ClipboardJS('.code-block-caption .fa-clipboard', {
    'text': function(trigger) {
      return $(trigger).data('clip-text');
    }
  });

  clipboard.on('success', function(e) {
    var $copied = $(e.trigger).prev();

    $copied.removeClass('hidden');

    setTimeout(function() {$copied.addClass('hidden'); }, 1000);
  });

  if (sizzle.on_load) {
    sizzle.on_load.forEach(function(f) {
      f();
    });
  }
});
</script>
</body>
</html>