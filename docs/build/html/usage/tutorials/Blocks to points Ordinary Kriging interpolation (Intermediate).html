

<!DOCTYPE html>


<html lang="en" >

  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" /><meta name="generator" content="Docutils 0.19: https://docutils.sourceforge.io/" />

    <title>Blocks to points Ordinary Kriging interpolation &#8212; Pyinterpolate 0.4 documentation</title>
  
  
  
  <script data-cfasync="false">
    document.documentElement.dataset.mode = localStorage.getItem("mode") || "";
    document.documentElement.dataset.theme = localStorage.getItem("theme") || "light";
  </script>
  
  <!-- Loaded before other Sphinx assets -->
  <link href="../../_static/styles/theme.css?digest=e353d410970836974a52" rel="stylesheet" />
<link href="../../_static/styles/bootstrap.css?digest=e353d410970836974a52" rel="stylesheet" />
<link href="../../_static/styles/pydata-sphinx-theme.css?digest=e353d410970836974a52" rel="stylesheet" />

  
  <link href="../../_static/vendor/fontawesome/6.1.2/css/all.min.css?digest=e353d410970836974a52" rel="stylesheet" />
  <link rel="preload" as="font" type="font/woff2" crossorigin href="../../_static/vendor/fontawesome/6.1.2/webfonts/fa-solid-900.woff2" />
<link rel="preload" as="font" type="font/woff2" crossorigin href="../../_static/vendor/fontawesome/6.1.2/webfonts/fa-brands-400.woff2" />
<link rel="preload" as="font" type="font/woff2" crossorigin href="../../_static/vendor/fontawesome/6.1.2/webfonts/fa-regular-400.woff2" />

    <link rel="stylesheet" type="text/css" href="../../_static/pygments.css" />
    <link rel="stylesheet" type="text/css" href="../../_static/copybutton.css" />
    <link rel="stylesheet" type="text/css" href="../../_static/nbsphinx-code-cells.css" />
  
  <!-- Pre-loaded scripts that we'll load fully later -->
  <link rel="preload" as="script" href="../../_static/scripts/bootstrap.js?digest=e353d410970836974a52" />
<link rel="preload" as="script" href="../../_static/scripts/pydata-sphinx-theme.js?digest=e353d410970836974a52" />

    <script data-url_root="../../" id="documentation_options" src="../../_static/documentation_options.js"></script>
    <script src="../../_static/jquery.js"></script>
    <script src="../../_static/underscore.js"></script>
    <script src="../../_static/_sphinx_javascript_frameworks_compat.js"></script>
    <script src="../../_static/doctools.js"></script>
    <script src="../../_static/sphinx_highlight.js"></script>
    <script src="../../_static/clipboard.min.js"></script>
    <script src="../../_static/copybutton.js"></script>
    <script crossorigin="anonymous" integrity="sha256-Ae2Vz/4ePdIu6ZyI/5ZGsYnb+m0JlOmKPjt6XZ9JJkA=" src="https://cdnjs.cloudflare.com/ajax/libs/require.js/2.3.4/require.min.js"></script>
    <script>window.MathJax = {"tex": {"inlineMath": [["$", "$"], ["\\(", "\\)"]], "processEscapes": true}, "options": {"ignoreHtmlClass": "tex2jax_ignore|mathjax_ignore|document", "processHtmlClass": "tex2jax_process|mathjax_process|math|output_area"}}</script>
    <script defer="defer" src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js"></script>
    <script>DOCUMENTATION_OPTIONS.pagename = 'usage/tutorials/Blocks to points Ordinary Kriging interpolation (Intermediate)';</script>
    <link rel="index" title="Index" href="../../genindex.html" />
    <link rel="search" title="Search" href="../../search.html" />
    <link rel="next" title="Directional Ordinary Kriging" href="Directional%20Ordinary%20Kriging%20%28Intermediate%29.html" />
    <link rel="prev" title="Semivariogram regularization" href="Semivariogram%20Regularization%20%28Intermediate%29.html" />
  <meta name="viewport" content="width=device-width, initial-scale=1"/>
  <meta name="docsearch:language" content="en"/>
  </head>
  
  
  <body data-bs-spy="scroll" data-bs-target=".bd-toc-nav" data-offset="180" data-bs-root-margin="0px 0px -60%" data-default-mode="">

  
  
  <a class="skip-link" href="#main-content">Skip to main content</a>
  
  <input type="checkbox"
          class="sidebar-toggle"
          name="__primary"
          id="__primary"/>
  <label class="overlay overlay-primary" for="__primary"></label>
  
  <input type="checkbox"
          class="sidebar-toggle"
          name="__secondary"
          id="__secondary"/>
  <label class="overlay overlay-secondary" for="__secondary"></label>
  
  <div class="search-button__wrapper">
    <div class="search-button__overlay"></div>
    <div class="search-button__search-container">
<form class="bd-search d-flex align-items-center"
      action="../../search.html"
      method="get">
  <i class="fa-solid fa-magnifying-glass"></i>
  <input type="search"
         class="form-control"
         name="q"
         id="search-input"
         placeholder="Search the docs ..."
         aria-label="Search the docs ..."
         autocomplete="off"
         autocorrect="off"
         autocapitalize="off"
         spellcheck="false"/>
  <span class="search-button__kbd-shortcut"><kbd class="kbd-shortcut__modifier">Ctrl</kbd>+<kbd>K</kbd></span>
</form></div>
  </div>
  
    <nav class="bd-header navbar navbar-expand-lg bd-navbar">
<div class="bd-header__inner bd-page-width">
  <label class="sidebar-toggle primary-toggle" for="__primary">
    <span class="fa-solid fa-bars"></span>
  </label>
  
  <div class="navbar-header-items__start">
    
      <div class="navbar-item">
  

<a class="navbar-brand logo" href="../../index.html">
  
  
  
  
  
    <p class="title logo__title">Pyinterpolate 0.4 documentation</p>
  
</a></div>
    
  </div>
  
  
  <div class="col-lg-9 navbar-header-items">
    
    <div class="me-auto navbar-header-items__center">
      
        <div class="navbar-item"><nav class="navbar-nav">
  <p class="sidebar-header-items__title"
     role="heading"
     aria-level="1"
     aria-label="Site Navigation">
    Site Navigation
  </p>
  <ul class="bd-navbar-elements navbar-nav">
    
                    <li class="nav-item">
                      <a class="nav-link nav-internal" href="../../setup/setup.html">
                        Setup
                      </a>
                    </li>
                

                    <li class="nav-item">
                      <a class="nav-link nav-internal" href="../quickstart.html">
                        Quickstart
                      </a>
                    </li>
                

                    <li class="nav-item current active">
                      <a class="nav-link nav-internal" href="../tutorials.html">
                        Tutorials
                      </a>
                    </li>
                

                    <li class="nav-item">
                      <a class="nav-link nav-internal" href="../../science/cite.html">
                        How to cite
                      </a>
                    </li>
                

                    <li class="nav-item">
                      <a class="nav-link nav-internal" href="../../api/api.html">
                        API
                      </a>
                    </li>
                
            <div class="nav-item dropdown">
                <button class="btn dropdown-toggle nav-item" type="button" data-bs-toggle="dropdown" aria-haspopup="true" aria-expanded="false">
                    More
                </button>
                <div class="dropdown-menu">
                    
                    <li class="nav-item">
                      <a class="nav-link nav-internal" href="../../developer/dev.html">
                        Development
                      </a>
                    </li>
                

                    <li class="nav-item">
                      <a class="nav-link nav-internal" href="../../community/community.html">
                        Community
                      </a>
                    </li>
                

                    <li class="nav-item">
                      <a class="nav-link nav-internal" href="../learning_materials.html">
                        Learning Materials
                      </a>
                    </li>
                

                    <li class="nav-item">
                      <a class="nav-link nav-internal" href="../../science/biblio.html">
                        Bibliography
                      </a>
                    </li>
                
                </div>
            </div>
            
  </ul>
</nav></div>
      
    </div>
    
    
    <div class="navbar-header-items__end">
      
        <div class="navbar-item navbar-persistent--container">
          
<script>
document.write(`
  <button class="btn btn-sm navbar-btn search-button search-button__button" title="Search" aria-label="Search" data-bs-placement="bottom" data-bs-toggle="tooltip">
    <i class="fa-solid fa-magnifying-glass"></i>
  </button>
`);
</script>
        </div>
      
      
        <div class="navbar-item">
<script>
document.write(`
  <button class="theme-switch-button btn btn-sm btn-outline-primary navbar-btn rounded-circle" title="light/dark" aria-label="light/dark" data-bs-placement="bottom" data-bs-toggle="tooltip">
    <span class="theme-switch" data-mode="light"><i class="fa-solid fa-sun"></i></span>
    <span class="theme-switch" data-mode="dark"><i class="fa-solid fa-moon"></i></span>
    <span class="theme-switch" data-mode="auto"><i class="fa-solid fa-circle-half-stroke"></i></span>
  </button>
`);
</script></div>
      
    </div>
    
  </div>
  
  
    <div class="navbar-persistent--mobile">
<script>
document.write(`
  <button class="btn btn-sm navbar-btn search-button search-button__button" title="Search" aria-label="Search" data-bs-placement="bottom" data-bs-toggle="tooltip">
    <i class="fa-solid fa-magnifying-glass"></i>
  </button>
`);
</script>
    </div>
  

  
    <label class="sidebar-toggle secondary-toggle" for="__secondary">
      <span class="fa-solid fa-outdent"></span>
    </label>
  
</div>

    </nav>
  
  <div class="bd-container">
    <div class="bd-container__inner bd-page-width">
      
      <div class="bd-sidebar-primary bd-sidebar">
        

  
  <div class="sidebar-header-items sidebar-primary__section">
    
    
      <div class="sidebar-header-items__center">
        
          <div class="navbar-item"><nav class="navbar-nav">
  <p class="sidebar-header-items__title"
     role="heading"
     aria-level="1"
     aria-label="Site Navigation">
    Site Navigation
  </p>
  <ul class="bd-navbar-elements navbar-nav">
    
                    <li class="nav-item">
                      <a class="nav-link nav-internal" href="../../setup/setup.html">
                        Setup
                      </a>
                    </li>
                

                    <li class="nav-item">
                      <a class="nav-link nav-internal" href="../quickstart.html">
                        Quickstart
                      </a>
                    </li>
                

                    <li class="nav-item current active">
                      <a class="nav-link nav-internal" href="../tutorials.html">
                        Tutorials
                      </a>
                    </li>
                

                    <li class="nav-item">
                      <a class="nav-link nav-internal" href="../../science/cite.html">
                        How to cite
                      </a>
                    </li>
                

                    <li class="nav-item">
                      <a class="nav-link nav-internal" href="../../api/api.html">
                        API
                      </a>
                    </li>
                
            <div class="nav-item dropdown">
                <button class="btn dropdown-toggle nav-item" type="button" data-bs-toggle="dropdown" aria-haspopup="true" aria-expanded="false">
                    More
                </button>
                <div class="dropdown-menu">
                    
                    <li class="nav-item">
                      <a class="nav-link nav-internal" href="../../developer/dev.html">
                        Development
                      </a>
                    </li>
                

                    <li class="nav-item">
                      <a class="nav-link nav-internal" href="../../community/community.html">
                        Community
                      </a>
                    </li>
                

                    <li class="nav-item">
                      <a class="nav-link nav-internal" href="../learning_materials.html">
                        Learning Materials
                      </a>
                    </li>
                

                    <li class="nav-item">
                      <a class="nav-link nav-internal" href="../../science/biblio.html">
                        Bibliography
                      </a>
                    </li>
                
                </div>
            </div>
            
  </ul>
</nav></div>
        
      </div>
    
    
    
      <div class="sidebar-header-items__end">
        
          <div class="navbar-item">
<script>
document.write(`
  <button class="theme-switch-button btn btn-sm btn-outline-primary navbar-btn rounded-circle" title="light/dark" aria-label="light/dark" data-bs-placement="bottom" data-bs-toggle="tooltip">
    <span class="theme-switch" data-mode="light"><i class="fa-solid fa-sun"></i></span>
    <span class="theme-switch" data-mode="dark"><i class="fa-solid fa-moon"></i></span>
    <span class="theme-switch" data-mode="auto"><i class="fa-solid fa-circle-half-stroke"></i></span>
  </button>
`);
</script></div>
        
      </div>
    
  </div>
  
    <div class="sidebar-primary-items__start sidebar-primary__section">
        <div class="sidebar-primary-item"><nav class="bd-docs-nav bd-links"
     aria-label="Section Navigation">
  <p class="bd-links__title" role="heading" aria-level="1">Section Navigation</p>
  <div class="bd-toc-item navbar-nav"><ul class="nav bd-sidenav">
<li class="toctree-l1"><a class="reference internal" href="Semivariogram%20Estimation%20%28Basic%29.html">Semivariogram Estimation</a></li>
<li class="toctree-l1"><a class="reference internal" href="Theoretical%20Models%20%28Basic%29.html">Semivariogram models</a></li>
<li class="toctree-l1"><a class="reference internal" href="Variogram%20Point%20Cloud%20%28Basic%29.html">Variogram Point Cloud</a></li>
<li class="toctree-l1"><a class="reference internal" href="Directional%20Semivariograms%20%28Basic%29.html">Directional semivariograms</a></li>
<li class="toctree-l1"><a class="reference internal" href="Ordinary%20and%20Simple%20Kriging%20%28Basic%29.html">Ordinary and Simple Kriging</a></li>
<li class="toctree-l1"><a class="reference internal" href="How%20good%20is%20our%20Kriging%20model%20-%20test%20it%20against%20IDW%20algorithm%20%28Basic%29.html">How good is my Kriging model? - tests with IDW algorithm</a></li>
</ul>
<ul class="current nav bd-sidenav">
<li class="toctree-l1"><a class="reference internal" href="Semivariogram%20Regularization%20%28Intermediate%29.html">Semivariogram regularization</a></li>
<li class="toctree-l1 current active"><a class="current reference internal" href="#">Blocks to points Ordinary Kriging interpolation</a></li>
<li class="toctree-l1"><a class="reference internal" href="Directional%20Ordinary%20Kriging%20%28Intermediate%29.html">Directional Ordinary Kriging</a></li>
<li class="toctree-l1"><a class="reference internal" href="Outliers%20and%20Their%20Influence%20on%20the%20Final%20Model%20%28Intermediate%29.html">Outliers and Their Influence on the Final Model</a></li>
</ul>
<ul class="nav bd-sidenav">
<li class="toctree-l1"><a class="reference internal" href="Poisson%20Kriging%20-%20Centroid%20Based%20%28Advanced%29.html">Poisson Kriging - centroid based approach</a></li>
<li class="toctree-l1"><a class="reference internal" href="Poisson%20Kriging%20-%20Area%20to%20Area%20%28Advanced%29.html">Poisson Kriging - Area to Area Kriging</a></li>
<li class="toctree-l1"><a class="reference internal" href="Poisson%20Kriging%20-%20Area%20to%20Point%20%28Advanced%29.html">Poisson Kriging - Area to Point Kriging</a></li>
</ul>
</div>
</nav></div>
    </div>
  
  
  <div class="sidebar-primary-items__end sidebar-primary__section">
  </div>
  
  <div id="rtd-footer-container"></div>


      </div>
      
      <main id="main-content" class="bd-main">
        
        
          <div class="bd-content">
            <div class="bd-article-container">
              
              <div class="bd-header-article">
<div class="header-article-items header-article__inner">
  
    <div class="header-article-items__start">
      
        <div class="header-article-item">



<nav aria-label="Breadcrumbs">
  <ul class="bd-breadcrumbs" role="navigation" aria-label="Breadcrumb">
    
    <li class="breadcrumb-item breadcrumb-home">
      <a href="../../index.html" class="nav-link" aria-label="Home">
        <i class="fa-solid fa-home"></i>
      </a>
    </li>
    
    <li class="breadcrumb-item"><a href="../tutorials.html" class="nav-link">Tutorials</a></li>
    
    <li class="breadcrumb-item active" aria-current="page">Blocks to points Ordinary Kriging interpolation</li>
  </ul>
</nav>
</div>
      
    </div>
  
  
</div>
</div>
              
              
              
                
<div id="searchbox"></div>
                <article class="bd-article" role="main">
                  
  <section id="Blocks-to-points-Ordinary-Kriging-interpolation">
<h1>Blocks to points Ordinary Kriging interpolation<a class="headerlink" href="#Blocks-to-points-Ordinary-Kriging-interpolation" title="Permalink to this heading">#</a></h1>
<section id="Table-of-Contents:">
<h2>Table of Contents:<a class="headerlink" href="#Table-of-Contents:" title="Permalink to this heading">#</a></h2>
<ol class="arabic simple">
<li><p>Read block data,</p></li>
<li><p>Detect and remove outliers,</p></li>
<li><p>Create semivariogram model,</p></li>
<li><p>Read point data canvas,</p></li>
<li><p>Build map of interpolated values,</p></li>
<li><p>Show map of interpolated values with choropleth map of the breast cancer rates.</p></li>
</ol>
</section>
<section id="Level:-Intermediate">
<h2>Level: Intermediate<a class="headerlink" href="#Level:-Intermediate" title="Permalink to this heading">#</a></h2>
</section>
<section id="Changelog">
<h2>Changelog<a class="headerlink" href="#Changelog" title="Permalink to this heading">#</a></h2>
<table class="table">
<thead>
<tr class="row-odd"><th class="head"><p>Date</p></th>
<th class="head"><p>Change description</p></th>
<th class="head"><p>Author</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><p>2022-11-05</p></td>
<td><p>Tutorial updated for the 0.3.5 version of the package</p></td>
<td><p>&#64;SimonMolinsky</p></td>
</tr>
<tr class="row-odd"><td><p>2022-10-21</p></td>
<td><p>Tutorial updated for the 0.3.4 version of the package</p></td>
<td><p>&#64;SimonMolinsky</p></td>
</tr>
<tr class="row-even"><td><p>2022-08-23</p></td>
<td><p>Tutorial updated for the 0.3.0 version of the package</p></td>
<td><p>&#64;SimonMolinsky</p></td>
</tr>
<tr class="row-odd"><td><p>2021-12-14</p></td>
<td><p>Sill selection was upgraded: now optimal sill is derived from the grid search within <code class="docutils literal notranslate"><span class="pre">TheoreticalSemivariogram</span></code> class</p></td>
<td><p>&#64;SimonMolinsky</p></td>
</tr>
<tr class="row-even"><td><p>2021-12-13</p></td>
<td><p>Changed behavior of <code class="docutils literal notranslate"><span class="pre">select_values_in_range()</span></code> function</p></td>
<td><p>&#64;SimonMolinsky</p></td>
</tr>
<tr class="row-odd"><td><p>2021-12-06</p></td>
<td><p>Behavior of <code class="docutils literal notranslate"><span class="pre">prepare_kriging_data()</span></code> function has changed</p></td>
<td><p>&#64;SimonMolinsky</p></td>
</tr>
<tr class="row-even"><td><p>2021-10-13</p></td>
<td><p>Refactored TheoreticalSemivariogram (name change of class attribute) and refactored <code class="docutils literal notranslate"><span class="pre">calc_semivariance_from_pt_cloud()</span></code> functions to protect calculations from <code class="docutils literal notranslate"><span class="pre">NaN's</span></code>.</p></td>
<td><p>&#64;ethmtrgt &amp;
&#64;SimonMolinsky</p></td>
</tr>
<tr class="row-odd"><td><p>2021-05-11</p></td>
<td><p>Refactored TheoreticalSemivariogram class</p></td>
<td><p>&#64;SimonMolinsky</p></td>
</tr>
<tr class="row-even"><td><p>2021-03-31</p></td>
<td><p>Update related to the change of semivariogram weighting. Updated cancer rates data.</p></td>
<td><p>&#64;SimonMolinsky</p></td>
</tr>
</tbody>
</table>
</section>
<section id="Introduction">
<h2>Introduction<a class="headerlink" href="#Introduction" title="Permalink to this heading">#</a></h2>
<p>This tutorial is based on the question of user <em>&#64;ikey</em> from <em>Discord</em> channel of the package (02/04/2021). Thank you <em>&#64;ikey</em> for your engagement!</p>
<p>In short:</p>
<blockquote>
<div><p>Are we able to perform Semivariogram Regularization and Poisson Kriging if our point support represents only points without any values?</p>
</div></blockquote>
<p><strong>No, it’s not possible</strong>. But there is a hack that we can use - we can interpolate missing values from areal centroids with Ordinary and Simple Kriging just like we do with <em>regular points</em>. Why is it not possible with unknown points?</p>
<p>The idea behind semivariogram regularization of areal aggregates is to use semivariogram of point support. Point support must reflect an ongoing process. For example, in the case of epidemiology:</p>
<ol class="arabic simple">
<li><p>We have areal counts of infections divided by POPULATION over some areas.</p></li>
<li><p>We take POPULATION blocks (points) with a number of inhabitants per block and use those as support for our map. Thus we transform the choropleth map into the point map, and only to the points where someone is living ==&gt; someone may be infected. We skip large parts of the map where the risk of infection is not present because no one is living there.</p></li>
<li><p>We finally obtain the population-at-risk map of points or smoothed choropleth map of infection risk without large visual bias where large/small areas seem to be more important.</p></li>
</ol>
<p>This works when we have specific <strong>counts over area divided by another parameter</strong> (time, population, probability, volume, etc.). In this scenario, we can find a function that links our areal counts with those underlying variables and/or processes. Without support values, we are not able to perform semivariogram regularization.</p>
<p>What we want to achieve may be done with Ordinary Kriging (because our points are unknown), and semivariogram regularization is not required (and not possible without any values).</p>
<p>In summary, we will learn how to:</p>
<ul class="simple">
<li><p>transform areal data into points,</p></li>
<li><p>detect and remove outliers from data,</p></li>
<li><p>create an interpolated map from unknown points,</p></li>
<li><p>visualize and save the created map.</p></li>
</ul>
<p>We use:</p>
<ul class="simple">
<li><p>for point canvas: <code class="docutils literal notranslate"><span class="pre">samples/point_data/shapefile/regular_grid_points.shp</span></code>,</p></li>
<li><p>for areal centroids: Breast cancer rates data is stored in the shapefile <code class="docutils literal notranslate"><span class="pre">samples/regularization/cancer_data.gpkg</span></code>.</p></li>
</ul>
<p>This tutorial requires understanding concepts presented in <strong>Semivariogram Estimation</strong> and <strong>Variogram Point Cloud</strong> tutorials along with <strong>Ordinary and Simple Kriging</strong> notebook and (optionally) <strong>Semivariogram Regularization</strong> tutorial.</p>
</section>
<section id="Import-packages">
<h2>Import packages<a class="headerlink" href="#Import-packages" title="Permalink to this heading">#</a></h2>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[1]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span>import numpy as np
import geopandas as gpd

import matplotlib.pyplot as plt

from pyinterpolate import Blocks, VariogramCloud, TheoreticalVariogram, kriging
</pre></div>
</div>
</div>
</section>
<section id="1)-Read-areal-data">
<h2>1) Read areal data<a class="headerlink" href="#1)-Read-areal-data" title="Permalink to this heading">#</a></h2>
<p>The block data represents the breast cancer rates in the Northeastern part of the United States. Rate is the number of new cases divided by the population in a county, and this fraction is multiplied by a constant factor of 100,000.</p>
<p>We read data from <code class="docutils literal notranslate"><span class="pre">geopackage</span></code> and use only <code class="docutils literal notranslate"><span class="pre">rate</span></code>, <code class="docutils literal notranslate"><span class="pre">centroid.x</span></code>, and <code class="docutils literal notranslate"><span class="pre">centroid.y</span></code> columns.</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[2]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span># Read and prepare data

DATASET = &#39;samples/regularization/cancer_data.gpkg&#39;
POLYGON_LAYER = &#39;areas&#39;
GEOMETRY_COL = &#39;geometry&#39;
POLYGON_ID = &#39;FIPS&#39;
POLYGON_VALUE = &#39;rate&#39;
MAX_RANGE = 400000
STEP_SIZE = 40000

AREAL_INPUT = Blocks()
AREAL_INPUT.from_file(DATASET, value_col=POLYGON_VALUE, index_col=POLYGON_ID, layer_name=POLYGON_LAYER)

AREAL_INPUT.data.head()
</pre></div>
</div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area stderr docutils container">
<div class="highlight"><pre>
ERROR 1: PROJ: proj_create_from_database: Open of /home/szymon/miniconda3/envs/blogt/share/proj failed
</pre></div></div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[2]:
</pre></div>
</div>
<div class="output_area rendered_html docutils container">
<div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>FIPS</th>
      <th>geometry</th>
      <th>rate</th>
      <th>centroid_x</th>
      <th>centroid_y</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>25019</td>
      <td>MULTIPOLYGON (((2115688.816 556471.240, 211569...</td>
      <td>192.2</td>
      <td>2.132630e+06</td>
      <td>557971.155949</td>
    </tr>
    <tr>
      <th>1</th>
      <td>36121</td>
      <td>POLYGON ((1419423.430 564830.379, 1419729.721 ...</td>
      <td>166.8</td>
      <td>1.442153e+06</td>
      <td>550673.935704</td>
    </tr>
    <tr>
      <th>2</th>
      <td>33001</td>
      <td>MULTIPOLYGON (((1937530.728 779787.978, 193751...</td>
      <td>157.4</td>
      <td>1.958207e+06</td>
      <td>766008.383446</td>
    </tr>
    <tr>
      <th>3</th>
      <td>25007</td>
      <td>MULTIPOLYGON (((2074073.532 539159.504, 207411...</td>
      <td>156.7</td>
      <td>2.082188e+06</td>
      <td>556830.822367</td>
    </tr>
    <tr>
      <th>4</th>
      <td>25001</td>
      <td>MULTIPOLYGON (((2095343.207 637424.961, 209528...</td>
      <td>155.3</td>
      <td>2.100747e+06</td>
      <td>600235.845891</td>
    </tr>
  </tbody>
</table>
</div></div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[3]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span>areal_centroids = AREAL_INPUT.data[[&#39;centroid_x&#39;, &#39;centroid_y&#39;, &#39;rate&#39;]].values
areal_centroids[0]
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[3]:
</pre></div>
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
array([2.13262960e+06, 5.57971156e+05, 1.92200000e+02])
</pre></div></div>
</div>
</section>
<section id="2)-Detect-and-remove-outliers">
<h2>2) Detect and remove outliers<a class="headerlink" href="#2)-Detect-and-remove-outliers" title="Permalink to this heading">#</a></h2>
<p>We check and clean data before the semivariogram fitting and the Ordinary Kriging interpolation. Variogram Point Cloud is the best way to analyze data and detect outliers. We inspect and compare different lags and step sizes and their respective point clouds. Then we will create multiple variograms and Kriging models.</p>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[4]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span># Create analysis parameters

maximum_range = 300000

number_of_lags = [4, 8, 16]
step_sizes = [maximum_range / x for x in number_of_lags]

variogram_clouds = []

for step_size in step_sizes:
    vc = VariogramCloud(input_array=areal_centroids, step_size=step_size, max_range=maximum_range+step_size)
    variogram_clouds.append(vc)
</pre></div>
</div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[5]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span>for vc in variogram_clouds:
    print(f&#39;Lags per area: {len(vc.lags)}&#39;)
    print(&#39;&#39;)
    vc.plot(&#39;violin&#39;)
    print(&#39;\n###########\n&#39;)
</pre></div>
</div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
Lags per area: 4

</pre></div></div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="../../_images/usage_tutorials_Blocks_to_points_Ordinary_Kriging_interpolation_%28Intermediate%29_8_1.png" src="../../_images/usage_tutorials_Blocks_to_points_Ordinary_Kriging_interpolation_%28Intermediate%29_8_1.png" />
</div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>

###########

Lags per area: 8

</pre></div></div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="../../_images/usage_tutorials_Blocks_to_points_Ordinary_Kriging_interpolation_%28Intermediate%29_8_3.png" src="../../_images/usage_tutorials_Blocks_to_points_Ordinary_Kriging_interpolation_%28Intermediate%29_8_3.png" />
</div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>

###########

Lags per area: 16

</pre></div></div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="../../_images/usage_tutorials_Blocks_to_points_Ordinary_Kriging_interpolation_%28Intermediate%29_8_5.png" src="../../_images/usage_tutorials_Blocks_to_points_Ordinary_Kriging_interpolation_%28Intermediate%29_8_5.png" />
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>

###########

</pre></div></div>
</div>
<p>What does a fast check tell us?</p>
<ul class="simple">
<li><p>point to point errors per lag are skewed toward positive values (the mean is always greater than the median),</p></li>
<li><p>less lags == less variability,</p></li>
<li><p>variability in the last case (32 lags) seems to be too high,</p></li>
<li><p>variability in the first case (4 lags) seems to be too small,</p></li>
<li><p>there are extreme semivariance values, and the largest extremities are present for the most distant lags.</p></li>
</ul>
<p>What can we do?</p>
<ul class="simple">
<li><p>remove outliers (extremely high semivariances) per each lag,</p></li>
<li><p>use a small number of neighbors and a range close to 200,000 to avoid unnecessary computations.</p></li>
</ul>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[6]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span># Now remove outliers from each lag

_ = [vc.remove_outliers(method=&#39;iqr&#39;, iqr_lower_limit=3, iqr_upper_limit=1.5, inplace=True) for vc in variogram_clouds]
</pre></div>
</div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[7]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span># And show data without outliers

for vc in variogram_clouds:
    print(f&#39;Lags per area: {len(vc.lags)}&#39;)
    print(&#39;&#39;)
    vc.plot(&#39;violin&#39;)
    print(&#39;\n###########\n&#39;)
</pre></div>
</div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
Lags per area: 4

</pre></div></div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="../../_images/usage_tutorials_Blocks_to_points_Ordinary_Kriging_interpolation_%28Intermediate%29_11_1.png" src="../../_images/usage_tutorials_Blocks_to_points_Ordinary_Kriging_interpolation_%28Intermediate%29_11_1.png" />
</div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>

###########

Lags per area: 8

</pre></div></div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="../../_images/usage_tutorials_Blocks_to_points_Ordinary_Kriging_interpolation_%28Intermediate%29_11_3.png" src="../../_images/usage_tutorials_Blocks_to_points_Ordinary_Kriging_interpolation_%28Intermediate%29_11_3.png" />
</div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>

###########

Lags per area: 16

</pre></div></div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="../../_images/usage_tutorials_Blocks_to_points_Ordinary_Kriging_interpolation_%28Intermediate%29_11_5.png" src="../../_images/usage_tutorials_Blocks_to_points_Ordinary_Kriging_interpolation_%28Intermediate%29_11_5.png" />
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>

###########

</pre></div></div>
</div>
<p>If we compare the <strong>y axis</strong> before and after removing outliers, we may see that values are now smaller and densely populated. After outlier removal, we see also that 32 lags are too much, and especially for the first lag, it generates too much noise. We can expect that model based on this division will work poorly.</p>
</section>
<section id="3.-Create-a-theoretical-semivariogram-model">
<h2>3. Create a theoretical semivariogram model<a class="headerlink" href="#3.-Create-a-theoretical-semivariogram-model" title="Permalink to this heading">#</a></h2>
<p>Semivariogram may be fitted manually or automatically. In this case, we fit it automatically - we test multiple models, and it’s easier to use the <code class="docutils literal notranslate"><span class="pre">autofit()</span></code> method of the <code class="docutils literal notranslate"><span class="pre">TheoreticalVariogram</span></code> object. We didn’t force any model to see how different results we would get.</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[8]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span>theoretical_semivariograms = []

for idx, vc in enumerate(variogram_clouds):

    print(f&#39;Semivariance calculated for {vc.lags} lags.&#39;)
    print(&#39;&#39;)
    # Calculate experimental model
    exp_model = vc.calculate_experimental_variogram()

    # Assign experimental model and data to TheoreticalSemivariogram

    theo_semi = TheoreticalVariogram()
    theo_semi.autofit(experimental_variogram=exp_model)
    theoretical_semivariograms.append(theo_semi)
    print(&#39;&#39;)
    print(&#39;Model parameters:&#39;)
    print(&#39;Model type:&#39;, theo_semi.name)
    print(&#39;Nugget:&#39;, theo_semi.nugget)
    print(&#39;Sill:&#39;, theo_semi.sill)
    print(&#39;Range:&#39;, theo_semi.rang)
    print(&#39;Model error:&#39;, theo_semi.rmse)
    print(&#39;&#39;)
    print(&#39;#####&#39;)
</pre></div>
</div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
Semivariance calculated for [ 75000. 150000. 225000. 300000.] lags.

</pre></div></div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area stderr docutils container">
<div class="highlight"><pre>
/home/szymon/Documents/Programming/Repositories/pyinterpolate-environment/pyinterpolate/pyinterpolate/variogram/theoretical/semivariogram.py:472: UserWarning: If you provide experimental variogram as a numpy array you must remember that the direction parameter must be set if it is a directional variogram. Otherwise, algorithm assumes that variogram is isotropic.
  warnings.warn(msg)
</pre></div></div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>

Model parameters:
Model type: circular
Nugget: 0
Sill: 104.18060667237297
Range: 102380.95238095238
Model error: 7.416168111798283

#####
Semivariance calculated for [ 37500.  75000. 112500. 150000. 187500. 225000. 262500. 300000.] lags.


Model parameters:
Model type: exponential
Nugget: 0
Sill: 111.82982174537467
Range: 37619.04761904762
Model error: 6.604433069510002

#####
Semivariance calculated for [ 18750.  37500.  56250.  75000.  93750. 112500. 131250. 150000. 168750.
 187500. 206250. 225000. 243750. 262500. 281250. 300000.] lags.


Model parameters:
Model type: cubic
Nugget: 0
Sill: 107.66421388064023
Range: 30000.0
Model error: 19.320002753214663

#####
</pre></div></div>
</div>
<p>Each case has a different model type, a different sill, and a different range! How do we choose the model parameters appropriately in this scenario? Error rises with the number of lags but is it a good indicator of the semivariogram fit? No, and we should be careful when choosing variograms with a few lags instead of variograms with multiple lags. We may miss some spatial patterns that will be averaged with a smaller number of lags. The 8-lag variogram seems to be the best because RMSE is the
lowest. On the other hand, 32-lags variograms work poorly!</p>
</section>
<section id="4.-Read-point-data-canvas">
<h2>4. Read point data canvas<a class="headerlink" href="#4.-Read-point-data-canvas" title="Permalink to this heading">#</a></h2>
<p>Our variogram model is ready to load the point file as the <strong>GeoDataFrame</strong> object, which stores the geometry column and data features as tables.</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[9]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span>points = &#39;samples/point_data/shapefile/regular_grid_points.shp&#39;  # file with grid for analysis
gdf_pts = gpd.read_file(points)
gdf_pts.set_index(&#39;id&#39;, inplace=True)
gdf_pts[&#39;x&#39;] = gdf_pts.geometry.x
gdf_pts[&#39;y&#39;] = gdf_pts.geometry.y
gdf_pts.head()
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[9]:
</pre></div>
</div>
<div class="output_area rendered_html docutils container">
<div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>geometry</th>
      <th>x</th>
      <th>y</th>
    </tr>
    <tr>
      <th>id</th>
      <th></th>
      <th></th>
      <th></th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>81.0</th>
      <td>POINT (1277277.671 441124.507)</td>
      <td>1.277278e+06</td>
      <td>441124.5068</td>
    </tr>
    <tr>
      <th>82.0</th>
      <td>POINT (1277277.671 431124.507)</td>
      <td>1.277278e+06</td>
      <td>431124.5068</td>
    </tr>
    <tr>
      <th>83.0</th>
      <td>POINT (1277277.671 421124.507)</td>
      <td>1.277278e+06</td>
      <td>421124.5068</td>
    </tr>
    <tr>
      <th>84.0</th>
      <td>POINT (1277277.671 411124.507)</td>
      <td>1.277278e+06</td>
      <td>411124.5068</td>
    </tr>
    <tr>
      <th>85.0</th>
      <td>POINT (1277277.671 401124.507)</td>
      <td>1.277278e+06</td>
      <td>401124.5068</td>
    </tr>
  </tbody>
</table>
</div></div>
</div>
</section>
<section id="5.-Build-a-map-of-interpolated-values">
<h2>5. Build a map of interpolated values<a class="headerlink" href="#5.-Build-a-map-of-interpolated-values" title="Permalink to this heading">#</a></h2>
<p>We can model all values in a batch. If we set the <code class="docutils literal notranslate"><span class="pre">number_of_workers</span></code> parameter to <code class="docutils literal notranslate"><span class="pre">-1</span></code> or a positive integer, then the algorithm will use parallel processing functions to speed up calculations.</p>
<p>Based on the learning from a semivariogram modeling step, we will set a number of neighboring areas to 8 and range to 200000. We will append interpolated values and errors to an existing data frame and plot them to compare results.</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[10]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span>preds_cols = []
errs_cols = []

for semi_model in theoretical_semivariograms:
    kriged = kriging(observations=areal_centroids,
                     theoretical_model=semi_model,
                     points=gdf_pts[[&#39;x&#39;, &#39;y&#39;]].values,
                     neighbors_range=200000,
                     no_neighbors=8,
                     number_of_workers=1,
                     use_all_neighbors_in_range=True)

    # Interpolate missing values and uncertainty
    pred_col_name = &#39;p &#39; + semi_model.name[:3] + &#39; &#39; + str(len(semi_model.lags))
    uncertainty_col_name = &#39;e &#39; + semi_model.name[:3] + &#39; &#39; + str(len(semi_model.lags))
    gdf_pts[pred_col_name] = kriged[:, 0]
    gdf_pts[uncertainty_col_name] = kriged[:, 1]
    preds_cols.append(pred_col_name)
    errs_cols.append(uncertainty_col_name)
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area stderr docutils container">
<div class="highlight"><pre>
100%|██████████| 5419/5419 [00:04&lt;00:00, 1190.56it/s]
100%|██████████| 5419/5419 [00:03&lt;00:00, 1402.50it/s]
100%|██████████| 5419/5419 [00:03&lt;00:00, 1392.23it/s]
</pre></div></div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[11]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span>gdf_pts.head()
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[11]:
</pre></div>
</div>
<div class="output_area rendered_html docutils container">
<div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>geometry</th>
      <th>x</th>
      <th>y</th>
      <th>p cir 4</th>
      <th>e cir 4</th>
      <th>p exp 8</th>
      <th>e exp 8</th>
      <th>p cub 16</th>
      <th>e cub 16</th>
    </tr>
    <tr>
      <th>id</th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>81.0</th>
      <td>POINT (1277277.671 441124.507)</td>
      <td>1.277278e+06</td>
      <td>441124.5068</td>
      <td>133.085189</td>
      <td>63.322684</td>
      <td>132.828256</td>
      <td>93.647290</td>
      <td>131.969565</td>
      <td>112.345267</td>
    </tr>
    <tr>
      <th>82.0</th>
      <td>POINT (1277277.671 431124.507)</td>
      <td>1.277278e+06</td>
      <td>431124.5068</td>
      <td>131.879395</td>
      <td>62.251709</td>
      <td>131.171342</td>
      <td>92.859017</td>
      <td>130.604348</td>
      <td>112.345267</td>
    </tr>
    <tr>
      <th>83.0</th>
      <td>POINT (1277277.671 421124.507)</td>
      <td>1.277278e+06</td>
      <td>421124.5068</td>
      <td>130.817630</td>
      <td>61.932193</td>
      <td>130.542053</td>
      <td>92.252755</td>
      <td>130.604348</td>
      <td>112.345267</td>
    </tr>
    <tr>
      <th>84.0</th>
      <td>POINT (1277277.671 411124.507)</td>
      <td>1.277278e+06</td>
      <td>411124.5068</td>
      <td>129.655109</td>
      <td>61.666624</td>
      <td>130.101171</td>
      <td>91.857396</td>
      <td>130.604348</td>
      <td>112.345267</td>
    </tr>
    <tr>
      <th>85.0</th>
      <td>POINT (1277277.671 401124.507)</td>
      <td>1.277278e+06</td>
      <td>401124.5068</td>
      <td>128.853456</td>
      <td>60.872324</td>
      <td>130.114977</td>
      <td>91.603116</td>
      <td>130.860000</td>
      <td>111.970782</td>
    </tr>
  </tbody>
</table>
</div></div>
</div>
<p>This is the somewhat complicated function in which we interpolate missing values as new columns of <strong>GeoDataFrame</strong>. <em>Uncertainty</em> is assigned to interpolated results for further analysis.</p>
<p>Now we can save our <strong>GeoDataFrame</strong> as a shapefile.</p>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[12]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span># Save interpolation results

gdf_pts.to_file(&#39;output/interpolation_results_areal_to_point.shp&#39;)
</pre></div>
</div>
</div>
<p>Now we will check the results directly in the notebook.</p>
</section>
<section id="6.-Show-a-map-of-interpolated-values-with-a-choropleth-map-of-the-breast-cancer-rates">
<h2>6. Show a map of interpolated values with a choropleth map of the breast cancer rates<a class="headerlink" href="#6.-Show-a-map-of-interpolated-values-with-a-choropleth-map-of-the-breast-cancer-rates" title="Permalink to this heading">#</a></h2>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[13]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span># Now compare results to choropleth maps
fig, axes = plt.subplots(nrows=2, ncols=3, figsize=(16, 16), sharex=&#39;all&#39;, sharey=&#39;all&#39;)

base1 = AREAL_INPUT.data.plot(ax=axes[0, 0], legend=True, edgecolor=&#39;black&#39;, color=&#39;white&#39;)
base2 = AREAL_INPUT.data.plot(ax=axes[0, 1], legend=True, edgecolor=&#39;black&#39;, color=&#39;white&#39;)
base3 = AREAL_INPUT.data.plot(ax=axes[0, 2], legend=True, edgecolor=&#39;black&#39;, color=&#39;white&#39;)
base4 = AREAL_INPUT.data.plot(ax=axes[1, 0], legend=True, edgecolor=&#39;black&#39;, color=&#39;white&#39;)
base5 = AREAL_INPUT.data.plot(ax=axes[1, 1], legend=True, edgecolor=&#39;black&#39;, color=&#39;white&#39;)
base6 = AREAL_INPUT.data.plot(ax=axes[1, 2], legend=True, edgecolor=&#39;black&#39;, color=&#39;white&#39;)

gdf_pts.plot(ax=base1, column=preds_cols[0], cmap=&#39;Spectral_r&#39;, alpha=0.3)
gdf_pts.plot(ax=base2, column=preds_cols[1], cmap=&#39;Spectral_r&#39;, alpha=0.3)
gdf_pts.plot(ax=base3, column=preds_cols[2], cmap=&#39;Spectral_r&#39;, alpha=0.3)
gdf_pts.plot(ax=base4, column=errs_cols[0], cmap=&#39;Reds&#39;, alpha=0.3)
gdf_pts.plot(ax=base5, column=errs_cols[1], cmap=&#39;Reds&#39;, alpha=0.3)
gdf_pts.plot(ax=base6, column=errs_cols[2], cmap=&#39;Reds&#39;, alpha=0.3)

axes[0, 0].set_title(preds_cols[0])
axes[0, 1].set_title(preds_cols[1])
axes[0, 2].set_title(preds_cols[2])
axes[1, 0].set_title(errs_cols[0])
axes[1, 1].set_title(errs_cols[1])
axes[1, 2].set_title(errs_cols[2])

plt.suptitle(&#39;Comparison of different Kriging models outputs&#39;)
plt.show()
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="../../_images/usage_tutorials_Blocks_to_points_Ordinary_Kriging_interpolation_%28Intermediate%29_25_0.png" src="../../_images/usage_tutorials_Blocks_to_points_Ordinary_Kriging_interpolation_%28Intermediate%29_25_0.png" />
</div>
</div>
<p>Visual inspection shows that:</p>
<blockquote>
<div><p>The circular model and the exponential model have created the smoothest results. An interesting pattern emerges on uncertainty maps. The variance errors are smoother on the first map (the circular model). The middle map produces a higher variance in output, but it still works as a filter. The last model doesn’t perform well, has too strict distance constraints, and the final outcome is not smooth. Sharply increasing variance errors on the uncertainty map of the cubic model tell us that maybe
we have chosen the wrong model - we are not able to retrieve meaningful information from it.</p>
</div></blockquote>
<p>Are absolute errors between maps large or not? Let’s check it in the last step:</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[14]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span>for pcol1 in preds_cols:
    print(&#39;Column:&#39;, pcol1)
    for pcol2 in preds_cols:
        if pcol1 == pcol2:
            pass
        else:
            mad = gdf_pts[pcol1] - gdf_pts[pcol2]
            mad = np.abs(np.mean(mad))
            print(f&#39;Mean Absolute Difference with {pcol2} is {mad:.4f}&#39;)
    print(&#39;&#39;)
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
Column: p cir 4
Mean Absolute Difference with p exp 8 is 0.2124
Mean Absolute Difference with p cub 16 is 0.6504

Column: p exp 8
Mean Absolute Difference with p cir 4 is 0.2124
Mean Absolute Difference with p cub 16 is 0.4380

Column: p cub 16
Mean Absolute Difference with p cir 4 is 0.6504
Mean Absolute Difference with p exp 8 is 0.4380

</pre></div></div>
</div>
<p>That differences are tiny, so we shouldn’t throw away one model after another. Semivariogram models are comparable. I prefer the <strong>8-lag</strong> theoretical variogram with an exponential model, and it has the best bias-to-variance ratio and a low RMSE error.</p>
<hr class="docutils" />
</section>
</section>


                </article>
              
              
              
                <footer class="bd-footer-article">
                  
<div class="footer-article-items footer-article__inner">
  
    <div class="footer-article-item"><!-- Previous / next buttons -->
<div class="prev-next-area">
    <a class="left-prev"
       href="Semivariogram%20Regularization%20%28Intermediate%29.html"
       title="previous page">
      <i class="fa-solid fa-angle-left"></i>
      <div class="prev-next-info">
        <p class="prev-next-subtitle">previous</p>
        <p class="prev-next-title">Semivariogram regularization</p>
      </div>
    </a>
    <a class="right-next"
       href="Directional%20Ordinary%20Kriging%20%28Intermediate%29.html"
       title="next page">
      <div class="prev-next-info">
        <p class="prev-next-subtitle">next</p>
        <p class="prev-next-title">Directional Ordinary Kriging</p>
      </div>
      <i class="fa-solid fa-angle-right"></i>
    </a>
</div></div>
  
</div>

                </footer>
              
            </div>
            
            
              
                <div class="bd-sidebar-secondary bd-toc"><div class="sidebar-secondary-items sidebar-secondary__inner">

  <div class="sidebar-secondary-item">
  <div class="page-toc tocsection onthispage">
    <i class="fa-solid fa-list"></i> On this page
  </div>
  <nav class="bd-toc-nav page-toc">
    <ul class="visible nav section-nav flex-column">
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#Table-of-Contents:">Table of Contents:</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#Level:-Intermediate">Level: Intermediate</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#Changelog">Changelog</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#Introduction">Introduction</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#Import-packages">Import packages</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#1)-Read-areal-data">1) Read areal data</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#2)-Detect-and-remove-outliers">2) Detect and remove outliers</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#3.-Create-a-theoretical-semivariogram-model">3. Create a theoretical semivariogram model</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#4.-Read-point-data-canvas">4. Read point data canvas</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#5.-Build-a-map-of-interpolated-values">5. Build a map of interpolated values</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#6.-Show-a-map-of-interpolated-values-with-a-choropleth-map-of-the-breast-cancer-rates">6. Show a map of interpolated values with a choropleth map of the breast cancer rates</a></li>
</ul>
  </nav></div>

  <div class="sidebar-secondary-item">
  <div class="tocsection sourcelink">
    <a href="../../_sources/usage/tutorials/Blocks to points Ordinary Kriging interpolation (Intermediate).ipynb.txt">
      <i class="fa-solid fa-file-lines"></i> Show Source
    </a>
  </div>
</div>

</div></div>
              
            
          </div>
          <footer class="bd-footer-content">
            
          </footer>
        
      </main>
    </div>
  </div>
  
  <!-- Scripts loaded after <body> so the DOM is not blocked -->
  <script src="../../_static/scripts/bootstrap.js?digest=e353d410970836974a52"></script>
<script src="../../_static/scripts/pydata-sphinx-theme.js?digest=e353d410970836974a52"></script>

  <footer class="bd-footer">
<div class="bd-footer__inner bd-page-width">
  
    <div class="footer-items__start">
      
        <div class="footer-item">
  <p class="copyright">
    
      © Copyright 2023, Szymon Moliński.
      <br/>
    
  </p>
</div>
      
        <div class="footer-item">
  <p class="sphinx-version">
    Created using <a href="https://www.sphinx-doc.org/">Sphinx</a> 5.3.0.
    <br/>
  </p>
</div>
      
    </div>
  
  
    <div class="footer-items__end">
      
        <div class="footer-item"><p class="theme-version">
  Built with the <a href="https://pydata-sphinx-theme.readthedocs.io/en/stable/index.html">PyData Sphinx Theme</a> 0.13.3.
</p></div>
      
    </div>
  
</div>

  </footer>
  </body>
</html>