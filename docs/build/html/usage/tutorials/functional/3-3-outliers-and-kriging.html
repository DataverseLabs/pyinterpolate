
<!DOCTYPE html>


<html lang="en" data-content_root="../../../" >

  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" /><meta name="viewport" content="width=device-width, initial-scale=1" />

    <title>Outliers and Kriging &#8212; pyinterpolate 1.0.2 documentation</title>
  
  
  
  <script data-cfasync="false">
    document.documentElement.dataset.mode = localStorage.getItem("mode") || "";
    document.documentElement.dataset.theme = localStorage.getItem("theme") || "";
  </script>
  <!--
    this give us a css class that will be invisible only if js is disabled
  -->
  <noscript>
    <style>
      .pst-js-only { display: none !important; }

    </style>
  </noscript>
  
  <!-- Loaded before other Sphinx assets -->
  <link href="../../../_static/styles/theme.css?digest=8878045cc6db502f8baf" rel="stylesheet" />
<link href="../../../_static/styles/pydata-sphinx-theme.css?digest=8878045cc6db502f8baf" rel="stylesheet" />

    <link rel="stylesheet" type="text/css" href="../../../_static/pygments.css?v=a746c00c" />
    <link rel="stylesheet" type="text/css" href="../../../_static/copybutton.css?v=76b2166b" />
    <link rel="stylesheet" type="text/css" href="../../../_static/nbsphinx-code-cells.css?v=2aa19091" />
  
  <!-- So that users can add custom icons -->
  <script src="../../../_static/scripts/fontawesome.js?digest=8878045cc6db502f8baf"></script>
  <!-- Pre-loaded scripts that we'll load fully later -->
  <link rel="preload" as="script" href="../../../_static/scripts/bootstrap.js?digest=8878045cc6db502f8baf" />
<link rel="preload" as="script" href="../../../_static/scripts/pydata-sphinx-theme.js?digest=8878045cc6db502f8baf" />

    <script src="../../../_static/documentation_options.js?v=1ed6394b"></script>
    <script src="../../../_static/doctools.js?v=9bcbadda"></script>
    <script src="../../../_static/sphinx_highlight.js?v=dc90522c"></script>
    <script src="../../../_static/clipboard.min.js?v=a7894cd8"></script>
    <script src="../../../_static/copybutton.js?v=f281be69"></script>
    <script crossorigin="anonymous" integrity="sha256-Ae2Vz/4ePdIu6ZyI/5ZGsYnb+m0JlOmKPjt6XZ9JJkA=" src="https://cdnjs.cloudflare.com/ajax/libs/require.js/2.3.4/require.min.js"></script>
    <script>window.MathJax = {"tex": {"inlineMath": [["$", "$"], ["\\(", "\\)"]], "processEscapes": true}, "options": {"ignoreHtmlClass": "tex2jax_ignore|mathjax_ignore|document", "processHtmlClass": "tex2jax_process|mathjax_process|math|output_area"}}</script>
    <script defer="defer" src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js"></script>
    <script>DOCUMENTATION_OPTIONS.pagename = 'usage/tutorials/functional/3-3-outliers-and-kriging';</script>
    <link rel="index" title="Index" href="../../../genindex.html" />
    <link rel="search" title="Search" href="../../../search.html" />
    <link rel="next" title="Directional Ordinary Kriging" href="3-4-directional-ordinary-kriging.html" />
    <link rel="prev" title="Benchmarking Kriging" href="3-2-benchmark-kriging.html" />
  <meta name="viewport" content="width=device-width, initial-scale=1"/>
  <meta name="docsearch:language" content="en"/>
  <meta name="docsearch:version" content="" />
  </head>
  
  
  <body data-bs-spy="scroll" data-bs-target=".bd-toc-nav" data-offset="180" data-bs-root-margin="0px 0px -60%" data-default-mode="">

  
  
  <div id="pst-skip-link" class="skip-link d-print-none"><a href="#main-content">Skip to main content</a></div>
  
  <div id="pst-scroll-pixel-helper"></div>
  
  <button type="button" class="btn rounded-pill" id="pst-back-to-top">
    <i class="fa-solid fa-arrow-up"></i>Back to top</button>

  
  <dialog id="pst-search-dialog">
    
<form class="bd-search d-flex align-items-center"
      action="../../../search.html"
      method="get">
  <i class="fa-solid fa-magnifying-glass"></i>
  <input type="search"
         class="form-control"
         name="q"
         placeholder="Search the docs ..."
         aria-label="Search the docs ..."
         autocomplete="off"
         autocorrect="off"
         autocapitalize="off"
         spellcheck="false"/>
  <span class="search-button__kbd-shortcut"><kbd class="kbd-shortcut__modifier">Ctrl</kbd>+<kbd>K</kbd></span>
</form>
  </dialog>

  <div class="pst-async-banner-revealer d-none">
  <aside id="bd-header-version-warning" class="d-none d-print-none" aria-label="Version warning"></aside>
</div>

  
    <header class="bd-header navbar navbar-expand-lg bd-navbar d-print-none">
<div class="bd-header__inner bd-page-width">
  <button class="pst-navbar-icon sidebar-toggle primary-toggle" aria-label="Site navigation">
    <span class="fa-solid fa-bars"></span>
  </button>
  
  
  <div class="col-lg-3 navbar-header-items__start">
    
      <div class="navbar-item">

  
    
  

<a class="navbar-brand logo" href="../../../index.html">
  
  
  
  
  
  
    <p class="title logo__title">pyinterpolate 1.0.2 documentation</p>
  
</a></div>
    
  </div>
  
  <div class="col-lg-9 navbar-header-items">
    
    <div class="me-auto navbar-header-items__center">
      
        <div class="navbar-item">
<nav>
  <ul class="bd-navbar-elements navbar-nav">
    
<li class="nav-item ">
  <a class="nav-link nav-internal" href="../../../setup/setup.html">
    Setup
  </a>
</li>


<li class="nav-item ">
  <a class="nav-link nav-internal" href="../../quickstart.html">
    Quickstart
  </a>
</li>


<li class="nav-item current active">
  <a class="nav-link nav-internal" href="../../tutorials.html">
    Tutorials
  </a>
</li>


<li class="nav-item ">
  <a class="nav-link nav-internal" href="../../learning_materials.html">
    Learning Materials
  </a>
</li>


<li class="nav-item ">
  <a class="nav-link nav-internal" href="../../../science/citation.html">
    Citation
  </a>
</li>

            <li class="nav-item dropdown">
                <button class="btn dropdown-toggle nav-item" type="button"
                data-bs-toggle="dropdown" aria-expanded="false"
                aria-controls="pst-nav-more-links">
                    More
                </button>
                <ul id="pst-nav-more-links" class="dropdown-menu">
                    
<li class=" ">
  <a class="nav-link dropdown-item nav-internal" href="../../../science/bibliography.html">
    Bibliography
  </a>
</li>


<li class=" ">
  <a class="nav-link dropdown-item nav-internal" href="../../../community/community.html">
    Community
  </a>
</li>


<li class=" ">
  <a class="nav-link dropdown-item nav-internal" href="../../../api/api.html">
    API
  </a>
</li>


<li class=" ">
  <a class="nav-link dropdown-item nav-internal" href="../../../api/changes.html">
    Changes between version 0.x and 1.x
  </a>
</li>


<li class=" ">
  <a class="nav-link dropdown-item nav-internal" href="../../../contributor/development.html">
    Development
  </a>
</li>

                </ul>
            </li>
            
  </ul>
</nav></div>
      
    </div>
    
    
    <div class="navbar-header-items__end">
      
        <div class="navbar-item navbar-persistent--container">
          

<button class="btn search-button-field search-button__button pst-js-only" title="Search" aria-label="Search" data-bs-placement="bottom" data-bs-toggle="tooltip">
 <i class="fa-solid fa-magnifying-glass"></i>
 <span class="search-button__default-text">Search</span>
 <span class="search-button__kbd-shortcut"><kbd class="kbd-shortcut__modifier">Ctrl</kbd>+<kbd class="kbd-shortcut__modifier">K</kbd></span>
</button>
        </div>
      
      
        <div class="navbar-item">

<button class="btn btn-sm nav-link pst-navbar-icon theme-switch-button pst-js-only" aria-label="Color mode" data-bs-title="Color mode"  data-bs-placement="bottom" data-bs-toggle="tooltip">
  <i class="theme-switch fa-solid fa-sun                fa-lg" data-mode="light" title="Light"></i>
  <i class="theme-switch fa-solid fa-moon               fa-lg" data-mode="dark"  title="Dark"></i>
  <i class="theme-switch fa-solid fa-circle-half-stroke fa-lg" data-mode="auto"  title="System Settings"></i>
</button></div>
      
    </div>
    
  </div>
  
  
    <div class="navbar-persistent--mobile">

<button class="btn search-button-field search-button__button pst-js-only" title="Search" aria-label="Search" data-bs-placement="bottom" data-bs-toggle="tooltip">
 <i class="fa-solid fa-magnifying-glass"></i>
 <span class="search-button__default-text">Search</span>
 <span class="search-button__kbd-shortcut"><kbd class="kbd-shortcut__modifier">Ctrl</kbd>+<kbd class="kbd-shortcut__modifier">K</kbd></span>
</button>
    </div>
  

  
    <button class="pst-navbar-icon sidebar-toggle secondary-toggle" aria-label="On this page">
      <span class="fa-solid fa-outdent"></span>
    </button>
  
</div>

    </header>
  

  <div class="bd-container">
    <div class="bd-container__inner bd-page-width">
      
      
      
      <dialog id="pst-primary-sidebar-modal"></dialog>
      <div id="pst-primary-sidebar" class="bd-sidebar-primary bd-sidebar">
        

  
  <div class="sidebar-header-items sidebar-primary__section">
    
    
      <div class="sidebar-header-items__center">
        
          
          
            <div class="navbar-item">
<nav>
  <ul class="bd-navbar-elements navbar-nav">
    
<li class="nav-item ">
  <a class="nav-link nav-internal" href="../../../setup/setup.html">
    Setup
  </a>
</li>


<li class="nav-item ">
  <a class="nav-link nav-internal" href="../../quickstart.html">
    Quickstart
  </a>
</li>


<li class="nav-item current active">
  <a class="nav-link nav-internal" href="../../tutorials.html">
    Tutorials
  </a>
</li>


<li class="nav-item ">
  <a class="nav-link nav-internal" href="../../learning_materials.html">
    Learning Materials
  </a>
</li>


<li class="nav-item ">
  <a class="nav-link nav-internal" href="../../../science/citation.html">
    Citation
  </a>
</li>


<li class="nav-item ">
  <a class="nav-link nav-internal" href="../../../science/bibliography.html">
    Bibliography
  </a>
</li>


<li class="nav-item ">
  <a class="nav-link nav-internal" href="../../../community/community.html">
    Community
  </a>
</li>


<li class="nav-item ">
  <a class="nav-link nav-internal" href="../../../api/api.html">
    API
  </a>
</li>


<li class="nav-item ">
  <a class="nav-link nav-internal" href="../../../api/changes.html">
    Changes between version 0.x and 1.x
  </a>
</li>


<li class="nav-item ">
  <a class="nav-link nav-internal" href="../../../contributor/development.html">
    Development
  </a>
</li>

  </ul>
</nav></div>
          
        
      </div>
    
    
    
      <div class="sidebar-header-items__end">
        
          <div class="navbar-item">

<button class="btn btn-sm nav-link pst-navbar-icon theme-switch-button pst-js-only" aria-label="Color mode" data-bs-title="Color mode"  data-bs-placement="bottom" data-bs-toggle="tooltip">
  <i class="theme-switch fa-solid fa-sun                fa-lg" data-mode="light" title="Light"></i>
  <i class="theme-switch fa-solid fa-moon               fa-lg" data-mode="dark"  title="Dark"></i>
  <i class="theme-switch fa-solid fa-circle-half-stroke fa-lg" data-mode="auto"  title="System Settings"></i>
</button></div>
        
      </div>
    
  </div>
  
    <div class="sidebar-primary-items__start sidebar-primary__section">
        <div class="sidebar-primary-item">
<nav class="bd-docs-nav bd-links"
     aria-label="Section Navigation">
  <p class="bd-links__title" role="heading" aria-level="1">Section Navigation</p>
  <div class="bd-toc-item navbar-nav"><ul class="nav bd-sidenav">
<li class="toctree-l1"><a class="reference internal" href="1-1-semivariogram-exploration.html">Semivariogram exploration</a></li>
<li class="toctree-l1"><a class="reference internal" href="1-2-semivariogram-models.html">Semivariogram models</a></li>
<li class="toctree-l1"><a class="reference internal" href="1-3-spatial-dependency-index.html">Spatial Dependency Index</a></li>
<li class="toctree-l1"><a class="reference internal" href="2-1-directional-semivariogram.html">Directional Semivariogram</a></li>
<li class="toctree-l1"><a class="reference internal" href="2-2-variogram-points-cloud.html">Variogram Points Cloud</a></li>
</ul>
<ul class="current nav bd-sidenav">
<li class="toctree-l1"><a class="reference internal" href="3-1-ordinary-and-simple-kriging.html">Ordinary and Simple Kriging</a></li>
<li class="toctree-l1"><a class="reference internal" href="3-2-benchmark-kriging.html">Benchmarking Kriging</a></li>
<li class="toctree-l1 current active"><a class="current reference internal" href="#">Outliers and Kriging</a></li>
<li class="toctree-l1"><a class="reference internal" href="3-4-directional-ordinary-kriging.html">Directional Ordinary Kriging</a></li>
<li class="toctree-l1"><a class="reference internal" href="3-5-blocks-to-points-ordinary-kriging.html">Blocks to points with Ordinary Kriging</a></li>
</ul>
<ul class="nav bd-sidenav">
<li class="toctree-l1"><a class="reference internal" href="4-1-semivariogram-regularization.html">Semivariogram Regularization</a></li>
<li class="toctree-l1"><a class="reference internal" href="4-2-poisson-kriging-centroid-based.html">Poisson Kriging Centroid-based approach</a></li>
<li class="toctree-l1"><a class="reference internal" href="4-3-poisson-kriging-area-to-area.html">Area-to-area Poisson Kriging</a></li>
<li class="toctree-l1"><a class="reference internal" href="4-4-poisson-kriging-area-to-point-smoothing.html">Area-to-Point Poisson Kriging</a></li>
</ul>
</div>
</nav></div>
    </div>
  
  
  <div class="sidebar-primary-items__end sidebar-primary__section">
      <div class="sidebar-primary-item">
<div id="ethical-ad-placement"
      class="flat"
      data-ea-publisher="readthedocs"
      data-ea-type="readthedocs-sidebar"
      data-ea-manual="true">
</div></div>
  </div>


      </div>
      
      <main id="main-content" class="bd-main" role="main">
        
        
          <div class="bd-content">
            <div class="bd-article-container">
              
              <div class="bd-header-article d-print-none">
<div class="header-article-items header-article__inner">
  
    <div class="header-article-items__start">
      
        <div class="header-article-item">

<nav aria-label="Breadcrumb" class="d-print-none">
  <ul class="bd-breadcrumbs">
    
    <li class="breadcrumb-item breadcrumb-home">
      <a href="../../../index.html" class="nav-link" aria-label="Home">
        <i class="fa-solid fa-home"></i>
      </a>
    </li>
    
    <li class="breadcrumb-item"><a href="../../tutorials.html" class="nav-link">Tutorials</a></li>
    
    <li class="breadcrumb-item active" aria-current="page"><span class="ellipsis">Outliers and Kriging</span></li>
  </ul>
</nav>
</div>
      
    </div>
  
  
</div>
</div>
              
              
              
                
<div id="searchbox"></div>
                <article class="bd-article">
                  
  <section id="Outliers-and-Kriging">
<h1>Outliers and Kriging<a class="headerlink" href="#Outliers-and-Kriging" title="Link to this heading">#</a></h1>
<p>Outliers may affect our analysis and the final interpolation results. In this tutorial, we learn about their influence on the final model and compare interpolation errors for different scenarios. In one set of experiments we clean outliers directly from a dataset, and in another set of experiments we remove outliers from semivariogram.</p>
<p>We can remove too high or too low values at the preprocessing stage (check part 2 of the tutorial) or remove outliers directly from the variogram point cloud (part 4).</p>
<section id="Prerequisites">
<h2>Prerequisites<a class="headerlink" href="#Prerequisites" title="Link to this heading">#</a></h2>
<ul class="simple">
<li><p><strong>Domain</strong>:</p>
<ul>
<li><p>semivariance and covariance functions</p></li>
<li><p>kriging (basics)</p></li>
<li><p>outliers (statistical concept)</p></li>
<li><p>variogram point cloud</p></li>
</ul>
</li>
<li><p><strong>Package</strong>:</p>
<ul>
<li><p><code class="docutils literal notranslate"><span class="pre">TheoreticalVariogram</span></code></p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">ExperimentalVariogram</span></code></p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">interpolate_points()</span></code></p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">VariogramCloud()</span></code></p></li>
</ul>
</li>
<li><p><strong>Programming</strong>:</p>
<ul>
<li><p>Python basics</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">pandas</span></code> basics</p></li>
</ul>
</li>
</ul>
</section>
<section id="Table-of-contents">
<h2>Table of contents<a class="headerlink" href="#Table-of-contents" title="Link to this heading">#</a></h2>
<ol class="arabic simple">
<li><p>Prepare data</p></li>
<li><p>Analyze distribution and remove potential outliers</p></li>
<li><p>Create the Variogram Point Cloud models</p></li>
<li><p>Remove outliers from the point cloud</p></li>
<li><p>Compare performance of Ordinary Kriging on data with different cleaning levels</p></li>
</ol>
</section>
<section id="1.-Prepare-data">
<h2>1. Prepare data<a class="headerlink" href="#1.-Prepare-data" title="Link to this heading">#</a></h2>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[1]:
</pre></div>
</div>
<div class="input_area highlight-ipython2 notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">geopandas</span> <span class="k">as</span> <span class="nn">gpd</span>
<span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>
<span class="kn">import</span> <span class="nn">pandas</span> <span class="k">as</span> <span class="nn">pd</span>

<span class="kn">import</span> <span class="nn">matplotlib.pyplot</span> <span class="k">as</span> <span class="nn">plt</span>

<span class="kn">from</span> <span class="nn">pyinterpolate</span> <span class="kn">import</span> <span class="n">VariogramCloud</span><span class="p">,</span> <span class="n">build_theoretical_variogram</span>
<span class="kn">from</span> <span class="nn">pyinterpolate</span> <span class="kn">import</span> <span class="n">interpolate_points</span>
</pre></div>
</div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[2]:
</pre></div>
</div>
<div class="input_area highlight-ipython2 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Load DEM data</span>

<span class="n">df</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">read_csv</span><span class="p">(</span>
    <span class="s1">&#39;../data/dem.csv&#39;</span>
<span class="p">)</span>
<span class="c1"># Populate geometry column and set CRS</span>

<span class="n">dem_geometry</span> <span class="o">=</span> <span class="n">gpd</span><span class="o">.</span><span class="n">points_from_xy</span><span class="p">(</span><span class="n">x</span><span class="o">=</span><span class="n">df</span><span class="p">[</span><span class="s1">&#39;longitude&#39;</span><span class="p">],</span> <span class="n">y</span><span class="o">=</span><span class="n">df</span><span class="p">[</span><span class="s1">&#39;latitude&#39;</span><span class="p">],</span> <span class="n">crs</span><span class="o">=</span><span class="s1">&#39;epsg:4326&#39;</span><span class="p">)</span>
<span class="n">dem</span> <span class="o">=</span> <span class="n">gpd</span><span class="o">.</span><span class="n">GeoDataFrame</span><span class="p">(</span><span class="n">df</span><span class="p">,</span> <span class="n">geometry</span><span class="o">=</span><span class="n">dem_geometry</span><span class="p">)</span>

<span class="c1"># Transform crs to metric values</span>
<span class="n">dem</span><span class="o">.</span><span class="n">to_crs</span><span class="p">(</span><span class="n">epsg</span><span class="o">=</span><span class="mi">2180</span><span class="p">,</span> <span class="n">inplace</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
<span class="n">dem</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">column</span><span class="o">=</span><span class="s1">&#39;dem&#39;</span><span class="p">,</span> <span class="n">cmap</span><span class="o">=</span><span class="s1">&#39;gist_earth&#39;</span><span class="p">,</span> <span class="n">alpha</span><span class="o">=</span><span class="mf">0.6</span><span class="p">,</span> <span class="n">vmin</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">legend</span><span class="o">=</span><span class="kc">True</span><span class="p">);</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="../../../_images/usage_tutorials_functional_3-3-outliers-and-kriging_3_0.png" src="../../../_images/usage_tutorials_functional_3-3-outliers-and-kriging_3_0.png" />
</div>
</div>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[3]:
</pre></div>
</div>
<div class="input_area highlight-ipython2 notranslate"><div class="highlight"><pre><span></span><span class="n">train</span> <span class="o">=</span> <span class="n">dem</span><span class="o">.</span><span class="n">sample</span><span class="p">(</span><span class="n">n</span><span class="o">=</span><span class="nb">int</span><span class="p">(</span><span class="mf">0.5</span><span class="o">*</span><span class="nb">len</span><span class="p">(</span><span class="n">dem</span><span class="p">)))</span>
<span class="n">test</span> <span class="o">=</span> <span class="n">dem</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="o">~</span><span class="n">dem</span><span class="o">.</span><span class="n">index</span><span class="o">.</span><span class="n">isin</span><span class="p">(</span><span class="n">train</span><span class="o">.</span><span class="n">index</span><span class="p">)]</span>
</pre></div>
</div>
</div>
</section>
<section id="2.-Analyze-data-distribution-and-remove-potential-outliers">
<h2>2. Analyze data distribution and remove potential outliers<a class="headerlink" href="#2.-Analyze-data-distribution-and-remove-potential-outliers" title="Link to this heading">#</a></h2>
<p>We will inspect all values in the train set to determine if our dataset contains outliers. In the beginning, we plot data distribution using violin plot, this kind of visulization will show the general distribution.</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[4]:
</pre></div>
</div>
<div class="input_area highlight-ipython2 notranslate"><div class="highlight"><pre><span></span><span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">10</span><span class="p">,</span> <span class="mi">6</span><span class="p">))</span>
<span class="n">plt</span><span class="o">.</span><span class="n">violinplot</span><span class="p">(</span><span class="n">train</span><span class="p">[</span><span class="s1">&#39;dem&#39;</span><span class="p">])</span>
<span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="../../../_images/usage_tutorials_functional_3-3-outliers-and-kriging_6_0.png" src="../../../_images/usage_tutorials_functional_3-3-outliers-and-kriging_6_0.png" />
</div>
</div>
<blockquote>
<div><p><strong>Note</strong>: Your plot may differ from the tutorial’s. Why is that? Because we take a random sample of 2% of values, and after each iteration, the algorithm takes different points for the analysis.</p>
</div></blockquote>
<p><strong>Clarification</strong></p>
<p>Investigation of the plot tells us that our data is:</p>
<ul class="simple">
<li><p>grouped around the lowest values, and most of the values are below 50 meters</p></li>
<li><p>has (probably) two different distributions mixed, which can be a sign that the Digital Elevation Model covers multiple different types of elevation. One is grouped around 20 meters, the next roughly 50 meters</p></li>
</ul>
<p>Violin plot is suitable for the distribution analysis. Finding outliers in this plot may be challenging because we see mostly distributions. We should change a plot type to understand if outliers exist in a dataset. The excellent choice is the boxplot:</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[5]:
</pre></div>
</div>
<div class="input_area highlight-ipython2 notranslate"><div class="highlight"><pre><span></span><span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">10</span><span class="p">,</span> <span class="mi">6</span><span class="p">))</span>
<span class="n">plt</span><span class="o">.</span><span class="n">boxplot</span><span class="p">(</span><span class="n">train</span><span class="p">[</span><span class="s1">&#39;dem&#39;</span><span class="p">])</span>
<span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="../../../_images/usage_tutorials_functional_3-3-outliers-and-kriging_8_0.png" src="../../../_images/usage_tutorials_functional_3-3-outliers-and-kriging_8_0.png" />
</div>
</div>
<p><strong>Boxplot</strong> is a handy data visualization tool. Let’s analyze this plot from the bottom up to the top.</p>
<blockquote>
<div><p><strong>Note</strong>: Boxplot represents values sorted in ascending order and their statistical properties: quartiles, median, and outliers.</p>
</div></blockquote>
<ul class="simple">
<li><p>The bottom whisker (horizontal line) represents the lower range of values in our dataset</p></li>
<li><p>The box lower line is the first quartile (<em>Q1</em>) of data or, in other words, 25% of values of our dataset are below this point</p></li>
<li><p>The middle line is the median (<em>Q2</em>) of our dataset</p></li>
<li><p>The upper line is the third quartile (<em>Q3</em>) of a data or, in other words, 75% of values are below this point,</p></li>
<li><p>The top whisker represents the upper range of values in our dataset.</p></li>
<li><p>Individual points (if they exist, then we see them as points below the bottom whisker or above the top whisker) are considered outliers. They could be outliers in the upper range as well as the lower range of our data. The significant distance between Q1 and the bottom whisker or between Q3 and the top whisker indicates potential outliers. Points below or above this distance are treated as outliers. The outlier distance is calculated as <span class="math notranslate nohighlight">\(weight * (Q3 - Q1)\)</span> where we can manually set the
<code class="docutils literal notranslate"><span class="pre">weight</span></code>, but other parameters are read from data.</p></li>
</ul>
<p>We use this knowledge to remove outliers from the dataset. We will manually remove outliers from the data, assuming that outliers are placed one standard deviation from Q1 (down) and Q3 (up).</p>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[6]:
</pre></div>
</div>
<div class="input_area highlight-ipython2 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Create training set without outliers</span>

<span class="n">q1</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">quantile</span><span class="p">(</span><span class="n">train</span><span class="p">[</span><span class="s1">&#39;dem&#39;</span><span class="p">],</span> <span class="mf">0.25</span><span class="p">)</span>
<span class="n">q3</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">quantile</span><span class="p">(</span><span class="n">train</span><span class="p">[</span><span class="s1">&#39;dem&#39;</span><span class="p">],</span> <span class="mf">0.75</span><span class="p">)</span>

<span class="n">top_limit</span> <span class="o">=</span> <span class="n">q3</span> <span class="o">+</span> <span class="p">(</span><span class="n">q3</span> <span class="o">-</span> <span class="n">q1</span><span class="p">)</span>

<span class="n">train_without_outliers</span> <span class="o">=</span> <span class="n">train</span><span class="p">[</span><span class="n">train</span><span class="p">[</span><span class="s1">&#39;dem&#39;</span><span class="p">]</span> <span class="o">&lt;</span> <span class="n">top_limit</span><span class="p">]</span>
</pre></div>
</div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[7]:
</pre></div>
</div>
<div class="input_area highlight-ipython2 notranslate"><div class="highlight"><pre><span></span><span class="n">train</span><span class="p">[</span><span class="s1">&#39;dem&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">describe</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[7]:
</pre></div>
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
count    3447.000000
mean       41.335986
std        22.165907
min        14.825253
25%        20.056290
50%        39.114426
75%        56.079584
max       106.866257
Name: dem, dtype: float64
</pre></div></div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[8]:
</pre></div>
</div>
<div class="input_area highlight-ipython2 notranslate"><div class="highlight"><pre><span></span><span class="n">train_without_outliers</span><span class="p">[</span><span class="s1">&#39;dem&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">describe</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[8]:
</pre></div>
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
count    3425.000000
mean       40.971479
std        21.760020
min        14.825253
25%        20.032963
50%        38.735107
75%        55.439457
max        91.712456
Name: dem, dtype: float64
</pre></div></div>
</div>
<p><strong>Clarification</strong></p>
<p>Mean and standard deviation of transformed dataset are lower, and the maximal value is different than in the raw training set. Does this transformation affect modeling? We will see in the next steps.</p>
</section>
<section id="3.-Create-Variogram-Clouds">
<h2>3. Create Variogram Clouds<a class="headerlink" href="#3.-Create-Variogram-Clouds" title="Link to this heading">#</a></h2>
<p>Now, we are going one step further, and we will transform both datasets with- and without- outliers and calculate variogram point clouds. Then, we compare both clouds.</p>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[9]:
</pre></div>
</div>
<div class="input_area highlight-ipython2 notranslate"><div class="highlight"><pre><span></span><span class="n">step_size</span> <span class="o">=</span> <span class="mi">1000</span>  <span class="c1"># meters</span>
<span class="n">max_range</span> <span class="o">=</span> <span class="mi">10000</span>  <span class="c1"># meters</span>
</pre></div>
</div>
</div>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[10]:
</pre></div>
</div>
<div class="input_area highlight-ipython2 notranslate"><div class="highlight"><pre><span></span><span class="n">cloud_with</span> <span class="o">=</span> <span class="n">VariogramCloud</span><span class="p">(</span>
    <span class="n">ds</span><span class="o">=</span><span class="n">train</span><span class="p">[[</span><span class="s1">&#39;geometry&#39;</span><span class="p">,</span> <span class="s1">&#39;dem&#39;</span><span class="p">]],</span>
    <span class="n">step_size</span><span class="o">=</span><span class="n">step_size</span><span class="p">,</span>
    <span class="n">max_range</span><span class="o">=</span><span class="n">max_range</span>
<span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[11]:
</pre></div>
</div>
<div class="input_area highlight-ipython2 notranslate"><div class="highlight"><pre><span></span><span class="n">cloud_with</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="s1">&#39;box&#39;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="../../../_images/usage_tutorials_functional_3-3-outliers-and-kriging_17_0.png" src="../../../_images/usage_tutorials_functional_3-3-outliers-and-kriging_17_0.png" />
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[11]:
</pre></div>
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
True
</pre></div></div>
</div>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[12]:
</pre></div>
</div>
<div class="input_area highlight-ipython2 notranslate"><div class="highlight"><pre><span></span><span class="n">cloud_without</span> <span class="o">=</span> <span class="n">VariogramCloud</span><span class="p">(</span>
    <span class="n">ds</span><span class="o">=</span><span class="n">train_without_outliers</span><span class="p">[[</span><span class="s1">&#39;geometry&#39;</span><span class="p">,</span> <span class="s1">&#39;dem&#39;</span><span class="p">]],</span>
    <span class="n">step_size</span><span class="o">=</span><span class="n">step_size</span><span class="p">,</span>
    <span class="n">max_range</span><span class="o">=</span><span class="n">max_range</span>
<span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[13]:
</pre></div>
</div>
<div class="input_area highlight-ipython2 notranslate"><div class="highlight"><pre><span></span><span class="n">cloud_without</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="s1">&#39;box&#39;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="../../../_images/usage_tutorials_functional_3-3-outliers-and-kriging_19_0.png" src="../../../_images/usage_tutorials_functional_3-3-outliers-and-kriging_19_0.png" />
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[13]:
</pre></div>
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
True
</pre></div></div>
</div>
<p><strong>Clarification</strong></p>
<p>The processed dataset has lower semivariances than the raw readings, and both variograms have a similar shape.</p>
<p>In the next cell, we will check a standard deviation of semivariances for each lag.</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[14]:
</pre></div>
</div>
<div class="input_area highlight-ipython2 notranslate"><div class="highlight"><pre><span></span><span class="n">with_stats</span> <span class="o">=</span> <span class="n">cloud_with</span><span class="o">.</span><span class="n">describe</span><span class="p">()</span>
<span class="n">without_stats</span> <span class="o">=</span> <span class="n">cloud_without</span><span class="o">.</span><span class="n">describe</span><span class="p">()</span>

<span class="n">with_stds</span> <span class="o">=</span> <span class="p">[]</span>
<span class="n">without_stds</span> <span class="o">=</span> <span class="p">[]</span>
<span class="n">lags</span> <span class="o">=</span> <span class="p">[]</span>
<span class="k">for</span> <span class="n">lag</span> <span class="ow">in</span> <span class="n">with_stats</span><span class="p">:</span>
    <span class="n">lags</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">lag</span><span class="p">)</span>
    <span class="n">with_stds</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">with_stats</span><span class="p">[</span><span class="n">lag</span><span class="p">][</span><span class="s1">&#39;std&#39;</span><span class="p">])</span>
    <span class="n">without_stds</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">without_stats</span><span class="p">[</span><span class="n">lag</span><span class="p">][</span><span class="s1">&#39;std&#39;</span><span class="p">])</span>

<span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">10</span><span class="p">,</span> <span class="mi">6</span><span class="p">))</span>
<span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">lags</span><span class="p">,</span> <span class="n">with_stds</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">lags</span><span class="p">,</span> <span class="n">without_stds</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">legend</span><span class="p">([</span><span class="s1">&#39;With outliers&#39;</span><span class="p">,</span> <span class="s1">&#39;No outliers&#39;</span><span class="p">])</span>
<span class="n">plt</span><span class="o">.</span><span class="n">xlabel</span><span class="p">(</span><span class="s1">&#39;Lag&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="s1">&#39;Standard Deviation&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="../../../_images/usage_tutorials_functional_3-3-outliers-and-kriging_21_0.png" src="../../../_images/usage_tutorials_functional_3-3-outliers-and-kriging_21_0.png" />
</div>
</div>
<p><strong>Clarification</strong></p>
<p>Data cleaning brings the best outcomes to more distant lags. Why? Because those lags group the largest sets of point pairs, and outlier influence is amplified by number of pairs with those outliers.</p>
<p>It doesn’t mean that the bottom semivariogram is better, especially when we consider the fact, that closest bins are those most important. We should proceed with experiments.</p>
</section>
<section id="4.-Remove-outliers-from-the-point-cloud">
<h2>4. Remove outliers from the point cloud<a class="headerlink" href="#4.-Remove-outliers-from-the-point-cloud" title="Link to this heading">#</a></h2>
<p>In this step, we will use <code class="docutils literal notranslate"><span class="pre">VariogramCloud</span></code> method <code class="docutils literal notranslate"><span class="pre">.remove_outliers()</span></code> to build two additional variogram point clouds from the raw and processed datasets.</p>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[15]:
</pre></div>
</div>
<div class="input_area highlight-ipython2 notranslate"><div class="highlight"><pre><span></span><span class="n">cloud_with_rem</span> <span class="o">=</span> <span class="n">cloud_with</span><span class="o">.</span><span class="n">remove_outliers</span><span class="p">(</span>
    <span class="n">method</span><span class="o">=</span><span class="s1">&#39;zscore&#39;</span><span class="p">,</span>
    <span class="n">z_lower_limit</span><span class="o">=-</span><span class="mi">2</span><span class="p">,</span>
    <span class="n">z_upper_limit</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span>
    <span class="n">inplace</span><span class="o">=</span><span class="kc">False</span>
<span class="p">)</span>

<span class="n">cloud_without_rem</span> <span class="o">=</span> <span class="n">cloud_without</span><span class="o">.</span><span class="n">remove_outliers</span><span class="p">(</span>
    <span class="n">method</span><span class="o">=</span><span class="s1">&#39;zscore&#39;</span><span class="p">,</span>
    <span class="n">z_lower_limit</span><span class="o">=-</span><span class="mi">2</span><span class="p">,</span>
    <span class="n">z_upper_limit</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span>
    <span class="n">inplace</span><span class="o">=</span><span class="kc">False</span>
<span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[16]:
</pre></div>
</div>
<div class="input_area highlight-ipython2 notranslate"><div class="highlight"><pre><span></span><span class="n">fig</span><span class="p">,</span> <span class="n">ax</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="n">nrows</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span> <span class="n">ncols</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span> <span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">16</span><span class="p">,</span> <span class="mi">14</span><span class="p">))</span>

<span class="n">ax</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">boxplot</span><span class="p">(</span><span class="nb">list</span><span class="p">(</span><span class="n">cloud_with</span><span class="o">.</span><span class="n">semivariances</span><span class="o">.</span><span class="n">values</span><span class="p">()))</span>
<span class="n">ax</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="s1">&#39;Raw dataset&#39;</span><span class="p">)</span>
<span class="n">ax</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="s1">&#39;Lag number&#39;</span><span class="p">)</span>
<span class="n">ax</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="s1">&#39;Semivariance value&#39;</span><span class="p">)</span>

<span class="n">ax</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">boxplot</span><span class="p">(</span><span class="nb">list</span><span class="p">(</span><span class="n">cloud_without</span><span class="o">.</span><span class="n">semivariances</span><span class="o">.</span><span class="n">values</span><span class="p">()))</span>
<span class="n">ax</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="s1">&#39;Outliers removed from semivariogram&#39;</span><span class="p">)</span>
<span class="n">ax</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="s1">&#39;Lag number&#39;</span><span class="p">)</span>
<span class="n">ax</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="s1">&#39;Semivariance value&#39;</span><span class="p">)</span>

<span class="n">ax</span><span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">boxplot</span><span class="p">(</span><span class="nb">list</span><span class="p">(</span><span class="n">cloud_with_rem</span><span class="o">.</span><span class="n">semivariances</span><span class="o">.</span><span class="n">values</span><span class="p">()))</span>
<span class="n">ax</span><span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="s1">&#39;Cleaned dataset using z-score for outliers detection&#39;</span><span class="p">)</span>
<span class="n">ax</span><span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="s1">&#39;Lag number&#39;</span><span class="p">)</span>
<span class="n">ax</span><span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="s1">&#39;Semivariance value&#39;</span><span class="p">)</span>

<span class="n">ax</span><span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">boxplot</span><span class="p">(</span><span class="nb">list</span><span class="p">(</span><span class="n">cloud_without_rem</span><span class="o">.</span><span class="n">semivariances</span><span class="o">.</span><span class="n">values</span><span class="p">()))</span>
<span class="n">ax</span><span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="s1">&#39;Outliers removed (1) from semivariogram and then using z-score (2)&#39;</span><span class="p">)</span>
<span class="n">ax</span><span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="s1">&#39;Lag number&#39;</span><span class="p">)</span>
<span class="n">ax</span><span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="s1">&#39;Semivariance value&#39;</span><span class="p">)</span>

<span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="../../../_images/usage_tutorials_functional_3-3-outliers-and-kriging_25_0.png" src="../../../_images/usage_tutorials_functional_3-3-outliers-and-kriging_25_0.png" />
</div>
</div>
<p><strong>Clarification</strong>: Comparison of multiple variogram clouds could be challenging. We see that the largest semivariances are present in the raw data. Heavily processed data has the lowest number of outliers. The medians in each dataset are distributed over a similar pattern. How is it similar? We can check if we transform the variogram point cloud into the experimental semivariogram. <code class="docutils literal notranslate"><span class="pre">VariogramCloud</span></code> class has a method for it: <code class="docutils literal notranslate"><span class="pre">.average_semivariance()</span></code>. We use it and compare four plots of
semivariances to gain more insight into the transformations.</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[17]:
</pre></div>
</div>
<div class="input_area highlight-ipython2 notranslate"><div class="highlight"><pre><span></span><span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">14</span><span class="p">,</span> <span class="mi">6</span><span class="p">))</span>
<span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">cloud_with</span><span class="o">.</span><span class="n">average_semivariance</span><span class="p">()[:,</span> <span class="mi">1</span><span class="p">],</span> <span class="n">c</span><span class="o">=</span><span class="s1">&#39;#a6611a&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">cloud_without</span><span class="o">.</span><span class="n">average_semivariance</span><span class="p">()[:,</span> <span class="mi">1</span><span class="p">],</span> <span class="n">c</span><span class="o">=</span><span class="s1">&#39;#dfc27d&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">cloud_with_rem</span><span class="o">.</span><span class="n">average_semivariance</span><span class="p">()[:,</span> <span class="mi">1</span><span class="p">],</span> <span class="s1">&#39;--&#39;</span><span class="p">,</span> <span class="n">c</span><span class="o">=</span><span class="s1">&#39;#80cdc1&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">cloud_without_rem</span><span class="o">.</span><span class="n">average_semivariance</span><span class="p">()[:,</span> <span class="mi">1</span><span class="p">],</span> <span class="s1">&#39;--&#39;</span><span class="p">,</span> <span class="n">c</span><span class="o">=</span><span class="s1">&#39;#018571&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">title</span><span class="p">(</span><span class="s1">&#39;Comparison of experimental semivariograms created with the different data preprocessing techniques&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="s1">&#39;Semivariance&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">xlabel</span><span class="p">(</span><span class="s1">&#39;Lag number&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">legend</span><span class="p">([</span><span class="s1">&#39;Raw&#39;</span><span class="p">,</span> <span class="s1">&#39;Raw | Filtered Semivariances&#39;</span><span class="p">,</span> <span class="s1">&#39;Preprocessed&#39;</span><span class="p">,</span> <span class="s1">&#39;Preprocessed | Filtered Semivariances&#39;</span><span class="p">])</span>
<span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="../../../_images/usage_tutorials_functional_3-3-outliers-and-kriging_27_0.png" src="../../../_images/usage_tutorials_functional_3-3-outliers-and-kriging_27_0.png" />
</div>
</div>
<p><strong>Clarification</strong>: An understanding of those plots is a challenging task. Let’s divide reasoning into multiple points:</p>
<ul class="simple">
<li><p>Raw dataset and preprocessed raw dataset show a similar pattern. The differences are more pronounced for the distant lags than for the closest point pairs (there are more point pairs, thus those lags have greater chance having outlier values)</p></li>
<li><p>Datasets with the cleaned variograms are different from the raw data. The absolute semivariance values per lag are smaller, and the semivariogram line is slightly different.</p></li>
<li><p>The differences between semivariograms are primarily visible at larger distances, and differences are minor for the closest point pairs.</p></li>
<li><p>Filtering semivariance sharply lowers the weights per lag, and removing outliers from the input data only slightly corrects the variogram.</p></li>
<li><p>Both preprocessed and preprocessed and cleaned datasets are the same. Why? Probably after initial preprocessing step there are no outliers at all!</p></li>
</ul>
<p>Let’s check how different variograms work with the real-world data.</p>
</section>
<section id="5.-Kriging-Models-based-on-different-variograms">
<h2>5. Kriging Models based on different variograms<a class="headerlink" href="#5.-Kriging-Models-based-on-different-variograms" title="Link to this heading">#</a></h2>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[18]:
</pre></div>
</div>
<div class="input_area highlight-ipython2 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Fit different semivariogram models into prepared datasets and variograms</span>

<span class="c1"># Raw</span>
<span class="n">raw_theo</span> <span class="o">=</span> <span class="n">build_theoretical_variogram</span><span class="p">(</span>
    <span class="n">experimental_variogram</span><span class="o">=</span><span class="n">cloud_with</span><span class="o">.</span><span class="n">average_semivariance</span><span class="p">(),</span>
    <span class="n">models_group</span><span class="o">=</span><span class="s1">&#39;linear&#39;</span><span class="p">,</span>
    <span class="n">nugget</span><span class="o">=</span><span class="mi">0</span>
<span class="p">)</span>

<span class="c1"># Raw with cleaned variogram</span>
<span class="n">raw_theo_no_out</span> <span class="o">=</span> <span class="n">build_theoretical_variogram</span><span class="p">(</span>
    <span class="n">experimental_variogram</span><span class="o">=</span><span class="n">cloud_without</span><span class="o">.</span><span class="n">average_semivariance</span><span class="p">(),</span>
    <span class="n">models_group</span><span class="o">=</span><span class="s1">&#39;linear&#39;</span><span class="p">,</span>
    <span class="n">nugget</span><span class="o">=</span><span class="mi">0</span>
<span class="p">)</span>

<span class="c1"># Preprocessed</span>
<span class="n">prep_theo</span> <span class="o">=</span> <span class="n">build_theoretical_variogram</span><span class="p">(</span>
    <span class="n">experimental_variogram</span><span class="o">=</span><span class="n">cloud_with_rem</span><span class="o">.</span><span class="n">average_semivariance</span><span class="p">(),</span>
    <span class="n">models_group</span><span class="o">=</span><span class="s1">&#39;linear&#39;</span><span class="p">,</span>
    <span class="n">nugget</span><span class="o">=</span><span class="mi">0</span>
<span class="p">)</span>

<span class="c1"># Preprocessed with cleaned variogram</span>
<span class="n">prep_theo_no_out</span> <span class="o">=</span> <span class="n">build_theoretical_variogram</span><span class="p">(</span>
    <span class="n">experimental_variogram</span><span class="o">=</span><span class="n">cloud_without_rem</span><span class="o">.</span><span class="n">average_semivariance</span><span class="p">(),</span>
    <span class="n">models_group</span><span class="o">=</span><span class="s1">&#39;linear&#39;</span><span class="p">,</span>
    <span class="n">nugget</span><span class="o">=</span><span class="mi">0</span>
<span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[19]:
</pre></div>
</div>
<div class="input_area highlight-ipython2 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Set Kriging models</span>

<span class="n">unknown_locs</span> <span class="o">=</span> <span class="n">test</span><span class="p">[</span><span class="s1">&#39;geometry&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">to_numpy</span><span class="p">()</span>

<span class="n">raw_interpolated</span> <span class="o">=</span> <span class="n">interpolate_points</span><span class="p">(</span>
    <span class="n">theoretical_model</span><span class="o">=</span><span class="n">raw_theo</span><span class="p">,</span>
    <span class="n">known_locations</span><span class="o">=</span><span class="n">train</span><span class="p">[[</span><span class="s1">&#39;geometry&#39;</span><span class="p">,</span> <span class="s1">&#39;dem&#39;</span><span class="p">]],</span>
    <span class="n">unknown_locations</span><span class="o">=</span><span class="n">unknown_locs</span><span class="p">,</span>
    <span class="n">progress_bar</span><span class="o">=</span><span class="kc">True</span>
<span class="p">)</span>

<span class="n">raw_no_interpolated</span> <span class="o">=</span> <span class="n">interpolate_points</span><span class="p">(</span>
    <span class="n">theoretical_model</span><span class="o">=</span><span class="n">raw_theo_no_out</span><span class="p">,</span>
    <span class="n">known_locations</span><span class="o">=</span><span class="n">train</span><span class="p">[[</span><span class="s1">&#39;geometry&#39;</span><span class="p">,</span> <span class="s1">&#39;dem&#39;</span><span class="p">]],</span>
    <span class="n">unknown_locations</span><span class="o">=</span><span class="n">unknown_locs</span><span class="p">,</span>
    <span class="n">progress_bar</span><span class="o">=</span><span class="kc">True</span>
<span class="p">)</span>

<span class="n">proc_raw_interpolated</span> <span class="o">=</span> <span class="n">interpolate_points</span><span class="p">(</span>
    <span class="n">theoretical_model</span><span class="o">=</span><span class="n">prep_theo</span><span class="p">,</span>
    <span class="n">known_locations</span><span class="o">=</span><span class="n">train</span><span class="p">[[</span><span class="s1">&#39;geometry&#39;</span><span class="p">,</span> <span class="s1">&#39;dem&#39;</span><span class="p">]],</span>
    <span class="n">unknown_locations</span><span class="o">=</span><span class="n">unknown_locs</span><span class="p">,</span>
    <span class="n">progress_bar</span><span class="o">=</span><span class="kc">True</span>
<span class="p">)</span>

<span class="n">proc_no_interpolated</span> <span class="o">=</span> <span class="n">interpolate_points</span><span class="p">(</span>
    <span class="n">theoretical_model</span><span class="o">=</span><span class="n">prep_theo_no_out</span><span class="p">,</span>
    <span class="n">known_locations</span><span class="o">=</span><span class="n">train</span><span class="p">[[</span><span class="s1">&#39;geometry&#39;</span><span class="p">,</span> <span class="s1">&#39;dem&#39;</span><span class="p">]],</span>
    <span class="n">unknown_locations</span><span class="o">=</span><span class="n">unknown_locs</span><span class="p">,</span>
    <span class="n">progress_bar</span><span class="o">=</span><span class="kc">True</span>
<span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area stderr docutils container">
<div class="highlight"><pre>
100%|██████████| 3448/3448 [00:14&lt;00:00, 243.12it/s]
100%|██████████| 3448/3448 [00:14&lt;00:00, 245.16it/s]
100%|██████████| 3448/3448 [00:15&lt;00:00, 227.41it/s]
100%|██████████| 3448/3448 [00:12&lt;00:00, 271.93it/s]
</pre></div></div>
</div>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[20]:
</pre></div>
</div>
<div class="input_area highlight-ipython2 notranslate"><div class="highlight"><pre><span></span><span class="c1"># estimate deviations using squared error</span>

<span class="n">results</span> <span class="o">=</span> <span class="n">test</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
<span class="n">results</span><span class="p">[</span><span class="s1">&#39;raw&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">raw_interpolated</span><span class="p">[:,</span> <span class="mi">0</span><span class="p">]</span>
<span class="n">results</span><span class="p">[</span><span class="s1">&#39;raw_variogram_filtering&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">raw_no_interpolated</span><span class="p">[:,</span> <span class="mi">0</span><span class="p">]</span>
<span class="n">results</span><span class="p">[</span><span class="s1">&#39;point_cloud_filtered&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">proc_raw_interpolated</span><span class="p">[:,</span> <span class="mi">0</span><span class="p">]</span>
<span class="n">results</span><span class="p">[</span><span class="s1">&#39;all_filtered&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">proc_no_interpolated</span><span class="p">[:,</span> <span class="mi">0</span><span class="p">]</span>
<br/></pre></div>
</div>
</div>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[21]:
</pre></div>
</div>
<div class="input_area highlight-ipython2 notranslate"><div class="highlight"><pre><span></span><span class="n">results</span><span class="p">[</span><span class="s1">&#39;d-raw&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="p">(</span><span class="n">results</span><span class="p">[</span><span class="s1">&#39;dem&#39;</span><span class="p">]</span> <span class="o">-</span> <span class="n">results</span><span class="p">[</span><span class="s1">&#39;raw&#39;</span><span class="p">])</span><span class="o">**</span><span class="mi">2</span>
<span class="n">results</span><span class="p">[</span><span class="s1">&#39;d-raw_variogram_filtering&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="p">(</span><span class="n">results</span><span class="p">[</span><span class="s1">&#39;dem&#39;</span><span class="p">]</span> <span class="o">-</span> <span class="n">results</span><span class="p">[</span><span class="s1">&#39;raw_variogram_filtering&#39;</span><span class="p">])</span><span class="o">**</span><span class="mi">2</span>
<span class="n">results</span><span class="p">[</span><span class="s1">&#39;d-point_cloud_filtered&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="p">(</span><span class="n">results</span><span class="p">[</span><span class="s1">&#39;dem&#39;</span><span class="p">]</span> <span class="o">-</span> <span class="n">results</span><span class="p">[</span><span class="s1">&#39;point_cloud_filtered&#39;</span><span class="p">])</span><span class="o">**</span><span class="mi">2</span>
<span class="n">results</span><span class="p">[</span><span class="s1">&#39;d-all_filtered&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="p">(</span><span class="n">results</span><span class="p">[</span><span class="s1">&#39;dem&#39;</span><span class="p">]</span> <span class="o">-</span> <span class="n">results</span><span class="p">[</span><span class="s1">&#39;all_filtered&#39;</span><span class="p">])</span><span class="o">**</span><span class="mi">2</span>
</pre></div>
</div>
</div>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[22]:
</pre></div>
</div>
<div class="input_area highlight-ipython2 notranslate"><div class="highlight"><pre><span></span><span class="n">stats</span> <span class="o">=</span> <span class="n">results</span><span class="p">[</span>
    <span class="p">[</span>
        <span class="s1">&#39;d-raw&#39;</span><span class="p">,</span>
        <span class="s1">&#39;d-raw_variogram_filtering&#39;</span><span class="p">,</span>
        <span class="s1">&#39;d-point_cloud_filtered&#39;</span><span class="p">,</span>
        <span class="s1">&#39;d-all_filtered&#39;</span>
    <span class="p">]</span>
<span class="p">]</span><span class="o">.</span><span class="n">describe</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[23]:
</pre></div>
</div>
<div class="input_area highlight-ipython2 notranslate"><div class="highlight"><pre><span></span><span class="n">stats</span><span class="o">.</span><span class="n">loc</span><span class="p">[[</span><span class="s1">&#39;mean&#39;</span><span class="p">,</span> <span class="s1">&#39;std&#39;</span><span class="p">,</span> <span class="s1">&#39;50%&#39;</span><span class="p">,</span> <span class="s1">&#39;min&#39;</span><span class="p">,</span> <span class="s1">&#39;max&#39;</span><span class="p">]]</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[23]:
</pre></div>
</div>
<div class="output_area rendered_html docutils container">
<div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>d-raw</th>
      <th>d-raw_variogram_filtering</th>
      <th>d-point_cloud_filtered</th>
      <th>d-all_filtered</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>mean</th>
      <td>8.278387e+00</td>
      <td>8.278387e+00</td>
      <td>8.278387e+00</td>
      <td>8.278387e+00</td>
    </tr>
    <tr>
      <th>std</th>
      <td>2.740584e+01</td>
      <td>2.740584e+01</td>
      <td>2.740584e+01</td>
      <td>2.740584e+01</td>
    </tr>
    <tr>
      <th>50%</th>
      <td>8.863351e-01</td>
      <td>8.863351e-01</td>
      <td>8.863351e-01</td>
      <td>8.863351e-01</td>
    </tr>
    <tr>
      <th>min</th>
      <td>1.372719e-10</td>
      <td>1.372719e-10</td>
      <td>1.372719e-10</td>
      <td>1.372719e-10</td>
    </tr>
    <tr>
      <th>max</th>
      <td>6.869088e+02</td>
      <td>6.869088e+02</td>
      <td>6.869088e+02</td>
      <td>6.869088e+02</td>
    </tr>
  </tbody>
</table>
</div></div>
</div>
<p>The view of this table may be different each time you run this tutorial (and it is related to the training-test division process). In some cases, you may get better results for the cleaned dataset; for others, results will be better for raw data. That’s why we should always have a validation set to compare different scenarios. The other idea is to use all the models and create a distribution of predictions and errors per point - we can use it later for decisions.</p>
<blockquote>
<div><p>NOTE: The example in this tutorial is Digital Elevation Model from Copernicus Land Monitoring Services. Looking at rather uniform results, you shouldn’t get the impression that raw data preprocessing and filtering are useless. There are cases where the sensor may produce unreliable and biased results, such as a satellite camera’s saturated pixel. Removing it with the specific noise-filtering algorithm before the variogram fitting might give you a better model.</p>
</div></blockquote>
</section>
<section id="Changelog">
<h2>Changelog<a class="headerlink" href="#Changelog" title="Link to this heading">#</a></h2>
<div class="pst-scrollable-table-container"><table class="table">
<thead>
<tr class="row-odd"><th class="head"><p>Date</p></th>
<th class="head"><p>Changes</p></th>
<th class="head"><p>Author</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><p>2025-05-17</p></td>
<td><p>Tutorial has been adapted to the 1.0 release</p></td>
<td><p>&#64;SimonMolinsky (Szymon Moliński)</p></td>
</tr>
</tbody>
</table>
</div>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[ ]:
</pre></div>
</div>
<div class="input_area highlight-ipython2 notranslate"><div class="highlight"><pre><span></span>
</pre></div>
</div>
</div>
</section>
</section>


                </article>
              
              
              
              
              
                <footer class="prev-next-footer d-print-none">
                  
<div class="prev-next-area">
    <a class="left-prev"
       href="3-2-benchmark-kriging.html"
       title="previous page">
      <i class="fa-solid fa-angle-left"></i>
      <div class="prev-next-info">
        <p class="prev-next-subtitle">previous</p>
        <p class="prev-next-title">Benchmarking Kriging</p>
      </div>
    </a>
    <a class="right-next"
       href="3-4-directional-ordinary-kriging.html"
       title="next page">
      <div class="prev-next-info">
        <p class="prev-next-subtitle">next</p>
        <p class="prev-next-title">Directional Ordinary Kriging</p>
      </div>
      <i class="fa-solid fa-angle-right"></i>
    </a>
</div>
                </footer>
              
            </div>
            
            
              
                <dialog id="pst-secondary-sidebar-modal"></dialog>
                <div id="pst-secondary-sidebar" class="bd-sidebar-secondary bd-toc"><div class="sidebar-secondary-items sidebar-secondary__inner">


  <div class="sidebar-secondary-item">
<div
    id="pst-page-navigation-heading-2"
    class="page-toc tocsection onthispage">
    <i class="fa-solid fa-list"></i> On this page
  </div>
  <nav class="bd-toc-nav page-toc" aria-labelledby="pst-page-navigation-heading-2">
    <ul class="visible nav section-nav flex-column">
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#Prerequisites">Prerequisites</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#Table-of-contents">Table of contents</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#1.-Prepare-data">1. Prepare data</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#2.-Analyze-data-distribution-and-remove-potential-outliers">2. Analyze data distribution and remove potential outliers</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#3.-Create-Variogram-Clouds">3. Create Variogram Clouds</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#4.-Remove-outliers-from-the-point-cloud">4. Remove outliers from the point cloud</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#5.-Kriging-Models-based-on-different-variograms">5. Kriging Models based on different variograms</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#Changelog">Changelog</a></li>
</ul>
  </nav></div>

  <div class="sidebar-secondary-item">
  <div role="note" aria-label="source link">
    <h3>This Page</h3>
    <ul class="this-page-menu">
      <li><a href="../../../_sources/usage/tutorials/functional/3-3-outliers-and-kriging.ipynb.txt"
            rel="nofollow">Show Source</a></li>
    </ul>
   </div></div>

</div></div>
              
            
          </div>
          <footer class="bd-footer-content">
            
          </footer>
        
      </main>
    </div>
  </div>
  
  <!-- Scripts loaded after <body> so the DOM is not blocked -->
  <script defer src="../../../_static/scripts/bootstrap.js?digest=8878045cc6db502f8baf"></script>
<script defer src="../../../_static/scripts/pydata-sphinx-theme.js?digest=8878045cc6db502f8baf"></script>

  <footer class="bd-footer">
<div class="bd-footer__inner bd-page-width">
  
    <div class="footer-items__start">
      
        <div class="footer-item">

  <p class="copyright">
    
      © Copyright 2025, Szymon Moliński.
      <br/>
    
  </p>
</div>
      
        <div class="footer-item">

  <p class="sphinx-version">
    Created using <a href="https://www.sphinx-doc.org/">Sphinx</a> 8.1.3.
    <br/>
  </p>
</div>
      
    </div>
  
  
  
    <div class="footer-items__end">
      
        <div class="footer-item">
<p class="theme-version">
  <!-- # L10n: Setting the PST URL as an argument as this does not need to be localized -->
  Built with the <a href="https://pydata-sphinx-theme.readthedocs.io/en/stable/index.html">PyData Sphinx Theme</a> 0.16.1.
</p></div>
      
    </div>
  
</div>

  </footer>
  </body>
</html>